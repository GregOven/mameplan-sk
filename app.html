<!doctype html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerlach â€“ PripravenosÅ¥ na krÃ­zovÃ© situÃ¡cie</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=Lexend:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --c-bg: #f5f3ee;
      --c-surface: #ffffff;
      --c-border: #e2ddd5;
      --c-text: #1a1714;
      --c-muted: #6b6560;
      --c-accent: #d4501a;
      --c-accent-light: #fdf0eb;
      --c-green: #2a7a4b;
      --c-green-light: #eaf4ee;
      --c-amber: #b45309;
      --c-amber-light: #fef3c7;
    }
    * { box-sizing: border-box; }
    body { font-family: 'Lexend', sans-serif; background: var(--c-bg); color: var(--c-text); font-size: 110%; }
    h1, h2, h3, .font-display { font-family: 'DM Sans', 'Lexend', sans-serif; letter-spacing: -0.025em; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN SYSTEM: SHADOWS & TRANSITIONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .shadow-sm { box-shadow: 0 1px 2px rgba(26,23,20,0.04), 0 1px 3px rgba(26,23,20,0.06); }
    .shadow-md { box-shadow: 0 2px 8px rgba(26,23,20,0.06), 0 4px 16px rgba(26,23,20,0.04); }
    .shadow-lg { box-shadow: 0 4px 12px rgba(26,23,20,0.08), 0 8px 32px rgba(26,23,20,0.06); }

    /* Tab switch stagger animation */
    .tab-pane.active > * {
      animation: fadeSlideIn 0.35s ease both;
    }
    .tab-pane.active > *:nth-child(1) { animation-delay: 0s; }
    .tab-pane.active > *:nth-child(2) { animation-delay: 0.05s; }
    .tab-pane.active > *:nth-child(3) { animation-delay: 0.1s; }
    .tab-pane.active > *:nth-child(4) { animation-delay: 0.15s; }
    .tab-pane.active > *:nth-child(5) { animation-delay: 0.2s; }
    .tab-pane.active > *:nth-child(6) { animation-delay: 0.25s; }
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Progress bar living gradient */
    .progress-fill::after {
      content: '';
      position: absolute; inset: 0;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.25) 50%, transparent 100%);
      animation: shimmer 2.5s ease-in-out infinite;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Confetti canvas */
    #confettiCanvas {
      position: fixed; inset: 0; z-index: 9999;
      pointer-events: none;
    }

    /* Easter egg: Tatry panorama */
    .easter-tatry {
      position: fixed; inset: 0; z-index: 10000;
      background: linear-gradient(180deg, #1a1b3a 0%, #2d3561 30%, #4a6fa5 60%, #87CEEB 100%);
      display: none; align-items: center; justify-content: center;
      flex-direction: column; cursor: pointer;
      animation: tatryFadeIn 0.6s ease;
    }
    .easter-tatry.visible { display: flex; }
    @keyframes tatryFadeIn {
      from { opacity: 0; } to { opacity: 1; }
    }
    .easter-tatry-mountains {
      width: 100%; max-width: 800px; height: 200px; position: relative;
    }
    .easter-tatry-quote {
      color: white; font-family: 'DM Sans', sans-serif;
      font-size: 1.5rem; font-weight: 700; text-align: center;
      margin-top: 2rem; padding: 0 2rem;
      text-shadow: 0 2px 12px rgba(0,0,0,0.3);
      letter-spacing: -0.02em;
    }
    .easter-tatry-sub {
      color: rgba(255,255,255,0.6); font-size: 0.85rem;
      margin-top: 1rem; font-family: 'Lexend', sans-serif;
    }

    .login-screen {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--c-bg);
      padding: 2rem;
      position: relative;
      overflow: hidden;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DEMO BANNER + VERSION BADGE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .demo-banner {
      display: none;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-bottom: 1px solid #f59e0b;
      padding: 0.5rem 1rem;
      text-align: center;
      font-size: 0.8rem;
      font-weight: 500;
      color: #92400e;
      /* StatickÃ½ banner â€” scrolluje preÄ. Verzia badge v headeri ostÃ¡va. */
    }
    .demo-banner.visible { display: flex; align-items: center; justify-content: center; gap: 0.75rem; flex-wrap: wrap; }
    .demo-banner a {
      display: inline-flex; align-items: center; gap: 0.25rem;
      background: #92400e; color: #fff;
      padding: 0.25rem 0.75rem; border-radius: 99px;
      font-size: 0.72rem; font-weight: 700;
      text-decoration: none; transition: background 0.15s;
    }
    .demo-banner a:hover { background: #78350f; }
    .version-badge {
      display: inline-flex; align-items: center; gap: 0.375rem;
      font-size: 0.65rem; font-weight: 600;
      padding: 0.15rem 0.5rem;
      border-radius: 99px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    .version-badge.beta {
      background: var(--c-accent-light);
      color: var(--c-accent);
      border: 1px solid rgba(212,80,26,0.2);
    }
    .version-badge.demo-badge {
      background: #fef3c7;
      color: #92400e;
      border: 1px solid #f59e0b;
    }
    /* Demo mode: badge in header serves as persistent reminder */
    .login-screen::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 120px;
      opacity: 0.06;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120'%3E%3Cpath d='M0 120 L80 70 L130 90 L200 40 L260 65 L330 20 L380 50 L440 10 L500 45 L560 15 L620 55 L680 25 L740 60 L800 35 L860 70 L920 45 L980 75 L1040 50 L1100 80 L1160 55 L1200 70 L1200 120Z' fill='%231a1714'/%3E%3C/svg%3E") no-repeat bottom center;
      background-size: cover;
      pointer-events: none;
    }
    .login-card {
      background: var(--c-surface);
      border: 1px solid var(--c-border);
      border-radius: 1.5rem;
      padding: 3rem 2.5rem;
      max-width: 420px;
      width: 100%;
      text-align: center;
      box-shadow: 0 4px 24px rgba(0,0,0,0.06);
    }
    .logo-mark {
      width: 64px; height: 64px;
      background: var(--c-accent);
      border-radius: 1rem;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 1.5rem;
      font-size: 1.75rem;
    }
    .btn-google {
      display: flex; align-items: center; justify-content: center; gap: 0.75rem;
      width: 100%;
      padding: 0.875rem 1.5rem;
      border: 1.5px solid var(--c-border);
      border-radius: 0.875rem;
      background: var(--c-surface);
      color: var(--c-text);
      font-family: 'Lexend', sans-serif;
      font-size: 0.9375rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn-google:hover { background: var(--c-bg); border-color: #c5c0b8; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    #btnDemoLogin:hover { background: #fef3c7 !important; border-color: #d97706 !important; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(245,158,11,0.15); }
    .btn-google svg { flex-shrink: 0; }

    .app-header {
      background: var(--c-surface);
      border-bottom: 1px solid var(--c-border);
      position: sticky; top: 0; z-index: 50;
    }
    .app-header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
      height: 60px;
    }
    .app-header-logo { display: flex; align-items: center; gap: 0.75rem; }
    .app-logo-sm {
      width: 32px; height: 32px;
      background: var(--c-accent);
      border-radius: 0.5rem;
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem; color: white;
    }

    .card {
      background: var(--c-surface);
      border: 1px solid var(--c-border);
      border-radius: 1.25rem;
      padding: 1.25rem;
      box-shadow: 0 1px 3px rgba(26,23,20,0.04), 0 2px 8px rgba(26,23,20,0.03);
      transition: box-shadow 0.25s ease, transform 0.25s ease;
    }
    .card:hover {
      box-shadow: 0 2px 8px rgba(26,23,20,0.06), 0 4px 16px rgba(26,23,20,0.04);
    }

    .progress-bar { height: 8px; border-radius: 999px; background: #ede9e3; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 999px; transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; overflow: hidden; }

    .cat-card {
      background: var(--c-surface);
      border: 2px solid var(--c-border);
      border-radius: 1.25rem;
      padding: 1rem;
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease, border-color 0.2s ease, background 0.2s ease;
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .cat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.11), inset 0 1px 0 rgba(255,255,255,0.8);
    }
    .cat-card.selected {
      transform: translateY(-5px);
      box-shadow: 0 10px 28px rgba(0,0,0,0.14);
      border-width: 3px;
    }

    .item-row {
      background: var(--c-surface);
      border: 1px solid var(--c-border);
      border-radius: 0.875rem;
      padding: 0.875rem 1rem;
      display: flex; align-items: flex-start; gap: 0.75rem;
      transition: background 0.1s;
    }
    .item-row:hover { background: #faf9f7; }

    .badge {
      display: inline-flex; align-items: center;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.7rem; font-weight: 600;
      border: 1px solid;
    }
    .badge-red { background: #fef2f2; color: #991b1b; border-color: #fecaca; }
    .badge-amber { background: var(--c-amber-light); color: var(--c-amber); border-color: #fcd34d; }
    .badge-gray { background: #f9fafb; color: #6b7280; border-color: #e5e7eb; }
    .badge-green { background: var(--c-green-light); color: var(--c-green); border-color: #86efac; }

    .btn-primary {
      background: var(--c-text); color: white;
      border: none; border-radius: 0.75rem;
      padding: 0.625rem 1.125rem;
      font-size: 0.875rem; font-weight: 500;
      cursor: pointer; transition: background 0.15s;
      font-family: 'Lexend', sans-serif;
    }
    .btn-primary:hover { background: #333; }
    .btn-danger {
      background: #fee2e2; color: #991b1b;
      border: 1px solid #fecaca;
      border-radius: 0.75rem;
      padding: 0.5rem 0.875rem;
      font-size: 0.8rem; font-weight: 500;
      cursor: pointer; transition: background 0.15s;
      font-family: 'Lexend', sans-serif;
    }
    .btn-danger:hover { background: #fecaca; }
    .btn-ghost {
      background: transparent; color: var(--c-muted);
      border: 1px solid var(--c-border);
      border-radius: 0.75rem;
      padding: 0.5rem 0.875rem;
      font-size: 0.8rem;
      cursor: pointer; transition: all 0.15s;
      font-family: 'Lexend', sans-serif;
    }
    .btn-ghost:hover { background: var(--c-bg); color: var(--c-text); }

    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.4);
      display: none; align-items: center; justify-content: center;
      padding: 1rem; z-index: 100;
      overscroll-behavior: contain;
    }
    .modal-overlay.open { display: flex; }
    .modal-box {
      background: var(--c-surface);
      border: 1px solid var(--c-border);
      border-radius: 1.5rem;
      padding: 1.5rem;
      width: 100%; max-width: 560px;
      max-height: 90vh; overflow-y: auto;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    }

    input[type="text"], input[type="number"], input[type="date"], input[type="url"], select, textarea {
      width: 100%;
      background: white;
      border: 1.5px solid var(--c-border);
      border-radius: 0.75rem;
      padding: 0.625rem 0.875rem;
      font-family: 'Lexend', sans-serif;
      font-size: 0.9rem;
      color: var(--c-text);
      transition: border-color 0.15s;
      outline: none;
    }
    input:focus, select:focus, textarea:focus { border-color: var(--c-accent); }

    .limit-banner {
      background: linear-gradient(135deg, #1a1714 0%, #2d2926 100%);
      color: white;
      border-radius: 1rem;
      padding: 1rem 1.25rem;
      display: flex; align-items: center; gap: 1rem;
    }

    .user-avatar {
      width: 32px; height: 32px;
      border-radius: 50%;
      background: var(--c-accent);
      display: flex; align-items: center; justify-content: center;
      color: white; font-weight: 700; font-size: 0.875rem;
      overflow: hidden;
    }
    .user-avatar img { width: 100%; height: 100%; object-fit: cover; }

    .sync-indicator {
      display: inline-flex; align-items: center; gap: 0.375rem;
      font-size: 0.75rem; color: var(--c-muted);
    }
    .sync-dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: #d1d5db;
    }
    .sync-dot.synced { background: var(--c-green); }
    .sync-dot.syncing { background: #f59e0b; animation: pulse 1s infinite; }

    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }

    .water-card {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border: 1.5px solid #bfdbfe;
      border-radius: 1rem;
      padding: 1.25rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PRVÃ POMOC
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .fa-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.75rem;
    }
    .fa-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 1rem 0.5rem;
      border-radius: 1rem;
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease, background 0.15s ease;
      background: var(--c-surface);
      border: 1.5px solid var(--c-border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .fa-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.10);
      border-color: #d4501a;
    }
    .fa-card:active { transform: translateY(-1px); }
    .fa-icon {
      width: 52px; height: 52px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      flex-shrink: 0;
    }
    .fa-card-label {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--c-text);
      line-height: 1.3;
    }
    .fa-modal-step {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--c-border);
    }
    .fa-modal-step:last-child { border-bottom: none; }
    .fa-step-num {
      width: 28px; height: 28px;
      border-radius: 50%;
      background: var(--c-accent);
      color: white;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.75rem; font-weight: 700;
      flex-shrink: 0;
    }
    .fa-step-text {
      font-size: 0.85rem;
      line-height: 1.55;
      color: var(--c-text);
    }
    .fa-step-text strong { color: var(--c-accent); }
    .fa-warning {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      font-size: 0.8rem;
      color: #991b1b;
      line-height: 1.5;
      margin-top: 0.75rem;
    }
    .fa-info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      font-size: 0.8rem;
      color: #1e40af;
      line-height: 1.5;
      margin-top: 0.75rem;
    }
    .fa-source {
      font-size: 0.68rem;
      color: var(--c-muted);
      margin-top: 1rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--c-border);
      line-height: 1.5;
    }
    .fa-emergency-bar {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      color: white;
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .fa-emergency-bar a {
      color: white;
      text-decoration: underline;
      font-weight: 700;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILNÃ RESPONZIVITA
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    @media (max-width: 640px) {

      /* PrvÃ¡ pomoc */
      .fa-grid { grid-template-columns: repeat(4, 1fr); gap: 0.5rem; }
      .fa-icon { width: 44px; height: 44px; font-size: 1.25rem; }
      .fa-card { padding: 0.75rem 0.375rem; }
      .fa-card-label { font-size: 0.65rem; }

      /* Header */
      .app-header-inner {
        padding: 0 1rem !important;
        height: 52px !important;
      }
      .app-header-logo span {
        font-size: 0.9375rem !important;
      }

      /* HlavnÃ½ obsah */
      .app-main-padding {
        padding: 1rem 0.75rem !important;
      }

      /* Profile + Overall - stack na mobile */
      .top-row-grid {
        grid-template-columns: 1fr !important;
      }

      /* KategÃ³rie - 2 stÄºpce na mobile */
      .categories-grid {
        grid-template-columns: 1fr 1fr !important;
        gap: 0.5rem !important;
      }

      /* PlÃ¡ny - 1 stÄºpec */
      .plans-grid {
        grid-template-columns: 1fr !important;
      }

      /* Profil karta - 2x2 grid */
      .profile-stats-grid {
        grid-template-columns: 1fr 1fr !important;
      }

      /* Buttons v header detail */
      .detail-header-row {
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      /* Item riadky - tlaÄidlÃ¡ menÅ¡ie */
      .item-row {
        padding: 0.75rem 0.75rem !important;
      }

      /* Modal - full screen na mobile */
      .modal-box {
        border-radius: 1.25rem 1.25rem 0 0 !important;
        max-height: 92vh !important;
        margin-top: auto !important;
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
      }
      .modal-overlay {
        align-items: flex-end !important;
        padding: 0 !important;
      }

      /* Profil modal - 3 stÄºpce -> 1 stÄºpec */
      .profile-3col {
        grid-template-columns: 1fr !important;
      }

      /* Osoby - 2x2 na mobile */
      .persons-grid {
        grid-template-columns: 1fr 1fr !important;
      }

      /* Dni sebestaÄnosti - stack */
      .prepdays-row {
        flex-direction: column !important;
        align-items: flex-start !important;
        gap: 0.625rem !important;
      }
      .prepdays-row input {
        width: 100% !important;
      }

      /* Water card grid */
      .water-info-grid {
        grid-template-columns: 1fr !important;
      }

      /* Cat card - menÅ¡Ã­ padding */
      .cat-card {
        padding: 0.75rem !important;
      }

      /* Sync indicator - skryÅ¥ text na mobile */
      .sync-label-text {
        display: none;
      }

      /* CelkovÃ¡ pripravenosÅ¥ - handled by hero banner */

      /* Item row tlaÄidlÃ¡ - len ikony na mobile */
      .item-btn-edit { font-size: 0.75rem !important; padding: 0.375rem 0.5rem !important; }
      .item-btn-del { padding: 0.375rem 0.5rem !important; }

      /* Profil karta - full width water box */
      .profile-water-full { grid-column: 1 / -1 !important; }

      /* VÃ½straha sekcia */
      .alerts-header { flex-wrap: wrap; gap: 0.5rem; }

      /* Nadpis KategÃ³rie */
      .cats-heading { font-size: 1.1rem !important; }

      /* Overall % ÄÃ­slo menÅ¡ie */
      #overallPct { font-size: 1.6rem !important; }

      /* PlÃ¡n karty - zmenÅ¡iÅ¥ padding */
      .plan-card { padding: 0.875rem !important; }

      /* Na mobile - skryÅ¥ desktop logout, zobraziÅ¥ mobile verziu */
      #btnLogout { display: none !important; }
      .user-avatar { cursor: pointer; }
      .mobile-logout-btn { display: flex !important; }

      /* OsobnÃ© kontakty modal - telefÃ³nne polia na 1 stÄºpec */
      #personalContactForm > div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
      }
      /* OsobnÃ© kontakty modal - menÅ¡Ã­ padding a scrollovateÄ¾nÃ½ form */
      #modalPersonalContact .modal-box {
        padding: 1.25rem 1rem !important;
      }
    }
    /* StrednÃ© obrazovky - tablet */
    @media (min-width: 641px) and (max-width: 900px) {
      .top-row-grid {
        grid-template-columns: 1fr 1fr !important;
      }
      .categories-grid {
        grid-template-columns: repeat(3, 1fr) !important;
      }
      .profile-3col {
        grid-template-columns: 1fr 1fr !important;
      }
    }
    
    #userMenu.open { display: block !important; }
    /* ZavrieÅ¥ menu pri kliknutÃ­ mimo */

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB NAVIGÃCIA
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .tab-bar {
      display: flex;
      justify-content: center;
      padding: 0.5rem 1.5rem 0.625rem;
      background: var(--c-surface);
      border-bottom: 1px solid var(--c-border);
    }
    .tab-bar-inner {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      background: var(--c-bg);
      border: 1px solid var(--c-border);
      border-radius: 0.875rem;
      padding: 0.25rem;
    }
    .tab-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      padding: 0.5rem 1.25rem;
      border: none;
      background: transparent;
      color: var(--c-muted);
      font-family: 'DM Sans', 'Lexend', sans-serif;
      font-size: 0.82rem;
      font-weight: 600;
      cursor: pointer;
      border-radius: 0.625rem;
      transition: all 0.2s ease;
      white-space: nowrap;
      position: relative;
    }
    .tab-btn:hover { color: var(--c-text); }
    .tab-btn.active {
      background: var(--c-surface); color: var(--c-text);
      box-shadow: 0 1px 3px rgba(26,23,20,0.08), 0 1px 2px rgba(26,23,20,0.06);
    }
    .tab-btn .tab-emoji { font-size: 0.9rem; }
    .tab-pane { display: none; }
    .tab-pane.active { display: grid; grid-template-columns: 1fr; gap: 1rem; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HERO BANNER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hero-banner {
      background: var(--c-surface);
      border: 1.5px solid var(--c-border);
      border-radius: 1.25rem;
      padding: 1.25rem 1.5rem;
      box-shadow: 0 2px 8px rgba(26,23,20,0.06), 0 4px 16px rgba(26,23,20,0.04);
      position: relative;
      overflow: hidden;
    }
    .hero-banner::before {
      content: '';
      position: absolute;
      bottom: 0; right: 0;
      width: 320px; height: 80px;
      opacity: 0.04;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 320 80'%3E%3Cpath d='M0 80 L40 45 L65 60 L95 25 L115 40 L140 15 L160 30 L175 10 L190 30 L210 18 L230 35 L250 22 L270 40 L290 30 L310 50 L320 42 L320 80Z' fill='%231a1714'/%3E%3C/svg%3E") no-repeat bottom right;
      background-size: contain;
      pointer-events: none;
    }
    .hero-top {
      display: flex; align-items: center; justify-content: space-between;
      gap: 1rem; margin-bottom: 0.75rem; position: relative; z-index: 1;
    }
    .hero-rank { display: flex; align-items: center; gap: 0.5rem; font-weight: 700; font-size: 1.125rem; font-family: 'DM Sans', sans-serif; }
    .hero-pct { font-size: 1.75rem; font-weight: 800; font-family: 'DM Sans', sans-serif; letter-spacing: -0.03em; }
    .hero-meta { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.75rem; position: relative; z-index: 1; }
    .hero-tag {
      display: inline-flex; align-items: center; gap: 0.25rem;
      background: var(--c-bg); border-radius: 0.5rem; padding: 0.25rem 0.625rem;
      font-size: 0.75rem; font-weight: 500; color: var(--c-muted);
      transition: background 0.15s;
    }
    .hero-tag:hover { background: #e8e4dd; }

    /* Slovak milestone messages (shown below progress) */
    .hero-milestone {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--c-muted);
      margin-top: 0.5rem;
      font-style: italic;
      position: relative; z-index: 1;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ONBOARDING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .onboarding-card {
      background: linear-gradient(135deg, #fef3c7 0%, #fef9c3 100%);
      border: 2px solid #fcd34d; border-radius: 1.25rem;
      padding: 2rem 1.5rem; text-align: center;
    }
    .onboarding-card h2 { font-size: 1.5rem; font-weight: 800; color: #92400e; margin-bottom: 0.5rem; font-family: 'DM Sans', sans-serif; letter-spacing: -0.03em; }
    .onboarding-card p { color: #a16207; font-size: 0.9rem; line-height: 1.6; margin-bottom: 1.5rem; }
    .onboarding-card .btn-primary { padding: 0.875rem 2rem; font-size: 1rem; background: #92400e; }
    .onboarding-card .btn-primary:hover { background: #78350f; }

    /* Procedure groups */
    .proc-group-heading {
      font-size: 0.78rem; font-weight: 700; color: var(--c-muted);
      text-transform: uppercase; letter-spacing: 0.05em;
      padding: 0.25rem 0; margin-top: 0.5rem; grid-column: 1 / -1;
    }
    .proc-group-heading:first-child { margin-top: 0; }

    .zone-intro { font-size: 0.85rem; color: var(--c-muted); line-height: 1.6; padding: 0.25rem 0 0.5rem; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILE BOTTOM NAV
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .bottom-nav {
      display: none; position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--c-surface); border-top: 1px solid var(--c-border);
      z-index: 50; padding: 0.375rem 0.5rem calc(0.375rem + env(safe-area-inset-bottom, 0px));
    }
    .bottom-nav .tab-btn {
      flex: 1;
      flex-direction: column; gap: 0.125rem; font-size: 0.65rem;
      padding: 0.375rem 0.25rem; border-radius: 0.625rem;
    }
    .bottom-nav .tab-btn .tab-emoji { font-size: 1.25rem; }
    .bottom-nav .tab-btn.active { background: transparent; color: var(--c-accent); }

    @media (max-width: 640px) {
      .tab-bar.top-tabs { display: none !important; }
      .bottom-nav { display: flex; gap: 0.25rem; }
      .app-main-padding { padding-bottom: 80px !important; }
      .hero-pct { font-size: 1.5rem !important; }
      .hero-rank { font-size: 1rem !important; }
      .hero-banner { padding: 1rem !important; }
      .hero-meta { gap: 0.375rem !important; }
      .hero-tag { font-size: 0.68rem !important; padding: 0.2rem 0.5rem !important; }
    }

    @media (min-width: 641px) and (max-width: 900px) {
      .tab-bar.top-tabs { padding: 0.375rem 1rem 0.5rem; }
      .tab-btn { font-size: 0.78rem; padding: 0.4rem 0.875rem; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DÃ”LEÅ½ITÃ‰ KONTAKTY & VAROVNÃ‰ SIGNÃLY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .ec-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 0.625rem;
    }
    .ec-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 1rem 0.625rem;
      border-radius: 1rem;
      background: var(--c-surface);
      border: 1.5px solid var(--c-border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
      text-decoration: none;
      color: var(--c-text);
      transition: transform 0.2s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.2s, border-color 0.2s;
      cursor: pointer;
    }
    .ec-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.10);
    }
    .ec-card:active { transform: translateY(-1px); }
    .ec-icon {
      width: 48px; height: 48px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.375rem;
      margin-bottom: 0.5rem;
      flex-shrink: 0;
    }
    .ec-card-label {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--c-text);
      line-height: 1.3;
    }
    .ec-card-number {
      font-size: 1rem;
      font-weight: 800;
      margin-top: 0.2rem;
      letter-spacing: -0.01em;
    }

    /* SirÃ©ny - vizualizÃ¡cia */
    .siren-card {
      background: var(--c-surface);
      border: 1.5px solid var(--c-border);
      border-radius: 1rem;
      padding: 1rem;
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.2s, border-color 0.2s;
    }
    .siren-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.10);
      border-color: var(--c-accent);
    }
    .siren-wave {
      height: 28px;
      border-radius: 0.375rem;
      overflow: hidden;
      position: relative;
      margin-top: 0.5rem;
    }
    .siren-wave-bar {
      position: absolute;
      bottom: 0;
      width: 3px;
      border-radius: 2px;
      animation: sirenPulse 1.5s ease-in-out infinite;
    }
    @keyframes sirenPulse {
      0%, 100% { transform: scaleY(0.3); }
      50% { transform: scaleY(1); }
    }
    .siren-wave-steady .siren-wave-bar {
      animation: sirenSteady 2s ease-in-out infinite;
    }
    @keyframes sirenSteady {
      0%, 100% { transform: scaleY(0.85); }
      50% { transform: scaleY(1); }
    }

    /* Postupy pri MU */
    .mu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.75rem;
    }
    .mu-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 1rem 0.5rem;
      border-radius: 1rem;
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.2s, border-color 0.15s;
      background: var(--c-surface);
      border: 1.5px solid var(--c-border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .mu-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.10);
      border-color: var(--c-accent);
    }
    .mu-card:active { transform: translateY(-1px); }
    .mu-icon {
      width: 52px; height: 52px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      flex-shrink: 0;
    }
    .mu-card-label {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--c-text);
      line-height: 1.3;
    }

    @media (max-width: 640px) {
      .ec-grid { grid-template-columns: repeat(3, 1fr); gap: 0.5rem; }
      .ec-icon { width: 40px; height: 40px; font-size: 1.125rem; }
      .ec-card { padding: 0.75rem 0.375rem; }
      .ec-card-label { font-size: 0.65rem; }
      .ec-card-number { font-size: 0.85rem; }
      .mu-grid { grid-template-columns: repeat(4, 1fr); gap: 0.5rem; }
      .mu-icon { width: 44px; height: 44px; font-size: 1.25rem; }
      .mu-card { padding: 0.75rem 0.375rem; }
      .mu-card-label { font-size: 0.65rem; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COOKIE BANNER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .cookie-banner {
      position: fixed; bottom: 0; left: 0; right: 0;
      z-index: 9999;
      background: #1a1612;
      color: rgba(255,255,255,0.85);
      border-top: 1px solid rgba(255,255,255,0.1);
      padding: 1rem 1.5rem;
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .cookie-banner.show { transform: none; }
    .cookie-banner-inner {
      max-width: 640px; margin: 0 auto;
      display: flex; align-items: center; gap: 1rem;
      flex-wrap: wrap;
    }
    .cookie-banner-text {
      flex: 1; min-width: 220px;
      font-size: 0.78rem; font-weight: 300; line-height: 1.6;
      font-family: 'DM Sans', 'Lexend', sans-serif;
    }
    .cookie-banner-text a { color: #c94f1a; text-decoration: underline; }
    .cookie-banner-actions { display: flex; gap: 0.5rem; flex-shrink: 0; }
    .cookie-btn {
      font-family: 'DM Sans', 'Lexend', sans-serif;
      font-size: 0.78rem; font-weight: 600;
      padding: 0.5rem 1.125rem;
      border-radius: 99px;
      cursor: pointer; border: none;
      transition: all 0.2s;
    }
    .cookie-btn-accept {
      background: #c94f1a; color: #fff;
    }
    .cookie-btn-accept:hover { background: #b5441a; }
    .cookie-btn-info {
      background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.7);
      border: 1px solid rgba(255,255,255,0.12);
      text-decoration: none; display: inline-flex; align-items: center;
    }
    .cookie-btn-info:hover { background: rgba(255,255,255,0.15); color: #fff; }
    @media (max-width: 640px) {
      .cookie-banner { padding: 0.875rem 1rem; }
      .cookie-banner-text { font-size: 0.72rem; min-width: 100%; }
      .cookie-banner-actions { width: 100%; }
      .cookie-btn { flex: 1; text-align: center; }
    }
  </style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="login-screen">
  <div class="login-card">
    <h1 style="font-size:1.75rem; font-weight:800; margin-bottom:0.5rem; letter-spacing:-0.03em; font-family:'DM Sans','Lexend',sans-serif;">Gerlach</h1>
    <p style="color:var(--c-muted); font-size:0.9rem; margin-bottom:2rem; line-height:1.6;">
      PomÃ¡ha domÃ¡cnostiam na Slovensku<br>pripraviÅ¥ sa na krÃ­zovÃ© situÃ¡cie.
    </p>
    <button class="btn-google" id="btnGoogleLogin">
      <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      PokraÄovaÅ¥ cez Google
    </button>
    <div style="text-align:center; margin-top:0.5rem; font-size:0.7rem; color:var(--c-muted); line-height:1.4;">
      Ãºdaje sa uloÅ¾ia do vÃ¡Å¡ho ÃºÄtu a budÃº dostupnÃ© na kaÅ¾dom zariadenÃ­
    </div>

    <div style="display:flex; align-items:center; gap:0.75rem; margin-top:1rem;">
      <div style="flex:1; height:1px; background:var(--c-border);"></div>
      <span style="font-size:0.75rem; color:var(--c-muted); font-weight:400;">alebo</span>
      <div style="flex:1; height:1px; background:var(--c-border);"></div>
    </div>

    <button class="btn-google" id="btnDemoLogin" style="margin-top:1rem; border-color:#f59e0b; background:#fffbeb;">
      ğŸ” VyskÃºÅ¡aÅ¥ demo
    </button>
    <div style="text-align:center; margin-top:0.5rem; font-size:0.7rem; color:var(--c-muted); line-height:1.4;">
      dÃ¡ta sa vymaÅ¾Ãº po zatvorenÃ­ prehliadaÄa
    </div>

    <div id="loginError" style="margin-top:1rem; color:#991b1b; font-size:0.85rem; display:none;"></div>
  </div>
  <p style="margin-top:1.5rem; font-size:0.75rem; color:var(--c-muted);">
    Gerlach Â© <span class="js-year"></span> â€“ Zadarmo pre verejnosÅ¥
  </p>
  <p style="margin-top:0.375rem; font-size:0.65rem; color:var(--c-muted);">
    <a href="./pravne-info.html" style="color:var(--c-muted); text-decoration:underline; text-underline-offset:2px;">Podmienky pouÅ¾Ã­vania</a>
    &nbsp;Â·&nbsp;
    <a href="./pravne-info.html#ochrana-udajov" style="color:var(--c-muted); text-decoration:underline; text-underline-offset:2px;">Ochrana Ãºdajov</a>
  </p>
</div>

<!-- REGISTRATION CLOSED SCREEN -->
<div id="closedScreen" style="display:none;" class="login-screen">
    <h1 style="font-size:1.5rem; font-weight:800; margin-bottom:0.5rem;">RegistrÃ¡cia uzavretÃ¡</h1>
    <p style="color:var(--c-muted); font-size:0.9rem; line-height:1.6;">
      MomentÃ¡lne sme dosiahli maximÃ¡lny poÄet pouÅ¾Ã­vateÄ¾ov v beta verzii. SkÃºs to znova neskÃ´r.
    </p>
</div>

<!-- MAIN APP -->
<div id="appScreen" style="display:none;">

  <!-- Demo banner: viditeÄ¾nÃ½ len v demo reÅ¾ime -->
  <div class="demo-banner" id="demoBanner" role="alert">
    <span>ğŸ” <strong>Demo reÅ¾im</strong> â€” skÃºÅ¡ate si Gerlach bez registrÃ¡cie. VÅ¡etko funguje rovnako, iba dÃ¡ta sa uloÅ¾ia len do prehliadaÄa (zmaÅ¾Ãº sa po zatvorenÃ­ karty v prehliadaÄi).</span>
    <a href="#" id="demoBannerCreateAccount">VytvoriÅ¥ ÃºÄet zadarmo</a>
  </div>

  <!-- Header -->
  <header class="app-header">
    <div class="app-header-inner">
      <div style="display:flex; align-items:center; gap:0.625rem;">
        <span style="font-family:'DM Sans','Lexend',sans-serif; font-weight:700; font-size:1.0625rem; letter-spacing:-0.02em; cursor:pointer;" id="headerLogo" title="Gerlach">Gerlach</span>
        <span class="version-badge beta" id="versionBadge">Beta v0.1</span>
      </div>
      <div style="display:flex; align-items:center; gap:1rem;">
      <span class="sync-indicator">
        <span class="sync-dot" id="syncDot"></span>
        <span id="syncLabel" class="sync-label-text">â€“</span>
      </span>
      <div style="display:flex; align-items:center; gap:0.5rem; position:relative;">
        <div class="user-avatar" id="userAvatar" onclick="document.getElementById('userMenu').classList.toggle('open')" style="cursor:pointer;">?</div>
        <button class="btn-ghost" id="btnLogout" style="padding:0.375rem 0.75rem;">OdhlÃ¡siÅ¥</button>
        <button class="mobile-logout-btn" onclick="document.getElementById('btnLogout').click();" style="display:none; background:none; border:1px solid var(--c-border); border-radius:0.5rem; padding:0.375rem 0.75rem; font-size:0.875rem; cursor:pointer; color:var(--c-muted); font-family:'Lexend',sans-serif; align-items:center; gap:0.375rem; font-weight:500;">OdhlÃ¡siÅ¥</button>
        <!-- Mobile user menu -->
        <div id="userMenu" style="display:none; position:absolute; top:calc(100% + 8px); right:0; background:white; border:1.5px solid var(--c-border); border-radius:0.875rem; padding:0.5rem; min-width:160px; box-shadow:0 8px 24px rgba(0,0,0,0.12); z-index:200;">
          <div id="userMenuName" style="font-size:0.8rem; font-weight:600; padding:0.5rem 0.75rem; color:var(--c-muted); border-bottom:1px solid var(--c-border); margin-bottom:0.375rem;"></div>
          <button onclick="document.getElementById('userMenu').classList.remove('open'); document.getElementById('btnLogout').click();" style="width:100%; text-align:left; background:none; border:none; padding:0.5rem 0.75rem; font-size:0.875rem; cursor:pointer; border-radius:0.625rem; color:#dc2626; font-family:'Lexend',sans-serif; font-weight:500;">
            ğŸšª OdhlÃ¡siÅ¥ sa
          </button>
        </div>
      </div>
    </div>
    </div><!-- end app-header-inner -->
  </header>

  <!-- Tab Bar (Desktop) -->
  <div class="tab-bar top-tabs" style="position:sticky; top:60px; z-index:49;">
    <div class="tab-bar-inner">
    <button class="tab-btn active" data-tab="preparation" onclick="switchTab('preparation')">
      <span class="tab-emoji">ğŸ’</span> Moja prÃ­prava
    </button>
    <button class="tab-btn" data-tab="knowledge" onclick="switchTab('knowledge')">
      <span class="tab-emoji">ğŸ“–</span> Vedomosti
    </button>
    <button class="tab-btn" data-tab="contacts" onclick="switchTab('contacts')">
      <span class="tab-emoji">ğŸ“</span> Kontakty
    </button>
    </div>
  </div>

  <div class="app-main-padding" style="max-width:1100px; margin:0 auto; padding:1.5rem 1rem;">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB A: MOJA PRÃPRAVA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-pane active" id="tabPreparation">

      <!-- Hero Banner (merged profile + progress) -->
      <div class="hero-banner" id="heroBanner"></div>

      <!-- Onboarding (for new users without profile) -->
      <div id="onboardingCard" style="display:none;">
        <div class="onboarding-card">
          <div style="font-size:3rem; margin-bottom:1rem;">ğŸ”ï¸</div>
          <h2>Vitajte v Gerlachu</h2>
          <p>ZaÄneme tÃ½m, Å¾e si nastavÃ­me vÃ¡Å¡ profil domÃ¡cnosti.<br>PodÄ¾a neho vypoÄÃ­tame, Äo presne potrebujete pripraviÅ¥.</p>
          <button class="btn-primary" onclick="openProfileEditor()">NastaviÅ¥ domÃ¡cnosÅ¥ â†’</button>
        </div>
      </div>

      <!-- Alerts -->
      <div class="card" id="alertsSection" style="display:none;">
        <h2 style="font-size:1rem; font-weight:700; margin-bottom:0.25rem;">âš ï¸ Upozornenia</h2>
        <p style="font-size:0.75rem; color:var(--c-muted); margin-bottom:0.75rem;">ÄŒo sa blÃ­Å¾i a oplatÃ­ sa rieÅ¡iÅ¥ teraz</p>
        <div id="alertsBox"></div>
      </div>

      <!-- Categories Grid -->
      <div id="categoriesSection">
        <h2 class="cats-heading" style="font-family:'Lexend',sans-serif; font-weight:700; font-size:1.275rem; margin-bottom:0.25rem;">ÄŒo maÅ¥ po ruke</h2>
        <p style="font-size:0.78rem; color:var(--c-muted); margin-bottom:0.75rem; line-height:1.4;">Nakupujte postupne, odÅ¡krtÃ¡vajte priebeÅ¾ne.</p>
        <div id="categoriesGrid" class="categories-grid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:0.75rem;"></div>
      </div>

      <!-- EvakuaÄnÃ© batohy -->
      <div class="card" id="evacBagsSection">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:0.875rem; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <h2 style="font-size:1.2rem; font-weight:700;">ğŸ’ EvakuaÄnÃ© batohy</h2>
            <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">OsobnÃ½ evakuaÄnÃ½ batoh pre kaÅ¾dÃ©ho Älena domÃ¡cnosti</p>
          </div>
          <button class="btn-ghost" id="btnRegenBags" style="font-size:0.72rem; padding:0.3rem 0.6rem; display:none;">ğŸ”„ PregenerovaÅ¥</button>
        </div>
        <div id="evacBagsContainer"></div>
      </div>

      <!-- RodinnÃ½ krÃ­zovÃ½ plÃ¡n -->
      <div class="card">
        <div style="margin-bottom:1rem;">
          <h2 style="font-size:1.2rem; font-weight:700;">ğŸ“‹ RodinnÃ½ krÃ­zovÃ½ plÃ¡n</h2>
          <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">Dohodnite sa vopred. KeÄ vypadne signÃ¡l, budete vedieÅ¥ Äo robiÅ¥.</p>
        </div>
        <div id="meetingPointBox"></div>
        <div style="margin-top:1rem;">
          <div style="font-size:0.78rem; font-weight:700; color:var(--c-muted); text-transform:uppercase; letter-spacing:0.05em; margin-bottom:0.625rem;">KrÃ­zovÃ© scenÃ¡re</div>
          <div id="scenariosBox" style="display:flex; flex-direction:column; gap:0.75rem;"></div>
        </div>
      </div>

    </div><!-- end tabPreparation -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB B: VEDOMOSTI â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-pane" id="tabKnowledge">

      <div class="zone-intro">NemusÃ­te si vÅ¡etko pamÃ¤taÅ¥ â€” staÄÃ­ vedieÅ¥, kde hÄ¾adaÅ¥.</div>

      <!-- Postupy pri MU -->
      <div class="card">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.875rem; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <h2 style="font-size:1.2rem; font-weight:700;">âš ï¸ Postupy pri mimoriadnych udalostiach</h2>
            <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">PrehÄ¾adnÃ© odporÃºÄania, Äo robiÅ¥ krok po kroku</p>
          </div>
        </div>
        <div id="emergencyProcGrid" class="mu-grid"></div>
      </div>

      <!-- PrvÃ¡ pomoc -->
      <div class="card">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.875rem; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <h2 style="font-size:1.2rem; font-weight:700;">ğŸ¥ PrvÃ¡ pomoc</h2>
            <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">ZÃ¡kladnÃ© postupy prvej pomoci, keÄ ide o minÃºty</p>
          </div>
          <div style="display:flex; gap:0.5rem; align-items:center;">
            <a href="tel:112" style="display:inline-flex; align-items:center; gap:0.375rem; background:#dc2626; color:white; border-radius:0.625rem; padding:0.4rem 0.75rem; font-size:0.78rem; font-weight:700; text-decoration:none; font-family:'Lexend',sans-serif;">ğŸ“ 112</a>
            <a href="tel:155" style="display:inline-flex; align-items:center; gap:0.375rem; background:#1e40af; color:white; border-radius:0.625rem; padding:0.4rem 0.75rem; font-size:0.78rem; font-weight:700; text-decoration:none; font-family:'Lexend',sans-serif;">ğŸš‘ 155</a>
          </div>
        </div>
        <div id="firstAidGrid" class="fa-grid"></div>
      </div>

      <!-- VarovnÃ© signÃ¡ly sirÃ©n -->
      <div class="card">
        <div style="margin-bottom:0.875rem;">
          <h2 style="font-size:1.2rem; font-weight:700;">ğŸ”” VarovnÃ© signÃ¡ly sirÃ©n</h2>
          <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">ÄŒo znamenajÃº jednotlivÃ© signÃ¡ly a ako ich rozoznaÅ¥</p>
        </div>
        <div id="sirensGrid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:0.625rem;"></div>
        <div style="background:var(--c-bg); border-radius:0.75rem; padding:0.75rem 1rem; margin-top:0.75rem; font-size:0.78rem; color:var(--c-muted); line-height:1.6;">
          <strong style="color:var(--c-text);">ğŸ’¡ Tip:</strong> SkÃºÅ¡ka sirÃ©n prebieha spravidla <strong>kaÅ¾dÃ½ druhÃ½ piatok v mesiaci o 12:00</strong>. SkÃºÅ¡ky sÃº vopred oznÃ¡menÃ© v mÃ©diÃ¡ch.
        </div>
      </div>

      <!-- NÃºdzovÃ© vysielanie rÃ¡dia -->
      <div class="card">
        <div style="margin-bottom:0.875rem;">
          <h2 style="font-size:1.2rem; font-weight:700;">ğŸ“» NÃºdzovÃ© vysielanie rÃ¡dia</h2>
          <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">Frekvencie, cez ktorÃ© si viete nÃ¡jsÅ¥ dÃ´leÅ¾itÃ© informÃ¡cie aj bez internetu</p>
        </div>
        <div id="radioGrid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:0.625rem;"></div>
        <div style="background:#eff6ff; border:1px solid #bfdbfe; border-radius:0.75rem; padding:0.75rem 1rem; margin-top:0.75rem; font-size:0.78rem; color:#1e40af; line-height:1.6;">
          <strong>â„¹ï¸ DÃ´leÅ¾itÃ©:</strong> PoÄas krÃ­zy sledujte SlovenskÃ½ rozhlas a RÃ¡dio Regina. RÃ¡dio na batÃ©rie patrÃ­ medzi najdÃ´leÅ¾itejÅ¡iu vÃ½bavu domÃ¡cnosti.
        </div>
      </div>

    </div><!-- end tabKnowledge -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB C: KONTAKTY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-pane" id="tabContacts">

      <div class="zone-intro">TiesÅˆovÃ© linky a kontakty na jednom mieste â€“ rÃ½chly prÃ­stup, keÄ to potrebujete.</div>

      <!-- DÃ´leÅ¾itÃ© kontakty (Å¡tÃ¡tne) -->
      <div class="card">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.875rem; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <h2 style="font-size:1.2rem; font-weight:700;">ğŸ“ DÃ´leÅ¾itÃ© kontakty</h2>
            <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">TiesÅˆovÃ© linky a kÄ¾ÃºÄovÃ© inÅ¡titÃºcie SR</p>
          </div>
        </div>
        <div style="margin-bottom:1rem;">
          <div style="font-size:0.78rem; font-weight:700; color:var(--c-muted); text-transform:uppercase; letter-spacing:0.05em; margin-bottom:0.625rem;">TiesÅˆovÃ© linky</div>
          <div class="ec-grid" id="emergencyLinesGrid"></div>
        </div>
        <div>
          <div style="font-size:0.78rem; font-weight:700; color:var(--c-muted); text-transform:uppercase; letter-spacing:0.05em; margin-bottom:0.625rem;">DÃ´leÅ¾itÃ© inÅ¡titÃºcie</div>
          <div id="institutionsGrid" style="display:flex; flex-direction:column; gap:0.5rem;"></div>
        </div>
      </div>

      <!-- OsobnÃ© kontakty -->
      <div class="card">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.875rem; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <h2 style="font-size:1.2rem; font-weight:700;">ğŸ‘¤ RodinnÃ© dÃ´leÅ¾itÃ© kontakty</h2>
            <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">Ä½udia, na ktorÃ½ch sa viete spoÄ¾ahnÃºÅ¥</p>
          </div>
          <button class="btn-ghost" id="btnAddPersonalContact" style="font-size:0.78rem; padding:0.375rem 0.75rem;">+ PridaÅ¥ kontakt</button>
        </div>
        <div id="personalContactsGrid" style="display:flex; flex-direction:column; gap:0.5rem;"></div>
      </div>

    </div><!-- end tabContacts -->

  </div><!-- end app-main-padding -->

  <!-- Bottom Nav (Mobile) -->
  <div class="bottom-nav" id="bottomNav">
    <button class="tab-btn active" data-tab="preparation" onclick="switchTab('preparation')">
      <span class="tab-emoji">ğŸ’</span> PrÃ­prava
    </button>
    <button class="tab-btn" data-tab="knowledge" onclick="switchTab('knowledge')">
      <span class="tab-emoji">ğŸ“–</span> Postupy
    </button>
    <button class="tab-btn" data-tab="contacts" onclick="switchTab('contacts')">
      <span class="tab-emoji">ğŸ“</span> Kontakty
    </button>
  </div>
</div><!-- end appScreen -->

<!-- Modal: EmailJS technickÃ¡ konfigurÃ¡cia -->
<div class="modal-overlay" id="modalEmailJSInfo">
  <div class="modal-box" style="max-width:420px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem;">
      <h3 style="font-family:'Lexend',sans-serif; font-weight:700; font-size:1rem;">âš™ï¸ TechnickÃ¡ poznÃ¡mka pre sprÃ¡vcu</h3>
      <button data-close="modalEmailJSInfo" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem;">âœ•</button>
    </div>
    <div style="font-size:0.8rem; color:var(--c-muted); line-height:1.6;">
      <p style="margin-bottom:0.5rem;">EmailovÃ© pripomienky vyuÅ¾Ã­vajÃº sluÅ¾bu <strong>EmailJS</strong>. Pre aktivÃ¡ciu je potrebnÃ© nastaviÅ¥ konfigurÃ¡ciu:</p>
      <div style="background:var(--c-bg); border-radius:0.5rem; padding:0.75rem; margin:0.5rem 0; font-family:monospace; font-size:0.72rem; line-height:1.5;">
        publicKey: "S9KjZEwsiiUC69fX-XqbK"<br>
        serviceId: "service_h4jkdfs"
      </div>
      <p style="margin-top:0.5rem;">Email sa odosiela max 1Ã— za 24 hodÃ­n. Upozornenia na expirÃ¡ciu podÄ¾a nastavenÃ­ sledovania + nÃ¡kupnÃ½ zoznam (14 dnÃ­ pred).</p>
    </div>
  </div>
</div>

<!-- Modal: Profile -->
<div class="modal-overlay" id="modalProfile">
  <div class="modal-box" style="max-width:640px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1.5rem;">
      <div>
        <h3 style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.25rem; margin:0;">VaÅ¡a domÃ¡cnosÅ¥</h3>
        <p style="font-size:0.8rem; color:var(--c-muted); margin:0.25rem 0 0;">PodÄ¾a tÃ½chto Ãºdajov vypoÄÃ­tame, Äo mÃ¡ pre vaÅ¡u domÃ¡cnosÅ¥ zmysel pripraviÅ¥.</p>
      </div>
      <button data-close="modalProfile" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem; flex-shrink:0; margin-left:1rem;">âœ•</button>
    </div>

    <form id="profileForm" style="display:grid; gap:1rem;">

      <!-- PoÄet osÃ´b -->
      <div style="background:var(--c-bg); border-radius:1rem; padding:1rem;">
        <div style="font-size:0.8rem; font-weight:700; color:var(--c-text); margin-bottom:0.75rem;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ PoÄet osÃ´b v domÃ¡cnosti <span style="font-size:0.68rem; font-weight:400; color:var(--c-muted);">(ovplyvÅˆuje niektorÃ© Å¡pecifickÃ© odporÃºÄania)</span></div>
        <div class="persons-grid" style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:0.625rem;">
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.3rem; white-space:nowrap;">DospelÃ­ (13â€“64)</label>
            <input name="adults" type="number" min="0" value="0"
              onfocus="if(this.value==='0')this.value=''"
              onblur="if(this.value==='')this.value='0'" style="text-align:center; font-weight:600; font-size:0.9rem;" />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.3rem; white-space:nowrap;">Deti (1â€“12)</label>
            <input name="kids" type="number" min="0" value="0"
              onfocus="if(this.value==='0')this.value=''"
              onblur="if(this.value==='')this.value='0'" style="text-align:center; font-weight:600; font-size:0.9rem;" />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.3rem; white-space:nowrap;">DojÄatÃ¡ (0â€“1)</label>
            <input name="infants" type="number" min="0" value="0"
              onfocus="if(this.value==='0')this.value=''"
              onblur="if(this.value==='')this.value='0'" style="text-align:center; font-weight:600; font-size:0.9rem;" />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.3rem; white-space:nowrap;">Seniori (65+)</label>
            <input name="seniors" type="number" min="0" value="0"
              onfocus="if(this.value==='0')this.value=''"
              onblur="if(this.value==='')this.value='0'" style="text-align:center; font-weight:600; font-size:0.9rem;" />
          </div>
        </div>
      </div>

      <!-- PoÄet dnÃ­ sebestaÄnosti -->
      <div class="prepdays-row" style="background:var(--c-bg); border-radius:1rem; padding:1rem; display:flex; align-items:center; gap:1rem;">
        <div style="flex:1;">
          <div style="font-size:0.8rem; font-weight:700; color:var(--c-text);">ğŸ“… PoÄet dnÃ­ sebestaÄnosti</div>
          <div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.2rem;">Minimum 3 dni. Pre vÃ¤ÄÅ¡Ã­ pocit istoty odporÃºÄame 7 dnÃ­.</div>
        </div>
        <input name="prepDays" type="number" min="1" max="30" value="3"
          onfocus="if(this.value==='3' && !this._touched)this.value=''"
          onblur="if(this.value===''){this.value='3'} this._touched=true;"
          style="width:80px; text-align:center; font-weight:600; font-size:0.9rem; flex-shrink:0;" />
      </div>

      <!-- ÃšroveÅˆ + NÃ¡kladovosÅ¥ + BÃ½vanie -->
      <div class="profile-3col" style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:0.75rem; align-items:start;">

        <!-- ÃšroveÅˆ pripravenosti -->
        <div style="background:var(--c-bg); border-radius:1rem; padding:1rem;">
          <div style="font-size:0.8rem; font-weight:700; color:var(--c-text); margin-bottom:0.2rem;">ğŸ›¡ï¸ ÃšroveÅˆ zÃ¡sob</div>
          <div style="font-size:0.72rem; color:var(--c-muted); margin-bottom:0.75rem; line-height:1.4;">UrÄuje vÃ½slednÃ½ komfort v Äase krÃ­zy.</div>
          <div style="display:flex; flex-direction:column; gap:0.5rem;">
            <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
              <input type="radio" name="readiness" value="standard" style="accent-color:var(--c-accent); flex-shrink:0;" />
              <div>
                <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">OdporÃºÄanÃ¡</div>
                <div style="font-size:0.7rem; color:var(--c-muted);">PodÄ¾a prÃ­ruÄiek</div>
              </div>
            </label>
            <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
              <input type="radio" name="readiness" value="enhanced" style="accent-color:var(--c-accent); flex-shrink:0;" />
              <div>
                <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">ZvÃ½Å¡enÃ¡</div>
                <div style="font-size:0.7rem; color:var(--c-muted);">+30% viac zÃ¡sob</div>
              </div>
            </label>
          </div>
        </div>

        <!-- NÃ¡kladovosÅ¥ -->
        <div style="background:var(--c-bg); border-radius:1rem; padding:1rem;">
          <div style="font-size:0.8rem; font-weight:700; color:var(--c-text); margin-bottom:0.2rem;">ğŸ’° NÃ¡kladovosÅ¥</div>
          <div style="font-size:0.72rem; color:var(--c-muted); margin-bottom:0.75rem; line-height:1.4;">CenovÃ¡ kategÃ³ria odporÃºÄanÃ½ch produktov.</div>
          <div style="display:flex; flex-direction:column; gap:0.5rem;">
            <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
              <input type="radio" name="budget" value="mid" style="accent-color:var(--c-accent); flex-shrink:0;" />
              <div>
                <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">ZÃ¡kladnÃ¡</div>
                <div style="font-size:0.7rem; color:var(--c-muted);">Kvalita za rozumnÃº cenu</div>
              </div>
            </label>
            <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
              <input type="radio" name="budget" value="premium" style="accent-color:var(--c-accent); flex-shrink:0;" />
              <div>
                <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">PrÃ©miovÃ¡</div>
                <div style="font-size:0.7rem; color:var(--c-muted);">Bez kompromisov</div>
              </div>
            </label>
          </div>
        </div>

        <!-- Typ bÃ½vania -->
        <div style="background:var(--c-bg); border-radius:1rem; padding:1rem;">
          <div style="font-size:0.8rem; font-weight:700; color:var(--c-text); margin-bottom:0.2rem;">ğŸ  Typ bÃ½vania</div>
          <div style="font-size:0.72rem; color:var(--c-muted); margin-bottom:0.75rem; line-height:1.4;">OvplyvÅˆuje niektorÃ© odporÃºÄania.</div>
          <div style="display:flex; flex-direction:column; gap:0.5rem;">
            <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
              <input type="radio" name="housing" value="flat" style="accent-color:var(--c-accent); flex-shrink:0;" />
              <div>
                <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">Byt</div>
                <div style="font-size:0.7rem; color:var(--c-muted);">PanelÃ¡k / bytovka</div>
              </div>
            </label>
            <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
              <input type="radio" name="housing" value="rd" style="accent-color:var(--c-accent); flex-shrink:0;" />
              <div>
                <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">RodinnÃ½ dom</div>
                <div style="font-size:0.7rem; color:var(--c-muted);">Bez pivnice / garÃ¡Å¾e</div>
              </div>
            </label>
            <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
              <input type="radio" name="housing" value="rd_cellar" style="accent-color:var(--c-accent); flex-shrink:0;" />
              <div>
                <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">RD + pivnica</div>
                <div style="font-size:0.7rem; color:var(--c-muted);">S pivnicou / garÃ¡Å¾ou</div>
              </div>
            </label>
          </div>
        </div>
      </div>

      <!-- Nastavenia: Sledovanie expirÃ¡cie -->
      <div style="background:var(--c-bg); border-radius:1rem; padding:1rem;">
        <div style="font-size:0.8rem; font-weight:700; color:var(--c-text); margin-bottom:0.2rem;">â° Sledovanie expirÃ¡cie</div>
        <div style="font-size:0.72rem; color:var(--c-muted); margin-bottom:0.75rem; line-height:1.4;">UpozornÃ­me vÃ¡s na poloÅ¾ky, ktorÃ½m sa blÃ­Å¾i dÃ¡tum spotreby.</div>
        <div style="display:flex; flex-wrap:wrap; gap:0.625rem;">
          <div style="display:flex; align-items:center; gap:0.375rem; background:#fef2f2; border:1px solid #fecaca; border-radius:0.625rem; padding:0.375rem 0.625rem;">
            <span style="font-size:0.75rem; font-weight:600; color:#dc2626;">ğŸ©º Lieky</span>
            <select id="alertDaysMeds" style="width:auto; font-size:0.75rem; padding:0.2rem 0.4rem; border-radius:0.375rem; border:1px solid #fecaca; background:white; color:#dc2626; font-weight:600;">
              <option value="270">9 mesiacov</option>
              <option value="180" selected>6 mesiacov</option>
              <option value="90">3 mesiace</option>
              <option value="30">1 mesiac</option>
            </select>
          </div>
          <div style="display:flex; align-items:center; gap:0.375rem; background:#eff6ff; border:1px solid #bfdbfe; border-radius:0.625rem; padding:0.375rem 0.625rem;">
            <span style="font-size:0.75rem; font-weight:600; color:#1e40af;">ğŸ¥« Potraviny a voda</span>
            <select id="alertDaysFood" style="width:auto; font-size:0.75rem; padding:0.2rem 0.4rem; border-radius:0.375rem; border:1px solid #bfdbfe; background:white; color:#1e40af; font-weight:600;">
              <option value="270">9 mesiacov</option>
              <option value="180">6 mesiacov</option>
              <option value="90">3 mesiace</option>
              <option value="30" selected>1 mesiac</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Nastavenia: EmailovÃ© pripomienky -->
      <div id="emailSettingsInProfile" style="background:var(--c-bg); border-radius:1rem; padding:1rem;">
        <div style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <div style="font-size:0.8rem; font-weight:700; color:var(--c-text);">âœ‰ï¸ EmailovÃ© pripomienky</div>
            <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.2rem;" id="emailNotifStatus">Pripomienky zatiaÄ¾ nie sÃº aktÃ­vne</div>
          </div>
          <div style="display:flex; gap:0.375rem;">
            <button type="button" id="btnTestEmail" onclick="sendTestNotification()" class="btn-ghost" style="font-size:0.72rem; padding:0.3rem 0.625rem;">TestovacÃ­ email</button>
            <button type="button" onclick="document.getElementById('modalEmailJSInfo').classList.add('open')" class="btn-ghost" style="font-size:0.65rem; padding:0.3rem 0.4rem; color:var(--c-muted);">âš™ï¸</button>
          </div>
        </div>
      </div>

      <div style="display:flex; justify-content:flex-end; padding-top:0.25rem;">
        <button type="submit" class="btn-primary" style="padding:0.75rem 2.5rem; font-size:0.9375rem;">UloÅ¾iÅ¥ profil</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: KategÃ³ria Detail -->
<div class="modal-overlay" id="modalCategory">
  <div class="modal-box" style="max-width:680px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1.25rem;">
      <div id="modalCatHeader" style="flex:1; min-width:0;"></div>
      <button data-close="modalCategory" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.375rem; flex-shrink:0; margin-left:1rem; width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:0.5rem; transition:background 0.15s;" onmouseover="this.style.background='var(--c-bg)'" onmouseout="this.style.background='none'">âœ•</button>
    </div>
    <div id="categoryDetail" style="max-height:65vh; overflow-y:auto; padding-right:0.25rem;"></div>
    <div style="display:flex; align-items:center; justify-content:space-between; padding-top:1rem; margin-top:0.5rem; border-top:1px solid var(--c-border);">
      <span id="modalCatProgress" style="font-size:0.8rem; color:var(--c-muted);"></span>
      <button class="btn-primary" id="btnAddItem" style="display:flex; align-items:center; gap:0.5rem;">
        <span style="font-size:1.1rem; line-height:1;">+</span> PridaÅ¥ poloÅ¾ku
      </button>
    </div>
  </div>
</div>

<!-- Modal: Add / Edit Item -->
<div class="modal-overlay" id="modalAddItem">
  <div class="modal-box" style="max-width:480px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1.25rem;">
      <h3 id="itemModalTitle" style="font-family:'Lexend',sans-serif; font-weight:700; font-size:1.125rem;">PridaÅ¥ poloÅ¾ku</h3>
      <button data-close="modalAddItem" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem;">âœ•</button>
    </div>
    <form id="addItemForm" style="display:grid; gap:0.75rem;">
      <input type="hidden" name="editIndex" value="-1" />
      <div>
        <label id="itemLabelName" style="font-size:0.8rem; color:var(--c-muted); display:block; margin-bottom:0.375rem;">NÃ¡zov *</label>
        <input name="name" type="text" required />
      </div>
      <div id="itemFieldQtyRow" style="display:grid; grid-template-columns:1fr 1fr; gap:0.75rem;">
        <div id="itemFieldQty">
          <label id="itemLabelQty" style="font-size:0.8rem; color:var(--c-muted); display:block; margin-bottom:0.375rem;">MnoÅ¾stvo</label>
          <input name="qty" type="text" placeholder="napr. 5 ks" />
        </div>
        <div id="itemFieldExpiry">
          <label style="font-size:0.8rem; color:var(--c-muted); display:block; margin-bottom:0.375rem;">ExpirÃ¡cia</label>
          <input name="expiry" type="date" />
        </div>
      </div>
      <div id="itemFieldDocs" style="display:none;">
        <label style="font-size:0.8rem; color:var(--c-muted); display:block; margin-bottom:0.375rem;">Typ uloÅ¾enia</label>
        <input name="qty_docs" type="text" placeholder="napr. OriginÃ¡l + scan Cloud + USB kÄ¾ÃºÄ" />
      </div>
      <div id="itemFieldLink">
        <label style="font-size:0.8rem; color:var(--c-muted); display:block; margin-bottom:0.375rem;">Odkaz (URL)</label>
        <input name="link" type="url" placeholder="https://..." />
      </div>
      <div style="display:flex; justify-content:flex-end; padding-top:0.5rem;">
        <button type="submit" id="btnItemSubmit" class="btn-primary" style="padding:0.75rem 2rem;">PridaÅ¥</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Delete Item Confirmation -->
<div class="modal-overlay" id="modalDeleteItem">
  <div class="modal-box" style="max-width:420px; text-align:center;">
    <div style="font-size:2.5rem; margin-bottom:0.75rem;">ğŸ—‘ï¸</div>
    <h3 id="deleteItemTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0 0 0.5rem;">OdstrÃ¡niÅ¥ poloÅ¾ku?</h3>
    <p id="deleteItemText" style="font-size:0.85rem; color:var(--c-muted); margin:0 0 1.25rem; line-height:1.5;"></p>
    <div style="display:flex; gap:0.625rem; justify-content:center;">
      <button data-close="modalDeleteItem" class="btn-ghost" style="padding:0.625rem 1.5rem; font-size:0.85rem;">ZruÅ¡iÅ¥</button>
      <button id="btnConfirmDelete" class="btn-primary" style="padding:0.625rem 1.5rem; font-size:0.85rem; background:#dc2626;">OdstrÃ¡niÅ¥</button>
    </div>
  </div>
</div>

<!-- Modal: Postup pri MU detail -->
<div class="modal-overlay" id="modalEmergencyProc">
  <div class="modal-box" style="max-width:600px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem;">
      <div style="display:flex; align-items:center; gap:0.75rem; flex:1; min-width:0;">
        <div class="mu-icon" id="muModalIcon" style="flex-shrink:0;"></div>
        <div>
          <h3 id="muModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;"></h3>
          <p id="muModalSubtitle" style="font-size:0.78rem; color:var(--c-muted); margin:0.125rem 0 0;"></p>
        </div>
      </div>
      <button data-close="modalEmergencyProc" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.375rem; flex-shrink:0; margin-left:1rem; width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:0.5rem; transition:background 0.15s;" onmouseover="this.style.background='var(--c-bg)'" onmouseout="this.style.background='none'">âœ•</button>
    </div>
    <div id="muModalContent" style="max-height:65vh; overflow-y:auto; padding-right:0.25rem;"></div>
  </div>
</div>

<!-- Modal: VarovnÃ½ signÃ¡l detail -->
<div class="modal-overlay" id="modalSiren">
  <div class="modal-box" style="max-width:500px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem;">
      <h3 id="sirenModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;"></h3>
      <button data-close="modalSiren" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.375rem; flex-shrink:0; margin-left:1rem; width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:0.5rem; transition:background 0.15s;" onmouseover="this.style.background='var(--c-bg)'" onmouseout="this.style.background='none'">âœ•</button>
    </div>
    <div id="sirenModalContent" style="max-height:65vh; overflow-y:auto;"></div>
  </div>
</div>

<!-- Modal: PrvÃ¡ pomoc detail -->

<!-- Modal: OsobnÃ½ kontakt -->

<!-- Modal: EvakuaÄnÃ½ batoh detail -->
<div class="modal-overlay" id="modalEvacBag">
  <div class="modal-box" style="max-width:560px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem;">
      <div style="display:flex; align-items:center; gap:0.75rem; flex:1; min-width:0;">
        <div id="evacBagModalIcon" style="width:48px; height:48px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.375rem; flex-shrink:0;"></div>
        <div>
          <h3 id="evacBagModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;"></h3>
          <p id="evacBagModalSubtitle" style="font-size:0.78rem; color:var(--c-muted); margin:0.125rem 0 0;"></p>
        </div>
      </div>
      <button data-close="modalEvacBag" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.375rem; flex-shrink:0; margin-left:1rem; width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:0.5rem; transition:background 0.15s;" onmouseover="this.style.background='var(--c-bg)'" onmouseout="this.style.background='none'">âœ•</button>
    </div>
    <div id="evacBagModalContent" style="max-height:65vh; overflow-y:auto; padding-right:0.25rem;"></div>
  </div>
</div>

<!-- Modal: OsobnÃ½ kontakt -->
<div class="modal-overlay" id="modalPersonalContact">
  <div class="modal-box" style="max-width:500px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1.25rem;">
      <div>
        <h3 id="pcModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;">ğŸ‘¤ NovÃ½ kontakt</h3>
        <p style="font-size:0.78rem; color:var(--c-muted); margin:0.25rem 0 0;">UloÅ¾te si dÃ´leÅ¾itÃ© ÄÃ­slo pre prÃ­pad nÃºdze</p>
      </div>
      <button data-close="modalPersonalContact" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem; flex-shrink:0; margin-left:1rem;">âœ•</button>
    </div>
    <form id="personalContactForm" style="display:grid; gap:1rem;">
      <input type="hidden" name="pc_editIndex" value="-1" />
      <div>
        <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">Typ kontaktu *</label>
        <div id="pcCategoryPicker" style="display:flex; flex-wrap:wrap; gap:0.375rem; margin-bottom:0.5rem;"></div>
        <input name="pc_customType" type="text" id="pcCustomTypeInput" placeholder="VlastnÃ½ typ (napr. Susedka MÃ¡ria)" style="display:none;" />
      </div>
      <div>
        <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">Meno / NÃ¡zov *</label>
        <input name="pc_name" type="text" required placeholder="napr. MUDr. KovÃ¡Ä, Allianz, Matka..." />
      </div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.625rem;">
        <div>
          <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">TelefÃ³n *</label>
          <input name="pc_phone" type="tel" required placeholder="+421..." />
        </div>
        <div>
          <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">TelefÃ³n 2 (zÃ¡loÅ¾nÃ½)</label>
          <input name="pc_phone2" type="tel" placeholder="" />
        </div>
      </div>
      <div>
        <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">Adresa</label>
        <input name="pc_address" type="text" placeholder="napr. HlavnÃ¡ 15, Bratislava" />
      </div>
      <div>
        <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">PoznÃ¡mka</label>
        <input name="pc_note" type="text" placeholder="napr. OrdinaÄnÃ© hodiny, ÄÃ­slo zmluvy..." />
      </div>
      <div style="display:flex; justify-content:flex-end; gap:0.5rem;">
        <button type="button" id="btnDeletePC" class="btn-ghost" style="padding:0.625rem 1.25rem; color:#dc2626; display:none;">OdstrÃ¡niÅ¥</button>
        <button type="submit" class="btn-primary" style="padding:0.625rem 2rem;">UloÅ¾iÅ¥</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Miesto stretnutia -->
<div class="modal-overlay" id="modalMeetingPoint">
  <div class="modal-box" style="max-width:560px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1.25rem;">
      <div>
        <h3 style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;">ğŸ“ Miesto stretnutia</h3>
        <p style="font-size:0.78rem; color:var(--c-muted); margin:0.25rem 0 0;">Kde sa stretnete, keÄ nebude signÃ¡l ani internet?</p>
      </div>
      <button data-close="modalMeetingPoint" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem; flex-shrink:0; margin-left:1rem;">âœ•</button>
    </div>
    <form id="meetingPointForm" style="display:grid; gap:1rem;">
      <div style="background:var(--c-bg); border-radius:1rem; padding:1rem;">
        <div style="font-size:0.8rem; font-weight:700; margin-bottom:0.625rem;">HlavnÃ© miesto</div>
        <div style="display:grid; gap:0.625rem;">
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.25rem;">NÃ¡zov miesta *</label>
            <input name="mp_name" type="text" placeholder="napr. Hodiny na nÃ¡mestÃ­, Kostol sv. Martina..." required />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.25rem;">Adresa / popis polohy</label>
            <input name="mp_address" type="text" placeholder="napr. HlavnÃ© nÃ¡mestie 1, pri fontÃ¡ne" />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.25rem;">PoznÃ¡mka</label>
            <input name="mp_note" type="text" placeholder="napr. Vchod od parkoviska, pri laviÄkÃ¡ch" />
          </div>
        </div>
      </div>

      <div style="background:#eff6ff; border:1px solid #bfdbfe; border-radius:1rem; padding:1rem;">
        <div style="font-size:0.8rem; font-weight:700; color:#1e40af; margin-bottom:0.25rem;">â° ÄŒasy stretÃ¡vania</div>
        <div style="font-size:0.72rem; color:#3b82f6; margin-bottom:0.625rem; line-height:1.5;">Kedy sa budete na mieste hÄ¾adaÅ¥? Napr. kaÅ¾dÃ© 4 hodiny. Ak tam druhÃ½ nie je, prÃ­Äte o ÄalÅ¡Ã­ interval.</div>
        <div id="meetingTimesEditor" style="display:flex; flex-wrap:wrap; gap:0.5rem; margin-bottom:0.5rem;"></div>
        <div style="display:flex; gap:0.5rem; align-items:center;">
          <input type="time" id="newMeetingTime" style="width:auto; font-size:0.85rem; padding:0.4rem 0.625rem;" />
          <button type="button" id="btnAddMeetingTime" class="btn-ghost" style="font-size:0.78rem; padding:0.4rem 0.75rem; white-space:nowrap;">+ PridaÅ¥ Äas</button>
        </div>
      </div>

      <div style="background:var(--c-bg); border-radius:1rem; padding:1rem;">
        <div style="font-size:0.8rem; font-weight:700; margin-bottom:0.25rem;">ZÃ¡loÅ¾nÃ© miesto</div>
        <div style="font-size:0.72rem; color:var(--c-muted); margin-bottom:0.625rem;">Ak hlavnÃ© miesto nie je prÃ­stupnÃ©.</div>
        <div style="display:grid; gap:0.625rem;">
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.25rem;">NÃ¡zov zÃ¡loÅ¾nÃ©ho miesta</label>
            <input name="mp_backup_name" type="text" placeholder="napr. Dom starej mamy, Å¡kola..." />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.25rem;">Adresa</label>
            <input name="mp_backup_address" type="text" placeholder="" />
          </div>
        </div>
      </div>

      <div style="display:flex; justify-content:flex-end;">
        <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: ScenÃ¡r -->
<div class="modal-overlay" id="modalScenario">
  <div class="modal-box" style="max-width:600px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1.25rem;">
      <div>
        <h3 id="scenarioModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;"></h3>
        <p id="scenarioModalSubtitle" style="font-size:0.78rem; color:var(--c-muted); margin:0.25rem 0 0;"></p>
      </div>
      <button data-close="modalScenario" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem; flex-shrink:0; margin-left:1rem;">âœ•</button>
    </div>
    <div id="scenarioModalContent"></div>
  </div>
</div>
<div class="modal-overlay" id="modalFirstAid">
  <div class="modal-box" style="max-width:600px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem;">
      <div style="display:flex; align-items:center; gap:0.75rem; flex:1; min-width:0;">
        <div class="fa-icon" id="faModalIcon" style="flex-shrink:0;"></div>
        <div>
          <h3 id="faModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;"></h3>
          <p id="faModalSubtitle" style="font-size:0.78rem; color:var(--c-muted); margin:0.125rem 0 0;"></p>
        </div>
      </div>
      <button data-close="modalFirstAid" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.375rem; flex-shrink:0; margin-left:1rem; width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:0.5rem; transition:background 0.15s;" onmouseover="this.style.background='var(--c-bg)'" onmouseout="this.style.background='none'">âœ•</button>
    </div>
    <div id="faModalContent" style="max-height:65vh; overflow-y:auto; padding-right:0.25rem;"></div>
  </div>
</div>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  // â”€â”€ EmailJS konfigurÃ¡cia â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // POKYN: Zaregistruj sa na emailjs.com, vytvor service + template a vloÅ¾ ID sem
  const EMAILJS_CONFIG = {
    publicKey:   "S9KjZEwsiiUC69fX-XqbK",     // Account â†’ API Keys
    serviceId:   "service_h4jkdfs",             // Email Services â†’ Service ID
    template_expiry:  "template_expiry_warn", // Template ID pre upozornenie na expirÃ¡ciu
    template_shopping: "template_shopping_list" // Template ID pre nÃ¡kupnÃ½ zoznam
  };
  // Inicializuj EmailJS
  (function() {
    if (EMAILJS_CONFIG.publicKey !== "YOUR_EMAILJS_PUBLIC_KEY") {
      emailjs.init({ publicKey: EMAILJS_CONFIG.publicKey });
    }
  })();
</script>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged }
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, runTransaction }
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // â”€â”€ Firebase config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Demo mode: ?mode=demo v URL
  let isDemo = new URLSearchParams(location.search).get('mode') === 'demo';

  const firebaseConfig = {
    apiKey: "AIzaSyA5_U4_9La4JpK8wAXBqY6GmkKxCLkH8T4",
    authDomain: "bez-paniky.firebaseapp.com",
    projectId: "bez-paniky",
    storageBucket: "bez-paniky.firebasestorage.app",
    messagingSenderId: "539726693021",
    appId: "1:539726693021:web:123de9d93568a285e54a74"
  };

  const MAX_USERS = 200; // Limit registrÃ¡ciÃ­

  // Firebase sa inicializuje VÅ½DY (aj v demo) â€” niektorÃ© funkcie ho potrebujÃº.
  // V demo reÅ¾ime sa preskoÄÃ­ len auth listener a ukladanie do Firestore.
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // â”€â”€ App state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const CATEGORIES = [
    { id: "food_water", name: "Jedlo a voda", emoji: "ğŸ¥«", weight: 1.2 },
    { id: "cash", name: "Peniaze", emoji: "ğŸ’µ", weight: 0.8 },
    { id: "medkit", name: "LekÃ¡rniÄka", emoji: "ğŸ©º", weight: 1.1 },
    { id: "hygiene", name: "Hygiena", emoji: "ğŸ§¼", weight: 0.8 },
    { id: "gear", name: "Vybavenie", emoji: "ğŸ”¦", weight: 1.0 },
    { id: "docs", name: "Doklady", emoji: "ğŸ“„", weight: 0.9 },
  ];

  const DEFAULT_ITEMS = {
    food_water: [
      { name: "PitnÃ¡ voda", done: false, qty: "", expiry: "", link: "", isWaterItem: true, waterBottles: 0 },
      { name: "TrvanlivÃ© jedlo (min. 3 dni)", done: false, qty: "", expiry: "", link: "" },
      { name: "OtvÃ¡raÄ / variÄ / palivo", done: false, qty: "", expiry: "", link: "" },
    ],
    cash: [
      { name: "HotovosÅ¥ na 3â€“7 dnÃ­", done: false, qty: "", expiry: "", link: "" },
      { name: "DrobnÃ© mince", done: false, qty: "", expiry: "", link: "" },
    ],
    medkit: [
      { name: "Lieky na predpis â€“ zÃ¡soba na 7 dnÃ­", done: false, qty: "", expiry: "", link: "" },
      { name: "Dezinfekcia na rany (Betadine / Skinsept)", done: false, qty: "1 ks", expiry: "", link: "" },
    ],
    hygiene: [
      { name: "ToaletnÃ½ papier", done: false, qty: "", expiry: "", link: "" },
      { name: "Mydlo", done: false, qty: "", expiry: "", link: "" },
    ],
    gear: [
      { name: "Baterka LED", done: false, qty: "", expiry: "", link: "" },
      { name: "RÃ¡dio na batÃ©rie AM/FM", done: false, qty: "1 ks", expiry: "", link: "" },
    ],
    docs: [
      // â”€â”€ OsobnÃ© dokumenty â”€â”€
      { name: "ObÄiansky preukaz / pas â€“ originÃ¡l", done: false, qty: "KaÅ¾dÃ½ Älen rodiny", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "ObÄiansky preukaz / pas â€“ kÃ³pia papier + scan", done: false, qty: "PDF: Cloud + USB", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "RodnÃ½ list â€“ originÃ¡l + Ãºradne overenÃ¡ kÃ³pia", done: false, qty: "1â€“2 ks overenÃ½ch", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "RodnÃ½ list â€“ scan na Cloud + USB", done: false, qty: "", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "SobÃ¡Å¡ny list / rozsudok o rozvode â€“ originÃ¡l", done: false, qty: "+ 1Ã— overenÃ¡ kÃ³pia", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "SobÃ¡Å¡ny list â€“ scan na Cloud + USB", done: false, qty: "", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "VodiÄskÃ½ preukaz â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "KartiÄka zdravotnej poisÅ¥ovne â€“ originÃ¡l", done: false, qty: "+ scan / fotka", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      // â”€â”€ Majetok a bÃ½vanie â”€â”€
      { name: "List vlastnÃ­ctva â€“ vÃ½pis z katastra", done: false, qty: "+ 1Ã— overenÃ¡ kÃ³pia", expiry: "", link: "", docGroup: "Majetok a bÃ½vanie" },
      { name: "List vlastnÃ­ctva â€“ scan Cloud + USB", done: false, qty: "", expiry: "", link: "", docGroup: "Majetok a bÃ½vanie" },
      { name: "KÃºpna zmluva na nehnuteÄ¾nosÅ¥ â€“ originÃ¡l", done: false, qty: "+ 1Ã— overenÃ¡ kÃ³pia", expiry: "", link: "", docGroup: "Majetok a bÃ½vanie" },
      { name: "HypotekÃ¡rna / ÃºverovÃ¡ zmluva â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Majetok a bÃ½vanie" },
      { name: "NÃ¡jomnÃ¡ zmluva (ak prenajÃ­mate) â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Majetok a bÃ½vanie" },
      // â”€â”€ Auto / Doprava â”€â”€
      { name: "TechnickÃ½ preukaz (osvedÄenie) â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Auto a doprava" },
      { name: "Zmluva o kÃºpe vozidla â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Auto a doprava" },
      { name: "PZP + havarijnÃ© poistenie â€“ zmluva + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Auto a doprava" },
      // â”€â”€ Zamestnanie a vzdelanie â”€â”€
      { name: "Diplom / vysvedÄenia â€“ originÃ¡l", done: false, qty: "+ Ãºradne overenÃ¡ kÃ³pia", expiry: "", link: "", docGroup: "Vzdelanie a prÃ¡ca" },
      { name: "Diplom â€“ scan na Cloud + USB", done: false, qty: "", expiry: "", link: "", docGroup: "Vzdelanie a prÃ¡ca" },
      { name: "CertifikÃ¡cie / odbornÃ© oprÃ¡vnenia â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Vzdelanie a prÃ¡ca" },
      // â”€â”€ Financie â”€â”€
      { name: "BankovÃ© ÃºÄty â€“ zmluvy originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Financie" },
      { name: "InvestiÄnÃ© zmluvy (broker, fondy) â€“ scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Financie" },
      { name: "Crypto seed / recovery frÃ¡za â€“ PAPIER offline", done: false, qty: "2Ã— na rÃ´znych miestach! Nikdy nescanovaÅ¥!", expiry: "", link: "", docGroup: "Financie" },
      { name: "Å½ivotnÃ¡ / ÃºrazovÃ¡ poistka â€“ zmluva + scan", done: false, qty: "Cloud + USB + poznÃ¡mka k podmienkam", expiry: "", link: "", docGroup: "Financie" },
      { name: "Poistenie domu / bytu â€“ zmluva + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Financie" },
      { name: "DaÅˆovÃ© dokumenty â€“ poslednÃ© 2â€“4 roky", done: false, qty: "Papier + scan", expiry: "", link: "", docGroup: "Financie" },
      // â”€â”€ ZdravotnÃ© dokumenty â”€â”€
      { name: "Karta pacienta â€“ scan + papierovÃ¡", done: false, qty: "", expiry: "", link: "", docGroup: "ZdravotnÃ© dokumenty" },
      { name: "LekÃ¡rske sprÃ¡vy (deti / chronickÃ­ pacienti)", done: false, qty: "Papier + Cloud + USB", expiry: "", link: "", docGroup: "ZdravotnÃ© dokumenty" },
      { name: "Alergie / lieky / kontakty â€“ 1Ã— A4 v lekÃ¡rniÄke", done: false, qty: "Papier v lekÃ¡rniÄke + batohu", expiry: "", link: "", docGroup: "ZdravotnÃ© dokumenty" },
      { name: "Darcu krvi / transplantÃ¡cie / dÃ´leÅ¾itÃ© med. info", done: false, qty: "Papier + scan", expiry: "", link: "", docGroup: "ZdravotnÃ© dokumenty" },
      // â”€â”€ KrÃ­zovÃ© dokumenty â”€â”€
      { name: "Plnomocenstvo â€“ NOTÃRSKY OVERENÃ‰", done: false, qty: "Na sprÃ¡vu majetku, bankovÃ© Ãºkony, poistky", expiry: "", link: "", docGroup: "KrÃ­zovÃ© dokumenty" },
      { name: "ZÃ¡vet / dediÄstvo â€“ originÃ¡l u notÃ¡ra", done: false, qty: "KÃ³pia pre rodinu. Scan neodporÃºÄanÃ½ ako dÃ´kaz!", expiry: "", link: "", docGroup: "KrÃ­zovÃ© dokumenty" },
      { name: "Zoznam kontaktov offline â€“ papier 1â€“2 strany", done: false, qty: "LekÃ¡r, prÃ¡vnik, banka, poisÅ¥ovne, hasiÄi, elektrikÃ¡r...", expiry: "", link: "", docGroup: "KrÃ­zovÃ© dokumenty" },
      { name: "USB kÄ¾ÃºÄ s dokumentmi â€“ pripravenÃ½ v batohu", done: false, qty: "Å ifrovanÃ½! + zÃ¡loha na Cloud", expiry: "", link: "", docGroup: "KrÃ­zovÃ© dokumenty" },
    ],
  };

  // â”€â”€ Dynamic item generation based on profile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function generateProfileItems(profile) {
    if (!profile) return {};
    const a = profile.adults || 0, k = profile.kids || 0, inf = profile.infants || 0, s = profile.seniors || 0;
    const persons = a + k + s; // Infants don't need most items separately
    const allP = a + k + inf + s;
    const days = profile.prepDays || 3;
    const c = profile.readinessCoeff || 1.0;
    const isPremium = profile.budget === "premium";
    const isEnhanced = profile.readiness === "enhanced";
    const ceil = Math.ceil;

    function q(val, unit) { return `${ceil(val * c)} ${unit}`; }
    function mk(name, qty, extra) { return { name, done: false, qty, expiry: "", link: "", ...extra }; }

    // â”€â”€ GEAR (Vybavenie) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const gear = [];
    // Osvetlenie
    gear.push(mk("Baterka LED", q(Math.max(persons, 1), "ks")));
    gear.push(mk("NÃ¡hradnÃ© batÃ©rie AAA do baterky", q(ceil(Math.max(persons, 1) * days / 3) * 2, "ks")));
    // RÃ¡dio
    gear.push(mk("RÃ¡dio na batÃ©rie AM/FM", "1 ks"));
    if (isPremium) gear.push(mk("RÃ¡dio nÃºdzovÃ© EtÃ³n Odyssey (kÄ¾ukou + solÃ¡rne)", "1 ks"));
    gear.push(mk("NÃ¡hradnÃ© batÃ©rie AA do rÃ¡dia", q(ceil(days / 2) * 4, "ks")));
    // Energia
    gear.push(mk("Powerbanka min. 20 000 mAh", q(ceil(Math.max(allP, 1) / 2), "ks")));
    // Varenie
    gear.push(mk("PlynovÃ½ kempingovÃ½ variÄ", "1 ks"));
    gear.push(mk("PlynovÃ© kartuÅ¡e (230 g)", q(ceil(days / 2), "ks")));
    gear.push(mk("ZÃ¡palky / zapaÄ¾ovaÄ", q(ceil(Math.max(persons, 1) / 2), "ks")));
    // Voda - nÃ¡doby
    const totalLitresDay = allP * 2;
    const bigCanisters = ceil(totalLitresDay * days / 10);
    const smallCanisters = ceil(totalLitresDay / 5);
    gear.push(mk(
      `Kanister na vodu s ventilom ${allP <= 2 ? "5" : "10"} L (EDA)`,
      `${bigCanisters} ks â€“ pred prvÃ½m pouÅ¾itÃ­m vyplÃ¡chnite, aby sa stratil zÃ¡pach z vÃ½roby`
    ));
    if (isEnhanced) gear.push(mk("Kanister na vodu 5 L (zÃ¡loÅ¾nÃ½)", q(smallCanisters, "ks")));
    // NÃ¡stroje
    gear.push(mk("MultifunkÄnÃ½ nÃ´Å¾", "1 ks"));
    gear.push(mk("PevnÃ¡ lepiaca pÃ¡ska (duct tape)", q(ceil(Math.max(allP, 1) / 3), "ks")));
    gear.push(mk("Ceruzka a papier (blok A5)", "1 set"));
    gear.push(mk("PÃ­Å¡Å¥alka (signalizaÄnÃ¡)", q(Math.max(persons, 1), "ks")));
    gear.push(mk("Paracord / lano 15 m", "1 ks"));
    gear.push(mk("Vrecia na odpad (60 L)", q(allP * ceil(days / 2), "ks")));
    // ZvieratÃ¡
    gear.push(mk("Krmivo pre domÃ¡ce zvieratÃ¡", `podÄ¾a potreby na ${days} dnÃ­`));
    // KÄ¾ÃºÄe
    gear.push(mk("NÃ¡hradnÃ© kÄ¾ÃºÄe od bytu / domu / auta", "1 sada"));

    // â”€â”€ MEDKIT (LekÃ¡rniÄka) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const medkit = [];
    // Lieky na predpis
    medkit.push(mk("Lieky na predpis â€“ zÃ¡soba na 7 dnÃ­", `+ popis: Äo, kedy, ako uÅ¾Ã­vate`, {expiry: ""}));
    // Dezinfekcia
    medkit.push(mk("Dezinfekcia na rany (Betadine / Skinsept)", q(Math.max(ceil(allP / 3), 1), "ks")));
    medkit.push(mk("Dezinfekcia na ruky (gÃ©l, 100 ml)", q(Math.max(allP, 1), "ks")));
    // Lieky
    medkit.push(mk("Lieky proti bolesti â€“ Ibuprofen 400 mg", q(Math.max(persons, 1), "balenie")));
    medkit.push(mk("Lieky proti horÃºÄke â€“ Paralen 500 mg", q(Math.max(persons, 1), "balenie")));
    medkit.push(mk("Lieky proti hnaÄke â€“ Smecta / Imodium", q(Math.max(persons, 1), "balenie")));
    medkit.push(mk("Lieky proti nevoÄ¾nosti (Kinedryl)", q(Math.max(ceil(allP / 2), 1), "balenie")));
    medkit.push(mk("AktÃ­vne uhlie (Carbosorb)", q(Math.max(ceil(allP / 2), 1), "balenie")));
    medkit.push(mk("Kvapky do oÄÃ­ (umelÃ© slzy)", "1 ks"));
    medkit.push(mk("Elektrolyty â€“ rehydrataÄnÃ© soli", q(Math.max(allP, 1), "sÃ¡Äkov")));
    // ObvÃ¤zy
    medkit.push(mk("ObvÃ¤zy elastickÃ© + gÃ¡za (sterilnÃ¡)", q(Math.max(ceil(allP / 2), 1), "set")));
    medkit.push(mk("NÃ¡plasti rÃ´zne veÄ¾kosti", q(Math.max(allP, 1), "balenie")));
    medkit.push(mk("TrojrohÃ¡ Å¡atka", q(2, "ks")));
    medkit.push(mk("JednorazovÃ© rukavice (nitrylovÃ©)", q(allP * 2, "pÃ¡rov")));
    medkit.push(mk("Å krtidlo (CAT tourniquet)", q(Math.max(ceil(allP / 3), 1), "ks")));
    medkit.push(mk("NoÅ¾nice (lekÃ¡rnickÃ©)", "1 ks"));
    medkit.push(mk("Pinzeta", "1 ks"));
    medkit.push(mk("Teplomer digitÃ¡lny", "1 ks"));
    medkit.push(mk("ZÃ¡chranÃ¡rska fÃ³lia (izotermickÃ¡ deka)", q(allP, "ks")));
    // Ochrana dÃ½chacÃ­ch ciest
    medkit.push(mk("RespirÃ¡tor FFP2", q(allP * 2, "ks")));
    medkit.push(mk("RespirÃ¡tor FFP3", q(allP, "ks")));
    // Deti â€“ ak sÃº v profile
    if (k > 0 || inf > 0) {
      medkit.push(mk("Paralen pre deti (ÄapÃ­ky alebo sirup)", q(k + inf, "balenie")));
      medkit.push(mk("Nurofen pre deti (sirup â€“ od 3 mesiacov)", q(k + inf, "balenie")));
      medkit.push(mk("Elektrolyty pre deti (rehydrataÄnÃ© soli)", q((k + inf) * 3, "sÃ¡Äkov")));
    }
    if (inf > 0) {
      medkit.push(mk("NosnÃ© kvapky pre bÃ¡bÃ¤tkÃ¡ (fyziologickÃ½ roztok)", q(inf, "ks")));
      medkit.push(mk("ZinkovÃ¡ masÅ¥ (ochrana pokoÅ¾ky dojÄaÅ¥a)", q(inf, "ks")));
      medkit.push(mk("Kvapky proti kolikÃ¡m (Espumisan / Sab Simplex)", q(inf, "ks")));
    }
    // Extras (Ukraine/ICRC recommendations)
    if (isEnhanced) {
      medkit.push(mk("ObvÃ¤z s hemostatikom (QuikClot / Celox)", q(Math.max(ceil(allP / 2), 1), "ks")));
      medkit.push(mk("Sam Splint â€“ dlahovacia pomÃ´cka", "1 ks"));
      medkit.push(mk("Chest seal â€“ okluzÃ­vna nÃ¡plasÅ¥ (pneumotorax)", "1 ks"));
    }

    // â”€â”€ HYGIENE (Hygiena) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const hygiene = [];
    hygiene.push(mk("ToaletnÃ½ papier", q(ceil(allP * days / 3), "roliek")));
    hygiene.push(mk("Mydlo / sprchovÃ½ gÃ©l", q(Math.max(ceil(allP / 2), 1), "ks")));
    hygiene.push(mk("VlhÄenÃ© utierky (veÄ¾kÃ© balenie)", q(Math.max(allP, 1), "balenie")));
    hygiene.push(mk("ZubnÃ¡ kefka + zubnÃ¡ pasta", q(allP, "ks + 1 pasta")));
    hygiene.push(mk("Å ampÃ³n (cestovnÃ© balenie)", q(Math.max(ceil(allP / 2), 1), "ks")));
    hygiene.push(mk("DÃ¡mska hygiena (vloÅ¾ky / tampÃ³ny)", "podÄ¾a potreby"));
    hygiene.push(mk("PapierovÃ© vreckovky", q(allP, "balenie")));
    hygiene.push(mk("KoÄkolit / absorpÄnÃ© vreckÃ¡ (nÃºdzovÃ¡ toaleta)", "1 balenie"));
    hygiene.push(mk("OdpadkovÃ© vreckÃ¡ na biologickÃ½ odpad", q(allP * ceil(days / 2), "ks")));
    if (inf > 0) {
      hygiene.push(mk("Plienky (jednorazovÃ©)", q(inf * days * 6, "ks")));
      hygiene.push(mk("DetskÃ© vlhÄenÃ© obrÃºsky", q(inf * 2, "balenie")));
      hygiene.push(mk("OchrannÃ½ krÃ©m na zadoÄek", q(inf, "ks")));
    }
    if (k > 0) {
      hygiene.push(mk("DetskÃ© vlhÄenÃ© obrÃºsky", q(k, "balenie")));
    }

    return { gear, medkit, hygiene };
  }

  // Regenerate items for dynamic categories, preserving done states and custom items
  function regenerateProfileBasedItems() {
    if (!state.profile) return;
    const generated = generateProfileItems(state.profile);
    ["gear", "medkit", "hygiene"].forEach(catId => {
      if (!generated[catId]) return;
      const existing = state.items[catId] || [];
      const doneMap = {};
      existing.forEach(it => { doneMap[it.name] = it.done; });
      // Generated item names set
      const genNames = new Set(generated[catId].map(it => it.name));
      // Custom items = items that exist but are NOT in generated list
      const custom = existing.filter(it => !genNames.has(it.name));
      state.items[catId] = [
        ...generated[catId].map(it => ({
          ...it,
          done: doneMap[it.name] !== undefined ? doneMap[it.name] : false
        })),
        ...custom
      ];
    });
  }

  // Funkcia na vytvorenie ÄistÃ©ho state - vÅ¾dy volaÅ¥ pri novom prihlÃ¡senÃ­
  function freshState() {
    return {
      profile: null,
      selectedCategoryId: "food_water",
      alertDaysMeds: 180,
      alertDaysFood: 30,
      items: structuredClone(DEFAULT_ITEMS),
      plans: {
        meetingPoint: {
          name: "",
          address: "",
          note: "",
          times: ["08:00", "12:00", "16:00", "20:00"],
          backup: { name: "", address: "" }
        },
        scenarios: {
          home: {
            steps: "1. ZostaÅˆte pokojnÃ­ a zistite Äo sa deje\n2. Skontrolujte zÃ¡soby a vybavenie\n3. Sledujte rozhlas / informÃ¡cie\n4. Ak treba evakuovaÅ¥ â€“ zoberte batoh a choÄte na miesto stretnutia",
            evacPlace: "",
            note: ""
          },
          separated: {
            tasks: [],
            meetPlace: "",
            meetTime: "",
            note: ""
          },
          partial: {
            whoHome: "",
            whoWork: "",
            homeSteps: "RodiÄ doma: pripravÃ­ batoh a zÃ¡soby, zabezpeÄÃ­ deti a ÄakÃ¡ na partnera alebo ide na miesto stretnutia.",
            workSteps: "RodiÄ v prÃ¡ci: bezpeÄne opustÃ­ pracovisko a smeruje na miesto stretnutia alebo domov.",
            meetPlace: "",
            meetTime: "",
            note: ""
          }
        }
      },
      personalContacts: [],
      evacuationBags: {}
    };
  }

  let state = freshState();

  let currentUser = null;
  let saveTimeout = null;
  let syncStatus = "idle"; // idle | syncing | synced

  // â”€â”€ Firestore helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function userDocRef(uid) { return doc(db, "users", uid, "data", "main"); }
  function metaRef() { return doc(db, "meta", "stats"); }

  async function loadUserData(uid) {
    // Demo: naÄÃ­tame zo sessionStorage (ak tam nieÄo je)
    if (isDemo) {
      try {
        const saved = sessionStorage.getItem('gerlach_demo_state');
        if (saved) {
          const data = JSON.parse(saved);
          state = { ...state, ...data };
        }
      } catch(e) { console.warn("Demo load error", e); }
      setSyncStatus("synced");
      return;
    }
    setSyncStatus("syncing");
    try {
      const snap = await getDoc(userDocRef(uid));
      if (snap.exists()) {
        const data = snap.data();
        // Deep merge plans structure (handle old A/B/C format migration)
        const defaultPlans = freshState().plans;
        let mergedPlans = defaultPlans;
        if (data.plans) {
          if (data.plans.meetingPoint) {
            // New format â€“ deep merge
            mergedPlans = {
              meetingPoint: { ...defaultPlans.meetingPoint, ...(data.plans.meetingPoint || {}), backup: { ...defaultPlans.meetingPoint.backup, ...((data.plans.meetingPoint||{}).backup || {}) } },
              scenarios: {
                home: { ...defaultPlans.scenarios.home, ...((data.plans.scenarios||{}).home || {}) },
                separated: { ...defaultPlans.scenarios.separated, ...((data.plans.scenarios||{}).separated || {}), tasks: ((data.plans.scenarios||{}).separated||{}).tasks || [] },
                partial: { ...defaultPlans.scenarios.partial, ...((data.plans.scenarios||{}).partial || {}) }
              }
            };
          }
          // else: old A/B/C format â€“ just use defaults, old data ignored
        }
        state = {
          ...state,
          ...data,
          items: { ...structuredClone(DEFAULT_ITEMS), ...(data.items || {}) },
          plans: mergedPlans,
          personalContacts: data.personalContacts || [],
          evacuationBags: data.evacuationBags || {}
        };
        // Migrate: ensure link field
        for (const cid of Object.keys(state.items)) {
          state.items[cid] = state.items[cid].map(it => ({ link: "", waterBottles: 0, isWaterItem: false, ...it }));
        }
        // Migrate: docs category â€“ if old format (no docGroup), replace with new comprehensive list
        if (state.items.docs && state.items.docs.length > 0 && !state.items.docs[0].docGroup) {
          state.items.docs = structuredClone(DEFAULT_ITEMS.docs);
        }
        // Migrate: alertDays â†’ alertDaysMeds + alertDaysFood
        if (!data.alertDaysMeds && !data.alertDaysFood) {
          state.alertDaysMeds = 180;
          state.alertDaysFood = data.alertDays || 30;
        } else {
          state.alertDaysMeds = data.alertDaysMeds || 180;
          state.alertDaysFood = data.alertDaysFood || 30;
        }
        delete state.alertDays;
        // Migrate: budget "basic" (old ÃšspornÃ¡) â†’ "mid" (new ZÃ¡kladnÃ¡)
        if (state.profile && state.profile.budget === "basic") {
          state.profile.budget = "mid";
        }
        // Migrate: remove old default items from dynamic categories (replaced by profile-based generation)
        const OLD_DEFAULTS = {
          gear: ["Baterka + zÃ¡loÅ¾nÃ© batÃ©rie", "Powerbanka (min. 10 000 mAh)", "RÃ¡dio na batÃ©rie"],
          medkit: ["Lieky proti bolesti (Paralen, Ibuprofen)", "ObvÃ¤zy, dezinfekcia, rukavice", "Lieky na predpis â€“ zÃ¡loÅ¾nÃ¡ zÃ¡soba"],
          hygiene: ["ToaletnÃ½ papier / vlhÄenÃ© utierky", "Mydlo / dezinfekcia rÃºk"]
        };
        for (const [catId, oldNames] of Object.entries(OLD_DEFAULTS)) {
          if (state.items[catId]) {
            state.items[catId] = state.items[catId].filter(it => !oldNames.includes(it.name));
          }
        }
        // Regenerate dynamic items from profile
        regenerateProfileBasedItems();
      }
      setSyncStatus("synced");
    } catch(e) {
      console.error("Load error", e);
      setSyncStatus("idle");
    }
  }

  async function saveUserData() {
    if (isDemo) {
      // Demo: ukladÃ¡me do sessionStorage (zmizne po zatvorenÃ­ tabu)
      try {
        sessionStorage.setItem('gerlach_demo_state', JSON.stringify(state));
        setSyncStatus("synced");
      } catch(e) { console.warn("Demo save error", e); }
      return;
    }
    if (!currentUser) return;
    setSyncStatus("syncing");
    try {
      await setDoc(userDocRef(currentUser.uid), state);
      setSyncStatus("synced");
    } catch(e) {
      console.error("Save error", e);
      setSyncStatus("idle");
    }
  }

  function scheduleSave() {
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(saveUserData, 1200);
  }

  function setSyncStatus(s) {
    syncStatus = s;
    const dot = document.getElementById("syncDot");
    const lbl = document.getElementById("syncLabel");
    if (!dot || !lbl) return;
    if (isDemo) {
      dot.className = "sync-dot";
      dot.style.background = "#f59e0b";
      lbl.textContent = s === "synced" ? "Demo Â· uloÅ¾enÃ©" : "Demo";
      return;
    }
    dot.style.background = "";
    dot.className = "sync-dot" + (s === "synced" ? " synced" : s === "syncing" ? " syncing" : "");
    lbl.textContent = s === "synced" ? "UloÅ¾enÃ©" : s === "syncing" ? "UkladÃ¡mâ€¦" : "";
  }

  // â”€â”€ Registration limit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function registerNewUser(uid) {
    try {
      const result = await runTransaction(db, async (tx) => {
        const meta = await tx.get(metaRef());
        const count = meta.exists() ? (meta.data().registeredUsers || 0) : 0;
        if (count >= MAX_USERS) throw new Error("LIMIT_REACHED");
        tx.set(metaRef(), { registeredUsers: count + 1 }, { merge: true });
        tx.set(userDocRef(uid), freshState());
        return true;
      });
      return result;
    } catch(e) {
      if (e.message === "LIMIT_REACHED") return false;
      throw e;
    }
  }

  // â”€â”€ Demo mode startup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Ak je ?mode=demo, preskoÄÃ­me celÃ½ Firebase Auth a spustÃ­me appku okamÅ¾ite
  function startDemoMode() {
    document.body.classList.add('is-demo');
    currentUser = { uid: 'demo', displayName: 'Demo pouÅ¾Ã­vateÄ¾', email: null, photoURL: null };

    // NaÄÃ­taj dÃ¡ta zo sessionStorage (ak user sa vrÃ¡til v tom istom tabe)
    loadUserData('demo');

    // UI: demo banner
    document.getElementById('demoBanner').classList.add('visible');

    // UI: version badge â†’ "Demo"
    const badge = document.getElementById('versionBadge');
    if (badge) {
      badge.textContent = 'Demo';
      badge.classList.remove('beta');
      badge.classList.add('demo-badge');
    }

    // UI: avatar
    const av = document.getElementById('userAvatar');
    if (av) av.textContent = 'D';

    // UI: sync indicator â€” show "Demo" instead of hiding
    const syncEl = document.querySelector('.sync-indicator');
    if (syncEl) {
      syncEl.style.display = '';
      const dot = document.getElementById('syncDot');
      const lbl = document.getElementById('syncLabel');
      if (dot) { dot.className = 'sync-dot'; dot.style.background = '#f59e0b'; }
      if (lbl) lbl.textContent = 'Demo';
    }

    // UI: logout â†’ "UkonÄiÅ¥ demo"
    const btnLO = document.getElementById('btnLogout');
    if (btnLO) { btnLO.textContent = 'UkonÄiÅ¥ demo'; btnLO.style.display = ''; }
    const mobileLO = document.querySelector('.mobile-logout-btn');
    if (mobileLO) { mobileLO.textContent = 'ğŸ” UkonÄiÅ¥ demo'; }

    showScreen('app');
    renderAll();
    setupLogoEasterEgg();

    // Demo: update email section in profile
    const emailSection = document.getElementById('emailSettingsInProfile');

    // Demo: "VytvoriÅ¥ ÃºÄet zadarmo" link v banneri â†’ ukonÄÃ­ demo a vrÃ¡ti na login
    const bannerLink = document.getElementById('demoBannerCreateAccount');
    if (bannerLink) {
      bannerLink.onclick = (e) => { e.preventDefault(); document.getElementById('btnLogout').click(); };
    }
    if (emailSection) {
      emailSection.innerHTML = `
        <div style="display:flex; align-items:center; gap:0.5rem;">
          <div>
            <div style="font-size:0.8rem; font-weight:700; color:var(--c-text);">âœ‰ï¸ EmailovÃ© pripomienky</div>
            <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.2rem;">V demo reÅ¾ime nie sÃº dostupnÃ©. UkonÄite demo a vytvorte si ÃºÄet pre emailovÃ© upozornenia na expirÃ¡cie.</div>
          </div>
        </div>`;
    }

    if (!state.profile) openModal('modalProfile');
  }

  // Ak isDemo (z ?mode=demo), spustÃ­me demo okamÅ¾ite
  if (isDemo) {
    startDemoMode();
  }

  // â”€â”€ Auth (len pre normÃ¡lny reÅ¾im) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById("btnGoogleLogin").onclick = async () => {
    if (isDemo) return; // V demo ignoruj Google login
    const provider = new GoogleAuthProvider();
    try {
      await signInWithPopup(auth, provider);
    } catch(e) {
      const err = document.getElementById("loginError");
      err.style.display = "block";
      err.textContent = "PrihlÃ¡senie zlyhalo. SkÃºs znova.";
    }
  };

  // Demo button na login screen
  document.getElementById("btnDemoLogin").onclick = () => {
    isDemo = true;
    startDemoMode();
  };

  document.getElementById("btnLogout").onclick = () => {
    if (isDemo) {
      // Demo: vymaÅ¾ sessionStorage, resetuj stav a vrÃ¡Å¥ na login
      sessionStorage.removeItem('gerlach_demo_state');
      isDemo = false;
      currentUser = null;
      state = freshState();
      // Reset UI demo prvkov
      document.body.classList.remove('is-demo');
      const badge = document.getElementById('versionBadge');
      if (badge) { badge.textContent = 'Beta v0.1'; badge.classList.remove('demo-badge'); badge.classList.add('beta'); }
      document.getElementById('demoBanner').classList.remove('visible');
      const btnLO = document.getElementById('btnLogout');
      if (btnLO) btnLO.textContent = 'OdhlÃ¡siÅ¥';
      const mobileLO = document.querySelector('.mobile-logout-btn');
      if (mobileLO) mobileLO.textContent = 'OdhlÃ¡siÅ¥';
      showScreen("login");
      return;
    }
    signOut(auth);
  };

  // Auth state listener â€” len v normÃ¡lnom reÅ¾ime
  if (!isDemo) {
    onAuthStateChanged(auth, async (user) => {
    // Ak medziÄasom uÅ¾Ã­vateÄ¾ spustil demo, nerob niÄ
    if (isDemo) return;
    if (!user) {
      currentUser = null;
      // Reset state pri odhlÃ¡senÃ­ - Å¾iadne dÃ¡ta nezostanÃº v pamÃ¤ti
      state = freshState();
      showScreen("login");
      return;
    }
    currentUser = user;
    // VÅ¾dy zaÄneme s ÄistÃ½m state pred naÄÃ­tanÃ­m dÃ¡t z Firestore
    state = freshState();
    // Check if user already has data
    const snap = await getDoc(userDocRef(user.uid));
    if (!snap.exists()) {
      // New user â€“ check limit
      const ok = await registerNewUser(user.uid);
      if (!ok) {
        showScreen("closed");
        await signOut(auth);
        return;
      }
    } else {
      await loadUserData(user.uid);
    }

    // Update avatar
    const av = document.getElementById("userAvatar");
    if (user.photoURL) {
      const img = document.createElement("img");
      img.src = user.photoURL;
      img.alt = "avatar";
      av.innerHTML = "";
      av.appendChild(img);
    } else {
      av.textContent = (user.displayName || user.email || "U")[0].toUpperCase();
    }

    showScreen("app");
    renderAll();
    setupLogoEasterEgg();
    if (!state.profile) openModal("modalProfile");
    // Skontroluj expirÃ¡cie a poÅ¡li notifikÃ¡cie (ak treba)
    setTimeout(checkAndSendNotifications, 2000);
  });
  } // end if (!isDemo)

  function showScreen(name) {
    document.getElementById("loginScreen").style.display = name === "login" ? "flex" : "none";
    document.getElementById("closedScreen").style.display = name === "closed" ? "flex" : "none";
    document.getElementById("appScreen").style.display = name === "app" ? "block" : "none";
  }

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function esc(s) {
    return String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
  }

  function daysUntil(d) {
    const ms = new Date(d + "T00:00:00") - new Date();
    return Math.ceil(ms / 86400000);
  }

  function colorForPct(p) {
    // PlynulÃ½ prechod: 0% = ÄervenÃ¡ (hsl 0), 100% = zelenÃ¡ (hsl 120)
    const h = Math.round((Math.min(100, Math.max(0, p)) / 100) * 120);
    const s = 75;
    const l = p < 15 ? 42 : p > 85 ? 36 : 38;
    return `hsl(${h} ${s}% ${l}%)`;
  }

  function rankForPct(p) {
    if (p <= 20) return "Ste eÅ¡te na zaÄiatku";
    if (p <= 40) return "UÅ¾ mÃ¡te zÃ¡klad";
    if (p <= 60) return "DobrÃ½ zÃ¡klad";
    if (p <= 80) return "VeÄ¾mi sluÅ¡ne";
    return "VÃ½borne pripravenÃ­";
  }

  function emojiForPct(p) {
    return "";
  }

  function calcWaterCompletion(item) {
    if (!item.isWaterItem || !state.profile) return item.done ? 100 : 0;
    const p = state.profile;
    const d = p.prepDays || 3;
    const coeff = p.readinessCoeff || 1.0;
    const total = ((p.adults||0)*2 + (p.kids||0)*1.5 + (p.infants||0)*1 + (p.seniors||0)*2) * d * coeff;
    if (!total) return 0;
    return Math.min(100, ((item.waterBottles||0)*1.5 / total) * 100);
  }

  function categoryScore(catId) {
    const items = state.items[catId] || [];
    if (!items.length) return 0;
    return items.reduce((sum, it) => sum + (it.isWaterItem ? calcWaterCompletion(it) : it.done ? 100 : 0), 0) / items.length;
  }

  function overallScore() {
    const { sum, w } = CATEGORIES.reduce((acc, c) => ({
      sum: acc.sum + categoryScore(c.id) * c.weight,
      w: acc.w + c.weight
    }), { sum: 0, w: 0 });
    return w ? sum / w : 0;
  }

  function isValidUrl(u) {
    try { const url = new URL(u); return url.protocol === "https:" || url.protocol === "http:"; } catch { return false; }
  }

  // â”€â”€ Modal helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openModal(id) {
    document.getElementById(id).classList.add("open");
    document.body.style.overflow = "hidden";
  }
  function closeModal(id) {
    document.getElementById(id).classList.remove("open");
    // Obnov scroll len ak Å¾iadny inÃ½ modal nie je otvorenÃ½
    if (!document.querySelector('.modal-overlay.open')) {
      document.body.style.overflow = "";
    }
  }
  document.querySelectorAll("[data-close]").forEach(b => b.onclick = () => closeModal(b.dataset.close));

  // â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  // â”€â”€ Slovak Progress Milestones â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getMilestoneHtml(pct) {
    let msg = "";
    if (pct <= 5) return "";
    if (pct < 25) msg = "KaÅ¾dÃ½ krok sa poÄÃ­ta";
    else if (pct < 50) msg = "PrvÃ½ krok na Rysy â€” zÃ¡klad stojÃ­";
    else if (pct < 75) msg = "Pol cesty na KrivÃ¡Åˆ â€” ste Äalej neÅ¾ vÃ¤ÄÅ¡ina";
    else if (pct < 100) msg = "Sedlo pod Gerlachom â€” uÅ¾ len kÃºsok";
    else msg = "Na vrchole Gerlachu! ğŸ‡¸ğŸ‡°";
    return `<div class="hero-milestone">${msg}</div>`;
  }

  // â”€â”€ Confetti (Slovak flag colors) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let confettiTriggered = false;
  function triggerSlovakConfetti() {
    if (confettiTriggered) return;
    confettiTriggered = true;
    const canvas = document.createElement('canvas');
    canvas.id = 'confettiCanvas';
    document.body.appendChild(canvas);
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const colors = ['#ffffff', '#0b4ea2', '#ee1c25', '#ffffff', '#0b4ea2', '#ee1c25', '#ffd700'];
    const particles = [];
    for (let i = 0; i < 150; i++) {
      particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height - canvas.height,
        w: Math.random() * 8 + 4,
        h: Math.random() * 6 + 3,
        color: colors[Math.floor(Math.random() * colors.length)],
        vx: (Math.random() - 0.5) * 3,
        vy: Math.random() * 3 + 2,
        rot: Math.random() * Math.PI * 2,
        vr: (Math.random() - 0.5) * 0.15,
        opacity: 1
      });
    }

    let frame = 0;
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      let alive = false;
      particles.forEach(p => {
        if (p.opacity <= 0) return;
        alive = true;
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        p.vy += 0.05;
        if (frame > 120) p.opacity -= 0.015;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.globalAlpha = Math.max(0, p.opacity);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        ctx.restore();
      });
      frame++;
      if (alive && frame < 300) {
        requestAnimationFrame(animate);
      } else {
        canvas.remove();
        // Reset after some time so it can trigger again if user drops below and returns
        setTimeout(() => { confettiTriggered = false; }, 60000);
      }
    }
    animate();
  }

  // â”€â”€ Easter Egg: Tatry Panorama (5 clicks on logo) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let logoClicks = 0;
  let logoClickTimer = null;
  function setupLogoEasterEgg() {
    const logo = document.getElementById('headerLogo');
    if (!logo) return;
    logo.onclick = () => {
      logoClicks++;
      clearTimeout(logoClickTimer);
      logoClickTimer = setTimeout(() => { logoClicks = 0; }, 2000);
      if (logoClicks >= 5) {
        logoClicks = 0;
        showTatryEasterEgg();
      }
    };
  }

  function showTatryEasterEgg() {
    let el = document.getElementById('tatryEasterEgg');
    if (!el) {
      el = document.createElement('div');
      el.id = 'tatryEasterEgg';
      el.className = 'easter-tatry';
      el.innerHTML = `
        <svg class="easter-tatry-mountains" viewBox="0 0 800 200" fill="none" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="mt1" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#8fa4bf"/><stop offset="100%" stop-color="#4a6fa5"/></linearGradient>
            <linearGradient id="mt2" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#a0b4c8"/><stop offset="100%" stop-color="#5a7fb5"/></linearGradient>
            <linearGradient id="snow" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="white"/><stop offset="100%" stop-color="#c8d8e8"/></linearGradient>
          </defs>
          <!-- Back range -->
          <path d="M0 200 L50 120 L100 140 L180 70 L250 110 L320 50 L380 85 L430 30 L480 75 L530 45 L580 90 L640 60 L700 100 L750 75 L800 110 L800 200Z" fill="url(#mt1)" opacity="0.6"/>
          <!-- Front range -->
          <path d="M0 200 L80 130 L140 150 L220 80 L280 120 L350 55 L400 90 L450 35 L500 80 L550 50 L610 100 L660 70 L720 115 L780 90 L800 105 L800 200Z" fill="url(#mt2)"/>
          <!-- Snow caps -->
          <path d="M430 30 L445 50 L450 35 L460 55 L480 75 L470 60 L455 48 L440 55 L425 45Z" fill="url(#snow)" opacity="0.9"/>
          <path d="M350 55 L365 72 L370 60 L380 75 L380 85 L370 70 L358 65Z" fill="url(#snow)" opacity="0.8"/>
          <path d="M530 45 L545 62 L550 50 L560 68 L570 80 L555 65 L540 58Z" fill="url(#snow)" opacity="0.8"/>
          <!-- Stars -->
          <circle cx="100" cy="30" r="1.5" fill="white" opacity="0.8"/>
          <circle cx="250" cy="15" r="1" fill="white" opacity="0.6"/>
          <circle cx="600" cy="20" r="1.5" fill="white" opacity="0.7"/>
          <circle cx="700" cy="35" r="1" fill="white" opacity="0.5"/>
          <circle cx="400" cy="10" r="2" fill="white" opacity="0.9"/>
        </svg>
        <div class="easter-tatry-quote">â€Kto raz bol na Gerlachu,<br>zvlÃ¡dne vÅ¡etko."</div>
        <div class="easter-tatry-sub">Klikni kamkoÄ¾vek pre nÃ¡vrat</div>
      `;
      el.onclick = () => el.classList.remove('visible');
      document.body.appendChild(el);
    }
    el.classList.add('visible');
  }

  // â”€â”€ Tab Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function switchTab(tabName) {
    document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
    const paneId = tabName === 'preparation' ? 'tabPreparation' : tabName === 'knowledge' ? 'tabKnowledge' : 'tabContacts';
    document.getElementById(paneId).classList.add('active');
    document.querySelectorAll('.tab-btn').forEach(b => {
      b.classList.toggle('active', b.dataset.tab === tabName);
    });
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  window.switchTab = switchTab;

  // â”€â”€ Hero Banner (merged profile + progress) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderHeroBanner() {
    const box = document.getElementById("heroBanner");
    const onb = document.getElementById("onboardingCard");
    const catSection = document.getElementById("categoriesSection");

    if (!state.profile) {
      box.style.display = "none";
      if (onb) onb.style.display = "block";
      if (catSection) catSection.style.display = "none";
      return;
    }

    box.style.display = "block";
    if (onb) onb.style.display = "none";
    if (catSection) catSection.style.display = "block";

    const p = state.profile;
    const pct = overallScore();
    const col = colorForPct(pct);
    const rank = rankForPct(pct);
    const emoji = emojiForPct(pct);
    const d = p.prepDays || 3;
    const totalPersons = (p.adults||0)+(p.kids||0)+(p.infants||0)+(p.seniors||0);
    const housingMap = { flat: "Byt", rd: "RodinnÃ½ dom", rd_cellar: "RD + pivnica" };
    const budgetMap = { mid: "ZÃ¡kladnÃ¡", premium: "PrÃ©miovÃ¡" };

    box.innerHTML = `
      <div class="hero-top">
        <div class="hero-rank"><span>${rank}</span></div>
        <div style="display:flex; align-items:center; gap:0.75rem;">
          <span class="hero-pct" style="color:${col};">${Math.round(pct)}%</span>
          <button class="btn-ghost" id="btnEditProfile" style="font-size:0.78rem; padding:0.375rem 0.75rem;">UpraviÅ¥ âš™ï¸</button>
        </div>
      </div>
      <div class="progress-bar" style="height:10px; position:relative; z-index:1;">
        <div class="progress-fill" style="width:${Math.round(pct)}%; background:${col};"></div>
      </div>
      ${getMilestoneHtml(pct)}
      <div class="hero-meta">
        <span class="hero-tag">ğŸ‘¥ ${totalPersons} ${totalPersons === 1 ? "osoba" : totalPersons < 5 ? "osoby" : "osÃ´b"}</span>
        <span class="hero-tag">ğŸ“… ${d} ${d === 1 ? "deÅˆ" : d < 5 ? "dni" : "dnÃ­"}</span>
        <span class="hero-tag">ğŸ  ${housingMap[p.housing] || "â€“"}</span>
        <span class="hero-tag">ğŸ’° ${budgetMap[p.budget] || "â€“"}</span>
      </div>`;

    // Re-bind edit profile button
    document.getElementById("btnEditProfile").onclick = openProfileEditor;
  }

  function renderProfileCard() { renderHeroBanner(); }

  function renderOverall() {
    const pct = overallScore();
    const col = colorForPct(pct);
    const mobBar = document.getElementById("overallBarMobile");
    const mobPct = document.getElementById("overallPctMobile");
    if (mobBar) { mobBar.style.width = Math.min(100, pct) + "%"; mobBar.style.background = col; }
    if (mobPct) { mobPct.textContent = Math.round(pct) + "%"; mobPct.style.color = col; }
  }

  function renderCategories() {
    const grid = document.getElementById("categoriesGrid");
    grid.innerHTML = "";
    for (const c of CATEGORIES) {
      const pct = categoryScore(c.id);
      const isSel = state.selectedCategoryId === c.id;
      const col = colorForPct(pct);
      // DynamickÃ¡ farba karty podÄ¾a % - jemnÃ½ tint pozadia a border
      const hue = Math.round((Math.min(100, Math.max(0, pct)) / 100) * 120);
      const cardBg = pct === 0 ? "var(--c-surface)" : `hsl(${hue} 60% 97%)`;
      const cardBorder = isSel
        ? `hsl(${hue} 65% ${pct === 0 ? 55 : 48}%)`
        : pct === 0 ? "var(--c-border)" : `hsl(${hue} 50% 82%)`;
      const cardShadow = isSel
        ? `0 10px 28px hsl(${hue} 60% 40% / 0.18)`
        : "0 1px 3px rgba(0,0,0,0.04)";

      const card = document.createElement("div");
      card.className = "cat-card" + (isSel ? " selected" : "");
      card.style.cssText = `background:${cardBg}; border-color:${cardBorder}; box-shadow:${cardShadow};`;
      card.innerHTML = `
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
          <div style="font-size:1.375rem;">${c.emoji}</div>
          <span style="font-size:1.125rem; font-weight:800; color:${col}; letter-spacing:-0.02em;">${Math.round(pct)}%</span>
        </div>
        <div style="font-weight:700; font-size:0.9375rem; margin-bottom:0.2rem; color:var(--c-text);">${c.name}</div>
        <div style="font-size:0.72rem; color:${pct === 0 ? 'var(--c-muted)' : col}; margin-bottom:0.625rem; font-weight:500;">splnenÃ© na ${Math.round(pct)}%</div>
        <div class="progress-bar" style="height:6px;">
          <div class="progress-fill" style="width:${Math.min(100,pct)}%; background:${col};"></div>
        </div>`;
      card.onclick = () => {
        state.selectedCategoryId = c.id;
        scheduleSave();
        renderCategories(); // aktualizuj selected stav kariet
        openCategoryModal(c);
      };
      grid.appendChild(card);
    }
  }

  // OtvoriÅ¥ modÃ¡lne okno kategÃ³rie
  function openCategoryModal(cat) {
    renderCategoryDetail();
    openModal("modalCategory");
  }

  function renderCategoryDetail() {
    const catId = state.selectedCategoryId;
    const cat = CATEGORIES.find(c => c.id === catId);
    const items = state.items[catId] || [];
    const pct = categoryScore(catId);
    const detail = document.getElementById("categoryDetail");
    detail.innerHTML = "";

    // Aktualizuj modal header
    const modalHeader = document.getElementById("modalCatHeader");
    if (modalHeader) {
      modalHeader.innerHTML = `
        <div style="display:flex; align-items:center; gap:0.875rem;">
          <div style="font-size:1.5rem;">${cat.emoji}</div>
          <div>
            <div style="font-size:1.125rem; font-weight:800; letter-spacing:-0.01em; line-height:1.2;">${cat.name}</div>
            <div style="font-size:0.78rem; color:var(--c-muted); margin-top:0.125rem;">${items.filter(i=>!i.isWaterItem ? i.done : calcWaterCompletion(i)>=100).length} / ${items.length} hotovo</div>
          </div>
          <div style="margin-left:auto; text-align:right; padding-right:0.5rem; line-height:1.1;">
            <div style="font-size:0.72rem; color:var(--c-muted);">splnenÃ© na</div>
            <div style="font-size:1.625rem; font-weight:800; color:${colorForPct(pct)}; letter-spacing:-0.03em;">${Math.round(pct)}%</div>
          </div>
        </div>
        <div style="margin-top:0.75rem;">
          <div class="progress-bar" style="height:6px;">
            <div class="progress-fill" style="width:${Math.min(100,pct)}%; background:${colorForPct(pct)};"></div>
          </div>
        </div>`;
    }

    // Progress v footer
    const modalProgress = document.getElementById("modalCatProgress");
    if (modalProgress) {
      modalProgress.textContent = `${items.filter(i=>!i.isWaterItem ? i.done : calcWaterCompletion(i)>=100).length} z ${items.length} poloÅ¾iek splnenÃ½ch`;
    }

    const list = document.createElement("div");
    list.style.cssText = "display:flex; flex-direction:column; gap:0.5rem;";

    // Docs category: info banner about storage strategy
    if (catId === "docs") {
      const banner = document.createElement("div");
      banner.innerHTML = `
        <div style="background:linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border:1.5px solid #bfdbfe; border-radius:1rem; padding:1rem; margin-bottom:1rem;">
          <div style="font-weight:700; font-size:0.85rem; color:#1e40af; margin-bottom:0.5rem;">ğŸ“‹ Kde uchovÃ¡vaÅ¥ dokumenty?</div>
          <div style="display:grid; grid-template-columns:repeat(2, 1fr); gap:0.375rem; font-size:0.72rem; line-height:1.5;">
            <div style="background:white; border-radius:0.5rem; padding:0.5rem 0.625rem; border:1px solid #bfdbfe;">
              <strong style="color:#1e40af;">ğŸ“ OriginÃ¡l</strong><br>
              <span style="color:var(--c-muted);">Doma v bezpeÄnom mieste (trezor, ohnivzdornÃ¡ schrÃ¡nka)</span>
            </div>
            <div style="background:white; border-radius:0.5rem; padding:0.5rem 0.625rem; border:1px solid #bfdbfe;">
              <strong style="color:#1e40af;">ğŸ“„ KÃ³pia</strong><br>
              <span style="color:var(--c-muted);">PapierovÃ¡ kÃ³pia v evakuaÄnom batohu + u prÃ­buznÃ½ch</span>
            </div>
            <div style="background:white; border-radius:0.5rem; padding:0.5rem 0.625rem; border:1px solid #bfdbfe;">
              <strong style="color:#1e40af;">ğŸ’¾ USB</strong><br>
              <span style="color:var(--c-muted);">Å ifrovanÃ½ USB kÄ¾ÃºÄ v batohu â€“ scany vÅ¡etkÃ½ch dokumentov</span>
            </div>
            <div style="background:white; border-radius:0.5rem; padding:0.5rem 0.625rem; border:1px solid #bfdbfe;">
              <strong style="color:#1e40af;">â˜ï¸ Cloud</strong><br>
              <span style="color:var(--c-muted);">Å ifrovanÃ© ÃºloÅ¾isko (Google Drive, iCloud) â€“ prÃ­stup odkiaÄ¾koÄ¾vek</span>
            </div>
          </div>
          <div style="margin-top:0.5rem; font-size:0.7rem; color:#3b82f6; line-height:1.5; font-style:italic;">
            âš ï¸ Crypto seed / recovery frÃ¡zy NIKDY nescanovaÅ¥ a neukladaÅ¥ digitÃ¡lne! Iba papier na 2 odliÅ¡nÃ½ch miestach.
          </div>
        </div>`;
      list.appendChild(banner);
    }

    if (!items.length) {
      list.innerHTML = `<p style="color:var(--c-muted); font-size:0.875rem;">ZatiaÄ¾ Å¾iadne poloÅ¾ky.</p>`;
    } else {
      let lastDocGroup = "";
      items.forEach((it, idx) => {
        // Group headers for docs category
        if (catId === "docs" && it.docGroup && it.docGroup !== lastDocGroup) {
          lastDocGroup = it.docGroup;
          const groupEmojis = { "OsobnÃ© dokumenty": "ğŸªª", "Majetok a bÃ½vanie": "ğŸ ", "Auto a doprava": "ğŸš—", "Vzdelanie a prÃ¡ca": "ğŸ“", "Financie": "ğŸ’°", "ZdravotnÃ© dokumenty": "ğŸ¥", "KrÃ­zovÃ© dokumenty": "ğŸš¨" };
          const gh = document.createElement("div");
          gh.style.cssText = "padding:0.625rem 0 0.25rem; margin-top:0.375rem;";
          gh.innerHTML = `<div style="font-size:0.72rem; font-weight:700; color:var(--c-muted); text-transform:uppercase; letter-spacing:0.05em;">${groupEmojis[it.docGroup]||"ğŸ“‹"} ${it.docGroup}</div>`;
          list.appendChild(gh);
        }
        if (it.isWaterItem && state.profile) {
          const p = state.profile;
          const d = p.prepDays || 3;
          const total = ((p.adults||0)*2 + (p.kids||0)*1.5 + (p.infants||0)*1 + (p.seniors||0)*2) * d;
          const current = (it.waterBottles||0) * 1.5;
          const wpct = calcWaterCompletion(it);
          const wCol = colorForPct(wpct);

          // VÃ½poÄet na koÄ¾ko dnÃ­/hodÃ­n vydrÅ¾Ã­ aktuÃ¡lna zÃ¡soba
          const dailyNeed = ((p.adults||0)*2 + (p.kids||0)*1.5 + (p.infants||0)*1 + (p.seniors||0)*2) * (p.readinessCoeff||1.0);
          const totalHours = dailyNeed > 0 ? (current / dailyNeed) * 24 : 0;
          const durDays = Math.floor(totalHours / 24);
          const durHours = Math.round(totalHours % 24);

          let durText = "";
          if (current === 0) {
            durText = "Å½iadna zÃ¡soba";
          } else if (totalHours < 24) {
            const h = Math.round(totalHours);
            durText = h <= 0 ? "Menej ako hodinu" : h === 1 ? "1 hodinu" : h < 5 ? h + " hodiny" : h + " hodÃ­n";
          } else {
            const dayWord = durDays === 1 ? "deÅˆ" : durDays < 5 ? "dni" : "dnÃ­";
            const hourPart = durHours > 0 ? (" a " + durHours + (durHours === 1 ? " hodinu" : durHours < 5 ? " hodiny" : " hodÃ­n")) : "";
            durText = durDays + " " + dayWord + hourPart;
          }
          // Farba podÄ¾a % naplnenia - rovnakÃ¡ logika ako vÅ¡ade inde
          const durPct = Math.min(100, (totalHours / ((p.prepDays||3) * 24)) * 100);
          const durHue = Math.round((Math.min(100, Math.max(0, durPct)) / 100) * 120);
          const durColor = `hsl(${durHue} 70% 34%)`;
          const durBg = `hsl(${durHue} 70% 96%)`;
          const durBorder = `hsl(${durHue} 60% 80%)`;

          const row = document.createElement("div");
          row.className = "water-card";
          row.innerHTML = `
            <div style="display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:0.875rem; gap:0.75rem;">
              <div style="font-weight:700; font-size:1rem;">ğŸ’§ ${esc(it.name)}</div>
              <span style="font-size:0.95rem; font-weight:700; color:${wCol}; flex-shrink:0;">${Math.round(wpct)}%</span>
            </div>

            <div class="water-info-grid" style="display:grid; grid-template-columns:1fr auto; gap:0.625rem; margin-bottom:0.875rem; align-items:stretch;">
              <div style="background:rgba(255,255,255,0.7); border-radius:0.625rem; padding:0.625rem 0.75rem;">
                <div style="font-size:0.7rem; color:#3b82f6; font-weight:600; margin-bottom:0.2rem; text-transform:uppercase; letter-spacing:0.04em;">ZÃ¡soby</div>
                <div style="font-size:0.9rem; font-weight:700; color:#1e3a8a;">${litreSklon(current)}</div>
                <div style="font-size:0.72rem; color:#3b82f6;">z potrebnÃ½ch ${litreSklon(total)} na ${d} ${d===1?"deÅˆ":d<5?"dni":"dnÃ­"}</div>
              </div>
              <div style="background:${durBg}; border:1px solid ${durBorder}; border-radius:0.625rem; padding:0.625rem 0.875rem; min-width:0; white-space:nowrap;">
                <div style="font-size:0.68rem; color:${durColor}; font-weight:600; margin-bottom:0.25rem; text-transform:uppercase; letter-spacing:0.04em;">VydrÅ¾Ã­ vÃ¡m na</div>
                <div style="font-size:0.95rem; font-weight:800; color:${durColor}; line-height:1.2;">${durText}</div>
                <div style="font-size:0.68rem; color:${durColor}; opacity:0.75; margin-top:0.2rem;">pri spotrebe ${dailyNeed.toFixed(1)} l/deÅˆ</div>
              </div>
            </div>

            <div class="progress-bar" style="margin-bottom:0.875rem; height:10px;">
              <div class="progress-fill" style="width:${Math.min(100,wpct)}%; background:${colorForPct(wpct)};"></div>
            </div>

            <div style="display:flex; align-items:center; gap:0.75rem;">
              <label style="font-size:0.8rem; color:#1e40af; white-space:nowrap; font-weight:500;">FÄ¾aÅ¡e 1,5 l:</label>
              <input type="number" min="0" value="${it.waterBottles||0}" id="wb_${idx}" style="width:80px;" />
              <span style="font-size:0.8rem; color:#3b82f6;">${litreSklon(current)} celkom</span>
            </div>`;
          list.appendChild(row);
          setTimeout(() => {
            const inp = document.getElementById(`wb_${idx}`);
            if (inp) inp.onchange = () => {
              state.items[catId][idx].waterBottles = Number(inp.value)||0;
              scheduleSave(); renderAll();
            };
          }, 0);
          return;
        }

        const exp = it.expiry ? daysUntil(it.expiry) : null;
        const catAlertDays = getAlertDaysForCategory(catId);
        const expBadge = it.expiry
          ? (exp < 0 ? `<span class="badge badge-red">EXPIROVANÃ‰</span>`
            : exp <= catAlertDays ? `<span class="badge badge-amber">za ${exp} dnÃ­</span>`
            : `<span class="badge badge-gray">za ${exp} dnÃ­</span>`)
          : "";
        const linkBtn = (it.link && isValidUrl(it.link))
          ? `<a href="${esc(it.link)}" target="_blank" rel="noopener" class="btn-ghost" style="padding:0.375rem 0.625rem; text-decoration:none;">ğŸ”—</a>`
          : "";

        const row = document.createElement("div");
        row.className = "item-row";
        row.innerHTML = `
          <input type="checkbox" style="margin-top:2px; width:16px; height:16px; accent-color:var(--c-green); flex-shrink:0;" ${it.done?"checked":""} data-toggle="${catId}:${idx}" />
          <div style="flex:1; min-width:0;">
            <div style="font-weight:500; font-size:0.875rem; ${it.done?"text-decoration:line-through; color:var(--c-muted)":""}">${esc(it.name)} ${expBadge}</div>
            <div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">${it.qty||"â€”"}${it.expiry ? " â€¢ " + it.expiry : ""}</div>
          </div>
          <div style="display:flex; gap:0.375rem; flex-shrink:0;">
            ${linkBtn}
            <button class="btn-ghost item-btn-edit" style="padding:0.375rem 0.625rem; font-size:0.75rem;" data-edit="${catId}:${idx}">UpraviÅ¥</button>
            <button class="btn-danger item-btn-del" style="padding:0.375rem 0.625rem;" data-del="${catId}:${idx}">âœ•</button>
          </div>`;
        list.appendChild(row);
      });
    }

    detail.appendChild(list);

    // Bind item actions
    detail.querySelectorAll("[data-toggle]").forEach(el => {
      el.onchange = () => {
        const [cid, i] = el.dataset.toggle.split(":");
        state.items[cid][+i].done = el.checked;
        scheduleSave(); renderAll();
      };
    });
    detail.querySelectorAll("[data-del]").forEach(el => {
      el.onclick = () => {
        const [cid, i] = el.dataset.del.split(":");
        openDeleteConfirmation(cid, +i);
      };
    });
    detail.querySelectorAll("[data-edit]").forEach(el => {
      el.onclick = () => {
        const [cid, i] = el.dataset.edit.split(":");
        openItemModal(cid, +i);
      };
    });
  }

  function renderPlans() {
    renderMeetingPoint();
    renderScenarios();
  }

  // â”€â”€ Miesto stretnutia â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderMeetingPoint() {
    const box = document.getElementById("meetingPointBox");
    if (!box) return;
    const mp = state.plans.meetingPoint;
    const hasData = mp.name && mp.name.trim();
    const hasTimes = mp.times && mp.times.length > 0;
    const hasBackup = mp.backup && mp.backup.name && mp.backup.name.trim();

    if (!hasData) {
      box.innerHTML = `
        <div style="background:linear-gradient(135deg, #fef3c7 0%, #fef9c3 100%); border:1.5px solid #fcd34d; border-radius:1rem; padding:1.25rem; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;" onclick="openMeetingPointModal()" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 18px rgba(0,0,0,0.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
          <div style="display:flex; align-items:center; gap:0.75rem;">
            <div style="width:48px; height:48px; border-radius:50%; background:#fbbf24; display:flex; align-items:center; justify-content:center; font-size:1.375rem; flex-shrink:0;">ğŸ“</div>
            <div style="flex:1;">
              <div style="font-weight:700; font-size:0.95rem; color:#92400e;">Nastavte miesto stretnutia</div>
              <div style="font-size:0.78rem; color:#a16207; line-height:1.5; margin-top:0.2rem;">Kde sa stretnete, keÄ vypadne signÃ¡l a internet? Dohodnite sa vopred s celou rodinou.</div>
            </div>
            <div style="font-size:1.25rem; color:#a16207; flex-shrink:0;">â†’</div>
          </div>
        </div>`;
      return;
    }

    let timesHtml = "";
    if (hasTimes) {
      timesHtml = `<div style="display:flex; flex-wrap:wrap; gap:0.375rem; margin-top:0.625rem;">` +
        mp.times.sort().map(t => `<span style="background:#eff6ff; border:1px solid #bfdbfe; color:#1e40af; border-radius:0.5rem; padding:0.2rem 0.5rem; font-size:0.75rem; font-weight:700; font-family:'Lexend',sans-serif;">${t}</span>`).join("") +
        `</div>`;
    }

    let backupHtml = "";
    if (hasBackup) {
      backupHtml = `
        <div style="margin-top:0.75rem; padding-top:0.75rem; border-top:1px dashed #bfdbfe;">
          <div style="font-size:0.72rem; font-weight:600; color:#3b82f6; text-transform:uppercase; letter-spacing:0.04em; margin-bottom:0.25rem;">ZÃ¡loÅ¾nÃ© miesto</div>
          <div style="font-weight:600; font-size:0.85rem;">${esc(mp.backup.name)}</div>
          ${mp.backup.address ? `<div style="font-size:0.75rem; color:var(--c-muted);">${esc(mp.backup.address)}</div>` : ""}
        </div>`;
    }

    box.innerHTML = `
      <div style="background:linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border:1.5px solid #bfdbfe; border-radius:1rem; padding:1.25rem;">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:0.75rem;">
          <div style="display:flex; align-items:flex-start; gap:0.75rem; flex:1; min-width:0;">
            <div style="width:48px; height:48px; border-radius:50%; background:#3b82f6; display:flex; align-items:center; justify-content:center; font-size:1.375rem; flex-shrink:0; color:white;">ğŸ“</div>
            <div style="flex:1; min-width:0;">
              <div style="font-size:0.68rem; font-weight:600; color:#3b82f6; text-transform:uppercase; letter-spacing:0.04em;">Miesto stretnutia</div>
              <div style="font-weight:800; font-size:1.0625rem; color:var(--c-text); margin-top:0.125rem;">${esc(mp.name)}</div>
              ${mp.address ? `<div style="font-size:0.8rem; color:var(--c-muted); margin-top:0.125rem;">ğŸ“Œ ${esc(mp.address)}</div>` : ""}
              ${mp.note ? `<div style="font-size:0.78rem; color:var(--c-muted); margin-top:0.25rem; font-style:italic;">${esc(mp.note)}</div>` : ""}
              ${hasTimes ? `<div style="margin-top:0.5rem;"><div style="font-size:0.68rem; font-weight:600; color:#3b82f6; margin-bottom:0.25rem;">â° ÄŒASY STRETÃVANIA</div>${timesHtml}</div>` : ""}
            </div>
          </div>
          <button class="btn-ghost" onclick="openMeetingPointModal()" style="font-size:0.78rem; padding:0.375rem 0.75rem; flex-shrink:0;">UpraviÅ¥</button>
        </div>
        ${backupHtml}
        <div style="background:rgba(255,255,255,0.6); border-radius:0.625rem; padding:0.625rem 0.75rem; margin-top:0.75rem; font-size:0.75rem; color:#1e40af; line-height:1.5;">
          ğŸ’¡ <strong>Pravidlo:</strong> Ak tam ten druhÃ½ nie je, poÄkajte 30 minÃºt a prÃ­Äte znova o ÄalÅ¡Ã­ interval.
        </div>
      </div>`;
  }

  // â”€â”€ KrÃ­zovÃ© scenÃ¡re â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const SCENARIO_DEFS = [
    {
      id: "home",
      emoji: "ğŸ ",
      title: "CelÃ¡ rodina je doma",
      subtitle: "KrÃ­zovÃ¡ situÃ¡cia zastihne vÅ¡etkÃ½ch doma spolu",
      color: "#2a7a4b",
      bg: "#eaf4ee",
      border: "#86efac"
    },
    {
      id: "separated",
      emoji: "ğŸ«",
      title: "RodiÄia v prÃ¡ci, deti mimo",
      subtitle: "Deti sÃº v Å¡kole / Å¡kÃ´lke / krÃºÅ¾koch â€“ oddelenÃ­ od rodiÄov",
      color: "#b45309",
      bg: "#fef3c7",
      border: "#fcd34d"
    },
    {
      id: "partial",
      emoji: "ğŸ‘¨â€ğŸ‘§",
      title: "Jeden rodiÄ doma, druhÃ½ v prÃ¡ci",
      subtitle: "Jeden z partnerov je s deÅ¥mi, druhÃ½ inde",
      color: "#1e40af",
      bg: "#eff6ff",
      border: "#bfdbfe"
    }
  ];

  function renderScenarios() {
    const box = document.getElementById("scenariosBox");
    if (!box) return;
    box.innerHTML = "";
    SCENARIO_DEFS.forEach(def => {
      const scenario = state.plans.scenarios[def.id];
      const filled = isScenarioFilled(def.id, scenario);
      const card = document.createElement("div");
      card.style.cssText = `background:${def.bg}; border:1.5px solid ${def.border}; border-radius:1rem; padding:1rem; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;`;
      card.onmouseover = () => { card.style.transform = "translateY(-2px)"; card.style.boxShadow = "0 6px 18px rgba(0,0,0,0.08)"; };
      card.onmouseout = () => { card.style.transform = ""; card.style.boxShadow = ""; };

      let previewHtml = "";
      if (filled) {
        previewHtml = getScenarioPreview(def.id, scenario);
      } else {
        previewHtml = `<div style="font-size:0.78rem; color:${def.color}; opacity:0.7; margin-top:0.375rem;">DoplniÅ¥ plÃ¡n pre tento scenÃ¡r â†’</div>`;
      }

      card.innerHTML = `
        <div style="display:flex; align-items:flex-start; gap:0.75rem;">
          <div style="width:40px; height:40px; border-radius:50%; background:white; border:1.5px solid ${def.border}; display:flex; align-items:center; justify-content:center; font-size:1.125rem; flex-shrink:0;">${def.emoji}</div>
          <div style="flex:1; min-width:0;">
            <div style="display:flex; align-items:center; gap:0.5rem;">
              <div style="font-weight:700; font-size:0.9rem; color:${def.color};">${def.title}</div>
              ${filled ? `<span style="background:white; border:1px solid ${def.border}; border-radius:999px; padding:0.1rem 0.4rem; font-size:0.625rem; font-weight:700; color:${def.color};">âœ“ HOTOVO</span>` : ""}
            </div>
            <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.125rem;">${def.subtitle}</div>
            ${previewHtml}
          </div>
        </div>`;
      card.onclick = () => openScenarioModal(def.id);
      box.appendChild(card);
    });
  }

  function isScenarioFilled(id, s) {
    if (id === "home") return !!(s.steps && s.steps.trim());
    if (id === "separated") return (s.tasks && s.tasks.length > 0) || !!(s.meetPlace && s.meetPlace.trim());
    if (id === "partial") return !!(s.whoHome && s.whoHome.trim()) || !!(s.whoWork && s.whoWork.trim());
    return false;
  }

  function getScenarioPreview(id, s) {
    if (id === "home") {
      const lines = (s.steps||"").split("\n").filter(l => l.trim()).slice(0, 2);
      return `<div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.375rem; line-height:1.5;">${lines.map(l => esc(l)).join("<br>")}</div>`;
    }
    if (id === "separated") {
      const taskCount = (s.tasks||[]).length;
      const taskPrev = (s.tasks||[]).slice(0, 2).map(t => `<strong>${esc(t.person||"?")}</strong> â†’ vyzdvihne <strong>${esc(t.picksUp||"?")}</strong> z ${esc(t.from||"?")}`).join("; ");
      return `<div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.375rem; line-height:1.5;">${taskCount > 0 ? taskPrev : ""}${s.meetPlace ? `<br>Stretnutie: <strong>${esc(s.meetPlace)}</strong>` : ""}${s.meetTime ? ` o <strong>${esc(s.meetTime)}</strong>` : ""}</div>`;
    }
    if (id === "partial") {
      return `<div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.375rem; line-height:1.5;">${s.whoHome ? `Doma: <strong>${esc(s.whoHome)}</strong>` : ""}${s.whoWork ? ` | V prÃ¡ci: <strong>${esc(s.whoWork)}</strong>` : ""}</div>`;
    }
    return "";
  }

  // â”€â”€ Meeting point modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let tempMeetingTimes = [];

  function openMeetingPointModal() {
    const mp = state.plans.meetingPoint;
    const f = document.getElementById("meetingPointForm");
    f.elements["mp_name"].value = mp.name || "";
    f.elements["mp_address"].value = mp.address || "";
    f.elements["mp_note"].value = mp.note || "";
    f.elements["mp_backup_name"].value = (mp.backup||{}).name || "";
    f.elements["mp_backup_address"].value = (mp.backup||{}).address || "";
    tempMeetingTimes = [...(mp.times || [])];
    renderMeetingTimesEditor();
    openModal("modalMeetingPoint");
  }

  function renderMeetingTimesEditor() {
    const box = document.getElementById("meetingTimesEditor");
    if (!box) return;
    box.innerHTML = tempMeetingTimes.sort().map((t, i) => `
      <span style="display:inline-flex; align-items:center; gap:0.25rem; background:white; border:1.5px solid #bfdbfe; border-radius:0.5rem; padding:0.25rem 0.375rem 0.25rem 0.5rem; font-size:0.8rem; font-weight:700; color:#1e40af; font-family:'Lexend',sans-serif;">
        ${t}
        <button type="button" onclick="removeMeetingTime(${i})" style="background:none; border:none; cursor:pointer; color:#93c5fd; font-size:1rem; line-height:1; padding:0 0.125rem;" title="OdstrÃ¡niÅ¥">âœ•</button>
      </span>
    `).join("");
  }

  function removeMeetingTime(i) {
    tempMeetingTimes.splice(i, 1);
    renderMeetingTimesEditor();
  }
  // expose to onclick
  window.removeMeetingTime = removeMeetingTime;
  window.openMeetingPointModal = openMeetingPointModal;

  document.getElementById("btnAddMeetingTime").onclick = () => {
    const inp = document.getElementById("newMeetingTime");
    if (inp.value && !tempMeetingTimes.includes(inp.value)) {
      tempMeetingTimes.push(inp.value);
      inp.value = "";
      renderMeetingTimesEditor();
    }
  };

  document.getElementById("meetingPointForm").onsubmit = (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    state.plans.meetingPoint = {
      name: String(fd.get("mp_name")||"").trim(),
      address: String(fd.get("mp_address")||"").trim(),
      note: String(fd.get("mp_note")||"").trim(),
      times: [...tempMeetingTimes],
      backup: {
        name: String(fd.get("mp_backup_name")||"").trim(),
        address: String(fd.get("mp_backup_address")||"").trim()
      }
    };
    closeModal("modalMeetingPoint");
    scheduleSave(); renderPlans();
  };

  // â”€â”€ Scenario modals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openScenarioModal(scenarioId) {
    const def = SCENARIO_DEFS.find(d => d.id === scenarioId);
    const s = state.plans.scenarios[scenarioId];
    document.getElementById("scenarioModalTitle").textContent = def.emoji + " " + def.title;
    document.getElementById("scenarioModalSubtitle").textContent = def.subtitle;
    const content = document.getElementById("scenarioModalContent");

    if (scenarioId === "home") {
      content.innerHTML = `
        <form id="scenarioHomeForm" style="display:grid; gap:1rem;">
          <div style="background:${def.bg}; border:1px solid ${def.border}; border-radius:0.75rem; padding:0.75rem 1rem; font-size:0.78rem; color:${def.color}; line-height:1.6;">
            <strong>SituÃ¡cia:</strong> CelÃ¡ rodina je doma keÄ nastane krÃ­za. ÄŒo robÃ­te ako prvÃ©?
          </div>
          <div>
            <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">Postup krok za krokom</label>
            <textarea name="steps" rows="6" style="line-height:1.6; font-size:0.85rem;" placeholder="1. ZostaÅˆte pokojnÃ­ a zistite Äo sa deje&#10;2. Skontrolujte zÃ¡soby&#10;3. Sledujte rozhlas&#10;4. Ak treba evakuovaÅ¥...">${esc(s.steps||"")}</textarea>
          </div>
          <div>
            <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">Kam evakuujete? (ak treba opustiÅ¥ dom)</label>
            <input name="evacPlace" type="text" value="${esc(s.evacPlace||"")}" placeholder="napr. K starÃ½m rodiÄom, na chatu, na miesto stretnutia..." />
          </div>
          <div>
            <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">PoznÃ¡mka</label>
            <input name="note" type="text" value="${esc(s.note||"")}" placeholder="ÄŒokoÄ¾vek dÃ´leÅ¾itÃ© pre tento scenÃ¡r" />
          </div>
          <div style="display:flex; justify-content:flex-end;">
            <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
          </div>
        </form>`;
      content.querySelector("#scenarioHomeForm").onsubmit = (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        state.plans.scenarios.home = {
          steps: String(fd.get("steps")||"").trim(),
          evacPlace: String(fd.get("evacPlace")||"").trim(),
          note: String(fd.get("note")||"").trim()
        };
        closeModal("modalScenario");
        scheduleSave(); renderPlans();
      };
    }

    else if (scenarioId === "separated") {
      const tasks = s.tasks || [];
      let tasksHtml = "";
      tasks.forEach((t, i) => {
        tasksHtml += `
          <div class="sep-task-row" style="background:white; border:1.5px solid ${def.border}; border-radius:0.875rem; padding:0.875rem; position:relative;">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
              <div style="font-weight:700; font-size:0.8rem; color:${def.color};">Ãšloha ${i+1}</div>
              <button type="button" data-removetask="${i}" style="background:none; border:none; cursor:pointer; color:#dc2626; font-size:0.8rem; font-weight:600; font-family:'Lexend',sans-serif;">OdstrÃ¡niÅ¥</button>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem;">
              <div>
                <label style="font-size:0.68rem; color:var(--c-muted); display:block; margin-bottom:0.2rem;">Kto ide?</label>
                <input name="task_person_${i}" type="text" value="${esc(t.person||"")}" placeholder="napr. Mama, Ocko, Babka..." style="font-size:0.85rem;" />
              </div>
              <div>
                <label style="font-size:0.68rem; color:var(--c-muted); display:block; margin-bottom:0.2rem;">Vyzdvihne koho?</label>
                <input name="task_picksUp_${i}" type="text" value="${esc(t.picksUp||"")}" placeholder="napr. Jakub, Ema..." style="font-size:0.85rem;" />
              </div>
              <div>
                <label style="font-size:0.68rem; color:var(--c-muted); display:block; margin-bottom:0.2rem;">OdkiaÄ¾?</label>
                <input name="task_from_${i}" type="text" value="${esc(t.from||"")}" placeholder="napr. ZÅ  PartizÃ¡nska, MÅ  LÃºÄka..." style="font-size:0.85rem;" />
              </div>
              <div>
                <label style="font-size:0.68rem; color:var(--c-muted); display:block; margin-bottom:0.2rem;">PoznÃ¡mka</label>
                <input name="task_note_${i}" type="text" value="${esc(t.note||"")}" placeholder="napr. BoÄnÃ½ vchod, trieda 3.A" style="font-size:0.85rem;" />
              </div>
            </div>
          </div>`;
      });

      content.innerHTML = `
        <form id="scenarioSepForm" style="display:grid; gap:1rem;">
          <div style="background:${def.bg}; border:1px solid ${def.border}; border-radius:0.75rem; padding:0.75rem 1rem; font-size:0.78rem; color:${def.color}; line-height:1.6;">
            <strong>SituÃ¡cia:</strong> RodiÄia sÃº v prÃ¡ci, deti v Å¡kole/Å¡kÃ´lke/krÃºÅ¾koch. Kto ide pre koho?
          </div>
          <div>
            <div style="font-size:0.78rem; font-weight:700; margin-bottom:0.5rem;">Rozdelenie Ãºloh</div>
            <div id="sepTasksList" style="display:flex; flex-direction:column; gap:0.625rem;">${tasksHtml}</div>
            <button type="button" id="btnAddSepTask" class="btn-ghost" style="margin-top:0.625rem; font-size:0.78rem; padding:0.5rem 1rem; width:100%; text-align:center;">+ PridaÅ¥ Ãºlohu (kto ide pre koho)</button>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.625rem;">
            <div>
              <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">Kde sa vÅ¡etci stretnete?</label>
              <input name="meetPlace" type="text" value="${esc(s.meetPlace||"")}" placeholder="napr. Doma, alebo miesto stretnutia" />
            </div>
            <div>
              <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">O koÄ¾kej najneskÃ´r?</label>
              <input name="meetTime" type="text" value="${esc(s.meetTime||"")}" placeholder="napr. Do 2 hodÃ­n, o 15:00..." />
            </div>
          </div>
          <div>
            <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">PoznÃ¡mka</label>
            <input name="note" type="text" value="${esc(s.note||"")}" placeholder="napr. Ak sa nedÃ¡ vyzdvihnÃºÅ¥ do 1h, volaÅ¥ babku..." />
          </div>
          <div style="display:flex; justify-content:flex-end;">
            <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
          </div>
        </form>`;

      let taskCount = tasks.length;
      const addTaskBtn = content.querySelector("#btnAddSepTask");
      const tasksList = content.querySelector("#sepTasksList");
      addTaskBtn.onclick = () => {
        const i = taskCount++;
        const row = document.createElement("div");
        row.className = "sep-task-row";
        row.style.cssText = `background:white; border:1.5px solid ${def.border}; border-radius:0.875rem; padding:0.875rem; position:relative;`;
        row.innerHTML = `
          <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
            <div style="font-weight:700; font-size:0.8rem; color:${def.color};">Ãšloha ${i+1}</div>
            <button type="button" data-removetask="${i}" style="background:none; border:none; cursor:pointer; color:#dc2626; font-size:0.8rem; font-weight:600; font-family:'Lexend',sans-serif;">OdstrÃ¡niÅ¥</button>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem;">
            <div><label style="font-size:0.68rem; color:var(--c-muted); display:block; margin-bottom:0.2rem;">Kto ide?</label><input name="task_person_${i}" type="text" placeholder="napr. Mama, Ocko, Babka..." style="font-size:0.85rem;" /></div>
            <div><label style="font-size:0.68rem; color:var(--c-muted); display:block; margin-bottom:0.2rem;">Vyzdvihne koho?</label><input name="task_picksUp_${i}" type="text" placeholder="napr. Jakub, Ema..." style="font-size:0.85rem;" /></div>
            <div><label style="font-size:0.68rem; color:var(--c-muted); display:block; margin-bottom:0.2rem;">OdkiaÄ¾?</label><input name="task_from_${i}" type="text" placeholder="napr. ZÅ  PartizÃ¡nska, MÅ  LÃºÄka..." style="font-size:0.85rem;" /></div>
            <div><label style="font-size:0.68rem; color:var(--c-muted); display:block; margin-bottom:0.2rem;">PoznÃ¡mka</label><input name="task_note_${i}" type="text" placeholder="" style="font-size:0.85rem;" /></div>
          </div>`;
        tasksList.appendChild(row);
        bindRemoveButtons();
      };

      function bindRemoveButtons() {
        content.querySelectorAll("[data-removetask]").forEach(b => {
          b.onclick = () => { b.closest(".sep-task-row").remove(); };
        });
      }
      bindRemoveButtons();

      content.querySelector("#scenarioSepForm").onsubmit = (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        const newTasks = [];
        const rows = content.querySelectorAll(".sep-task-row");
        rows.forEach(row => {
          const inputs = row.querySelectorAll("input");
          if (inputs.length >= 2) {
            const task = {
              person: (inputs[0]?.value||"").trim(),
              picksUp: (inputs[1]?.value||"").trim(),
              from: (inputs[2]?.value||"").trim(),
              note: (inputs[3]?.value||"").trim()
            };
            if (task.person || task.picksUp) newTasks.push(task);
          }
        });
        state.plans.scenarios.separated = {
          tasks: newTasks,
          meetPlace: String(fd.get("meetPlace")||"").trim(),
          meetTime: String(fd.get("meetTime")||"").trim(),
          note: String(fd.get("note")||"").trim()
        };
        closeModal("modalScenario");
        scheduleSave(); renderPlans();
      };
    }

    else if (scenarioId === "partial") {
      content.innerHTML = `
        <form id="scenarioPartForm" style="display:grid; gap:1rem;">
          <div style="background:${def.bg}; border:1px solid ${def.border}; border-radius:0.75rem; padding:0.75rem 1rem; font-size:0.78rem; color:${def.color}; line-height:1.6;">
            <strong>SituÃ¡cia:</strong> Jeden z partnerov je doma s deÅ¥mi, druhÃ½ je v prÃ¡ci. ÄŒo robÃ­ kaÅ¾dÃ½?
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.625rem;">
            <div>
              <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">Kto je doma?</label>
              <input name="whoHome" type="text" value="${esc(s.whoHome||"")}" placeholder="napr. Mama, MiÅ¡o..." />
            </div>
            <div>
              <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">Kto je v prÃ¡ci?</label>
              <input name="whoWork" type="text" value="${esc(s.whoWork||"")}" placeholder="napr. Ocko, Katka..." />
            </div>
          </div>
          <div>
            <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">ÄŒo robÃ­ ten doma?</label>
            <textarea name="homeSteps" rows="3" style="line-height:1.6; font-size:0.85rem;" placeholder="PripravÃ­ batoh, zabezpeÄÃ­ deti, ide na miesto stretnutia...">${esc(s.homeSteps||"")}</textarea>
          </div>
          <div>
            <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">ÄŒo robÃ­ ten v prÃ¡ci?</label>
            <textarea name="workSteps" rows="3" style="line-height:1.6; font-size:0.85rem;" placeholder="BezpeÄne opustÃ­ pracovisko, smeruje domov alebo na miesto stretnutia...">${esc(s.workSteps||"")}</textarea>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.625rem;">
            <div>
              <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">Kde sa stretnete?</label>
              <input name="meetPlace" type="text" value="${esc(s.meetPlace||"")}" placeholder="napr. Doma, alebo miesto stretnutia" />
            </div>
            <div>
              <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">O koÄ¾kej najneskÃ´r?</label>
              <input name="meetTime" type="text" value="${esc(s.meetTime||"")}" placeholder="napr. Do 2 hodÃ­n, ASAP..." />
            </div>
          </div>
          <div>
            <label style="font-size:0.78rem; color:var(--c-muted); display:block; margin-bottom:0.375rem; font-weight:600;">PoznÃ¡mka</label>
            <input name="note" type="text" value="${esc(s.note||"")}" placeholder="napr. KÄ¾ÃºÄe od auta â€“ v Å¡uflÃ­ku v chodbe..." />
          </div>
          <div style="display:flex; justify-content:flex-end;">
            <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
          </div>
        </form>`;
      content.querySelector("#scenarioPartForm").onsubmit = (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        state.plans.scenarios.partial = {
          whoHome: String(fd.get("whoHome")||"").trim(),
          whoWork: String(fd.get("whoWork")||"").trim(),
          homeSteps: String(fd.get("homeSteps")||"").trim(),
          workSteps: String(fd.get("workSteps")||"").trim(),
          meetPlace: String(fd.get("meetPlace")||"").trim(),
          meetTime: String(fd.get("meetTime")||"").trim(),
          note: String(fd.get("note")||"").trim()
        };
        closeModal("modalScenario");
        scheduleSave(); renderPlans();
      };
    }

    openModal("modalScenario");
  }

  function getAlertDaysForCategory(catId) {
    if (catId === "medkit") return state.alertDaysMeds || 180;
    if (catId === "food_water") return state.alertDaysFood || 30;
    return state.alertDaysFood || 30;
  }

  function renderAlerts() {
    // Sync select values from state
    const selMeds = document.getElementById("alertDaysMeds");
    const selFood = document.getElementById("alertDaysFood");
    if (selMeds) selMeds.value = state.alertDaysMeds || 180;
    if (selFood) selFood.value = state.alertDaysFood || 30;

    const alerts = [];
    for (const c of CATEGORIES) {
      const threshold = getAlertDaysForCategory(c.id);
      (state.items[c.id]||[]).forEach((it, idx) => {
        if (!it.expiry) return;
        const d = daysUntil(it.expiry);
        if (d <= threshold) alerts.push({ ...it, catName: c.name, catId: c.id, idx, days: d, threshold });
      });
    }
    alerts.sort((a,b) => a.days - b.days);
    const section = document.getElementById("alertsSection");
    const box = document.getElementById("alertsBox");
    // Email notif status â€“ update in profile modal
    const emailStatus = document.getElementById("emailNotifStatus");
    if (emailStatus) {
      const configured = EMAILJS_CONFIG.publicKey !== "YOUR_EMAILJS_PUBLIC_KEY";
      emailStatus.textContent = configured
        ? `âœ… AktÃ­vne â€“ pripomienky na ${currentUser?.email || "vÃ¡Å¡ email"}`
        : "Pripomienky zatiaÄ¾ nie sÃº aktÃ­vne";
      emailStatus.style.color = configured ? "var(--c-green)" : "var(--c-muted)";
    }

    if (!alerts.length) { section.style.display = "none"; return; }
    section.style.display = "block";
    box.innerHTML = alerts.slice(0,6).map(a => `
      <div style="display:flex; align-items:center; justify-content:space-between; padding:0.625rem 0; border-bottom:1px solid var(--c-border);">
        <div>
          <div style="font-weight:500; font-size:0.875rem;">${esc(a.name)}</div>
          <div style="font-size:0.75rem; color:var(--c-muted);">${esc(a.catName)} â€¢ ${esc(a.expiry)}</div>
        </div>
        <span class="badge ${a.days < 0 ? 'badge-red' : 'badge-amber'}">${a.days < 0 ? 'EXPIROVANÃ‰' : 'za ' + a.days + ' dnÃ­'}</span>
      </div>`).join("");
  }


  // Zobrazenie litrov - vÅ¾dy len ÄÃ­slo + "l"
  function litreSklon(val) {
    const n = parseFloat(val);
    return n.toFixed(1) + " l";
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PRVÃ POMOC â€“ dÃ¡ta podÄ¾a ERC Guidelines 2025 + prÃ­ruÄka MV SR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const FIRST_AID_DATA = [
    {
      id: "cardiac_arrest",
      emoji: "â¤ï¸",
      title: "ZÃ¡stava srdca",
      subtitle: "KPR â€“ KardiopulmonÃ¡lna resuscitÃ¡cia",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { text: "<strong>Zistite stav osoby</strong> â€“ zavolajte na Åˆu a jemne Åˆou potriaste za ramenÃ¡. Ak nereaguje a nedÃ½cha alebo dÃ½cha abnormÃ¡lne (lapavÃ©, chrÄivÃ© dÃ½chanie), ide o zÃ¡stavu srdca." },
        { text: "<strong>Zavolajte 155 alebo 112</strong> â€“ aktivujte zÃ¡chranku ihneÄ. Ak je prÃ­tomnÃ½ niekto ÄalÅ¡Ã­, nechajte ho zavolaÅ¥ a vy zaÄnite resuscitÃ¡ciu." },
        { text: "<strong>ZaÄnite stlaÄovanie hrudnÃ­ka</strong> â€“ poloÅ¾te postihnutÃ©ho na tvrdÃ½ podklad na chrbÃ¡t. KÄ¾aknite si k nemu zboku. PoloÅ¾te zÃ¡pÃ¤stie jednej ruky do stredu hrudnÃ­ka (dolnÃ¡ polovica hrudnej kosti), druhÃº ruku poloÅ¾te na Åˆu. StlÃ¡Äajte do hÄºbky <strong>5â€“6 cm</strong> rÃ½chlosÅ¥ou <strong>100â€“120 stlaÄenÃ­ za minÃºtu</strong>. Po kaÅ¾dom stlaÄenÃ­ hrudnÃ­k Ãºplne uvoÄ¾nite." },
        { text: "<strong>DÃ½chanie z Ãºst do Ãºst</strong> â€“ po 30 stlaÄeniach zakloÅˆte hlavu, zdvihnite bradu, zatlaÄte nos a 2Ã— vdÃ½chnite do Ãºst (kaÅ¾dÃ½ vdych cca 1 sekundu). PokraÄujte v pomere <strong>30 stlaÄenÃ­ : 2 vdychy</strong>." },
        { text: "<strong>AED (defibrilÃ¡tor)</strong> â€“ ak je dostupnÃ½ automatickÃ½ externÃ½ defibrilÃ¡tor, zapnite ho a nalepte elektrÃ³dy na holÃ½ hrudnÃ­k podÄ¾a obrÃ¡zkov na elektrÃ³dach. RiaÄte sa hlasovÃ½mi pokynmi prÃ­stroja. PoÄas analÃ½zy a vÃ½boja sa osoby nedotÃ½kajte." },
        { text: "<strong>NeprestÃ¡vajte</strong> â€“ pokraÄujte v resuscitÃ¡cii, kÃ½m neprÃ­de zÃ¡chranka, kÃ½m osoba nezaÄne normÃ¡lne dÃ½chaÅ¥, alebo kÃ½m ste Ãºplne vyÄerpanÃ­." }
      ],
      warning: "Ak si nie ste istÃ­ dÃ½chanÃ­m, zaÄnite resuscitÃ¡ciu. Aj lapavÃ©, chrÄivÃ© dÃ½chanie (agonÃ¡lne dÃ½chanie) je znÃ¡mkou zÃ¡stavy srdca. Ak nemÃ´Å¾ete alebo nechcete dÃ½chaÅ¥ z Ãºst do Ãºst, robte aspoÅˆ nepretrÅ¾itÃ© stlaÄovanie hrudnÃ­ka â€“ aj to zachraÅˆuje Å¾ivoty.",
      info: "TiesÅˆovÃ© ÄÃ­sla SR: <strong>112</strong> (vÅ¡eobecnÃ¡ tiesÅˆovÃ¡ linka), <strong>155</strong> (zÃ¡chrannÃ¡ zdravotnÃ¡ sluÅ¾ba). Na linku 112 je moÅ¾nÃ© zaslaÅ¥ aj SMS.",
      source: "ERC Guidelines 2025 â€“ Adult Basic Life Support (Olasveengen et al., Resuscitation 2025); PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "bleeding",
      emoji: "ğŸ©¸",
      title: "SilnÃ© krvÃ¡canie",
      subtitle: "Å½ivot ohrozujÃºce vonkajÅ¡ie krvÃ¡canie",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { text: "<strong>Zavolajte 155 alebo 112</strong> â€“ pri masÃ­vnom krvÃ¡canÃ­ ihneÄ volajte zÃ¡chranku." },
        { text: "<strong>Priamy tlak na ranu</strong> â€“ pritlaÄte na krvÃ¡cajÃºcu ranu ÄistÃº tkaninu, obvÃ¤z alebo priamo ruku (ideÃ¡lne s rukavicami). TlaÄte pevne a nepretrÅ¾ite." },
        { text: "<strong>Ak tlak nestaÄÃ­</strong> â€“ vtlaÄte do rany hemostatickÃ½ obvÃ¤z alebo ÄistÃº tkaninu a pokraÄujte v pevnom tlaku na Åˆu." },
        { text: "<strong>PriloÅ¾te tlakovÃ½ obvÃ¤z</strong> â€“ keÄ sa krvÃ¡canie zastavÃ­, zabezpeÄte ranu tlakovÃ½m obvÃ¤zom. ObvÃ¤z neodstraÅˆujte, ak sa presiaknÃº â€“ pridajte ÄalÅ¡iu vrstvu." },
        { text: "<strong>Turniket pri krvÃ¡canÃ­ na konÄatine</strong> â€“ ak priamy tlak nezastavuje masÃ­vne krvÃ¡canie z konÄatiny, priloÅ¾te Å¡krtidlo (turniket) Äo najbliÅ¾Å¡ie k rane medzi ranou a srdcom. ZaznaÄte Äas priloÅ¾enia. Turniket neuvoÄ¾Åˆujte." },
        { text: "<strong>UloÅ¾te postihnutÃ©ho</strong> â€“ poloÅ¾te ho na chrbÃ¡t, udrÅ¾ujte v teple a Äakajte na zÃ¡chranku." }
      ],
      warning: "NepouÅ¾Ã­vajte tlakovÃ© body (stlaÄenie tepny Äalej od rany) â€“ podÄ¾a ERC 2025 nie sÃº ÃºÄinnÃ©. VÅ¾dy priamo tlaÄte na ranu. KaÅ¾dÃº osobu po zastavenÃ­ zÃ¡vaÅ¾nÃ©ho krvÃ¡cania musÃ­ vyÅ¡etriÅ¥ lekÃ¡r.",
      info: null,
      source: "ERC Guidelines 2025 â€“ First Aid (Zideman et al., Resuscitation 2025); ILCOR CoSTR 2025 â€“ Control of life-threatening bleeding"
    },
    {
      id: "burns",
      emoji: "ğŸ”¥",
      title: "PopÃ¡leniny",
      subtitle: "TermickÃ© popÃ¡leniny a obareniny",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>Zastavte pÃ´sobenie tepla</strong> â€“ odstrÃ¡Åˆte osobu od zdroja popÃ¡lenia. Ak horÃ­ obleÄenie: zastavte osobu, poloÅ¾te na zem a vÃ¡Ä¾ajte (stopâ€“dropâ€“roll)." },
        { text: "<strong>ChlaÄte teÄÃºcou vodou</strong> â€“ ihneÄ chlaÄte popÃ¡leninu pod teÄÃºcou vodou izbovej teploty (cca 15â€“25 Â°C) po dobu <strong>minimÃ¡lne 20 minÃºt</strong>. ZaÄnite Äo najskÃ´r â€“ chladenie je ÃºÄinnÃ© aj do 3 hodÃ­n po popÃ¡lenÃ­." },
        { text: "<strong>OdstrÃ¡Åˆte obleÄenie a Å¡perky</strong> â€“ opatrne ich zloÅ¾te z popÃ¡lenej oblasti, ak nie sÃº prilepenÃ© k rane. Å perky a prstene odstrÃ¡Åˆte kÃ½m opuch neznemoÅ¾nÃ­ ich stiahnutie." },
        { text: "<strong>Zakryte ranu</strong> â€“ po chladenÃ­ voÄ¾ne prikryte popÃ¡leninu Äistou, nelepivou tkaninou alebo potravinÃ¡rskou fÃ³liou." },
        { text: "<strong>Zavolajte 155 alebo 112</strong> â€“ pri veÄ¾kÃ½ch, hlbokÃ½ch popÃ¡leninÃ¡ch, popÃ¡leninÃ¡ch tvÃ¡re/rÃºk/genitÃ¡liÃ­, pri detskÃ½ch popÃ¡leninÃ¡ch alebo ak si nie ste istÃ­ zÃ¡vaÅ¾nosÅ¥ou." }
      ],
      warning: "Na popÃ¡leninu NIKDY nedÃ¡vajte Ä¾ad, maslo, zubnÃº pastu, olej ani inÃ© domÃ¡ce prostriedky. NepouÅ¾Ã­vajte veÄ¾mi studenÃº vodu â€“ hrozÃ­ podchladenie, najmÃ¤ u detÃ­. Neprepichujte pÄ¾uzgiere.",
      info: null,
      source: "ERC Guidelines 2025 â€“ First Aid; ILCOR CoSTR 2025 â€“ Active cooling of thermal burns (strong recommendation)"
    },
    {
      id: "fractures",
      emoji: "ğŸ¦´",
      title: "Zlomeniny",
      subtitle: "Zlomeniny kostÃ­ a poranenia kÄºbov",
      iconBg: "#f5f3ee",
      iconBorder: "#e2ddd5",
      steps: [
        { text: "<strong>ZabrÃ¡Åˆte ÄalÅ¡iemu poraneniu</strong> â€“ postihnutÃ©ho zbytoÄne nehÃ½bte. Ak hrozÃ­ nebezpeÄenstvo na mieste (poÅ¾iar, doprava), premiestnite ho Äo nejopatrnejÅ¡ie." },
        { text: "<strong>Znehybnite postihnutÃº oblasÅ¥</strong> â€“ zaistite poranenÃº konÄatinu v polohe, v akej sa nachÃ¡dza. Na dlahu pouÅ¾ite akÃ½koÄ¾vek tvrdÃ½ predmet (doska, palica, zrolovanÃ© noviny) alebo fixujte poranenÃº konÄatinu k telu." },
        { text: "<strong>PriloÅ¾te studenÃ½ obklad</strong> â€“ na opuchnutÃ© miesto priloÅ¾te studenÃ½ obklad zabalenÃ½ v tkanine na 15â€“20 minÃºt. Priamo na koÅ¾u Ä¾ad nedÃ¡vajte." },
        { text: "<strong>Zavolajte 155 alebo 112</strong> â€“ vÅ¾dy pri podozrenÃ­ na zlomeninu, deformÃ¡cii konÄatiny, neschopnosti pohybu alebo silnej bolesti." },
        { text: "<strong>Pri otvorenÃ½ch zlomeninÃ¡ch</strong> â€“ ak kosÅ¥ preÄnieva koÅ¾ou, ranu voÄ¾ne prikryte Äistou tkaninou. S kosÅ¥ou nemanipulujte a nesnaÅ¾te sa ju vtlaÄiÅ¥ spÃ¤Å¥." }
      ],
      warning: "Pri podozrenÃ­ na poranenie chrbtice alebo krku nehÃ½bte osobou, pokiaÄ¾ to nie je absolÃºtne nevyhnutnÃ© (priame ohrozenie Å¾ivota). PoÄkajte na zÃ¡chranÃ¡rov. Ak musÃ­te osobu presunÃºÅ¥, udrÅ¾ujte hlavu, krk a chrbÃ¡t v jednej lÃ­nii.",
      info: null,
      source: "ERC Guidelines 2025 â€“ First Aid: Cervical spinal motion restriction; VÅ¡eobecnÃ© odporÃºÄania pre prvÃº pomoc pri zlomeninÃ¡ch"
    },
    {
      id: "shock",
      emoji: "ğŸ˜°",
      title: "Å ok",
      subtitle: "ObehovÃ½ Å¡ok â€“ zlyhanie krvnÃ©ho obehu",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>Rozpoznajte prÃ­znaky</strong> â€“ bledÃ¡, studenÃ¡, spotenÃ¡ koÅ¾a; zrÃ½chlenÃ½ pulz a dÃ½chanie; zmÃ¤tenosÅ¥ alebo ospalosÅ¥; smÃ¤d; zÃ¡vraty." },
        { text: "<strong>Zavolajte 155 alebo 112</strong> â€“ Å¡ok je Å¾ivot ohrozujÃºci stav, zÃ¡chranku volajte ihneÄ." },
        { text: "<strong>UloÅ¾te osobu na chrbÃ¡t</strong> â€“ poloÅ¾te postihnutÃ©ho na rovnÃ½ podklad. Ak nemÃ¡ poranenie nÃ´h, zdvihnite mu nohy do vÃ½Å¡ky 30â€“40 cm (podloÅ¾te vankÃºÅ¡om, batohom, obleÄenÃ­m) â€“ pomÃ¡ha to udrÅ¾aÅ¥ krvnÃ½ obeh." },
        { text: "<strong>UdrÅ¾ujte teplo</strong> â€“ prikryte osobu dekou, kabÃ¡tom alebo ÄÃ­mkoÄ¾vek, Äo zabranÃ­ strate telesnÃ©ho tepla. Izolujte aj od studenÃ©ho povrchu." },
        { text: "<strong>OÅ¡etrite prÃ­Äinu</strong> â€“ ak je prÃ­Äinou krvÃ¡canie, zastavte ho (pozri sekciu SilnÃ© krvÃ¡canie). Ak mÃ¡ alergickÃº reakciu s opuchom, pomÃ´Å¾te s podanÃ­m adrenalÃ­novÃ©ho autoinjektora, ak ho mÃ¡." },
        { text: "<strong>NepodÃ¡vajte jedlo ani pitie</strong> â€“ osoba v Å¡oku nesmie piÅ¥ ani jesÅ¥ (hrozÃ­ vdÃ½chnutie). Ak je veÄ¾mi smÃ¤dnÃ¡, navlhÄite jej pery." }
      ],
      warning: "Ak osoba stratÃ­ vedomie ale dÃ½cha, uloÅ¾te ju do stabilizovanej (boÄnej) polohy. Ak prestane dÃ½chaÅ¥, okamÅ¾ite zaÄnite resuscitÃ¡ciu (KPR).",
      info: null,
      source: "ERC Guidelines 2025 â€“ First Aid: Shock management; ERC Guidelines 2025 â€“ Special Circumstances"
    },
    {
      id: "choking",
      emoji: "ğŸ˜¤",
      title: "Dusenie",
      subtitle: "Cudzie teleso v dÃ½chacÃ­ch cestÃ¡ch",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { text: "<strong>Rozpoznajte dusenie</strong> â€“ osoba sa nÃ¡hle nemÃ´Å¾e rozprÃ¡vaÅ¥, kaÅ¡laÅ¥ ani dÃ½chaÅ¥. ÄŒasto sa chytÃ¡ za hrdlo (univerzÃ¡lny znak dusenia). Ak mÃ´Å¾e kaÅ¡laÅ¥, povzbudzujte ju, nech kaÅ¡le." },
        { text: "<strong>5 Ãºderov medzi lopatky</strong> â€“ postavte sa zboku za postihnutÃ©ho. Jednou rukou podoprite hrudnÃ­k a predkloÅˆte ho. Druhou rukou udrite 5Ã— medzi lopatky (pÃ¤tou dlane). KaÅ¾dÃ½ Ãºder mÃ¡ byÅ¥ samostatnÃ½ a dostatoÄne silnÃ½." },
        { text: "<strong>5 stlaÄenÃ­ brucha (Heimlichov manÃ©ver)</strong> â€“ ak Ãºdery nepomÃ´Å¾u, postavte sa za osobu a objÃ­mte ju okolo brucha. Zatnite pÃ¤sÅ¥ a umiestnite ju medzi pupok a dolnÃ½ okraj rebier. DruhÃº ruku poloÅ¾te na pÃ¤sÅ¥. Prudko zatlaÄte dovnÃºtra a nahor 5Ã—." },
        { text: "<strong>Striedajte</strong> â€“ striedajte 5 Ãºderov a 5 stlaÄenÃ­, kÃ½m sa cudzÃ­ predmet neuvoÄ¾nÃ­ alebo osoba nestratÃ­ vedomie." },
        { text: "<strong>Ak stratÃ­ vedomie</strong> â€“ opatrne poloÅ¾te osobu na zem a ihneÄ zavolajte 155/112. ZaÄnite resuscitÃ¡ciu (KPR) â€“ stlaÄovanie hrudnÃ­ka mÃ´Å¾e pomÃ´cÅ¥ uvoÄ¾niÅ¥ predmet. Pred kaÅ¾dÃ½m pokusom o vdÃ½chnutie skontrolujte Ãºsta â€“ ak vidÃ­te predmet, vyberte ho." }
      ],
      warning: "U tehotnÃ½ch Å¾ien a obÃ©znych osÃ´b namiesto stlaÄenÃ­ brucha pouÅ¾ite stlaÄenia hrudnÃ­ka (ruky umiestnite na strednÃº ÄasÅ¥ hrudnej kosti). U detÃ­ do 1 roka pouÅ¾ite 5 Ãºderov medzi lopatky a 5 stlaÄenÃ­ hrudnÃ­ka (nie brucha). KaÅ¾dÃ½, kto bol oÅ¡etrenÃ½ stlaÄeniami brucha, musÃ­ byÅ¥ nÃ¡sledne vyÅ¡etrenÃ½ lekÃ¡rom.",
      info: null,
      source: "ERC Guidelines 2025 â€“ First Aid: Foreign body airway obstruction (FBAO); ERC Guidelines 2025 â€“ Basic Life Support"
    },
    {
      id: "hypothermia",
      emoji: "ğŸ¥¶",
      title: "Podchladenie",
      subtitle: "Pokles telesnej teploty pod 35 Â°C",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { text: "<strong>Rozpoznajte prÃ­znaky</strong> â€“ triaÅ¡ka, zmÃ¤tenosÅ¥, ospalosÅ¥, Å¥aÅ¾kopÃ¡dna reÄ, stuhnutÃ© svaly. Pri Å¥aÅ¾kom podchladenÃ­ triaÅ¡ka ustÃ¡va, vedomie sa strÃ¡ca." },
        { text: "<strong>PresuÅˆte do tepla</strong> â€“ premiestnite osobu z chladnÃ©ho prostredia do teplÃ©ho miesta. Ak to nie je moÅ¾nÃ©, chrÃ¡Åˆte ju pred vetrom, daÅ¾Äom a chladom (prÃ­streÅ¡ok, izolÃ¡cia od zeme)." },
        { text: "<strong>VyzleÄte mokrÃ© obleÄenie</strong> â€“ opatrne vyzleÄte mokrÃ© veci a nahraÄte ich suchÃ½mi. Osoba sa nesmie sama prezliekaÅ¥ (pohyb spÃ´sobuje ÄalÅ¡iu stratu tepla)." },
        { text: "<strong>Zahrievajte postupne</strong> â€“ zabaÄ¾te osobu do diek, spacÃ¡ku, izotermickej fÃ³lie. Na hrudnÃ­k a podpazuÅ¡ie mÃ´Å¾ete priloÅ¾iÅ¥ teplÃ© (nie horÃºce!) obklady alebo fÄ¾aÅ¡e s teplou vodou zabalenÃ© v tkanine." },
        { text: "<strong>TeplÃ© nÃ¡poje</strong> â€“ ak je osoba pri vedomÃ­ a dokÃ¡Å¾e prehÄºtaÅ¥, podajte jej teplÃ½ sladkÃ½ Äaj. NepodÃ¡vajte alkohol â€“ rozÅ¡iruje cievy a zvyÅ¡uje straty tepla." },
        { text: "<strong>Zavolajte 155 alebo 112</strong> â€“ pri Å¥aÅ¾kom podchladenÃ­ (zmÃ¤tenosÅ¥, strata vedomia, ustÃ¡vajÃºca triaÅ¡ka) vÅ¾dy volajte zÃ¡chranku." }
      ],
      warning: "S Å¥aÅ¾ko podchladenou osobou zaobchÃ¡dzajte veÄ¾mi jemne â€“ prudkÃ½ pohyb alebo trenie konÄatÃ­n mÃ´Å¾e spÃ´sobiÅ¥ srdcovÃ© arytmie. Nezahrievajte nÃ¡hle (napr. horÃºcou vodou). Ak osoba nedÃ½cha, zaÄnite resuscitÃ¡ciu (KPR).",
      info: "PrÃ­ruÄka MV SR odporÃºÄa: pouÅ¾Ã­vajte viac vrstiev obleÄenia, teplÃ© ponoÅ¾ky, Äiapku, Å¡Ã¡l a rukavice. V prÃ­pade premoÄenia majte po ruke rezervnÃ© obleÄenie.",
      source: "ERC Guidelines 2025 â€“ Special Circumstances: Hypothermia; PrÃ­ruÄka MV SR â€“ NÃ­zke teploty"
    },
    {
      id: "poisoning",
      emoji: "â˜ ï¸",
      title: "Otrava",
      subtitle: "PoÅ¾itie, vdÃ½chnutie alebo kontakt s jedom",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { text: "<strong>Zaistite bezpeÄnosÅ¥</strong> â€“ uistite sa, Å¾e je miesto bezpeÄnÃ© pre vÃ¡s. Pri otrave plynom alebo chemikÃ¡liou odveÄte osobu na ÄerstvÃ½ vzduch. Sami nevstupujte do zamorenÃ©ho priestoru bez ochrany." },
        { text: "<strong>Zavolajte 155 alebo 112</strong> â€“ ihneÄ volajte zÃ¡chranku. Alebo zavolajte na <strong>NÃ¡rodnÃ© toxikologickÃ© informaÄnÃ© centrum: +421 2 5477 4166</strong> (funguje 24/7)." },
        { text: "<strong>Zistite Äo, koÄ¾ko a kedy</strong> â€“ ak je to moÅ¾nÃ©, zistite akÃº lÃ¡tku osoba poÅ¾ila/vdÃ½chla, koÄ¾ko a kedy. Zachovajte obal, zvyÅ¡ok lÃ¡tky alebo zvratky pre zÃ¡chranÃ¡rov." },
        { text: "<strong>NevyvolÃ¡vajte zvracanie</strong> â€“ pokiaÄ¾ to vÃ½slovne neodporuÄÃ­ lekÃ¡r alebo operÃ¡tor tiesÅˆovej linky. Pri Å¾ieravÃ½ch lÃ¡tkach (kyseliny, lÃºhy) by zvracanie spÃ´sobilo ÄalÅ¡ie poÅ¡kodenie." },
        { text: "<strong>Ak je osoba v bezvedomÃ­</strong> â€“ ak dÃ½cha, uloÅ¾te ju do stabilizovanej (boÄnej) polohy, aby sa nezadusila zvratkami. Ak nedÃ½cha, zaÄnite resuscitÃ¡ciu (KPR)." },
        { text: "<strong>Pri kontakte s chemikÃ¡liou na koÅ¾i/v oÄiach</strong> â€“ vyplachujte postihnutÃ© miesto veÄ¾kÃ½m mnoÅ¾stvom Äistej teÄÃºcej vody minimÃ¡lne 15â€“20 minÃºt." }
      ],
      warning: "NepodÃ¡vajte niÄ Ãºstami (mlieko, uhlie, vodu) bez konzultÃ¡cie s lekÃ¡rom alebo toxikolÃ³gom. Pri otrave nebezpeÄnÃ½mi chemickÃ½mi lÃ¡tkami â€“ MV SR odporÃºÄa: chrÃ¡Åˆte si dÃ½chacie cesty a oÄi, opustite ohrozenÃ½ priestor, sledujte pokyny na oficiÃ¡lnych kanÃ¡loch.",
      info: "NÃ¡rodnÃ© toxikologickÃ© informaÄnÃ© centrum (NTIC): <strong><a href='tel:+421254774166' style='color:#1e40af;'>+421 2 5477 4166</a></strong> alebo <strong><a href='tel:+421911166066' style='color:#1e40af;'>0911 166 066</a></strong> (24/7, nonstop). Centrum poskytuje odbornÃ© rady pri otravÃ¡ch pre lekÃ¡rov aj verejnosÅ¥.",
      source: "ERC Guidelines 2025 â€“ Special Circumstances: Toxic agents; PrÃ­ruÄka MV SR â€“ Ãšnik nebezpeÄnÃ½ch chemickÃ½ch lÃ¡tok; NTIC pri DFNsP Bratislava"
    }
  ];

  function renderFirstAid() {
    const grid = document.getElementById("firstAidGrid");
    if (!grid) return;
    grid.innerHTML = "";
    FIRST_AID_DATA.forEach(item => {
      const card = document.createElement("div");
      card.className = "fa-card";
      card.setAttribute("role", "button");
      card.setAttribute("tabindex", "0");
      card.setAttribute("aria-label", item.title + " â€“ zobraziÅ¥ postup prvej pomoci");
      card.innerHTML = `
        <div class="fa-icon" style="background:${item.iconBg}; border:1.5px solid ${item.iconBorder};">
          ${item.emoji}
        </div>
        <div class="fa-card-label">${item.title}</div>`;
      card.onclick = () => openFirstAidModal(item);
      card.onkeydown = (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); openFirstAidModal(item); }};
      grid.appendChild(card);
    });
  }

  function openFirstAidModal(item) {
    const icon = document.getElementById("faModalIcon");
    const title = document.getElementById("faModalTitle");
    const subtitle = document.getElementById("faModalSubtitle");
    const content = document.getElementById("faModalContent");

    icon.style.background = item.iconBg;
    icon.style.border = `1.5px solid ${item.iconBorder}`;
    icon.textContent = item.emoji;
    title.textContent = item.title;
    subtitle.textContent = item.subtitle;

    let html = `<div class="fa-emergency-bar">ğŸ“ TiesÅˆovÃ© ÄÃ­slo: <a href="tel:112">112</a> &nbsp;|&nbsp; ZÃ¡chranka: <a href="tel:155">155</a></div>`;

    // Steps
    html += `<div style="margin-bottom:0.5rem;">`;
    item.steps.forEach((step, idx) => {
      html += `<div class="fa-modal-step">
        <div class="fa-step-num">${idx + 1}</div>
        <div class="fa-step-text">${step.text}</div>
      </div>`;
    });
    html += `</div>`;

    // Warning
    if (item.warning) {
      html += `<div class="fa-warning"><strong>âš ï¸ DÃ´leÅ¾itÃ©:</strong> ${item.warning}</div>`;
    }

    // Info
    if (item.info) {
      html += `<div class="fa-info"><strong>â„¹ï¸ Tip:</strong> ${item.info}</div>`;
    }

    // Source
    html += `<div class="fa-source"><strong>Zdroj:</strong> ${item.source}</div>`;

    content.innerHTML = html;
    openModal("modalFirstAid");
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DÃ”LEÅ½ITÃ‰ KONTAKTY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const EMERGENCY_LINES = [
    { number: "112", label: "TiesÅˆovÃ¡ linka", desc: "VÅ¡eobecnÃ¡ tiesÅˆovÃ¡ linka v celej EurÃ³pe (24/7). MoÅ¾no zaslaÅ¥ aj SMS.", emoji: "ğŸ†˜", bg: "#fef2f2", border: "#fecaca", color: "#dc2626" },
    { number: "150", label: "HasiÄi", desc: "HasiÄskÃ½ a zÃ¡chrannÃ½ zbor SR.", emoji: "ğŸš’", bg: "#fef2f2", border: "#fecaca", color: "#dc2626" },
    { number: "155", label: "ZÃ¡chranka", desc: "RÃ½chla zdravotnÃ¡ pomoc.", emoji: "ğŸš‘", bg: "#eff6ff", border: "#bfdbfe", color: "#1e40af" },
    { number: "158", label: "PolÃ­cia", desc: "PolicajnÃ½ zbor SR.", emoji: "ğŸš”", bg: "#eff6ff", border: "#bfdbfe", color: "#1e40af" },
    { number: "159", label: "MestskÃ¡ polÃ­cia", desc: "ObecnÃ¡ / mestskÃ¡ polÃ­cia.", emoji: "ğŸ‘®", bg: "#f5f3ee", border: "#e2ddd5", color: "#6b6560" },
    { number: "18 300", label: "HorskÃ¡ sluÅ¾ba", desc: "HorskÃ¡ zÃ¡chrannÃ¡ sluÅ¾ba.", emoji: "â›°ï¸", bg: "#eaf4ee", border: "#86efac", color: "#2a7a4b" },
  ];

  const INSTITUTIONS = [
    { name: "NÃ¡rodnÃ© toxikologickÃ© informaÄnÃ© centrum", phone: "+421 2 5477 4166", phone2: "0911 166 066", desc: "24/7 nonstop â€“ odbornÃ© rady pri otravÃ¡ch pre lekÃ¡rov aj verejnosÅ¥.", emoji: "â˜ ï¸" },
    { name: "SlovenskÃ½ hydrometeorologickÃ½ Ãºstav (SHMÃš)", url: "https://www.shmu.sk", desc: "MeteorologickÃ© a hydrologickÃ© vÃ½strahy, predpovede poÄasia.", emoji: "ğŸŒ¦ï¸" },
    { name: "Ministerstvo vnÃºtra SR â€“ CivilnÃ¡ ochrana", url: "https://www.minv.sk", desc: "AktuÃ¡lne informÃ¡cie o ochrane Å¾ivota a zdravia pri mimoriadnych udalostiach.", emoji: "ğŸ›¡ï¸" },
    { name: "Ãšrad verejnÃ©ho zdravotnÃ­ctva SR", phone: "+421 2 4928 4111", url: "https://www.uvzsr.sk", desc: "EpidemiologickÃ© ohrozenia, ochrana zdravia obyvateÄ¾stva.", emoji: "ğŸ¥" },
    { name: "SlovenskÃ½ ÄŒervenÃ½ krÃ­Å¾", phone: "+421 2 5441 3868", url: "https://www.redcross.sk", desc: "HumanitÃ¡rna pomoc, prvÃ¡ pomoc, vyhÄ¾adÃ¡vanie osÃ´b.", emoji: "âœš" },
  ];

  function renderEmergencyContacts() {
    // TiesÅˆovÃ© linky
    const linesGrid = document.getElementById("emergencyLinesGrid");
    if (!linesGrid) return;
    linesGrid.innerHTML = "";
    EMERGENCY_LINES.forEach(line => {
      const card = document.createElement("a");
      card.href = `tel:${line.number.replace(/\s/g, "")}`;
      card.className = "ec-card";
      card.title = line.desc;
      card.innerHTML = `
        <div class="ec-icon" style="background:${line.bg}; border:1.5px solid ${line.border};">${line.emoji}</div>
        <div class="ec-card-label">${line.label}</div>
        <div class="ec-card-number" style="color:${line.color};">${line.number}</div>`;
      linesGrid.appendChild(card);
    });

    // InÅ¡titÃºcie
    const instGrid = document.getElementById("institutionsGrid");
    if (!instGrid) return;
    instGrid.innerHTML = "";
    INSTITUTIONS.forEach(inst => {
      const row = document.createElement("div");
      row.style.cssText = "display:flex; align-items:flex-start; gap:0.75rem; padding:0.75rem 0.875rem; background:var(--c-bg); border-radius:0.875rem;";
      let actions = "";
      if (inst.phone) actions += `<a href="tel:${inst.phone.replace(/\s/g, "")}" style="display:inline-flex; align-items:center; gap:0.25rem; background:#eaf4ee; color:#2a7a4b; border:1px solid #86efac; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; text-decoration:none; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ“ ${inst.phone}</a> `;
      if (inst.phone2) actions += `<a href="tel:${inst.phone2.replace(/\s/g, "")}" style="display:inline-flex; align-items:center; gap:0.25rem; background:#eaf4ee; color:#2a7a4b; border:1px solid #86efac; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; text-decoration:none; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ“ ${inst.phone2}</a> `;
      if (inst.url) actions += `<a href="${inst.url}" target="_blank" rel="noopener" style="display:inline-flex; align-items:center; gap:0.25rem; background:#eff6ff; color:#1e40af; border:1px solid #bfdbfe; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; text-decoration:none; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ”— Web</a>`;
      row.innerHTML = `
        <div style="font-size:1.25rem; flex-shrink:0; margin-top:0.125rem;">${inst.emoji}</div>
        <div style="flex:1; min-width:0;">
          <div style="font-weight:700; font-size:0.85rem; line-height:1.3;">${inst.name}</div>
          <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.15rem; line-height:1.5;">${inst.desc}</div>
          <div style="display:flex; flex-wrap:wrap; gap:0.375rem; margin-top:0.5rem;">${actions}</div>
        </div>`;
      instGrid.appendChild(row);
    });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // OSOBNÃ‰ DÃ”LEÅ½ITÃ‰ KONTAKTY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const PC_CATEGORIES = [
    { id: "doctor",      emoji: "ğŸ©º", label: "LekÃ¡r",               placeholder: "MUDr. KovÃ¡Ä, praktickÃ½ lekÃ¡r" },
    { id: "doctor_kid",  emoji: "ğŸ‘¶", label: "Pediater",            placeholder: "MUDr. NovÃ¡, detskÃ¡ ambulancia" },
    { id: "dentist",     emoji: "ğŸ¦·", label: "ZubÃ¡r",               placeholder: "MDDr. HorvÃ¡t" },
    { id: "pharmacy",    emoji: "ğŸ’Š", label: "LekÃ¡reÅˆ",             placeholder: "LekÃ¡reÅˆ pri nemocnici" },
    { id: "lawyer",      emoji: "âš–ï¸", label: "PrÃ¡vnik",             placeholder: "JUDr. NovÃ¡k" },
    { id: "bank",        emoji: "ğŸ¦", label: "Banka",               placeholder: "SlovenskÃ¡ sporiteÄ¾Åˆa, poboÄka..." },
    { id: "ins_life",    emoji: "ğŸ›¡ï¸", label: "Å½ivotnÃ¡ poisÅ¥ovÅˆa",   placeholder: "Allianz â€“ ÄÃ­slo zmluvy..." },
    { id: "ins_car",     emoji: "ğŸš—", label: "Autopoistenie",       placeholder: "Generali â€“ PZP / havarijnÃ©" },
    { id: "ins_home",    emoji: "ğŸ ", label: "Poistenie bytu/domu", placeholder: "ÄŒSOB PoisÅ¥ovÅˆa â€“ domÃ¡cnosÅ¥" },
    { id: "electric",    emoji: "âš¡", label: "ElektrikÃ¡r",           placeholder: "PoruchovÃ¡ linka / sÃºkromnÃ½" },
    { id: "gas",         emoji: "ğŸ”¥", label: "PlynÃ¡r",              placeholder: "SPP poruchovÃ¡ linka" },
    { id: "water",       emoji: "ğŸ’§", label: "VodÃ¡r",               placeholder: "BVS poruchovÃ¡ linka" },
    { id: "locksmith",   emoji: "ğŸ”‘", label: "ZÃ¡moÄnÃ­k",            placeholder: "Non-stop zÃ¡moÄnÃ­cka sluÅ¾ba" },
    { id: "vet",         emoji: "ğŸ¾", label: "VeterinÃ¡r",           placeholder: "MVDr. HorvÃ¡th, veterinÃ¡rna klinika" },
    { id: "neighbor",    emoji: "ğŸ˜ï¸", label: "Sused / susedka",     placeholder: "PÃ¡n HorvÃ¡th, 3. poschodie" },
    { id: "family",      emoji: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§", label: "RodinnÃ½ kontakt",    placeholder: "Babka, dedko, teta..." },
    { id: "work",        emoji: "ğŸ’¼", label: "PrÃ¡ca / zamestnÃ¡vateÄ¾", placeholder: "HR oddelenie, Å¡Ã©f..." },
    { id: "school",      emoji: "ğŸ’", label: "Å kola / Å¡kÃ´lka",      placeholder: "ZÅ  PartizÃ¡nska, triedna uÄiteÄ¾ka" },
    { id: "embassy",     emoji: "ğŸ›ï¸", label: "AmbasÃ¡da / konzulÃ¡t", placeholder: "ZastupiteÄ¾skÃ½ Ãºrad..." },
    { id: "other",       emoji: "ğŸ“", label: "InÃ½ kontakt",         placeholder: "" },
  ];

  let pcSelectedCategoryId = "";

  function renderPersonalContacts() {
    const grid = document.getElementById("personalContactsGrid");
    if (!grid) return;
    const contacts = state.personalContacts || [];

    if (contacts.length === 0) {
      grid.innerHTML = `
        <div onclick="openPersonalContactModal(-1)" style="background:linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%); border:1.5px dashed #86efac; border-radius:1rem; padding:1.25rem; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 18px rgba(0,0,0,0.06)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
          <div style="display:flex; align-items:center; gap:0.75rem;">
            <div style="width:44px; height:44px; border-radius:50%; background:#86efac; display:flex; align-items:center; justify-content:center; font-size:1.25rem; flex-shrink:0;">+</div>
            <div>
              <div style="font-weight:700; font-size:0.9rem; color:#166534;">Pridajte si dÃ´leÅ¾itÃ© kontakty</div>
              <div style="font-size:0.75rem; color:#22c55e; line-height:1.5; margin-top:0.125rem;">LekÃ¡r, poisÅ¥ovÅˆa, elektrikÃ¡r, zÃ¡moÄnÃ­k a ÄalÅ¡ie â€” vÅ¡etko na jednom mieste, offline prÃ­stupnÃ©.</div>
            </div>
          </div>
        </div>`;
      return;
    }

    // Group contacts by category
    const grouped = {};
    contacts.forEach((c, idx) => {
      const catId = c.categoryId || "other";
      if (!grouped[catId]) grouped[catId] = [];
      grouped[catId].push({ ...c, _idx: idx });
    });

    let html = "";
    // Sort groups by PC_CATEGORIES order
    const catOrder = PC_CATEGORIES.map(c => c.id);
    const sortedKeys = Object.keys(grouped).sort((a, b) => catOrder.indexOf(a) - catOrder.indexOf(b));

    sortedKeys.forEach(catId => {
      const cat = PC_CATEGORIES.find(c => c.id === catId) || { emoji: "ğŸ“", label: "InÃ½" };
      const items = grouped[catId];
      items.forEach(c => {
        const phoneClean = (c.phone||"").replace(/\s/g, "");
        const phone2Clean = (c.phone2||"").replace(/\s/g, "");
        html += `
          <div style="display:flex; align-items:flex-start; gap:0.75rem; padding:0.75rem 0.875rem; background:var(--c-bg); border-radius:0.875rem; cursor:pointer; transition:background 0.15s;" onclick="openPersonalContactModal(${c._idx})" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='var(--c-bg)'">
            <div style="font-size:1.25rem; flex-shrink:0; margin-top:0.125rem;">${cat.emoji}</div>
            <div style="flex:1; min-width:0;">
              <div style="display:flex; align-items:center; gap:0.375rem; flex-wrap:wrap;">
                <span style="font-weight:700; font-size:0.85rem; line-height:1.3;">${esc(c.name||"")}</span>
                <span style="font-size:0.65rem; font-weight:600; color:var(--c-muted); background:var(--c-surface); border:1px solid var(--c-border); border-radius:0.375rem; padding:0.1rem 0.375rem;">${cat.label}${c.customType ? " â€“ " + esc(c.customType) : ""}</span>
              </div>
              ${c.note ? `<div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.15rem; line-height:1.4;">${esc(c.note)}</div>` : ""}
              <div style="display:flex; flex-wrap:wrap; gap:0.375rem; margin-top:0.5rem;" onclick="event.stopPropagation()">
                <a href="tel:${phoneClean}" style="display:inline-flex; align-items:center; gap:0.25rem; background:#eaf4ee; color:#2a7a4b; border:1px solid #86efac; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; text-decoration:none; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ“ ${esc(c.phone||"")}</a>
                ${c.phone2 ? `<a href="tel:${phone2Clean}" style="display:inline-flex; align-items:center; gap:0.25rem; background:#eaf4ee; color:#2a7a4b; border:1px solid #86efac; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; text-decoration:none; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ“ ${esc(c.phone2)}</a>` : ""}
                ${c.address ? `<span style="display:inline-flex; align-items:center; gap:0.25rem; background:#eff6ff; color:#1e40af; border:1px solid #bfdbfe; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ“Œ ${esc(c.address)}</span>` : ""}
              </div>
            </div>
            <div style="color:var(--c-muted); font-size:0.8rem; flex-shrink:0; margin-top:0.25rem;">âœï¸</div>
          </div>`;
      });
    });

    grid.innerHTML = html;
  }

  // â”€â”€ Personal contact modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openPersonalContactModal(editIndex) {
    const f = document.getElementById("personalContactForm");
    const isEdit = editIndex >= 0 && editIndex < (state.personalContacts||[]).length;
    const c = isEdit ? state.personalContacts[editIndex] : {};

    document.getElementById("pcModalTitle").textContent = isEdit ? "âœï¸ UpraviÅ¥ kontakt" : "ğŸ‘¤ NovÃ½ kontakt";
    f.elements["pc_editIndex"].value = editIndex;
    f.elements["pc_name"].value = c.name || "";
    f.elements["pc_phone"].value = c.phone || "";
    f.elements["pc_phone2"].value = c.phone2 || "";
    f.elements["pc_address"].value = c.address || "";
    f.elements["pc_note"].value = c.note || "";
    document.getElementById("pcCustomTypeInput").value = c.customType || "";
    document.getElementById("pcCustomTypeInput").style.display = (c.categoryId === "other") ? "block" : "none";
    document.getElementById("btnDeletePC").style.display = isEdit ? "inline-flex" : "none";

    pcSelectedCategoryId = c.categoryId || "";
    renderPCCategoryPicker();
    openModal("modalPersonalContact");
  }
  window.openPersonalContactModal = openPersonalContactModal;

  function renderPCCategoryPicker() {
    const box = document.getElementById("pcCategoryPicker");
    if (!box) return;
    box.innerHTML = PC_CATEGORIES.map(cat => {
      const sel = pcSelectedCategoryId === cat.id;
      return `<button type="button" data-pccat="${cat.id}" style="display:inline-flex; align-items:center; gap:0.25rem; padding:0.3rem 0.5rem; border-radius:0.5rem; font-size:0.72rem; font-weight:600; font-family:'Lexend',sans-serif; cursor:pointer; transition:all 0.15s; border:1.5px solid ${sel ? '#2a7a4b' : 'var(--c-border)'}; background:${sel ? '#eaf4ee' : 'var(--c-surface)'}; color:${sel ? '#2a7a4b' : 'var(--c-muted)'};" title="${cat.label}">${cat.emoji} ${cat.label}</button>`;
    }).join("");
    box.querySelectorAll("[data-pccat]").forEach(btn => {
      btn.onclick = () => {
        pcSelectedCategoryId = btn.dataset.pccat;
        renderPCCategoryPicker();
        const custom = document.getElementById("pcCustomTypeInput");
        custom.style.display = pcSelectedCategoryId === "other" ? "block" : "none";
        // Pre-fill name placeholder
        const cat = PC_CATEGORIES.find(c => c.id === pcSelectedCategoryId);
        if (cat && cat.placeholder) {
          document.querySelector("[name='pc_name']").placeholder = cat.placeholder;
        }
      };
    });
  }

  document.getElementById("btnAddPersonalContact").onclick = () => openPersonalContactModal(-1);

  document.getElementById("personalContactForm").onsubmit = (e) => {
    e.preventDefault();
    if (!pcSelectedCategoryId) { alert("Vyberte typ kontaktu."); return; }
    const fd = new FormData(e.target);
    const idx = parseInt(fd.get("pc_editIndex"));
    const contact = {
      categoryId: pcSelectedCategoryId,
      customType: pcSelectedCategoryId === "other" ? String(fd.get("pc_customType")||"").trim() : "",
      name: String(fd.get("pc_name")||"").trim(),
      phone: String(fd.get("pc_phone")||"").trim(),
      phone2: String(fd.get("pc_phone2")||"").trim(),
      address: String(fd.get("pc_address")||"").trim(),
      note: String(fd.get("pc_note")||"").trim()
    };
    if (!state.personalContacts) state.personalContacts = [];
    if (idx >= 0 && idx < state.personalContacts.length) {
      state.personalContacts[idx] = contact;
    } else {
      state.personalContacts.push(contact);
    }
    closeModal("modalPersonalContact");
    scheduleSave(); renderPersonalContacts();
  };

  document.getElementById("btnDeletePC").onclick = () => {
    const idx = parseInt(document.getElementById("personalContactForm").elements["pc_editIndex"].value);
    if (idx >= 0 && idx < (state.personalContacts||[]).length) {
      if (confirm("OdstrÃ¡niÅ¥ tento kontakt?")) {
        state.personalContacts.splice(idx, 1);
        closeModal("modalPersonalContact");
        scheduleSave(); renderPersonalContacts();
      }
    }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EVAKUAÄŒNÃ‰ BATOÅ½INY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const EVAC_BAG_TYPES = {
    adult:  { emoji: "ğŸ§‘", label: "DospelÃ½", maxKg: 25, kcalDay: 2000, color: "#1e40af", bg: "#eff6ff", border: "#bfdbfe" },
    kid:    { emoji: "ğŸ§’", label: "DieÅ¥a",   maxKg: 15, kcalDay: 1500, color: "#b45309", bg: "#fef3c7", border: "#fcd34d" },
    infant: { emoji: "ğŸ‘¶", label: "BÃ¡bÃ¤tko", maxKg: 5,  kcalDay: 800,  color: "#be185d", bg: "#fdf2f8", border: "#fbcfe8" },
    senior: { emoji: "ğŸ‘´", label: "Senior",  maxKg: 20, kcalDay: 1800, color: "#2a7a4b", bg: "#eaf4ee", border: "#86efac" },
  };

  function getEvacBagItems(type) {
    const t = EVAC_BAG_TYPES[type];
    const kcal = t.kcalDay;
    const items = [];

    // â”€â”€ Doklady & peniaze â”€â”€
    items.push({ cat: "Doklady a peniaze", items: [
      { name: "ObÄiansky preukaz / pas", note: "OriginÃ¡l â€“ vÅ¾dy maÅ¥ pri sebe" },
      { name: "KartiÄka zdravotnej poisÅ¥ovne", note: "OriginÃ¡l" },
      { name: "KÃ³pie dÃ´leÅ¾itÃ½ch dokumentov (papier)", note: "RodnÃ½ list, sobÃ¡Å¡ny list, zmluvy, poistky" },
      { name: "Å ifrovanÃ½ USB kÄ¾ÃºÄ so scanmi dokumentov", note: "VÅ¡etky doklady v PDF â€“ viÄ kategÃ³ria Doklady" },
      { name: "KÄ¾ÃºÄe", note: "Dom, auto, pivnica, kancelÃ¡ria" },
      { name: "HotovosÅ¥ + platobnÃ© karty", note: "DrobnÃ© mince + bankovky, min. na 3 dni" },
      { name: "Zoznam kontaktov na papieri", note: "LekÃ¡r, prÃ¡vnik, banka, poisÅ¥ovÅˆa, rodina" },
      { name: "ZdravotnÃ½ info list (alergie, lieky)", note: "1Ã— A4 â€“ krvnÃ¡ skupina, alergie, uÅ¾Ã­vanÃ© lieky" },
    ]});

    // â”€â”€ Zdravie â”€â”€
    const healthItems = [
      { name: "LekÃ¡rniÄka", note: "ObvÃ¤zy, dezinfekcia, nÃ¡plaste, rukavice" },
      { name: "Pravidelne uÅ¾Ã­vanÃ© lieky", note: "ZÃ¡soby na minimÃ¡lne 7 dnÃ­" },
      { name: "Dezinfekcia na ruky", note: "" },
    ];
    if (type !== "infant") {
      healthItems.push({ name: "Okuliare / kontaktnÃ© Å¡oÅ¡ovky", note: "Ak ich pouÅ¾Ã­vate â€“ nÃ¡hradnÃ©!" });
    }
    if (type === "infant") {
      healthItems.push({ name: "Plienky a vlhÄenÃ© utierky", note: "ZÃ¡soba na min. 3 dni" });
      healthItems.push({ name: "DojÄenskÃ¡ vÃ½Å¾iva / mlieko", note: "PrÃ¡Å¡kovÃ© + fÄ¾aÅ¡ka s cumlÃ­kom" });
      healthItems.push({ name: "CumlÃ­k a obÄ¾ÃºbenÃ¡ hraÄka", note: "Na upokojenie" });
    }
    items.push({ cat: "Zdravie a hygiena", items: healthItems });

    // â”€â”€ Jedlo a voda â”€â”€
    const foodItems = [
      { name: "BalenÃ¡ pitnÃ¡ voda", note: "Min. 1,5 l na 24 hodÃ­n" },
      { name: "FÄ¾aÅ¡a na filtrovanie vody", note: "Pre prÃ­pad kontaminovanej vody â€“ zvÃ½Å¡enÃ¡ odolnosÅ¥" },
      { name: `TrvanlivÃ© jedlo na 24 h (${kcal} kcal)`, note: type === "infant" ? "DetskÃ¡ vÃ½Å¾iva v pohÃ¡riku, kaÅ¡a" : type === "kid" ? "EnergetickÃ© tyÄinky, orechy, suÅ¡enÃ© ovocie, konzervy" : "EnergetickÃ© tyÄinky, orechy, konzervy, suÅ¡enÃ© mÃ¤so, ÄokolÃ¡da" },
    ];
    if (type !== "infant") {
      foodItems.push({ name: "HrnÄek + miska + prÃ­bor", note: "Ä½ahkÃ©, plastovÃ© alebo titÃ¡novÃ©" });
      foodItems.push({ name: "MultifunkÄnÃ½ nÃ´Å¾", note: "VrÃ¡tane otvÃ¡raÄa na konzervy" });
    }
    items.push({ cat: "Jedlo a voda", items: foodItems });

    // â”€â”€ ObleÄenie â”€â”€
    const clothItems = [
      { name: "PevnÃ¡ obuv", note: "NepremokavÃ¡, pohodlnÃ¡ â€“ pripraviÅ¥ k batohu" },
      { name: "PlÃ¡Å¡tenka / nepremokavÃ¡ bunda", note: "" },
      { name: "NÃ¡hradnÃ© obleÄenie", note: type === "infant" ? "2Ã— body, Äiapka, ponoÅ¾ky" : "TriÄko, nohavice, mikina, Äiapka" },
      { name: "SpodnÃ© prÃ¡dlo a ponoÅ¾ky", note: "Min. 2 sady" },
    ];
    items.push({ cat: "ObleÄenie", items: clothItems });

    // â”€â”€ Spanie a teplo â”€â”€
    const sleepItems = [
      { name: "SpacÃ¡k alebo teplÃ¡ deka", note: "KompaktnÃ½, Ä¾ahkÃ½" },
    ];
    if (type !== "infant") {
      sleepItems.push({ name: "Karimatka", note: "Skladacia penovÃ¡ alebo nafukovacia" });
    }
    if (type === "infant") {
      sleepItems.push({ name: "ZavinovaÄka / detskÃ¡ deka", note: "" });
    }
    items.push({ cat: "Spanie a teplo", items: sleepItems });

    // â”€â”€ Technika a komunikÃ¡cia â”€â”€
    const techItems = [];
    if (type !== "infant") {
      techItems.push({ name: "MobilnÃ½ telefÃ³n + nabÃ­jaÄka", note: "S kÃ¡blem" });
      techItems.push({ name: "NabitÃ¡ power banka", note: "Min. 10 000 mAh, pravidelne dobÃ­jaÅ¥" });
    }
    if (type === "adult" || type === "senior") {
      techItems.push({ name: "RÃ¡dio na batÃ©rie", note: "Na prÃ­jem nÃºdzovÃ©ho vysielania" });
    }
    techItems.push({ name: "Baterka / Äelovka", note: "S nÃ¡hradnÃ½mi batÃ©riami" });
    if (type !== "infant") {
      techItems.push({ name: "Papier a ceruzka", note: "Na poznÃ¡mky, sprÃ¡vy pre rodinu" });
    }
    if (techItems.length) items.push({ cat: "Technika a komunikÃ¡cia", items: techItems });

    // â”€â”€ RÃ´zne â”€â”€
    const miscItems = [
      { name: "UterÃ¡k z mikrovlÃ¡kna", note: "SkladacÃ­, rÃ½chloschnÃºci" },
    ];
    if (type === "kid") {
      miscItems.push({ name: "HraÄka / plyÅ¡iak / hra", note: "Na upokojenie a rozptÃ½lenie" });
      miscItems.push({ name: "Kniha / omaÄ¾ovÃ¡nky + ceruzky", note: "" });
    } else if (type === "adult" || type === "senior") {
      miscItems.push({ name: "Kniha / spoloÄenskÃ¡ hra / karty", note: "PsychickÃ¡ pohoda je dÃ´leÅ¾itÃ¡" });
      miscItems.push({ name: "PÃ­Å¡Å¥alka", note: "Na privolanie pomoci" });
      miscItems.push({ name: "IgelitovÃ© vreckÃ¡ (3â€“5 ks)", note: "Na odpadky, mokrÃ© veci, improvizovanÃ¡ ochrana" });
      miscItems.push({ name: "PÃ¡ska lepiaca (duct tape)", note: "UniverzÃ¡lne pouÅ¾itie â€“ opravy, utesÅˆovanie" });
      miscItems.push({ name: "Lano / Å¡nÃºra (5 m)", note: "Paracord alebo podobnÃ©" });
    }
    items.push({ cat: "RÃ´zne", items: miscItems });

    return items;
  }

  function generateEvacBags() {
    const p = state.profile;
    if (!p) return;
    const bags = {};
    let idx = 0;
    for (let i = 0; i < (p.adults||0); i++) {
      const id = "adult_" + i;
      const existing = state.evacuationBags[id];
      bags[id] = {
        type: "adult",
        label: (p.adults > 1) ? `DospelÃ½ ${i + 1}` : "DospelÃ½",
        checked: existing ? existing.checked : {}
      };
      idx++;
    }
    for (let i = 0; i < (p.kids||0); i++) {
      const id = "kid_" + i;
      const existing = state.evacuationBags[id];
      bags[id] = {
        type: "kid",
        label: (p.kids > 1) ? `DieÅ¥a ${i + 1}` : "DieÅ¥a",
        checked: existing ? existing.checked : {}
      };
    }
    for (let i = 0; i < (p.infants||0); i++) {
      const id = "infant_" + i;
      const existing = state.evacuationBags[id];
      bags[id] = {
        type: "infant",
        label: (p.infants > 1) ? `BÃ¡bÃ¤tko ${i + 1}` : "BÃ¡bÃ¤tko",
        checked: existing ? existing.checked : {}
      };
    }
    for (let i = 0; i < (p.seniors||0); i++) {
      const id = "senior_" + i;
      const existing = state.evacuationBags[id];
      bags[id] = {
        type: "senior",
        label: (p.seniors > 1) ? `Senior ${i + 1}` : "Senior",
        checked: existing ? existing.checked : {}
      };
    }
    state.evacuationBags = bags;
  }

  function getBagProgress(bagId) {
    const bag = state.evacuationBags[bagId];
    if (!bag) return { done: 0, total: 0, pct: 0 };
    const sections = getEvacBagItems(bag.type);
    let total = 0, done = 0;
    sections.forEach(sec => sec.items.forEach(item => {
      total++;
      if (bag.checked && bag.checked[item.name]) done++;
    }));
    return { done, total, pct: total ? Math.round((done / total) * 100) : 0 };
  }

  function renderEvacBags() {
    const container = document.getElementById("evacBagsContainer");
    const regenBtn = document.getElementById("btnRegenBags");
    if (!container) return;

    if (!state.profile) {
      container.innerHTML = `
        <div style="background:var(--c-bg); border-radius:1rem; padding:1.25rem; text-align:center;">
          <div style="font-size:2rem; margin-bottom:0.5rem;">ğŸ’</div>
          <div style="font-weight:600; font-size:0.9rem; margin-bottom:0.25rem;">Najprv vyplÅˆte profil domÃ¡cnosti</div>
          <div style="font-size:0.78rem; color:var(--c-muted);">BatoÅ¾iny sa vygenerujÃº podÄ¾a poÄtu a typu Älenov vaÅ¡ej rodiny.</div>
        </div>`;
      if (regenBtn) regenBtn.style.display = "none";
      return;
    }

    // Auto-generate if empty or profile changed
    const bagKeys = Object.keys(state.evacuationBags);
    const expectedCount = (state.profile.adults||0) + (state.profile.kids||0) + (state.profile.infants||0) + (state.profile.seniors||0);
    if (bagKeys.length === 0 || bagKeys.length !== expectedCount) {
      generateEvacBags();
      scheduleSave();
    }
    if (regenBtn) regenBtn.style.display = "inline-flex";

    // BYOB info banner
    let html = `
      <div style="background:linear-gradient(135deg, #fef3c7 0%, #fef9c3 100%); border:1.5px solid #fcd34d; border-radius:1rem; padding:1rem; margin-bottom:1rem;">
        <div style="display:flex; align-items:flex-start; gap:0.75rem;">
          <div style="font-size:1.375rem; flex-shrink:0; margin-top:0.125rem;">ğŸ’¡</div>
          <div>
            <div style="font-weight:700; font-size:0.85rem; color:#92400e; margin-bottom:0.25rem;">PreÄo maÅ¥ pripravenÃ½ evakuaÄnÃ½ batoh?</div>
            <div style="font-size:0.75rem; color:#a16207; line-height:1.6;">
              KeÄ musÃ­te zostaÅ¥ doma, pomÃ¡hajÃº zÃ¡soby. 
              KeÄ musÃ­te <strong>odÃ­sÅ¥ rÃ½chlo</strong> (napr. poÅ¾iar, povodeÅˆ, chemickÃ½ Ãºnik, vojenskÃ½ konflikt), pomÃ´Å¾e pripravenÃ½ batoh.
              StaÄÃ­ ho zobraÅ¥ a Ã­sÅ¥. KaÅ¾dÃ½ Älen domÃ¡cnosti by mal maÅ¥ svoj.
            </div>
            <div style="font-size:0.72rem; color:#92400e; margin-top:0.375rem; font-weight:600;">Max. hmotnosÅ¥: DospelÃ½ 25 kg &nbsp;|&nbsp; DieÅ¥a 15 kg &nbsp;|&nbsp; + 5 kg prÃ­ruÄnÃ½ batoh</div>
          </div>
        </div>
      </div>`;

    // Bag cards
    html += `<div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:0.625rem;">`;
    Object.keys(state.evacuationBags).forEach(bagId => {
      const bag = state.evacuationBags[bagId];
      const t = EVAC_BAG_TYPES[bag.type];
      const prog = getBagProgress(bagId);
      const progressColor = colorForPct(prog.pct);

      html += `
        <div onclick="openEvacBagModal('${bagId}')" style="background:${t.bg}; border:1.5px solid ${t.border}; border-radius:1rem; padding:1rem; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 6px 18px rgba(0,0,0,0.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
          <div style="display:flex; align-items:center; gap:0.625rem; margin-bottom:0.75rem;">
            <div style="width:40px; height:40px; border-radius:50%; background:white; border:1.5px solid ${t.border}; display:flex; align-items:center; justify-content:center; font-size:1.125rem; flex-shrink:0;">${t.emoji}</div>
            <div>
              <div style="font-weight:700; font-size:0.9rem; color:${t.color};">${esc(bag.label)}</div>
              <div style="font-size:0.68rem; color:var(--c-muted);">max ${t.maxKg} kg &nbsp;Â·&nbsp; ${t.kcalDay} kcal/deÅˆ</div>
            </div>
          </div>
          <div style="display:flex; align-items:center; gap:0.5rem;">
            <div class="progress-bar" style="flex:1; height:6px; margin:0;">
              <div class="progress-fill" style="width:${prog.pct}%; background:${progressColor}; transition:width 0.4s ease;"></div>
            </div>
            <span style="font-size:0.75rem; font-weight:700; color:${progressColor}; white-space:nowrap;">${prog.done}/${prog.total}</span>
          </div>
          ${prog.pct === 100 ? `<div style="text-align:center; margin-top:0.5rem; font-size:0.72rem; font-weight:700; color:#2a7a4b;">âœ“ KompletnÃ¡</div>` : ""}
        </div>`;
    });
    html += `</div>`;

    container.innerHTML = html;
  }

  function openEvacBagModal(bagId) {
    const bag = state.evacuationBags[bagId];
    if (!bag) return;
    const t = EVAC_BAG_TYPES[bag.type];
    const sections = getEvacBagItems(bag.type);
    const prog = getBagProgress(bagId);

    const icon = document.getElementById("evacBagModalIcon");
    icon.style.background = t.bg;
    icon.style.border = `1.5px solid ${t.border}`;
    icon.textContent = t.emoji;
    document.getElementById("evacBagModalTitle").textContent = "ğŸ’ " + bag.label;
    document.getElementById("evacBagModalSubtitle").textContent = `Max ${t.maxKg} kg Â· ${t.kcalDay} kcal/deÅˆ Â· ${prog.done}/${prog.total} poloÅ¾iek`;

    let html = `
      <div style="display:flex; align-items:center; gap:0.625rem; margin-bottom:1rem;">
        <div class="progress-bar" style="flex:1; height:8px; margin:0;">
          <div class="progress-fill" style="width:${prog.pct}%; background:${colorForPct(prog.pct)}; transition:width 0.3s;"></div>
        </div>
        <span style="font-size:0.9rem; font-weight:800; color:${colorForPct(prog.pct)};">${prog.pct}%</span>
      </div>`;

    sections.forEach(sec => {
      html += `<div style="margin-bottom:1rem;">
        <div style="font-size:0.72rem; font-weight:700; color:var(--c-muted); text-transform:uppercase; letter-spacing:0.05em; margin-bottom:0.5rem;">${sec.cat}</div>`;
      sec.items.forEach(item => {
        const checked = bag.checked && bag.checked[item.name];
        html += `
          <div data-evacitem="${esc(item.name)}" data-evacbag="${bagId}" style="display:flex; align-items:flex-start; gap:0.625rem; padding:0.5rem 0.625rem; border-radius:0.625rem; cursor:pointer; transition:background 0.15s; ${checked ? 'opacity:0.6;' : ''}" onmouseover="this.style.background='var(--c-bg)'" onmouseout="this.style.background='transparent'">
            <div style="width:22px; height:22px; border-radius:0.375rem; border:2px solid ${checked ? '#2a7a4b' : 'var(--c-border)'}; background:${checked ? '#2a7a4b' : 'white'}; display:flex; align-items:center; justify-content:center; flex-shrink:0; margin-top:0.0625rem; transition:all 0.15s;">
              ${checked ? '<span style="color:white; font-size:0.75rem; font-weight:700;">âœ“</span>' : ''}
            </div>
            <div style="flex:1; min-width:0;">
              <div style="font-size:0.85rem; font-weight:600; ${checked ? 'text-decoration:line-through; color:var(--c-muted);' : 'color:var(--c-text);'}">${esc(item.name)}</div>
              ${item.note ? `<div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.1rem; line-height:1.4;">${esc(item.note)}</div>` : ""}
            </div>
          </div>`;
      });
      html += `</div>`;
    });

    html += `
      <div style="display:flex; justify-content:space-between; align-items:center; padding-top:0.75rem; border-top:1px solid var(--c-border); margin-top:0.5rem;">
        <button type="button" onclick="toggleAllEvacItems('${bagId}', true)" class="btn-ghost" style="font-size:0.72rem; padding:0.375rem 0.75rem;">âœ“ OznaÄiÅ¥ vÅ¡etko</button>
        <button type="button" onclick="toggleAllEvacItems('${bagId}', false)" class="btn-ghost" style="font-size:0.72rem; padding:0.375rem 0.75rem; color:#dc2626;">âœ• OdznaÄiÅ¥ vÅ¡etko</button>
      </div>`;

    const content = document.getElementById("evacBagModalContent");
    content.innerHTML = html;

    // Bind item clicks
    content.querySelectorAll("[data-evacitem]").forEach(el => {
      el.onclick = () => {
        const itemName = el.dataset.evacitem;
        const bId = el.dataset.evacbag;
        if (!state.evacuationBags[bId].checked) state.evacuationBags[bId].checked = {};
        state.evacuationBags[bId].checked[itemName] = !state.evacuationBags[bId].checked[itemName];
        scheduleSave();
        // Re-render modal in place
        openEvacBagModal(bId);
        renderEvacBags();
      };
    });

    openModal("modalEvacBag");
  }
  window.openEvacBagModal = openEvacBagModal;

  function toggleAllEvacItems(bagId, val) {
    const bag = state.evacuationBags[bagId];
    if (!bag) return;
    const sections = getEvacBagItems(bag.type);
    if (!bag.checked) bag.checked = {};
    sections.forEach(sec => sec.items.forEach(item => {
      bag.checked[item.name] = val;
    }));
    scheduleSave();
    openEvacBagModal(bagId);
    renderEvacBags();
  }
  window.toggleAllEvacItems = toggleAllEvacItems;

  document.getElementById("btnRegenBags").onclick = () => {
    if (confirm("PregenerovaÅ¥ batohy podÄ¾a aktuÃ¡lneho profilu? ZaÅ¡krtnutÃ© poloÅ¾ky sa zachovajÃº.")) {
      generateEvacBags();
      scheduleSave();
      renderEvacBags();
    }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // VAROVNÃ‰ SIGNÃLY SIRÃ‰N
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const SIRENS_DATA = [
    {
      id: "general",
      title: "VÅ¡eobecnÃ© ohrozenie",
      duration: "2 minÃºty",
      type: "kolÃ­savÃ½ tÃ³n",
      color: "#dc2626",
      bg: "#fef2f2",
      border: "#fecaca",
      wave: "oscillating",
      meaning: "Signalizuje ohrozenie alebo vznik mimoriadnej udalosti, ako aj moÅ¾nosÅ¥ rozÅ¡Ã­renia jej nÃ¡sledkov.",
      action: "IhneÄ vyhÄ¾adajte Ãºkryt v najbliÅ¾Å¡ej budove. Zavrite a utesnite oknÃ¡, dvere a ventilaÄnÃ© otvory. Sledujte vysielanie rozhlasu a televÃ­zie. RiaÄte sa pokynmi zÃ¡chrannÃ½ch zloÅ¾iek.",
      note: "KolÃ­savÃ½m tÃ³nom v trvanÃ­ 2 min sa poÄas vojnovÃ©ho stavu vyhlasuje aj ohrozenie v prÃ­pade moÅ¾nÃ©ho vzduÅ¡nÃ©ho napadnutia."
    },
    {
      id: "water",
      title: "Ohrozenie vodou",
      duration: "6 minÃºt",
      type: "stÃ¡ly tÃ³n",
      color: "#1e40af",
      bg: "#eff6ff",
      border: "#bfdbfe",
      wave: "steady",
      meaning: "Signalizuje ohrozenie niÄivÃ½mi ÃºÄinkami vody â€“ povodne, pretrhnutie hrÃ¡dze a pod.",
      action: "OkamÅ¾ite sa presuÅˆte na vyÅ¡Å¡ie poloÅ¾enÃ© miesto. Nevstupujte do zaplavenÃ½ch oblastÃ­. Sledujte pokyny zÃ¡chrannÃ½ch zloÅ¾iek a miestnych Ãºradov.",
      note: null
    },
    {
      id: "end",
      title: "Koniec ohrozenia",
      duration: "2 minÃºty",
      type: "stÃ¡ly tÃ³n",
      color: "#2a7a4b",
      bg: "#eaf4ee",
      border: "#86efac",
      wave: "steady",
      meaning: "Signalizuje koniec ohrozenia alebo koniec pÃ´sobenia nÃ¡sledkov mimoriadnej udalosti.",
      action: "Sledujte doplnkovÃº hovorenÃº informÃ¡ciu v mÃ©diÃ¡ch. RiaÄte sa pokynmi kompetentnÃ½ch orgÃ¡nov. Nevracajte sa do ohrozenej oblasti, kÃ½m to nebude povolenÃ©.",
      note: "Tento signÃ¡l sa vysiela bez opakovania a je doplnenÃ½ hovorenou informÃ¡ciou."
    },
    {
      id: "test",
      title: "SkÃºÅ¡ka sirÃ©n",
      duration: "2 minÃºty",
      type: "stÃ¡ly tÃ³n",
      color: "#6b6560",
      bg: "#f5f3ee",
      border: "#e2ddd5",
      wave: "steady",
      meaning: "PravidelnÃ© preskÃºÅ¡anie funkÄnosti sirÃ©n. NejednÃ¡ sa o skutoÄnÃ© ohrozenie.",
      action: "Å½iadna akcia nie je potrebnÃ¡. SkÃºÅ¡ky sÃº vopred oznÃ¡menÃ© v mÃ©diÃ¡ch.",
      note: "SkÃºÅ¡ka prebieha spravidla kaÅ¾dÃ½ druhÃ½ piatok v mesiaci o 12:00."
    }
  ];

  function renderSirens() {
    const grid = document.getElementById("sirensGrid");
    if (!grid) return;
    grid.innerHTML = "";
    SIRENS_DATA.forEach(siren => {
      const card = document.createElement("div");
      card.className = "siren-card";
      // Generuj wave bars
      const barCount = 20;
      let bars = "";
      for (let i = 0; i < barCount; i++) {
        const delay = siren.wave === "oscillating"
          ? (Math.sin(i * 0.6) * 0.4 + 0.3).toFixed(2)
          : (0.1 * (i % 3)).toFixed(2);
        const height = siren.wave === "oscillating"
          ? Math.round(40 + Math.sin(i * 0.8) * 35)
          : Math.round(70 + Math.sin(i * 0.2) * 10);
        bars += `<div class="siren-wave-bar" style="left:${(i / barCount) * 100}%; height:${height}%; background:${siren.color}; opacity:0.6; animation-delay:${delay}s;"></div>`;
      }
      card.innerHTML = `
        <div style="display:flex; align-items:center; justify-content:space-between; gap:0.5rem;">
          <div>
            <div style="font-weight:700; font-size:0.9rem; color:${siren.color};">${siren.title}</div>
            <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.125rem;">${siren.duration} â€“ ${siren.type}</div>
          </div>
          <div style="background:${siren.bg}; border:1px solid ${siren.border}; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.68rem; font-weight:700; color:${siren.color}; white-space:nowrap;">${siren.duration}</div>
        </div>
        <div class="siren-wave ${siren.wave === 'steady' ? 'siren-wave-steady' : ''}" style="background:${siren.bg}; border:1px solid ${siren.border};">${bars}</div>`;
      card.onclick = () => openSirenModal(siren);
      grid.appendChild(card);
    });
  }

  function openSirenModal(siren) {
    document.getElementById("sirenModalTitle").textContent = "ğŸ”” " + siren.title;
    let html = `
      <div style="background:${siren.bg}; border:1.5px solid ${siren.border}; border-radius:1rem; padding:1rem; margin-bottom:1rem;">
        <div style="display:flex; align-items:center; gap:0.75rem; margin-bottom:0.5rem;">
          <div style="font-size:1.75rem; font-weight:800; color:${siren.color};">${siren.duration}</div>
          <div>
            <div style="font-weight:700; color:${siren.color}; font-size:0.9rem;">${siren.type.charAt(0).toUpperCase() + siren.type.slice(1)}</div>
            <div style="font-size:0.75rem; color:var(--c-muted);">trvanie signÃ¡lu</div>
          </div>
        </div>
      </div>

      <div style="margin-bottom:1rem;">
        <div style="font-weight:700; font-size:0.85rem; margin-bottom:0.375rem;">ğŸ“– VÃ½znam</div>
        <div style="font-size:0.85rem; color:var(--c-text); line-height:1.6;">${siren.meaning}</div>
      </div>

      <div style="margin-bottom:1rem;">
        <div style="font-weight:700; font-size:0.85rem; margin-bottom:0.375rem;">âœ… ÄŒo robiÅ¥</div>
        <div style="font-size:0.85rem; color:var(--c-text); line-height:1.6;">${siren.action}</div>
      </div>`;

    if (siren.note) {
      html += `<div class="fa-info"><strong>â„¹ï¸ PoznÃ¡mka:</strong> ${siren.note}</div>`;
    }

    html += `<div class="fa-source"><strong>Zdroj:</strong> PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu" (2025)</div>`;

    document.getElementById("sirenModalContent").innerHTML = html;
    openModal("modalSiren");
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // NÃšDZOVÃ‰ VYSIELANIE RÃDIA
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const RADIO_DATA = [
    {
      name: "SlovenskÃ½ rozhlas â€“ RÃ¡dio Slovensko",
      desc: "HlavnÃ½ kanÃ¡l pre nÃºdzovÃ© hlÃ¡senia a pokyny zÃ¡chrannÃ½ch zloÅ¾iek pre celÃ© Slovensko.",
      emoji: "ğŸ“¡",
      bg: "#fef2f2",
      border: "#fecaca",
      frequencies: [
        { region: "Bratislava", fm: "96.6 MHz" },
        { region: "BanskÃ¡ Bystrica", fm: "94.4 MHz" },
        { region: "KoÅ¡ice", fm: "89.5 MHz" },
        { region: "Å½ilina", fm: "104.8 MHz" },
        { region: "Nitra", fm: "92.2 MHz" },
        { region: "PreÅ¡ov", fm: "100.3 MHz" },
        { region: "TrenÄÃ­n", fm: "92.7 MHz" },
        { region: "Trnava", fm: "101.1 MHz" },
      ]
    },
    {
      name: "RÃ¡dio Regina",
      desc: "RegionÃ¡lne vysielanie s lokÃ¡lnymi nÃºdzovÃ½mi informÃ¡ciami a varovaniami.",
      emoji: "ğŸ”ï¸",
      bg: "#eff6ff",
      border: "#bfdbfe",
      frequencies: [
        { region: "ZÃ¡pad (BA, TN, TT, NR)", fm: "99.3 MHz" },
        { region: "Stred (BB, ZA)", fm: "100.3 MHz" },
        { region: "VÃ½chod (KE, PO)", fm: "103.2 MHz" },
      ]
    },
    {
      name: "RÃ¡dio Patria",
      desc: "Vysielanie v maÄarskom jazyku â€“ nÃºdzovÃ© hlÃ¡senia pre juÅ¾nÃ© Slovensko.",
      emoji: "ğŸŒ",
      bg: "#eaf4ee",
      border: "#86efac",
      frequencies: [
        { region: "Bratislava", fm: "98.9 MHz" },
        { region: "KomÃ¡rno", fm: "96.2 MHz" },
        { region: "Rim. Sobota", fm: "105.5 MHz" },
      ]
    }
  ];

  function renderRadio() {
    const grid = document.getElementById("radioGrid");
    if (!grid) return;
    grid.innerHTML = "";
    RADIO_DATA.forEach(radio => {
      const card = document.createElement("div");
      card.style.cssText = `background:${radio.bg}; border:1.5px solid ${radio.border}; border-radius:1rem; padding:1rem;`;
      let freqHtml = radio.frequencies.map(f =>
        `<div style="display:flex; justify-content:space-between; padding:0.3rem 0; border-bottom:1px solid ${radio.border};">
          <span style="font-size:0.78rem; color:var(--c-muted);">${f.region}</span>
          <span style="font-size:0.78rem; font-weight:700; color:var(--c-text);">${f.fm}</span>
        </div>`
      ).join("");
      card.innerHTML = `
        <div style="display:flex; align-items:center; gap:0.625rem; margin-bottom:0.625rem;">
          <span style="font-size:1.25rem;">${radio.emoji}</span>
          <div>
            <div style="font-weight:700; font-size:0.875rem;">${radio.name}</div>
            <div style="font-size:0.7rem; color:var(--c-muted); line-height:1.4; margin-top:0.1rem;">${radio.desc}</div>
          </div>
        </div>
        <div>${freqHtml}</div>`;
      grid.appendChild(card);
    });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // POSTUPY PRI MIMORIADNYCH UDALOSTIACH
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const EMERGENCY_PROC_DATA = [
    {
      id: "flood",
      emoji: "ğŸŒŠ",
      title: "Povodne",
      subtitle: "SilnÃ© daÅ¾de, zÃ¡plavy a stÃºpanie hladÃ­n",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { text: "<strong>Zatvorte vÅ¡etky oknÃ¡ a dvere</strong> â€“ zabrÃ¡Åˆte vniknutiu vody do obytnÃ½ch priestorov." },
        { text: "<strong>Sledujte poÄasie a spravodajstvo</strong> â€“ informÃ¡cie z SHMÃš a mÃ©diÃ­ sÃº kÄ¾ÃºÄovÃ©." },
        { text: "<strong>OdstrÃ¡Åˆte nebezpeÄnÃ© lÃ¡tky</strong> â€“ jedy, kyseliny a Å¾ieraviny, ktorÃ© mÃ´Å¾u reagovaÅ¥ s vodou." },
        { text: "<strong>Vypnite elektrinu, vodu a plyn</strong> â€“ predÃ­Äte Ãºrazom a vÃ½buchom." },
        { text: "<strong>Pripravte si evakuaÄnÃ½ batoh</strong> â€“ doklady, lieky, voda, potraviny, obleÄenie." },
        { text: "<strong>PresuÅˆte sa na vyvÃ½Å¡enÃ© miesto</strong> â€“ v prÃ­pade Äasovej tiesne okamÅ¾ite preruÅ¡te vÅ¡etky aktivity." },
        { text: "<strong>Nejazdite cez zaplavenÃ© cesty</strong> â€“ ak neviete hÄºbku vody. RÃ½chlo opustite auto, ktorÃ© zalieva voda." },
        { text: "<strong>Zavolajte 112</strong> z bezpeÄnÃ©ho miesta a poÄkajte na ÄalÅ¡ie inÅ¡trukcie." }
      ],
      warning: "Vyhnite sa cestovaniu cez rizikovÃ© oblasti. Uistite sa, Å¾e vaÅ¡i blÃ­zki a susedia majÃº vÅ¡etky informÃ¡cie. Dbajte na vlastnÃº bezpeÄnosÅ¥.",
      source: "PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "earthquake",
      emoji: "ğŸ«¨",
      title: "Zemetrasenie",
      subtitle: "SeizmickÃ¡ aktivita a otrasy",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>V budove zostaÅˆte vo vnÃºtri, mimo budovy zostaÅˆte vonku</strong> â€“ najviac Ãºrazov sa stÃ¡va pri panickÃ½ch presunoch." },
        { text: "<strong>VyhÄ¾adajte vhodnÃ© miesto</strong> â€“ postavte sa k opornÃ©mu mÃºru alebo pod rÃ¡m dverÃ­, nikdy nie k oknu." },
        { text: "<strong>Ukryte sa pod stÃ´l</strong> alebo pod najbliÅ¾Å¡Ã­ odolnÃ½ predmet." },
        { text: "<strong>Nevstupujte do vÃ½Å¥ahu</strong> a na schodiÅ¡te." },
        { text: "<strong>Vonku sa zdrÅ¾iavajte Äalej</strong> od elektrickÃ©ho vedenia, stromov a pomnÃ­kov." },
        { text: "<strong>NepouÅ¾Ã­vajte otvorenÃ½ oheÅˆ</strong> â€“ hrozÃ­ vÃ½buch plynu a nÃ¡slednÃ½ poÅ¾iar." },
        { text: "<strong>V aute okamÅ¾ite zastavte</strong> na otvorenom priestranstve a nevystupujte poÄas otrasov." }
      ],
      warning: "Zachovajte pokoj a rozvahu. Po otrasoch skontrolujte blÃ­zkych a susedov. V Ãºzkych uliciach hÄ¾adajte ochranu pod najbliÅ¾Å¡ou brÃ¡nou.",
      source: "PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "fire",
      emoji: "ğŸ”¥",
      title: "PoÅ¾iar",
      subtitle: "PoÅ¾iar v budove alebo okolÃ­",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { text: "<strong>OhlÃ¡ste poÅ¾iar na ÄÃ­slo 150 alebo 112</strong> â€“ z bezpeÄnÃ©ho miesta, bez zbytoÄnÃ©ho odkladu." },
        { text: "<strong>Ak je to moÅ¾nÃ©, poÅ¾iar uhaste</strong> alebo spravte opatrenia na zamedzenie jeho Å¡Ã­renia." },
        { text: "<strong>Uzavrite prÃ­vod plynu a elektriny.</strong>" },
        { text: "<strong>IhneÄ opustite ohrozenÃ½ priestor</strong> â€“ informujte osoby, ktorÃ© mÃ´Å¾u byÅ¥ ohrozenÃ©." },
        { text: "<strong>Poskytnite pomoc</strong> tÃ½m, ktorÃ­ ju potrebujÃº â€“ ak tÃ½m neohrozÃ­te seba." },
        { text: "<strong>UvoÄ¾nite prÃ­stupovÃ© cesty</strong> zÃ¡chrannÃ½m zloÅ¾kÃ¡m â€“ minimÃ¡lne 3 metre." }
      ],
      warning: "Na vÃ½zvu veliteÄ¾a zÃ¡sahu poskytnite vecnÃº alebo osobnÃº pomoc. Nikdy sa nevracajte do horiacej budovy.",
      source: "PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "blackout",
      emoji: "ğŸ”Œ",
      title: "VÃ½padok elektriny",
      subtitle: "ÄŒo robiÅ¥ keÄ vypadne elektrickÃ½ prÃºd",
      iconBg: "#f5f3ee",
      iconBorder: "#e2ddd5",
      steps: [
        { header: "OkamÅ¾itÃ© kroky" },
        { text: "<strong>Odpojte elektrickÃ© spotrebiÄe zo zÃ¡suviek.</strong> NajjednoduchÅ¡ie je vypnÃºÅ¥ hlavnÃ½ istiÄe â€“ ochrÃ¡nite spotrebiÄe pred poÅ¡kodenÃ­m pri obnovenÃ­ prÃºdu." },
        { text: "<strong>PlatobnÃ© karty a bankomaty nebudÃº fungovaÅ¥.</strong> Majte doma hotovosÅ¥ (mince aj bankovky) na niekoÄ¾ko dnÃ­." },
        { note: "Do niekoÄ¾kÃ½ch hodÃ­n prestanÃº fungovaÅ¥ aj telefÃ³nne siete. VÃ½znamne sa obmedzÃ­ vÃ¤ÄÅ¡ina zÃ¡kladnÃ½ch sluÅ¾ieb." },
        { header: "Jedlo a zÃ¡soby" },
        { text: "<strong>LedniÄku a mrazÃ¡k otvÃ¡rajte Äo najmenej</strong> â€“ potraviny zostanÃº chladenÃ© dlhÅ¡ie." },
        { text: "<strong>NiektorÃ© veci premiestnite z mrazÃ¡ku do lednice</strong> â€“ pomÃ´Å¾e to udrÅ¾aÅ¥ v nej chlad." },
        { text: "<strong>Kontrolujte podlahu</strong> â€“ pri tÃ¡nÃ­ mÃ´Å¾e vytekaÅ¥ voda." },
        { text: "<strong>RozmrazenÃ© potraviny spotrebujte Äo najrÃ½chlejÅ¡ie.</strong> Ak ich chcete znova zmraziÅ¥, najprv ich tepelne spracujte." },
        { text: "<strong>V zime skladujte potraviny vonku</strong> â€“ chrÃ¡Åˆte ich pred zvieratami, vlhkosÅ¥ou a priamym slnkom." },
        { text: "<strong>Jedlo pripravte bez elektriny:</strong> kuskus, instantnÃ¡ kaÅ¡a, obilnÃ© vloÄky staÄÃ­ zaliaÅ¥ studenou vodou. Varenie na kempingovom variÄi alebo grile â€“ s ohÅˆom zaobchÃ¡dzajte opatrne." },
        { header: "Ako zostaÅ¥ v teple" },
        { text: "<strong>Dostatok teplÃ©ho obleÄenia, obuvi a prikrÃ½vok</strong> pre vÅ¡etkÃ½ch Älenov domÃ¡cnosti." },
        { text: "<strong>UdrÅ¾iavajte teplo len v jednej miestnosti.</strong> OstatnÃ© miestnosti pouÅ¾Ã­vajte Äo najmenej." },
        { text: "<strong>Zavrite dvere do ostatnÃ½ch miestnostÃ­</strong> a otvory utesnite zÃ¡vesom alebo dekami." },
        { text: "<strong>Na podlahu poloÅ¾te koberec alebo prikrÃ½vky.</strong> OblieÄte sa do vrstiev prieduÅ¡nÃ©ho obleÄenia." },
        { text: "<strong>Presunete posteÄ¾ na najteplejÅ¡ie miesto</strong> â€“ vÅ¡etci v domÃ¡cnosti by mali trÃ¡viÅ¥ Äas a spaÅ¥ v jednej miestnosti." },
        { warn: "<strong>Alkohol</strong> zahrieva len krÃ¡tkodobo a piÅ¥ ho v krÃ­ze mÃ´Å¾e byÅ¥ nebezpeÄnÃ© â€“ zniÅ¾uje pozornosÅ¥ a zhorÅ¡uje Ãºsudok. LepÅ¡ie sa mu Ãºplne vyhnÃºÅ¥." },
        { header: "Toaleta a hygiena" },
        { text: "<strong>PloÅ¡nÃ½ vÃ½padok elektriny mÃ´Å¾e preruÅ¡iÅ¥ dodÃ¡vky vody.</strong> Toaletu splÃ¡chnuteÄ¾ iba raz, potom sa nÃ¡drÅ¾ka nenapÄºÅˆa." },
        { text: "<strong>Pri preruÅ¡enÃ­ vody aj elektriny</strong> pouÅ¾Ã­vajte toaletu len v nevyhnutnÃ½ch prÃ­padoch. Na umytie rÃºk pouÅ¾Ã­vajte dezinfekciu." },
        { note: "<strong>NouzovÃ© rieÅ¡enie:</strong> do zÃ¡chodovej misy vloÅ¾Ã­te odpadkovÃ½ pytel, dÃ¡te naÅˆ toaletnÃ½ papier, noviny alebo koÄkolit. Po pouÅ¾itÃ­ pytel pevne zaviaÅ¾ete a vloÅ¾Ã­te do ÄalÅ¡Ã­ch dvoch vriec." },
        { header: "MobilnÃ½ telefÃ³n" },
        { text: "<strong>TelefÃ³n pouÅ¾Ã­vajte len v najnutnejÅ¡Ã­ch prÃ­padoch.</strong> SieÅ¥ mÃ´Å¾e byÅ¥ preÅ¥aÅ¾enÃ¡ alebo nefunkÄnÃ¡." },
        { text: "<strong>Obmedzite sÅ¥ahovanie dÃ¡t</strong> a zbytoÄnÃº komunikÃ¡ciu, Å¡etrite batÃ©riu." },
        { header: "KeÄ sa dodÃ¡vky elektriny obnovia" },
        { text: "<strong>Skontrolujte vÅ¡etky elektrickÃ© spotrebiÄe a osvetlenie</strong> v byte alebo dome." },
        { text: "<strong>Uistite sa, Å¾e nie je zapnutÃ½ sporÃ¡k</strong> alebo inÃ½ spotrebiÄ, ktorÃ½ by mohol byÅ¥ nebezpeÄnÃ½." },
        { text: "<strong>Overte stav potravÃ­n</strong> v lednici a mrazÃ¡ku." }
      ],
      warning: "Pozor: V budovÃ¡ch s diaÄ¾kovÃ½m vykurovanÃ­m mÃ´Å¾e byÅ¥ teplÃ¡ voda poÄas vÃ½padku prÃºdu nebezpeÄne horÃºca aÅ¾ vrÃºca.",
      source: "PrÃ­ruÄka 72h.gov.cz + PrÃ­ruÄka MV SR"
    },
    {
      id: "chemical",
      emoji: "ğŸ§ª",
      title: "ChemickÃ½ Ãºnik",
      subtitle: "Ãšnik nebezpeÄnÃ½ch chemickÃ½ch lÃ¡tok",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>UrÃ½chlene opustite ohrozenÃ© miesto.</strong>" },
        { text: "<strong>Ukryte sa v uzavretej miestnosti</strong> â€“ vytvorte izolovanÃ½ uzavretÃ½ priestor." },
        { text: "<strong>Vypnite ventilÃ¡ciu a klimatizÃ¡ciu.</strong>" },
        { text: "<strong>Uhaste otvorenÃ½ oheÅˆ</strong> a vypnite plynovÃ© spotrebiÄe." },
        { text: "<strong>ChrÃ¡Åˆte si dÃ½chacie cesty a oÄi</strong> â€“ navlhÄenou tkaninou, improvizovanÃ½m rÃºÅ¡kom." },
        { text: "<strong>Sledujte informÃ¡cie</strong> na oficiÃ¡lnych komunikaÄnÃ½ch kanÃ¡loch." },
        { text: "<strong>Telefonujte len v sÃºrnom prÃ­pade</strong> â€“ nezaÅ¥aÅ¾ujte siete." },
        { text: "<strong>Nikdy sa neukrÃ½vajte do pivnÃ­c</strong> a terÃ©nnych nerovnostÃ­ â€“ chemickÃ© lÃ¡tky sÃº Äasto Å¥aÅ¾Å¡ie neÅ¾ vzduch." }
      ],
      warning: "Pripravte si evakuaÄnÃ½ batoh. NakÅ•mte domÃ¡ce zvieratÃ¡ a uzatvorte ich v prepravnÃ½ch boxoch. ÄŒakajte na pokyny zÃ¡chrannÃ½ch zloÅ¾iek.",
      source: "PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "radiation",
      emoji: "â˜¢ï¸",
      title: "RÃ¡dioaktÃ­vny Ãºnik",
      subtitle: "Ãšnik nebezpeÄnÃ½ch rÃ¡dioaktÃ­vnych lÃ¡tok",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>Na otvorenom priestranstve ihneÄ vyhÄ¾adajte najbliÅ¾Å¡iu budovu.</strong>" },
        { text: "<strong>Ukryte sa</strong> â€“ zdrÅ¾iavajte sa v stredovÃ½ch miestnostiach na prÃ­zemÃ­ alebo v suterÃ©ne." },
        { text: "<strong>Ak ste mohli prÃ­sÅ¥ do styku s rÃ¡dioaktÃ­vnymi lÃ¡tkami:</strong> odloÅ¾te kontaminovanÃ½ odev do neprieduÅ¡nÃ©ho obalu, umyte si ruky, tvÃ¡r, vlasy, vyplÃ¡chnite oÄi a Ãºsta, osprchujte sa a vymeÅˆte bielizeÅˆ." },
        { text: "<strong>Uzatvorte a utesnite oknÃ¡, dvere</strong> â€“ vypnite ventilÃ¡ciu a utesnite ÄalÅ¡ie otvory." },
        { text: "<strong>ZabezpeÄte potraviny a vodu</strong> pred kontaminÃ¡ciou pomocou vzduchotesne uzavretÃ½ch nÃ¡dob." },
        { text: "<strong>NepoÅ¾Ã­vajte nechrÃ¡nenÃ© potraviny</strong>, ovocie a zeleninu z voÄ¾nÃ©ho priestranstva." },
        { text: "<strong>EvakuÃ¡ciu vykonajte</strong> aÅ¾ na zÃ¡klade pokynov zÃ¡chranÃ¡rov alebo oficiÃ¡lneho vyhlÃ¡senia." }
      ],
      warning: "Sledujte informÃ¡cie na oficiÃ¡lnych komunikaÄnÃ½ch kanÃ¡loch. Pripravte si prostriedky improvizovanej ochrany a evakuaÄnÃ½ batoh.",
      source: "PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "landslide",
      emoji: "â›°ï¸",
      title: "Zosuv pÃ´dy",
      subtitle: "Zosuvy pÃ´dy a prÃ­valovÃ© bahno",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>Sledujte zmeny okolia</strong> â€“ neobvyklÃ© zvuky (praskajÃºce stromy, skaly), nÃ¡hle zmeny hladiny tokov, viditeÄ¾nÃ© zmeny povrchu zeme." },
        { text: "<strong>V budove sa zdrÅ¾ujte</strong> Äo najÄalej od moÅ¾nÃ©ho ohrozenia, na vyÅ¡Å¡om poschodÃ­. Schovajte sa pod pevnÃ½ nÃ¡bytok." },
        { text: "<strong>Vonku sa presuÅˆte</strong> mimo trasy zosuvu na najbliÅ¾Å¡ie vyvÃ½Å¡enÃ© miesto." },
        { text: "<strong>Ak nemÃ´Å¾ete uniknÃºÅ¥</strong> â€“ schovajte sa za skupinu vÃ¤ÄÅ¡Ã­ch stromov alebo v najodolnejÅ¡ej budove." },
        { text: "<strong>Zavolajte 112</strong> z bezpeÄnÃ©ho miesta a poÄkajte na inÅ¡trukcie." }
      ],
      warning: "NajvÃ¤ÄÅ¡ie riziko zosuvu je pri prÃ­valovom daÅ¾di, hlavne ak je zem nasiaknutÃ¡ po dlhotrvajÃºcich daÅ¾Äoch.",
      source: "PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "storm",
      emoji: "ğŸŒªï¸",
      title: "VÃ­chrica",
      subtitle: "VÃ­chrica a silnÃ½ vietor",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { text: "<strong>NevychÃ¡dzajte z domu</strong> ak nemusÃ­te." },
        { text: "<strong>NezdrÅ¾iavajte sa na voÄ¾nÃ½ch plochÃ¡ch.</strong>" },
        { text: "<strong>Zatvorte a zabezpeÄte oknÃ¡ a dvere.</strong>" },
        { text: "<strong>OdloÅ¾te z dvorov voÄ¾ne poloÅ¾enÃ© predmety</strong> â€“ mÃ´Å¾u sa staÅ¥ nebezpeÄnÃ½mi projektilmi." },
        { text: "<strong>Neparkujte pod stromami</strong> a pri chatrnÃ½ch budovÃ¡ch." },
        { text: "<strong>Vyhnite sa pohybu v horÃ¡ch a parkoch.</strong>" }
      ],
      warning: "ZabezpeÄte domÃ¡ce zvieratÃ¡. Nejazdite s Ä¾ahkÃ½mi vozidlami po otvorenÃ½ch veternÃ½ch plochÃ¡ch.",
      source: "PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "terror",
      emoji: "ğŸš¨",
      title: "TeroristickÃ½ Ãºtok",
      subtitle: "BombovÃ½ Ãºtok alebo streÄ¾ba",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { text: "<strong>Ak mÃ¡te ÃºnikovÃº cestu â€“ uteÄte.</strong> Zoberte si iba telefÃ³n, prepnite ho do tichÃ©ho reÅ¾imu." },
        { text: "<strong>Varujte ostatnÃ½ch</strong> pred vstupom do nebezpeÄnej zÃ³ny." },
        { text: "<strong>Ak nemÃ´Å¾ete utiecÅ¥ â€“ schovajte sa.</strong> Zamknite dvere, kÄ¾ÃºÄ ponechajte v zÃ¡mku." },
        { text: "<strong>NezdrÅ¾ujte sa v blÃ­zkosti okien</strong> â€“ schovajte sa za pevnÃ© veÄ¾kÃ© predmety." },
        { text: "<strong>Pri bezprostrednom ohrozenÃ­ bojujte.</strong> PouÅ¾ite predmety v okolÃ­ â€“ palica, kÄ¾ÃºÄe, hasiaci prÃ­stroj." },
        { text: "<strong>Volajte 158 alebo 112</strong> â€“ inak zbytoÄne netelefonujte." },
        { text: "<strong>NezdieÄ¾ajte zÃ¡znamy na sociÃ¡lnych sieÅ¥ach</strong> â€“ mÃ´Å¾u byÅ¥ zneuÅ¾itÃ©." }
      ],
      warning: "PlÅˆte pokyny vydanÃ© oprÃ¡vnenÃ½mi osobami. Ak neohrozÃ­te seba, poskytnite pomoc tÃ½m, ktorÃ­ ju potrebujÃº. Sledujte informÃ¡cie na oficiÃ¡lnych kanÃ¡loch.",
      source: "PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "heat",
      emoji: "ğŸŒ¡ï¸",
      title: "HorÃºÄavy",
      subtitle: "ExtrÃ©mne vysokÃ© teploty",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>ZdrÅ¾iavajte sa v tieni</strong> â€“ vyhÃ½bajte sa priamemu slnku." },
        { text: "<strong>DodrÅ¾iavajte pitnÃ½ reÅ¾im</strong> a Ä¾ahÅ¡ie sa stravujte." },
        { text: "<strong>Vhodne sa obliekajte</strong> â€“ Ä¾ahkÃ©, vzduÅ¡nÃ© obleÄenie svetlÃ½ch farieb." },
        { text: "<strong>TieÅˆte oknÃ¡</strong> Å¾alÃºziami alebo roletami â€“ zabrÃ¡Åˆte prenikaniu slneÄnÃ½ch lÃºÄov." },
        { text: "<strong>OsvieÅ¾te sa vlaÅ¾nou sprchou</strong> aspoÅˆ raz denne â€“ pozor na prÃ­liÅ¡ studenÃº vodu." },
        { text: "<strong>NenechÃ¡vajte deti a zvieratÃ¡</strong> v zaparkovanÃ½ch autÃ¡ch â€“ nikdy, v Å¾iadnom prÃ­pade." }
      ],
      warning: "PouÅ¾Ã­vajte krÃ©my s UV ochranou. ZabezpeÄte dostatok tekutÃ­n pre zvieratÃ¡ a Ãºkryt pred slnkom.",
      source: "PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "snow",
      emoji: "â„ï¸",
      title: "SnehovÃ¡ kalamita",
      subtitle: "ExtrÃ©mne sneÅ¾enie a nÃ­zke teploty",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { text: "<strong>Obmedzte automobilovÃº prepravu</strong> â€“ hrozÃ­ uviaznutie vozidiel." },
        { text: "<strong>Neblokujte odhrnutÃ© cesty</strong> â€“ zÃ¡chrannÃ© zloÅ¾ky musia prejsÅ¥." },
        { text: "<strong>Sledujte predpovede</strong> na strÃ¡nke SHMÃš (shmu.sk)." },
        { text: "<strong>Neparkujte pod stromami</strong> a pri chatrnÃ½ch budovÃ¡ch." },
        { text: "<strong>PouÅ¾Ã­vajte viac vrstiev obleÄenia</strong> â€“ teplÃ© ponoÅ¾ky, Äiapku, Å¡Ã¡l, rukavice." },
        { text: "<strong>NezdrÅ¾iavajte sa dlho na mraze</strong> â€“ Å¡portovÃ© aktivity presuÅˆte do interiÃ©ru." },
        { text: "<strong>ZabezpeÄte domÃ¡ce zvieratÃ¡</strong> pred mrazom." }
      ],
      warning: "NedotÃ½kajte sa namrznutÃ½ch kovovÃ½ch predmetov holÃ½mi rukami. V prÃ­pade premoÄenia majte po ruke rezervnÃ© obleÄenie. VrchnÃ© obleÄenie by malo byÅ¥ odolnÃ© voÄi vetru a daÅ¾Äu.",
      source: "PrÃ­ruÄka MV SR â€V prÃ­pade krÃ­zy alebo ozbrojenÃ©ho konfliktu"
    },
    {
      id: "evacuation",
      emoji: "ğŸƒ",
      title: "EvakuÃ¡cia",
      subtitle: "KompletnÃ½ postup pri nariadenÃ­ evakuÃ¡cie",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { header: "BezpeÄnostnÃ© opatrenia" },
        { text: "<strong>Uhaste oheÅˆ v kamnÃ¡ch alebo krbe.</strong>" },
        { text: "<strong>Vypnite elektrickÃ© spotrebiÄe</strong> (okrem mrazÃ¡ku a ledniÄky)." },
        { text: "<strong>Zavrite oknÃ¡ a dvere,</strong> vypnite ventilÃ¡ciu a klimatizÃ¡ciu." },
        { text: "<strong>Uzavrite vodu a plyn.</strong>" },
        { header: "ÄŒo si vziaÅ¥ so sebou?" },
        { text: "<strong>EvakuaÄnÃ½ batoh</strong> â€“ zavazadlo oznaÄte Å¡tÃ­tkom so menom a telefÃ³nnym ÄÃ­slom majiteÄ¾a." },
        { text: "<strong>HmotnosÅ¥ batohu:</strong> max 25 kg (dospelÃ½), 15 kg (dieÅ¥a), + 5 kg prÃ­ruÄnÃ¡." },
        { header: "Ochrana osÃ´b" },
        { text: "<strong>DeÅ¥om a zraniteÄ¾nÃ½m osobÃ¡m</strong> dajte do kapsy kartiÄku so menom, adresou a kontaktom na prÃ­buznÃ©ho." },
        { text: "<strong>Upozornite na evakuÃ¡ciu susedov.</strong> PonÃºknite im pomoc." },
        { header: "Pred odchodom" },
        { text: "<strong>Zamknite byt alebo dom.</strong>" },
        { text: "<strong>Na dvere nalepte lÃ­stok</strong> s informÃ¡ciou, kedy a kam ste sa evakuovali, s vaÅ¡imi menami a kontaktami. UÄ¾ahÄÃ­te tÃ½m prÃ¡cu zÃ¡chranÃ¡rom pri kontrole evakuovanÃ½ch oblastÃ­." },
        { text: "<strong>Ak sa evakuujete sami,</strong> prihlÃ¡ste sa u znÃ¡mym alebo Ãºradom. ZÃ¡chrannÃ© zloÅ¾ky budÃº vedieÅ¥, kde vÃ¡s v prÃ­pade potreby nÃ¡jsÅ¥." },
        { header: "Na zhromaÅ¾disku" },
        { text: "<strong>Dostavte sa na urÄenÃ© miesto.</strong>" },
        { text: "<strong>V prÃ­pade potreby pouÅ¾ite ochranu dÃ½chacÃ­ch ciest</strong> a povrchu tela." },
        { text: "<strong>RiaÄte sa pokynmi zÃ¡chranÃ¡rov</strong> a zodpovednÃ½ch osÃ´b." },
        { text: "<strong>NeÅ¾ sa evakuujete autom,</strong> zvÃ¡Å¾te rizikÃ¡ (poÄasÃ­, palivo, stav ciest)." }
      ],
      warning: "VÃ½zvu k evakuÃ¡cii musÃ­te uposlÃºchnuÅ¥ a riadiÅ¥ sa pokynmi zÃ¡chrannÃ½ch zloÅ¾iek. ChrÃ¡nime tÃ½m nielen seba, ale aj zdravie a Å¾ivoty zÃ¡chrannÃ½ch zloÅ¾iek.",
      source: "PrÃ­ruÄka 72h.gov.cz + PrÃ­ruÄka MV SR"
    },
    {
      id: "armed_conflict",
      emoji: "ğŸ’£",
      title: "OzbrojenÃ½ konflikt",
      subtitle: "ÄŒo robiÅ¥ pri ostreÄ¾ovanÃ­, dronoch a bombardovanÃ­",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { header: "KeÄ zaznie vzduÅ¡nÃ½ poplach (sirÃ©na)" },
        { text: "<strong>OkamÅ¾ite vyhÄ¾adajte Ãºkryt</strong> â€“ pivnica, suterÃ©n, metro, podzemnÃ½ parking alebo vnÃºtornÃ¡ miestnosÅ¥ bez okien." },
        { text: "<strong>DrÅ¾te sa Äalej od okien, sklenenÃ½ch plÃ´ch a vonkajÅ¡Ã­ch stien.</strong>" },
        { text: "<strong>Sadnite si alebo Ä¾ahnite na zem</strong> â€“ ÄÃ­m niÅ¾Å¡ie, tÃ½m lepÅ¡ie." },
        { text: "<strong>ChrÃ¡Åˆte si hlavu a krk</strong> rukami alebo vankÃºÅ¡om." },
        { text: "<strong>ZostaÅˆte v Ãºkryte</strong> kÃ½m nezaznie signÃ¡l koniec ohrozenia alebo kÃ½m nedostanete oficiÃ¡lnu informÃ¡ciu." },
        { warn: "Nikdy nevychÃ¡dzajte von bezprostredne po vÃ½buchu â€“ mÃ´Å¾u nasledovaÅ¥ ÄalÅ¡ie Ãºtoky (tzv. double tap)." },
        { header: "ğŸ¢ Byt (bytovÃ½ dom)", forHousing: ["flat"] },
        { text: "<strong>IdeÃ¡lny Ãºkryt je pivnica alebo suterÃ©n</strong> bytovÃ©ho domu. Dohodnite sa s ostatnÃ½mi obyvateÄ¾mi vopred.", forHousing: ["flat"] },
        { text: "<strong>Ak nemÃ¡te prÃ­stup do pivnice,</strong> choÄte do vnÃºtornej chodby alebo kÃºpeÄ¾ne â€“ miestnostÃ­ bez okien, obklopenÃ½ch nosnÃ½mi stenami.", forHousing: ["flat"] },
        { text: "<strong>NepouÅ¾Ã­vajte vÃ½Å¥ah</strong> â€“ pri vÃ½buchu sa mÃ´Å¾e zaseknÃºÅ¥ a zostanete uvÃ¤znenÃ­.", forHousing: ["flat"] },
        { text: "<strong>Prelepte oknÃ¡ krÃ­Å¾om lepenkou</strong> â€“ zmenÅ¡Ã­te riziko poranenia odletujÃºcim sklom.", forHousing: ["flat"] },
        { header: "ğŸ  Dom", forHousing: ["rd"] },
        { text: "<strong>Ak nemÃ¡te pivnicu,</strong> Ãºkryt vytvorte v najniÅ¾Å¡om podlaÅ¾Ã­ â€“ vnÃºtornÃ¡ miestnosÅ¥ bez okien (kÃºpeÄ¾Åˆa, komora, priestor pod schodiskom).", forHousing: ["rd"] },
        { text: "<strong>Zosilnite steny vrstvou vriec s pieskom</strong> alebo nÃ¡bytkom naplnenÃ½m knihami.", forHousing: ["rd"] },
        { text: "<strong>Prelepte oknÃ¡ krÃ­Å¾om lepenkou</strong> a zakryte ich zÃ¡vesmi alebo matracmi.", forHousing: ["rd"] },
        { header: "ğŸ  Dom s pivnicou", forHousing: ["rd_cellar"] },
        { text: "<strong>Pivnica je najlepÅ¡Ã­ Ãºkryt v dome.</strong> Pripravte ju vopred â€“ vyÄistite, doplÅˆte zÃ¡soby vody, jedla, baterku a rÃ¡dio.", forHousing: ["rd_cellar"] },
        { text: "<strong>Zosilnite strop pivnice</strong> ak je to moÅ¾nÃ© â€“ drevenÃ© trÃ¡my, dosky, podpery.", forHousing: ["rd_cellar"] },
        { text: "<strong>Majte viacero vÃ½chodov</strong> z pivnice ak je to moÅ¾nÃ© â€“ ÃºnikovÃ½ otvor alebo okno.", forHousing: ["rd_cellar"] },
        { text: "<strong>Prelepte oknÃ¡ v hornÃ½ch podlaÅ¾iach</strong> krÃ­Å¾om lepenkou.", forHousing: ["rd_cellar"] },
        { header: "Drony" },
        { text: "<strong>Ak poÄujete charakteristickÃ½ bzukot dronu,</strong> okamÅ¾ite sa ukryte pod betÃ³novÃº konÅ¡trukciu alebo do budovy." },
        { text: "<strong>Nepozerajte sa hore a nefotografujte</strong> â€“ svetlo displeja vÃ¡s identifikuje." },
        { text: "<strong>Ä½ahnite si na zem tvÃ¡rou nadol</strong> a zakryte si hlavu, ak ste vonku bez Ãºkrytu." },
        { text: "<strong>Ak ste v aute,</strong> zastavte, vystÃºpte a rÃ½chlo sa ukryte v najbliÅ¾Å¡ej budove alebo priekope." },
        { header: "Po vÃ½buchu / ostreÄ¾ovanÃ­" },
        { text: "<strong>Skontrolujte seba a blÃ­zkych</strong> â€“ oÅ¡etrite zranenia, zastavte krvÃ¡canie." },
        { text: "<strong>Ak sa budova poÅ¡kodila,</strong> opatrne ju opustite â€“ pozor na uvoÄ¾nenÃ© konÅ¡trukcie a Ãºlomky." },
        { text: "<strong>NedotÃ½kajte sa neznÃ¡mych predmetov</strong> â€“ mÃ´Å¾e Ã­sÅ¥ o nevybuchnutÃº munÃ­ciu." },
        { text: "<strong>Zavolajte 112</strong> a informujte zÃ¡chranÃ¡rov o situÃ¡cii." },
        { header: "PrÃ­prava vopred" },
        { text: "<strong>Identifikujte najbliÅ¾Å¡ie Ãºkryty</strong> â€“ pivnice, podzemnÃ© garÃ¡Å¾e, metro, krytovÃ© priestory." },
        { text: "<strong>Majte pripravenÃº evakuaÄnÃ½ batoh</strong> pri dverÃ¡ch â€“ doklady, voda, lieky, baterka, power banka." },
        { text: "<strong>Dohodnite sa s rodinou na plÃ¡ne stretnutia</strong> â€“ kde sa stretnete ak vypadne signÃ¡l." },
        { text: "<strong>NauÄte sa zÃ¡klady prvej pomoci</strong> â€“ zastavenie krvÃ¡cania, oÅ¡etrenie popÃ¡lenÃ­n, stabilizovanÃ¡ poloha." },
        { text: "<strong>Sledujte oficiÃ¡lne kanÃ¡ly</strong> â€“ civilnÃ¡ ochrana, armÃ¡da, overenÃ© spravodajskÃ© zdroje." }
      ],
      warning: "Tieto odporÃºÄania vychÃ¡dzajÃº zo skÃºsenostÃ­ ukrajinskÃ©ho obyvateÄ¾stva. VÅ¾dy sa riaÄte pokynmi miestnych autorÃ­t a zÃ¡chrannÃ½ch zloÅ¾iek. NevychÃ¡dzajte von poÄas vzduÅ¡nÃ©ho poplachu.",
      source: "OdporÃºÄania DSNS (UkrajinskÃ¡ zÃ¡chrannÃ¡ sluÅ¾ba) + PrÃ­ruÄka MV SR + ICRC"
    },
    {
      id: "survival_72h",
      emoji: "â±ï¸",
      title: "72 hodÃ­n bez sluÅ¾ieb",
      subtitle: "Ako zvlÃ¡dnuÅ¥ 3 dni bez zÃ¡kladnÃ½ch sluÅ¾ieb",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { header: "ÄŒo sa mÃ´Å¾e zmeniÅ¥ v krÃ­ze?" },
        { text: "<strong>Z kohÃºtika nepoteÄie voda.</strong> NepÃ´jde elektrina." },
        { text: "<strong>Prestane fungovaÅ¥ telefÃ³n,</strong> televÃ­zia a internet." },
        { text: "<strong>Nikde si nevyzdvihneme lieky.</strong> Nebudeme mÃ´cÅ¥ beÅ¾ne variÅ¥ a ohrievaÅ¥ jedlo." },
        { text: "<strong>Prestane fungovaÅ¥ kÃºrenie.</strong> Obchody budÃº zavretÃ© alebo v nich niÄ nekÃºpime." },
        { text: "<strong>NezaplatÃ­me platobnou kartou.</strong> Na ÄerpacÃ­ch staniciach nenatankujeme." },
        { text: "<strong>Toaletu budeme mÃ´cÅ¥ splÃ¡chnuÅ¥ moÅ¾no iba raz.</strong> Prestane jazdiÅ¥ hromadnÃ¡ doprava." },
        { note: "Pravidlo 72 hodÃ­n hovorÃ­, Å¾e kaÅ¾dÃ½ zvlÃ¡dne prvÃ© tri dni bez pomoci zÃ¡chrannÃ½ch zloÅ¾iek â€“ iba s tÃ½m, Äo mÃ¡ doma. Ak sa vÄas pripravÃ­me, pomÃ´Å¾eme tÃ½m aj ostatnÃ½m." },
        { header: "DobrÃ¡ prÃ­prava mÃ´Å¾e zachrÃ¡niÅ¥ Å¾ivot" },
        { text: "<strong>KeÄ sa pripravÃ­me vopred,</strong> nebudeme v strese a lepÅ¡ie ochrÃ¡nime svoje zdravie aj majetok." },
        { text: "<strong>Budeme kÄ¾udnejÅ¡Ã­ a istejÅ¡Ã­.</strong> Budeme vedieÅ¥ Äo robiÅ¥ a dokÃ¡Å¾eme pomÃ´cÅ¥ aj svojÃ­m blÃ­zkym a susedom." },
        { header: "Voda" },
        { text: "<strong>Na pitie pouÅ¾Ã­vajte iba balenÃº vodu</strong> alebo vodu z pristavenÃ½ch cisterien." },
        { warn: "Pozor â€“ v budovÃ¡ch s diaÄ¾kovÃ½m vykurovanÃ­m mÃ´Å¾e byÅ¥ teplÃ¡ voda poÄas vÃ½padku prÃºdu nebezpeÄne horÃºca aÅ¾ vrÃºca." }
      ],
      warning: "NajnÃ¡roÄnejÅ¡ie bÃ½vajÃº prvÃ© tri dni (72 hodÃ­n). PrÃ­prava zaberie len pÃ¡r hodÃ­n, ale mÃ´Å¾e uÅ¡etriÅ¥ veÄ¾a starostÃ­. PrÃ­ruÄku si preÄÃ­tajte, pripravte si veci a uschovajte ju na dostupnÃ© miesto.",
      source: "PrÃ­ruÄka 72h.gov.cz"
    },
    {
      id: "shelter",
      emoji: "ğŸ›–",
      title: "Ukrytie",
      subtitle: "Kedy a ako sa ukryÅ¥ na bezpeÄnom mieste",
      iconBg: "#f0fdf4",
      iconBorder: "#86efac",
      steps: [
        { text: "<strong>KeÄ zaznie varovnÃ½ signÃ¡l vÅ¡eobecnÃ¡ vÃ½straha</strong> (kolÃ­savÃ½ tÃ³n po dobu 140 sekÃºnd), je najdÃ´leÅ¾itejÅ¡ie okamÅ¾ite vyhÄ¾adaÅ¥ bezpeÄnÃ© miesto v najbliÅ¾Å¡ej pevnej budove." },
        { header: "Kedy sa musÃ­me ukryÅ¥?" },
        { text: "<strong>SilnÃ¡ bÃºrka alebo tornÃ¡do</strong>" },
        { text: "<strong>VysokÃ¡ koncentrÃ¡cia jedovatÃ©ho dymu</strong> spÃ´sobenÃ¡ poÅ¾iarom" },
        { text: "<strong>Ãšnik nebezpeÄnÃ½ch lÃ¡tok</strong> do okolia" },
        { text: "<strong>Riziko Ãºniku radiÃ¡cie</strong>" },
        { note: "BezpeÄnÃ½m miestom mÃ´Å¾e byÅ¥ domov, Å¡kola, pracovisko alebo inÃ¡ verejnÃ¡ budova (obchodnÃ© centrum, ÃºradnÃ¡ budova). AutobusovÃ¡ zastÃ¡vka alebo auto bezpeÄnÃ½m Ãºkrytom nie sÃº." },
        { header: "ÄŒo robiÅ¥ po varovnom signÃ¡li?" },
        { text: "<strong>RÃ½chle sa ukryte v najbliÅ¾Å¡ej budove.</strong>" },
        { text: "<strong>DÃ´kladne uzavrite dvere a oknÃ¡.</strong> Utesnite otvory, vypnite ventilÃ¡ciu a klimatizÃ¡ciu." },
        { text: "<strong>Zaistite si prÃ­stup k informÃ¡ciÃ¡m.</strong> Pri vÃ½padku prÃºdu pomÃ´Å¾e rÃ¡dio na batÃ©rie." },
        { text: "<strong>ZbytoÄne netelefonujte,</strong> aby ste nepreÅ¥aÅ¾ovali mobilnÃ© siete." },
        { text: "<strong>ZostaÅˆte v bezpeÄnom Ãºkryte</strong> a Äakajte na ÄalÅ¡ie pokyny zÃ¡chrannÃ½ch zloÅ¾iek alebo zodpovednÃ½ch Ãºradov." },
        { warn: "NiektorÃ© nebezpeÄnÃ© lÃ¡tky nie sÃº vidieÅ¥ ani cÃ­tiÅ¥. V kaÅ¾dom prÃ­pade preto berieme varovanie Ãºradov vÃ¡Å¾ne." }
      ],
      warning: "Nic veÄ¾a robiÅ¥ nemusÃ­te. StaÄÃ­ sa ukryÅ¥, utesniÅ¥ miestnosÅ¥ a ÄakaÅ¥ na pokyny. PamÃ¤tajte na vÅ¡eobecnÃ½ signÃ¡l â€“ kolÃ­savÃ½ tÃ³n 140 sekÃºnd.",
      source: "PrÃ­ruÄka 72h.gov.cz"
    },
    {
      id: "help_neighbors",
      emoji: "ğŸ¤",
      title: "Pomoc susedom",
      subtitle: "VzÃ¡jomnÃ¡ pomoc v okolÃ­ poÄas krÃ­zy",
      iconBg: "#f0fdf4",
      iconBorder: "#86efac",
      steps: [
        { text: "<strong>Å½ije vo vaÅ¡om okolÃ­ niekto, kto by mohol potrebovaÅ¥ pomoc?</strong> ÄŒlovek vo vyÅ¡Å¡om veku, s malÃ½mi deÅ¥mi, s handicapom, nemocnÃ½ alebo cudzinec, ktorÃ½ nerozumie dobre slovensky." },
        { note: "V krÃ­zovÃ½ch situÃ¡ciÃ¡ch je vzÃ¡jomnÃ¡ pomoc kÄ¾ÃºÄovÃ¡ a mÃ´Å¾e zachrÃ¡niÅ¥ Å¾ivot. SpoloÄne sme silnejÅ¡Ã­ a dokÃ¡Å¾eme prekonaÅ¥ aj tie najÅ¥aÅ¾Å¡ie vÃ½zvy." },
        { header: "Ä½udia v naÅ¡om okolÃ­" },
        { text: "<strong>MÃ´Å¾u potrebovaÅ¥ lekÃ¡rsku pomoc.</strong>" },
        { text: "<strong>MÃ´Å¾e im dochÃ¡dzaÅ¥ jedlo alebo lieky.</strong>" },
        { text: "<strong>MÃ´Å¾u maÅ¥ problÃ©m dostaÅ¥ sa</strong> na miesto, kde sa rozdÃ¡va voda." },
        { text: "<strong>MoÅ¾no nevedia,</strong> preÄo nefunguje elektrina a neteÄie voda." },
        { header: "ÄŒo mÃ´Å¾eme pre susedov urobiÅ¥?" },
        { text: "<strong>V naliehavÃ½ch prÃ­padoch zavolÃ¡me pomoc.</strong>" },
        { text: "<strong>RozdelÃ­me sa s nimi o zÃ¡soby.</strong>" },
        { text: "<strong>PomÃ´Å¾eme im s nÃ¡kupom alebo s presunom.</strong>" },
        { text: "<strong>PonÃºkneme, Å¾e im budeme odovzdÃ¡vaÅ¥ dÃ´leÅ¾itÃ© informÃ¡cie.</strong>" }
      ],
      warning: "SpoloÄenstvo a susedskÃ¡ pomoc sÃº v krÃ­zovÃ½ch situÃ¡ciÃ¡ch neoceniteÄ¾nÃ©. Ak dokÃ¡Å¾ete pomÃ´cÅ¥, pomÃ´Å¾te.",
      source: "PrÃ­ruÄka 72h.gov.cz"
    },
    {
      id: "children_crisis",
      emoji: "ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦",
      title: "KomunikÃ¡cia s deÅ¥mi",
      subtitle: "Ako hovoriÅ¥ s deÅ¥mi o krÃ­ze",
      iconBg: "#fdf2f8",
      iconBorder: "#fbcfe8",
      steps: [
        { text: "<strong>V krÃ­zovÃ½ch situÃ¡ciÃ¡ch sa deÅ¥om venujte eÅ¡te viac neÅ¾ inokedy.</strong> Deti potrebujÃº chÃ¡paÅ¥, Äo sa deje, cÃ­tiÅ¥ naÅ¡u podporu a vedieÅ¥, Äo ich ÄakÃ¡. VÄaka tomu sa s danou situÃ¡ciou lepÅ¡ie vyrovnajÃº." },
        { header: "Ako s deÅ¥mi komunikovaÅ¥?" },
        { text: "<strong>Hovorte s nimi otvorene a Ãºprimne,</strong> primerane veku." },
        { text: "<strong>Dajte im priestor,</strong> aby povedali, z Äoho majÃº obavy." },
        { text: "<strong>RozprÃ¡vajte sa o svojich pocitoch.</strong>" },
        { text: "<strong>NaslÃºchajte ich otÃ¡zkam a nÃ¡zorom.</strong>" },
        { text: "<strong>SnaÅ¾te sa zostaÅ¥ v kÄ¾ude.</strong> Deti totiÅ¾ zrkadlia naÅ¡e emÃ³cie." },
        { text: "<strong>Zapojujeme ich primerane veku</strong> do beÅ¾nÃ½ch a postupne aj novÃ½ch ÄinnostÃ­." },
        { header: "PraktickÃ© tipy" },
        { text: "<strong>HovorÃ­me o situÃ¡cii jednoducho a zrozumiteÄ¾ne.</strong>" },
        { text: "<strong>ZdÃ´raznÃ­me, Å¾e situÃ¡ciu rieÅ¡ia odbornÃ­ci</strong> a Å¾e robia vÅ¡etko pre to, aby nÃ¡s ochrÃ¡nili." },
        { text: "<strong>Ujistime ich, Å¾e budeme stÃ¡le s nimi.</strong>" },
        { text: "<strong>Povedieme im, Å¾e to spolu zvlÃ¡dneme</strong> a Å¾e existujÃº Ä¾udia, ktorÃ­ nÃ¡m pomÃ´Å¾u." },
        { text: "<strong>Ak je to moÅ¾nÃ©, udrÅ¾ujeme obvyklÃ½ reÅ¾im.</strong>" },
        { note: "<strong>EvakuÃ¡cia:</strong> V prÃ­pade evakuÃ¡cie nezabudnite pripraviÅ¥ dieÅ¥aÅ¥u cedulku s adresou a kontaktom na blÃ­zku osobu. A do evakuaÄnÃ©ho batohu pribaÄ¾te malÃº hraÄku." }
      ],
      warning: "",
      source: "PrÃ­ruÄka 72h.gov.cz"
    },
    {
      id: "mental_health",
      emoji: "ğŸ§ ",
      title: "PsychickÃ¡ podpora",
      subtitle: "Podpora v Å¥aÅ¾kÃ½ch chvÃ­Ä¾ach pre dospelÃ½ch",
      iconBg: "#ede9fe",
      iconBorder: "#c4b5fd",
      steps: [
        { text: "<strong>V krÃ­zovÃ½ch situÃ¡ciÃ¡ch je dÃ´leÅ¾itÃ© myslieÅ¥</strong> aj na psychickÃº pohodu. KaÅ¾dÃ½ Älovek mÃ´Å¾e preÅ¾Ã­vaÅ¥ a potrebovaÅ¥ nieÄo inÃ©ho." },
        { header: "Ako druhÃ½ch psychicky podporovaÅ¥?" },
        { text: "<strong>HovorÃ­me s nimi otvorene a s reÅ¡pektom.</strong>" },
        { text: "<strong>DÃ¡me im priestor,</strong> aby vyjadrili svoje obavy a emÃ³cie." },
        { text: "<strong>NaslÃºchame a nesÃºdime.</strong>" },
        { text: "<strong>SnaÅ¾Ã­me sa udrÅ¾iavaÅ¥ beÅ¾nÃ½ dennÃ½ reÅ¾im.</strong>" },
        { text: "<strong>UmoÅ¾nÃ­me im, aby sa zapojili</strong> do rieÅ¡enia situÃ¡cie spÃ´sobom, ktorÃ½ zvlÃ¡dnu." },
        { header: "Kde hÄ¾adaÅ¥ pomoc?" },
        { text: "<strong>Linka dÃ´very (Slovensko):</strong> 0800 500 333 â€“ bezplatnÃ¡, nonstop" },
        { text: "<strong>Linka pomoci:</strong> 116 123 (SK) â€“ pre emocionÃ¡lnu podporu" },
        { note: "StarÃ¡te sa o niekoho, kto mÃ¡ Å¡pecifickÃ© potreby (starÅ¡Ã­ Älovek, osoba so zdravotnÃ½m znevÃ½hodnenÃ­m alebo s duÅ¡evnÃ½m ochorenÃ­m)? Na webe <strong>72h.gov.cz</strong> nÃ¡jdete podrobnejÅ¡ie informÃ¡cie o tom, akÃ¡ pomoc je k dispozÃ­cii." }
      ],
      warning: "",
      source: "PrÃ­ruÄka 72h.gov.cz + Linka dÃ´very SR"
    },
    {
      id: "info_hygiene",
      emoji: "ğŸ“°",
      title: "Overovanie informÃ¡ciÃ­",
      subtitle: "Ako zachÃ¡dzaÅ¥ s informÃ¡ciami v krÃ­ze",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>KeÄ nastane krÃ­zovÃ¡ situÃ¡cia,</strong> Äasto sa zaÄnÃº rÃ½chlo Å¡Ã­riÅ¥ nepodloÅ¾enÃ© informÃ¡cie a fÃ¡my. TakÃ©to sprÃ¡vy mÃ´Å¾u zvyÅ¡ovaÅ¥ neistotu a strach a komplikovaÅ¥ prÃ¡cu zÃ¡chrannÃ½ch zloÅ¾iek." },
        { header: "Ako zachÃ¡dzaÅ¥ s informÃ¡ciami?" },
        { text: "<strong>Overujeme informÃ¡cie z niekoÄ¾kÃ½ch dÃ´veryhodnÃ½ch zdrojov.</strong>" },
        { text: "<strong>Spoliehame sa predovÅ¡etkÃ½m na oficiÃ¡lne zdroje</strong> â€“ SlovenskÃ½ rozhlas, STV, RTVS, CivilnÃ¡ ochrana SR." },
        { text: "<strong>ZdieÄ¾ame iba overenÃ© informÃ¡cie,</strong> o ktorÃ½ch sme si istÃ­, Å¾e sÃº pravdivÃ©." },
        { note: "V krÃ­ze platÃ­: najprv overiÅ¥, potom zdieÄ¾aÅ¥. NepravdivÃ© sprÃ¡vy mÃ´Å¾u spÃ´sobiÅ¥ paniku a ohroziÅ¥ Å¾ivoty." }
      ],
      warning: "",
      source: "PrÃ­ruÄka 72h.gov.cz"
    }
  ];

  function renderEmergencyProc() {
    const grid = document.getElementById("emergencyProcGrid");
    if (!grid) return;
    grid.innerHTML = "";

    // Group definitions from UX audit
    const groups = [
      { label: "PrÃ­rodnÃ© hrozby", ids: ["flood", "earthquake", "storm", "landslide", "heat", "snow"] },
      { label: "HavÃ¡rie a ohrozenia", ids: ["fire", "blackout", "chemical", "radiation", "terror", "armed_conflict"] },
      { label: "PripravenosÅ¥ a podpora", ids: ["survival_72h", "shelter", "evacuation", "help_neighbors", "children_crisis", "mental_health", "info_hygiene"] }
    ];

    groups.forEach(group => {
      // Add group heading
      const heading = document.createElement("div");
      heading.className = "proc-group-heading";
      heading.textContent = group.label;
      grid.appendChild(heading);

      // Add cards for this group
      group.ids.forEach(id => {
        const item = EMERGENCY_PROC_DATA.find(d => d.id === id);
        if (!item) return;
        const card = document.createElement("div");
        card.className = "mu-card";
        card.setAttribute("role", "button");
        card.setAttribute("tabindex", "0");
        card.setAttribute("aria-label", item.title + " â€“ zobraziÅ¥ postup");
        card.innerHTML = `
          <div class="mu-icon" style="background:${item.iconBg}; border:1.5px solid ${item.iconBorder};">
            ${item.emoji}
          </div>
          <div class="mu-card-label">${item.title}</div>`;
        card.onclick = () => openEmergencyProcModal(item);
        card.onkeydown = (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); openEmergencyProcModal(item); }};
        grid.appendChild(card);
      });
    });
  }

  function openEmergencyProcModal(item) {
    const icon = document.getElementById("muModalIcon");
    const title = document.getElementById("muModalTitle");
    const subtitle = document.getElementById("muModalSubtitle");
    const content = document.getElementById("muModalContent");

    icon.style.background = item.iconBg;
    icon.style.border = `1.5px solid ${item.iconBorder}`;
    icon.textContent = item.emoji;
    title.textContent = item.title;
    subtitle.textContent = item.subtitle;

    let html = `<div class="fa-emergency-bar">ğŸ“ TiesÅˆovÃ© ÄÃ­slo: <a href="tel:112">112</a> &nbsp;|&nbsp; HasiÄi: <a href="tel:150">150</a> &nbsp;|&nbsp; PolÃ­cia: <a href="tel:158">158</a></div>`;

    // Render steps with support for headers, notes, and housing-specific content
    html += `<div style="margin-bottom:0.5rem;">`;
    let stepNum = 0;
    const housing = (state.profile && state.profile.housing) || "flat";

    item.steps.forEach(step => {
      // Housing-specific content filter â€“ applies to ALL step types
      if (step.forHousing) {
        if (!step.forHousing.includes(housing)) return;
      }
      // Section header
      if (step.header) {
        html += `<div style="font-size:0.82rem; font-weight:700; color:var(--c-text); margin:1rem 0 0.5rem; padding-bottom:0.375rem; border-bottom:1.5px solid var(--c-border);">${step.header}</div>`;
        stepNum = 0;
        return;
      }
      // Info/note box
      if (step.note) {
        html += `<div style="background:#fef3c7; border:1px solid #fcd34d; border-radius:0.75rem; padding:0.75rem; margin:0.5rem 0; font-size:0.78rem; line-height:1.6; color:#92400e;"><strong>ğŸ’¡</strong> ${step.note}</div>`;
        return;
      }
      // Warning box
      if (step.warn) {
        html += `<div style="background:#fef2f2; border:1px solid #fecaca; border-radius:0.75rem; padding:0.75rem; margin:0.5rem 0; font-size:0.78rem; line-height:1.6; color:#991b1b;"><strong>âš ï¸</strong> ${step.warn}</div>`;
        return;
      }
      stepNum++;
      html += `<div class="fa-modal-step">
        <div class="fa-step-num">${stepNum}</div>
        <div class="fa-step-text">${step.text}</div>
      </div>`;
    });
    html += `</div>`;

    if (item.warning) {
      html += `<div class="fa-warning"><strong>âš ï¸ DÃ´leÅ¾itÃ©:</strong> ${item.warning}</div>`;
    }

    html += `<div class="fa-source"><strong>Zdroj:</strong> ${item.source}</div>`;

    content.innerHTML = html;
    openModal("modalEmergencyProc");
  }

  function renderAll() {
    renderProfileCard();
    renderOverall();
    renderCategories();
    renderFirstAid();
    renderEmergencyContacts();
    renderPersonalContacts();
    renderSirens();
    renderRadio();
    renderEmergencyProc();
    renderEvacBags();
    // Aktualizuj detail kategÃ³rie len ak je modal otvorenÃ½
    if (document.getElementById("modalCategory").classList.contains("open")) {
      renderCategoryDetail();
    }
    renderPlans();
    renderAlerts();
    // Check for 100% completion â†’ Slovak confetti
    if (state.profile && overallScore() >= 99.5) {
      setTimeout(triggerSlovakConfetti, 500);
    }
  }

  // â”€â”€ Forms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openProfileEditor() {
    const f = document.getElementById("profileForm");
    if (state.profile) {
      const p = state.profile;
      ["adults","kids","infants","seniors","prepDays"].forEach(k => {
        if (f.elements[k]) f.elements[k].value = p[k] ?? (k === "prepDays" ? 3 : 0);
      });
      ["readiness","budget","housing"].forEach(k => {
        const val = p[k];
        if (val) {
          const radio = f.querySelector(`input[name="${k}"][value="${val}"]`);
          if (radio) radio.checked = true;
        }
      });
    } else {
      const defReadiness = f.querySelector('input[name="readiness"][value="standard"]');
      if (defReadiness) defReadiness.checked = true;
      const defBudget = f.querySelector('input[name="budget"][value="mid"]');
      if (defBudget) defBudget.checked = true;
      const defHousing = f.querySelector('input[name="housing"][value="flat"]');
      if (defHousing) defHousing.checked = true;
    }
    openModal("modalProfile");
  }
  window.openProfileEditor = openProfileEditor;

  document.getElementById("profileForm").onsubmit = (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);

    // Koeficient pre zvÃ½Å¡enÃº pripravenosÅ¥
    const readiness = String(fd.get("readiness") || "standard");
    const readinessCoeff = readiness === "enhanced" ? 1.3 : 1.0;

    state.profile = {
      adults:   +fd.get("adults")   || 0,
      kids:     +fd.get("kids")     || 0,
      infants:  +fd.get("infants")  || 0,
      seniors:  +fd.get("seniors")  || 0,
      prepDays: +fd.get("prepDays") || 3,
      housing:  String(fd.get("housing")  || "flat"),
      readiness,
      readinessCoeff,
      budget:   String(fd.get("budget")   || "mid"),
    };
    closeModal("modalProfile");
    regenerateProfileBasedItems();
    scheduleSave(); renderAll();
    // Onboarding: scroll to categories after first profile save
    setTimeout(() => {
      const catSection = document.getElementById("categoriesSection");
      if (catSection) catSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 300);
  };

  // â”€â”€ Unified Item Modal (Add / Edit) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let pendingDeleteCatId = "";
  let pendingDeleteIdx = -1;

  function openItemModal(catId, itemIdx) {
    const f = document.getElementById("addItemForm");
    const isEdit = itemIdx >= 0 && state.items[catId] && itemIdx < state.items[catId].length;
    const item = isEdit ? state.items[catId][itemIdx] : {};
    const isDocs = (catId === "docs");
    const hasExpiry = (catId === "food_water" || catId === "medkit");
    const hasLink = (catId === "food_water" || catId === "medkit" || catId === "hygiene" || catId === "gear");
    const isCashOnly = (catId === "cash");

    // Title
    const catLabels = { docs: "doklad", cash: "poloÅ¾ku", medkit: "poloÅ¾ku", food_water: "poloÅ¾ku", hygiene: "poloÅ¾ku", gear: "poloÅ¾ku" };
    if (isDocs) {
      document.getElementById("itemModalTitle").textContent = isEdit ? "âœï¸ UpraviÅ¥ doklad" : "â• PridaÅ¥ doklad";
    } else {
      document.getElementById("itemModalTitle").textContent = isEdit ? "âœï¸ UpraviÅ¥ poloÅ¾ku" : "â• PridaÅ¥ poloÅ¾ku";
    }
    document.getElementById("btnItemSubmit").textContent = isEdit ? "UloÅ¾iÅ¥" : "PridaÅ¥";

    // Name label
    document.getElementById("itemLabelName").textContent = isDocs ? "NÃ¡zov dokladu *" : "NÃ¡zov *";

    // Field visibility per category:
    // docs: Name + Typ uloÅ¾enia only
    // cash: Name + MnoÅ¾stvo only
    // food_water, medkit: Name + MnoÅ¾stvo + ExpirÃ¡cia + Odkaz
    // hygiene, gear: Name + MnoÅ¾stvo + Odkaz (no expiry)
    const qtyRow = document.getElementById("itemFieldQtyRow");
    const expiryField = document.getElementById("itemFieldExpiry");
    const docsField = document.getElementById("itemFieldDocs");
    const linkField = document.getElementById("itemFieldLink");

    if (isDocs) {
      qtyRow.style.display = "none";
      docsField.style.display = "block";
      linkField.style.display = "none";
    } else {
      qtyRow.style.display = hasExpiry ? "grid" : "block";
      qtyRow.style.gridTemplateColumns = hasExpiry ? "1fr 1fr" : "1fr";
      expiryField.style.display = hasExpiry ? "block" : "none";
      docsField.style.display = "none";
      linkField.style.display = (hasLink && !isCashOnly) ? "block" : "none";
    }

    f.elements["editIndex"].value = itemIdx;
    f.elements["name"].value = item.name || "";

    if (isDocs) {
      f.elements["qty_docs"].value = item.qty || "";
      f.elements["qty"].value = "";
      f.elements["expiry"].value = "";
      f.elements["link"].value = "";
    } else {
      f.elements["qty"].value = item.qty || "";
      f.elements["qty_docs"].value = "";
      f.elements["expiry"].value = hasExpiry ? (item.expiry || "") : "";
      f.elements["link"].value = hasLink ? (item.link || "") : "";
    }

    openModal("modalAddItem");
  }

  function openDeleteConfirmation(catId, itemIdx) {
    const cat = CATEGORIES.find(c => c.id === catId);
    const item = state.items[catId] && state.items[catId][itemIdx];
    if (!item || !cat) return;
    pendingDeleteCatId = catId;
    pendingDeleteIdx = itemIdx;
    document.getElementById("deleteItemTitle").textContent = "OdstrÃ¡niÅ¥ poloÅ¾ku?";
    document.getElementById("deleteItemText").innerHTML =
      `Naozaj si Å¾elÃ¡te odstrÃ¡niÅ¥ poloÅ¾ku <strong>${esc(item.name)}</strong> zo zoznamu <strong>${cat.emoji} ${cat.name}</strong>?`;
    openModal("modalDeleteItem");
  }

  document.getElementById("btnConfirmDelete").onclick = () => {
    if (pendingDeleteCatId && pendingDeleteIdx >= 0 && state.items[pendingDeleteCatId]) {
      state.items[pendingDeleteCatId].splice(pendingDeleteIdx, 1);
      closeModal("modalDeleteItem");
      scheduleSave(); renderAll();
    }
  };

  document.getElementById("btnAddItem").onclick = () => {
    openItemModal(state.selectedCategoryId, -1);
  };

  document.getElementById("addItemForm").onsubmit = (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const name = String(fd.get("name")||"").trim();
    if (!name) return;
    const cid = state.selectedCategoryId;
    const idx = parseInt(fd.get("editIndex"));
    const isDocs = (cid === "docs");
    const hasExpiry = (cid === "food_water" || cid === "medkit");
    const hasLink = (cid === "food_water" || cid === "medkit" || cid === "hygiene" || cid === "gear");

    const itemData = {
      name,
      qty: isDocs ? String(fd.get("qty_docs")||"").trim() : String(fd.get("qty")||"").trim(),
      expiry: hasExpiry ? String(fd.get("expiry")||"").trim() : "",
      link: hasLink ? String(fd.get("link")||"").trim() : "",
    };

    state.items[cid] = state.items[cid] || [];
    if (idx >= 0 && idx < state.items[cid].length) {
      Object.assign(state.items[cid][idx], itemData);
    } else {
      const newItem = { ...itemData, done: false };
      if (isDocs) newItem.docGroup = "InÃ©";
      state.items[cid].push(newItem);
    }
    closeModal("modalAddItem");
    e.target.reset();
    scheduleSave(); renderAll();
  };

  document.getElementById("alertDaysMeds").onchange = (e) => {
    state.alertDaysMeds = +e.target.value;
    scheduleSave(); renderAlerts(); renderAll();
  };
  document.getElementById("alertDaysFood").onchange = (e) => {
    state.alertDaysFood = +e.target.value;
    scheduleSave(); renderAlerts(); renderAll();
  };

  // Click outside modal to close
  document.querySelectorAll(".modal-overlay").forEach(overlay => {
    overlay.onclick = (e) => { if (e.target === overlay) closeModal(overlay.id); };
  });


  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EMAIL NOTIFIKÃCIE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // PrahovÃ© hodnoty v dÅˆoch
  // ExpirÃ¡cia: riadi sa nastaveniami v appke (alertDaysMeds / alertDaysFood)
  const NOTIFY_SHOPPING_DAYS = 14; // nÃ¡kupnÃ½ zoznam ak expiruje do 14 dnÃ­
  const NOTIFY_COOLDOWN_H    = 24; // min. hodÃ­n medzi emailami rovnakÃ©ho typu

  // ZistÃ­ Äo expiruje â€“ vrÃ¡ti pole { name, catName, expiry, days }
  // Ak thresholdDays nie je zadanÃ½, pouÅ¾ije per-kategÃ³riu nastavenia
  function getExpiringItems(thresholdDays) {
    const items = [];
    for (const c of CATEGORIES) {
      const catThreshold = thresholdDays !== undefined ? thresholdDays : getAlertDaysForCategory(c.id);
      (state.items[c.id] || []).forEach(it => {
        if (!it.expiry || !it.done) return; // len poloÅ¾ky ktorÃ© sÃº v zÃ¡sobÃ¡ch (done=true)
        const d = daysUntil(it.expiry);
        if (d <= catThreshold) {
          items.push({
            name:    it.name,
            catName: c.name,
            expiry:  it.expiry,
            days:    d,
            qty:     it.qty || ""
          });
        }
      });
    }
    return items.sort((a, b) => a.days - b.days);
  }

  // Skontroluje Äi sa mÃ¡ poslaÅ¥ email (cooldown 24h)
  async function canSendEmail(type) {
    if (isDemo) return false; // Demo: Å¾iadne emaily
    if (!currentUser) return false;
    if (EMAILJS_CONFIG.publicKey === "YOUR_EMAILJS_PUBLIC_KEY") return false; // nekonfigurovanÃ©
    try {
      const snap = await getDoc(doc(db, "users", currentUser.uid, "notifications", type));
      if (!snap.exists()) return true;
      const lastSent = snap.data().sentAt?.toMillis?.() || 0;
      const hoursSince = (Date.now() - lastSent) / 3600000;
      return hoursSince >= NOTIFY_COOLDOWN_H;
    } catch { return false; }
  }

  // ZapÃ­Å¡e timestamp poslednÃ©ho odoslania
  async function markEmailSent(type) {
    if (isDemo || !currentUser) return;
    try {
      await setDoc(
        doc(db, "users", currentUser.uid, "notifications", type),
        { sentAt: new Date() }
      );
    } catch(e) { console.warn("markEmailSent error", e); }
  }

  // FormÃ¡tuje zoznam poloÅ¾iek do HTML pre email
  function formatItemsHtml(items) {
    return items.map(it => {
      const daysLabel = it.days < 0
        ? "<span style='color:#dc2626;font-weight:600;'>EXPIROVANÃ‰</span>"
        : `za <strong>${it.days} dnÃ­</strong> (${it.expiry})`;
      return `<tr>
        <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;">${it.name}</td>
        <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;color:#6b6560;">${it.catName}</td>
        <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;">${daysLabel}</td>
      </tr>`;
    }).join("");
  }

  // EMAIL 1 â€“ Upozornenie na blÃ­Å¾iacu sa expirÃ¡ciu (spotrebuj to!)
  async function sendExpiryWarningEmail(items) {
    if (!currentUser?.email) return;
    if (!(await canSendEmail("expiry_warning"))) return;
    if (!items.length) return;

    const userName = currentUser.displayName?.split(" ")[0] || "pouÅ¾Ã­vateÄ¾";
    const itemsHtml = formatItemsHtml(items);
    const itemCount = items.length;

    try {
      await emailjs.send(EMAILJS_CONFIG.serviceId, EMAILJS_CONFIG.template_expiry, {
        to_email:    currentUser.email,
        to_name:     userName,
        item_count:  itemCount,
        items_html:  itemsHtml,
        items_text:  items.map(it => `â€¢ ${it.name} (${it.catName}) â€“ expiruje ${it.expiry}`).join("\n"),
        app_url:     window.location.href,
        subject:     `Gerlach: ${itemCount} ${itemCount === 1 ? "poloÅ¾ka" : itemCount < 5 ? "poloÅ¾ky" : "poloÅ¾iek"} v zÃ¡sobÃ¡ch Äoskoro expiruje`
      });
      await markEmailSent("expiry_warning");
      console.log("âœ‰ï¸ Expiry warning email odoslanÃ½");
    } catch(e) {
      console.warn("EmailJS expiry send error:", e);
    }
  }

  // EMAIL 2 â€“ NÃ¡kupnÃ½ zoznam (dobuÄ zÃ¡soby!)
  async function sendShoppingListEmail(items) {
    if (!currentUser?.email) return;
    if (!(await canSendEmail("shopping_list"))) return;
    if (!items.length) return;

    const userName = currentUser.displayName?.split(" ")[0] || "pouÅ¾Ã­vateÄ¾";
    const itemCount = items.length;
    const shoppingHtml = items.map(it => `<tr>
      <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;"><strong>${it.name}</strong></td>
      <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;color:#6b6560;">${it.catName}</td>
      <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;color:#6b6560;">${it.qty || "â€”"}</td>
    </tr>`).join("");

    try {
      await emailjs.send(EMAILJS_CONFIG.serviceId, EMAILJS_CONFIG.template_shopping, {
        to_email:      currentUser.email,
        to_name:       userName,
        item_count:    itemCount,
        shopping_html: shoppingHtml,
        shopping_text: items.map(it => `â€¢ ${it.name} (${it.catName})${it.qty ? " â€“ " + it.qty : ""}`).join("\n"),
        app_url:       window.location.href,
        subject:       `Gerlach: NÃ¡kupnÃ½ zoznam â€“ ${itemCount} ${itemCount === 1 ? "poloÅ¾ka na doplnenie" : "poloÅ¾ky na doplnenie"}`
      });
      await markEmailSent("shopping_list");
      console.log("âœ‰ï¸ Shopping list email odoslanÃ½");
    } catch(e) {
      console.warn("EmailJS shopping send error:", e);
    }
  }

  // HlavnÃ¡ funkcia â€“ skontroluje expirÃ¡cie a odoÅ¡le emaily ak treba
  async function checkAndSendNotifications() {
    if (isDemo) return; // Demo: Å¾iadne emaily
    if (!currentUser || EMAILJS_CONFIG.publicKey === "YOUR_EMAILJS_PUBLIC_KEY") return;

    const expiringItems  = getExpiringItems(); // per-category thresholds
    const criticalItems  = getExpiringItems(NOTIFY_SHOPPING_DAYS);

    // Email 1: upozornenie (podÄ¾a nastavenÃ½ch prahov per kategÃ³ria)
    if (expiringItems.length > 0) {
      await sendExpiryWarningEmail(expiringItems);
    }

    // Email 2: nÃ¡kupnÃ½ zoznam (do 14 dnÃ­) â€“ s oneskorenÃ­m aby neiÅ¡li sÃºÄasne
    if (criticalItems.length > 0) {
      setTimeout(() => sendShoppingListEmail(criticalItems), 3000);
    }
  }

  // UI funkcia â€“ manuÃ¡lne odoslanie z appky (tlaÄidlo)
  async function sendTestNotification() {
    if (isDemo) {
      alert("V demo reÅ¾ime nie sÃº emailovÃ© notifikÃ¡cie dostupnÃ©. Vytvorte si ÃºÄet zadarmo pre plnÃº funkcionalitu.");
      return;
    }
    const btn = document.getElementById("btnTestEmail");
    if (btn) { btn.disabled = true; btn.textContent = "Odosielam..."; }

    try {
      const expiringItems = getExpiringItems(); // per-category thresholds
      const criticalItems = getExpiringItems(NOTIFY_SHOPPING_DAYS);

      if (!expiringItems.length && !criticalItems.length) {
        alert("Å½iadne poloÅ¾ky s blÃ­Å¾iacou sa expirÃ¡ciou. Pridajte poloÅ¾ky s dÃ¡tumom expirÃ¡cie.");
        return;
      }

      // ObÃ­de cooldown pre testovanie
      if (EMAILJS_CONFIG.publicKey !== "YOUR_EMAILJS_PUBLIC_KEY") {
        await emailjs.send(EMAILJS_CONFIG.serviceId, EMAILJS_CONFIG.template_expiry, {
          to_email:   currentUser.email,
          to_name:    currentUser.displayName?.split(" ")[0] || "pouÅ¾Ã­vateÄ¾",
          item_count: expiringItems.length,
          items_text: expiringItems.map(it => `â€¢ ${it.name} (${it.catName}) â€“ expiruje ${it.expiry}`).join("\n"),
          items_html: formatItemsHtml(expiringItems),
          app_url:    window.location.href,
          subject:    "Gerlach: Test emailovej notifikÃ¡cie"
        });
        alert(`âœ… TestovacÃ­ email odoslanÃ½ na ${currentUser.email}`);
      } else {
        alert("EmailJS nie je nakonfigurovanÃ½. Pozri komentÃ¡re v kÃ³de.");
      }
    } catch(e) {
      alert("Chyba pri odosielanÃ­: " + (e.text || e.message || e));
    } finally {
      if (btn) { btn.disabled = false; btn.textContent = "TestovacÃ­ email"; }
    }
  }

  // ZavrieÅ¥ user menu pri kliknutÃ­ mimo
  document.addEventListener("click", (e) => {
    const menu = document.getElementById("userMenu");
    const avatar = document.getElementById("userAvatar");
    if (menu && !menu.contains(e.target) && e.target !== avatar) {
      menu.classList.remove("open");
    }
  });

  // Dynamic year
  document.querySelectorAll('.js-year').forEach(el => { el.textContent = new Date().getFullYear(); });

</script>

<!-- Cookie Banner -->
<div class="cookie-banner" id="cookieBanner" role="dialog" aria-label="InformÃ¡cia o cookies">
  <div class="cookie-banner-inner">
    <div class="cookie-banner-text">
      AplikÃ¡cia pouÅ¾Ã­va vÃ½luÄne <strong style="font-weight:500;color:#fff;">nevyhnutnÃ© cookies</strong> na prihlÃ¡senie a zÃ¡kladnÃº funkcionality. Å½iadne analytickÃ© ani reklamnÃ© cookies nepouÅ¾Ã­vame.
      <a href="./pravne-info.html#cookies">Viac info</a>
    </div>
    <div class="cookie-banner-actions">
      <button class="cookie-btn cookie-btn-accept" onclick="acceptCookies()">Rozumiem</button>
      <a class="cookie-btn cookie-btn-info" href="./pravne-info.html#cookies">Podrobnosti</a>
    </div>
  </div>
</div>
<script>
  (function() {
    if (!localStorage.getItem('gerlach_cookie_consent')) {
      setTimeout(function() {
        document.getElementById('cookieBanner').classList.add('show');
      }, 1500);
    }
  })();
  function acceptCookies() {
    localStorage.setItem('gerlach_cookie_consent', Date.now().toString());
    document.getElementById('cookieBanner').classList.remove('show');
  }
</script>
</body>
</html>
