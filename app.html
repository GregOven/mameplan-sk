<!doctype html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerlach â€“ PripravenosÅ¥ na krÃ­zovÃ© situÃ¡cie</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=Lexend:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --c-bg: #f5f3ee;
      --c-surface: #ffffff;
      --c-border: #e2ddd5;
      --c-text: #1a1714;
      --c-muted: #6b6560;
      --c-accent: #d4501a;
      --c-accent-light: #fdf0eb;
      --c-green: #2a7a4b;
      --c-green-light: #eaf4ee;
      --c-amber: #b45309;
      --c-amber-light: #fef3c7;
    }
    * { box-sizing: border-box; }
    body { font-family: 'Lexend', sans-serif; background: var(--c-bg); color: var(--c-text); font-size: 110%; }
    h1, h2, h3, .font-display { font-family: 'DM Sans', 'Lexend', sans-serif; letter-spacing: -0.025em; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ACCESSIBILITY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .skip-link {
      position: absolute;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--c-text);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0 0 0.75rem 0.75rem;
      font-size: 0.85rem;
      font-weight: 600;
      z-index: 10001;
      text-decoration: none;
      transition: top 0.2s;
    }
    .skip-link:focus {
      top: 0;
      outline: 3px solid var(--c-accent);
      outline-offset: 2px;
    }

    /* Focus visible ring for all interactive elements */
    [tabindex]:focus-visible,
    button:focus-visible,
    a:focus-visible,
    input:focus-visible,
    select:focus-visible {
      outline: 2.5px solid var(--c-accent);
      outline-offset: 2px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN SYSTEM: SHADOWS & TRANSITIONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .shadow-sm { box-shadow: 0 1px 2px rgba(26,23,20,0.04), 0 1px 3px rgba(26,23,20,0.06); }
    .shadow-md { box-shadow: 0 2px 8px rgba(26,23,20,0.06), 0 4px 16px rgba(26,23,20,0.04); }
    .shadow-lg { box-shadow: 0 4px 12px rgba(26,23,20,0.08), 0 8px 32px rgba(26,23,20,0.06); }

    /* Tab switch stagger animation */
    .tab-pane.active > * {
      animation: fadeSlideIn 0.35s ease both;
    }
    .tab-pane.active > *:nth-child(1) { animation-delay: 0s; }
    .tab-pane.active > *:nth-child(2) { animation-delay: 0.05s; }
    .tab-pane.active > *:nth-child(3) { animation-delay: 0.1s; }
    .tab-pane.active > *:nth-child(4) { animation-delay: 0.15s; }
    .tab-pane.active > *:nth-child(5) { animation-delay: 0.2s; }
    .tab-pane.active > *:nth-child(6) { animation-delay: 0.25s; }
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Progress bar living gradient */
    .progress-fill::after {
      content: '';
      position: absolute; inset: 0;
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.25) 50%, transparent 100%);
      animation: shimmer 2.5s ease-in-out infinite;
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Confetti canvas */
    #confettiCanvas {
      position: fixed; inset: 0; z-index: 9999;
      pointer-events: none;
    }

    /* Easter egg: Tatry panorama */
    .easter-tatry {
      position: fixed; inset: 0; z-index: 10000;
      background: linear-gradient(180deg, #1a1b3a 0%, #2d3561 30%, #4a6fa5 60%, #87CEEB 100%);
      display: none; align-items: center; justify-content: center;
      flex-direction: column; cursor: pointer;
      animation: tatryFadeIn 0.6s ease;
    }
    .easter-tatry.visible { display: flex; }
    @keyframes tatryFadeIn {
      from { opacity: 0; } to { opacity: 1; }
    }
    .easter-tatry-mountains {
      width: 100%; max-width: 800px; height: 200px; position: relative;
    }
    .easter-tatry-quote {
      color: white; font-family: 'DM Sans', sans-serif;
      font-size: 1.5rem; font-weight: 700; text-align: center;
      margin-top: 2rem; padding: 0 2rem;
      text-shadow: 0 2px 12px rgba(0,0,0,0.3);
      letter-spacing: -0.02em;
    }
    .easter-tatry-sub {
      color: rgba(255,255,255,0.6); font-size: 0.85rem;
      margin-top: 1rem; font-family: 'Lexend', sans-serif;
    }

    .login-screen {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--c-bg);
      padding: 2rem;
      position: relative;
      overflow: hidden;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DEMO BANNER + VERSION BADGE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .demo-banner {
      display: none;
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-bottom: 1px solid #f59e0b;
      padding: 0.5rem 1rem;
      text-align: center;
      font-size: 0.8rem;
      font-weight: 500;
      color: #92400e;
      /* StatickÃ½ banner â€” scrolluje preÄ. Verzia badge v headeri ostÃ¡va. */
    }
    .demo-banner.visible { display: flex; align-items: center; justify-content: center; gap: 0.75rem; flex-wrap: wrap; }
    .demo-banner a {
      display: inline-flex; align-items: center; gap: 0.25rem;
      background: #92400e; color: #fff;
      padding: 0.25rem 0.75rem; border-radius: 99px;
      font-size: 0.72rem; font-weight: 700;
      text-decoration: none; transition: background 0.15s;
    }
    .demo-banner a:hover { background: #78350f; }
    .version-badge {
      display: inline-flex; align-items: center; gap: 0.375rem;
      font-size: 0.65rem; font-weight: 600;
      padding: 0.15rem 0.5rem;
      border-radius: 99px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    .version-badge.beta {
      background: var(--c-accent-light);
      color: var(--c-accent);
      border: 1px solid rgba(212,80,26,0.2);
    }
    .version-badge.demo-badge {
      background: #fef3c7;
      color: #92400e;
      border: 1px solid #f59e0b;
    }
    /* Demo mode: badge in header serves as persistent reminder */
    .login-screen::after {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 120px;
      opacity: 0.06;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120'%3E%3Cpath d='M0 120 L80 70 L130 90 L200 40 L260 65 L330 20 L380 50 L440 10 L500 45 L560 15 L620 55 L680 25 L740 60 L800 35 L860 70 L920 45 L980 75 L1040 50 L1100 80 L1160 55 L1200 70 L1200 120Z' fill='%231a1714'/%3E%3C/svg%3E") no-repeat bottom center;
      background-size: cover;
      pointer-events: none;
    }
    .login-card {
      background: var(--c-surface);
      border: 1px solid var(--c-border);
      border-radius: 1.5rem;
      padding: 3rem 2.5rem;
      max-width: 420px;
      width: 100%;
      text-align: center;
      box-shadow: 0 4px 24px rgba(0,0,0,0.06);
    }
    .logo-mark {
      width: 64px; height: 64px;
      background: var(--c-accent);
      border-radius: 1rem;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 1.5rem;
      font-size: 1.75rem;
    }
    .btn-google {
      display: flex; align-items: center; justify-content: center; gap: 0.75rem;
      width: 100%;
      padding: 0.875rem 1.5rem;
      border: 1.5px solid var(--c-border);
      border-radius: 0.875rem;
      background: var(--c-surface);
      color: var(--c-text);
      font-family: 'Lexend', sans-serif;
      font-size: 0.9375rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn-google:hover { background: var(--c-bg); border-color: #c5c0b8; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    #btnDemoLogin:hover { background: #fef3c7 !important; border-color: #d97706 !important; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(245,158,11,0.15); }
    .btn-google svg { flex-shrink: 0; }

    .app-header {
      background: var(--c-surface);
      border-bottom: 1px solid var(--c-border);
      position: sticky; top: 0; z-index: 50;
    }
    .app-header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
      height: 60px;
    }
    .app-header-logo { display: flex; align-items: center; gap: 0.75rem; }
    .app-logo-sm {
      width: 32px; height: 32px;
      background: var(--c-accent);
      border-radius: 0.5rem;
      display: flex; align-items: center; justify-content: center;
      font-size: 1rem; color: white;
    }

    .card {
      background: var(--c-surface);
      border: 1px solid var(--c-border);
      border-radius: 1.25rem;
      padding: 1.25rem;
      box-shadow: 0 1px 3px rgba(26,23,20,0.04), 0 2px 8px rgba(26,23,20,0.03);
      transition: box-shadow 0.25s ease, transform 0.25s ease;
    }
    .card:hover {
      box-shadow: 0 2px 8px rgba(26,23,20,0.06), 0 4px 16px rgba(26,23,20,0.04);
    }

    .progress-bar { height: 8px; border-radius: 999px; background: #ede9e3; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 999px; transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; overflow: hidden; }

    .cat-card {
      background: var(--c-surface);
      border: 2px solid var(--c-border);
      border-radius: 1.25rem;
      padding: 1rem;
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease, border-color 0.2s ease, background 0.2s ease;
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .cat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.11), inset 0 1px 0 rgba(255,255,255,0.8);
    }
    .cat-card.selected {
      transform: translateY(-5px);
      box-shadow: 0 10px 28px rgba(0,0,0,0.14);
      border-width: 3px;
    }

    .item-row {
      background: var(--c-surface);
      border: 1px solid var(--c-border);
      border-radius: 0.875rem;
      padding: 0.875rem 1rem;
      display: flex; align-items: flex-start; gap: 0.75rem;
      transition: background 0.1s;
    }
    .item-row:hover { background: #faf9f7; }

    .badge {
      display: inline-flex; align-items: center;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.7rem; font-weight: 600;
      border: 1px solid;
    }
    .badge-red { background: #fef2f2; color: #991b1b; border-color: #fecaca; }
    .badge-amber { background: var(--c-amber-light); color: var(--c-amber); border-color: #fcd34d; }
    .badge-gray { background: #f9fafb; color: #6b7280; border-color: #e5e7eb; }
    .badge-green { background: var(--c-green-light); color: var(--c-green); border-color: #86efac; }

    .btn-primary {
      background: var(--c-text); color: white;
      border: none; border-radius: 0.75rem;
      padding: 0.625rem 1.125rem;
      font-size: 0.875rem; font-weight: 500;
      cursor: pointer; transition: background 0.15s;
      font-family: 'Lexend', sans-serif;
    }
    .btn-primary:hover { background: #333; }
    .btn-danger {
      background: #fee2e2; color: #991b1b;
      border: 1px solid #fecaca;
      border-radius: 0.75rem;
      padding: 0.5rem 0.875rem;
      font-size: 0.8rem; font-weight: 500;
      cursor: pointer; transition: background 0.15s;
      font-family: 'Lexend', sans-serif;
    }
    .btn-danger:hover { background: #fecaca; }
    .btn-ghost {
      background: transparent; color: var(--c-muted);
      border: 1px solid var(--c-border);
      border-radius: 0.75rem;
      padding: 0.5rem 0.875rem;
      font-size: 0.8rem;
      cursor: pointer; transition: all 0.15s;
      font-family: 'Lexend', sans-serif;
    }
    .btn-ghost:hover { background: var(--c-bg); color: var(--c-text); }

    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.4);
      display: none; align-items: center; justify-content: center;
      padding: 1rem; z-index: 100;
      overscroll-behavior: contain;
    }
    .modal-overlay.open { display: flex; }
    .modal-box {
      background: var(--c-surface);
      border: 1px solid var(--c-border);
      border-radius: 1.5rem;
      padding: 1.5rem;
      width: 100%; max-width: 560px;
      max-height: 90vh; overflow-y: auto;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
    }

    input[type="text"], input[type="number"], input[type="date"], input[type="url"], select, textarea {
      width: 100%;
      background: white;
      border: 1.5px solid var(--c-border);
      border-radius: 0.75rem;
      padding: 0.625rem 0.875rem;
      font-family: 'Lexend', sans-serif;
      font-size: 0.9rem;
      color: var(--c-text);
      transition: border-color 0.15s;
      outline: none;
    }
    input:focus, select:focus, textarea:focus { border-color: var(--c-accent); }

    .limit-banner {
      background: linear-gradient(135deg, #1a1714 0%, #2d2926 100%);
      color: white;
      border-radius: 1rem;
      padding: 1rem 1.25rem;
      display: flex; align-items: center; gap: 1rem;
    }

    .user-avatar {
      width: 32px; height: 32px;
      border-radius: 50%;
      background: var(--c-accent);
      display: flex; align-items: center; justify-content: center;
      color: white; font-weight: 700; font-size: 0.875rem;
      overflow: hidden;
    }
    .user-avatar img { width: 100%; height: 100%; object-fit: cover; }

    .sync-indicator {
      display: inline-flex; align-items: center; gap: 0.375rem;
      font-size: 0.75rem; color: var(--c-muted);
    }
    .sync-dot {
      width: 7px; height: 7px; border-radius: 50%;
      background: #d1d5db;
    }
    .sync-dot.synced { background: var(--c-green); }
    .sync-dot.syncing { background: #f59e0b; animation: pulse 1s infinite; }

    @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
    @keyframes tipSlideIn { from { opacity:0; transform:translateY(-8px); } to { opacity:1; transform:translateY(0); } }

    .water-card {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      border: 1.5px solid #bfdbfe;
      border-radius: 1rem;
      padding: 1.25rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PRVÃ POMOC
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .fa-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.75rem;
    }
    .fa-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 1rem 0.5rem;
      border-radius: 1rem;
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease, background 0.15s ease;
      background: var(--c-surface);
      border: 1.5px solid var(--c-border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .fa-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.10);
      border-color: #d4501a;
    }
    .fa-card:active { transform: translateY(-1px); }
    .fa-icon {
      width: 52px; height: 52px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      flex-shrink: 0;
    }
    .fa-card-label {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--c-text);
      line-height: 1.3;
    }
    .fa-modal-step {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--c-border);
    }
    .fa-modal-step:last-child { border-bottom: none; }
    .fa-step-num {
      width: 28px; height: 28px;
      border-radius: 50%;
      background: var(--c-accent);
      color: white;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.75rem; font-weight: 700;
      flex-shrink: 0;
    }
    .fa-step-text {
      font-size: 0.85rem;
      line-height: 1.55;
      color: var(--c-text);
    }
    .fa-step-text strong { color: var(--c-accent); }
    .fa-warning {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      font-size: 0.8rem;
      color: #991b1b;
      line-height: 1.5;
      margin-top: 0.75rem;
    }
    .fa-info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      font-size: 0.8rem;
      color: #1e40af;
      line-height: 1.5;
      margin-top: 0.75rem;
    }
    .fa-source {
      font-size: 0.68rem;
      color: var(--c-muted);
      margin-top: 1rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--c-border);
      line-height: 1.5;
    }
    .fa-emergency-bar {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      color: white;
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .fa-emergency-bar a {
      color: white;
      text-decoration: underline;
      font-weight: 700;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       UTILITY CLASSES (consolidated inline styles)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    /* Modal close button */
    .modal-close {
      background: none; border: none; cursor: pointer;
      color: var(--c-muted); font-size: 1.375rem;
      flex-shrink: 0; margin-left: 1rem;
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 0.5rem; transition: background 0.15s;
    }
    .modal-close:hover { background: var(--c-bg); }

    /* Modal header row */
    .modal-header {
      display: flex; align-items: center;
      justify-content: space-between;
      margin-bottom: 1.25rem;
    }

    /* Section heading (uppercase muted) */
    .section-label {
      font-size: 0.78rem; font-weight: 700;
      color: var(--c-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.625rem;
    }

    /* Card inner section background */
    .card-section {
      background: var(--c-bg);
      border-radius: 1rem;
      padding: 1rem;
    }

    /* Item form label (bold) â€” used in category/bag item rows */
    .item-label {
      font-size: 0.78rem; color: var(--c-muted);
      display: block; margin-bottom: 0.375rem;
      font-weight: 600;
    }
    /* Item form sublabel */
    .item-sublabel {
      font-size: 0.68rem; color: var(--c-muted);
      display: block; margin-bottom: 0.2rem;
    }
    /* Item form label (regular) */
    .item-label-light {
      font-size: 0.8rem; color: var(--c-muted);
      display: block; margin-bottom: 0.375rem;
    }

    /* Undo toast */
    .undo-toast {
      position: fixed;
      bottom: calc(80px + env(safe-area-inset-bottom, 0px));
      left: 50%; transform: translateX(-50%);
      background: #1a1714; color: white;
      padding: 0.75rem 1.25rem;
      border-radius: 1rem;
      font-family: 'Lexend', sans-serif;
      font-size: 0.82rem;
      display: flex; align-items: center; gap: 0.75rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.24);
      z-index: 200;
      animation: toastSlideUp 0.3s ease-out;
    }
    .undo-toast button {
      background: none; border: none;
      color: #60a5fa; font-weight: 700;
      font-family: 'Lexend', sans-serif;
      font-size: 0.82rem; cursor: pointer;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      transition: background 0.15s;
    }
    .undo-toast button:hover { background: rgba(96,165,250,0.15); }
    @keyframes toastSlideUp {
      from { opacity: 0; transform: translateX(-50%) translateY(16px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    @media (max-width: 640px) {

      /* PrvÃ¡ pomoc */
      .fa-grid { grid-template-columns: repeat(4, 1fr); gap: 0.5rem; }
      .fa-icon { width: 44px; height: 44px; font-size: 1.25rem; }
      .fa-card { padding: 0.75rem 0.375rem; }
      .fa-card-label { font-size: 0.65rem; }

      /* Header */
      .app-header-inner {
        padding: 0 1rem !important;
        height: 52px !important;
      }
      .app-header-logo span {
        font-size: 0.9375rem !important;
      }

      /* HlavnÃ½ obsah */
      .app-main-padding {
        padding: 1rem 0.75rem !important;
      }

      /* Profile + Overall - stack na mobile */
      .top-row-grid {
        grid-template-columns: 1fr !important;
      }

      /* KategÃ³rie - 2 stÄºpce na mobile */
      .categories-grid {
        grid-template-columns: 1fr 1fr !important;
        gap: 0.5rem !important;
      }

      /* PlÃ¡ny - 1 stÄºpec */
      .plans-grid {
        grid-template-columns: 1fr !important;
      }

      /* Profil karta - 2x2 grid */
      .profile-stats-grid {
        grid-template-columns: 1fr 1fr !important;
      }

      /* Buttons v header detail */
      .detail-header-row {
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      /* Item riadky - tlaÄidlÃ¡ menÅ¡ie */
      .item-row {
        padding: 0.75rem 0.75rem !important;
      }

      /* Modal - full screen na mobile */
      .modal-box {
        border-radius: 1.25rem 1.25rem 0 0 !important;
        max-height: 92vh !important;
        margin-top: auto !important;
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        right: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
      }
      .modal-box::before {
        content: '';
        display: block;
        width: 36px;
        height: 4px;
        border-radius: 2px;
        background: var(--c-border);
        margin: 0 auto 0.75rem;
        opacity: 0.7;
      }
      .modal-overlay {
        align-items: flex-end !important;
        padding: 0 !important;
      }

      /* Profil modal - 3 stÄºpce -> 1 stÄºpec */
      .profile-3col {
        grid-template-columns: 1fr !important;
      }

      /* Osoby - 2x2 na mobile */
      .persons-grid {
        grid-template-columns: 1fr 1fr !important;
      }

      /* Dni + BÃ½vanie - stack na mobile */
      .profile-days-housing {
        grid-template-columns: 1fr !important;
      }

      /* Water card grid */
      .water-info-grid {
        grid-template-columns: 1fr !important;
      }

      /* Cat card - menÅ¡Ã­ padding */
      .cat-card {
        padding: 0.75rem !important;
      }

      /* Sync indicator - skryÅ¥ text na mobile */
      .sync-label-text {
        display: none;
      }

      /* CelkovÃ¡ pripravenosÅ¥ - handled by hero banner */

      /* Item row tlaÄidlÃ¡ - len ikony na mobile */
      .item-btn-edit { font-size: 0.75rem !important; padding: 0.375rem 0.5rem !important; }
      .item-btn-del { padding: 0.375rem 0.5rem !important; }

      /* Profil karta - full width water box */
      .profile-water-full { grid-column: 1 / -1 !important; }

      /* VÃ½straha sekcia */
      .alerts-header { flex-wrap: wrap; gap: 0.5rem; }

      /* Nadpis KategÃ³rie */
      .cats-heading { font-size: 1.1rem !important; }

      /* Overall % ÄÃ­slo menÅ¡ie */
      #overallPct { font-size: 1.6rem !important; }

      /* PlÃ¡n karty - zmenÅ¡iÅ¥ padding */
      .plan-card { padding: 0.875rem !important; }

      /* Na mobile - skryÅ¥ desktop logout, zobraziÅ¥ mobile verziu */
      #btnLogout { display: none !important; }
      .user-avatar { cursor: pointer; }
      .mobile-logout-btn { display: flex !important; }

      /* OsobnÃ© kontakty modal - telefÃ³nne polia na 1 stÄºpec */
      #personalContactForm > div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
      }
      /* OsobnÃ© kontakty modal - menÅ¡Ã­ padding a scrollovateÄ¾nÃ½ form */
      #modalPersonalContact .modal-box {
        padding: 1.25rem 1rem !important;
      }
    }
    /* StrednÃ© obrazovky - tablet */
    @media (min-width: 641px) and (max-width: 900px) {
      .top-row-grid {
        grid-template-columns: 1fr 1fr !important;
      }
      .categories-grid {
        grid-template-columns: repeat(3, 1fr) !important;
      }
      .profile-3col {
        grid-template-columns: 1fr 1fr !important;
      }
    }
    
    #userMenu.open { display: block !important; }
    /* ZavrieÅ¥ menu pri kliknutÃ­ mimo */

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB NAVIGÃCIA
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .tab-bar {
      display: flex;
      justify-content: center;
      padding: 0.5rem 1.5rem 0.625rem;
      background: var(--c-surface);
      border-bottom: 1px solid var(--c-border);
    }
    .tab-bar-inner {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      background: var(--c-bg);
      border: 1px solid var(--c-border);
      border-radius: 0.875rem;
      padding: 0.25rem;
    }
    .tab-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      padding: 0.5rem 1.25rem;
      border: none;
      background: transparent;
      color: var(--c-muted);
      font-family: 'DM Sans', 'Lexend', sans-serif;
      font-size: 0.82rem;
      font-weight: 600;
      cursor: pointer;
      border-radius: 0.625rem;
      transition: all 0.2s ease;
      white-space: nowrap;
      position: relative;
    }
    .tab-btn:hover { color: var(--c-text); }
    .tab-btn.active {
      background: var(--c-surface); color: var(--c-text);
      box-shadow: 0 1px 3px rgba(26,23,20,0.08), 0 1px 2px rgba(26,23,20,0.06);
    }
    .tab-btn .tab-emoji { font-size: 0.9rem; }
    .tab-pane { display: none; }
    .tab-pane.active { display: grid; grid-template-columns: 1fr; gap: 1rem; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HERO BANNER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .hero-banner {
      background: var(--c-surface);
      border: 1.5px solid var(--c-border);
      border-radius: 1.25rem;
      padding: 1.25rem 1.5rem;
      box-shadow: 0 2px 8px rgba(26,23,20,0.06), 0 4px 16px rgba(26,23,20,0.04);
      position: relative;
      overflow: hidden;
    }
    .hero-banner::before {
      content: '';
      position: absolute;
      bottom: 0; right: 0;
      width: 320px; height: 80px;
      opacity: 0.04;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 320 80'%3E%3Cpath d='M0 80 L40 45 L65 60 L95 25 L115 40 L140 15 L160 30 L175 10 L190 30 L210 18 L230 35 L250 22 L270 40 L290 30 L310 50 L320 42 L320 80Z' fill='%231a1714'/%3E%3C/svg%3E") no-repeat bottom right;
      background-size: contain;
      pointer-events: none;
    }
    .hero-top {
      display: flex; align-items: center; justify-content: space-between;
      gap: 1rem; margin-bottom: 0.75rem; position: relative; z-index: 1;
    }
    .hero-rank { display: flex; align-items: center; gap: 0.5rem; font-weight: 700; font-size: 1.125rem; font-family: 'DM Sans', sans-serif; }
    .hero-pct { font-size: 1.75rem; font-weight: 800; font-family: 'DM Sans', sans-serif; letter-spacing: -0.03em; }
    .hero-meta { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.75rem; position: relative; z-index: 1; }
    .hero-tag {
      display: inline-flex; align-items: center; gap: 0.25rem;
      background: var(--c-bg); border-radius: 0.5rem; padding: 0.25rem 0.625rem;
      font-size: 0.75rem; font-weight: 500; color: var(--c-muted);
      transition: background 0.15s;
    }
    .hero-tag:hover { background: #e8e4dd; }

    /* Slovak milestone messages (shown below progress) */
    .hero-milestone {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--c-muted);
      margin-top: 0.5rem;
      font-style: italic;
      position: relative; z-index: 1;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ONBOARDING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .onboarding-card {
      background: linear-gradient(135deg, #fef3c7 0%, #fef9c3 100%);
      border: 2px solid #fcd34d; border-radius: 1.25rem;
      padding: 2rem 1.5rem; text-align: center;
    }
    .onboarding-card h2 { font-size: 1.5rem; font-weight: 800; color: #92400e; margin-bottom: 0.5rem; font-family: 'DM Sans', sans-serif; letter-spacing: -0.03em; }
    .onboarding-card p { color: #854d0e; font-size: 0.9rem; line-height: 1.6; margin-bottom: 1.5rem; }
    .onboarding-card .btn-primary { padding: 0.875rem 2rem; font-size: 1rem; background: #92400e; }
    .onboarding-card .btn-primary:hover { background: #78350f; }

    /* Procedure groups */
    .proc-group-heading {
      font-size: 0.78rem; font-weight: 700; color: var(--c-muted);
      text-transform: uppercase; letter-spacing: 0.05em;
      padding: 0.25rem 0; margin-top: 0.5rem; grid-column: 1 / -1;
    }
    .proc-group-heading:first-child { margin-top: 0; }

    .zone-intro { font-size: 0.85rem; color: var(--c-muted); line-height: 1.6; padding: 0.25rem 0 0.5rem; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILE BOTTOM NAV
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .bottom-nav {
      display: none; position: fixed; bottom: 0; left: 0; right: 0;
      background: var(--c-surface); border-top: 1px solid var(--c-border);
      z-index: 50; padding: 0.375rem 0.5rem calc(0.375rem + env(safe-area-inset-bottom, 0px));
    }
    .bottom-nav .tab-btn {
      flex: 1;
      flex-direction: column; gap: 0.1rem; font-size: 0.6rem;
      padding: 0.35rem 0.125rem; border-radius: 0.625rem;
    }
    .bottom-nav .tab-btn .tab-emoji { font-size: 1.125rem; }
    .bottom-nav .tab-btn.active {
      background: transparent; color: var(--c-accent);
    }
    .bottom-nav .tab-btn.active::after {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 24px;
      height: 3px;
      border-radius: 0 0 3px 3px;
      background: var(--c-accent);
      transition: width 0.2s;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SOS FLOATING ACTION BUTTON
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .sos-fab {
      display: none;
      position: fixed;
      z-index: 48;
      bottom: calc(72px + env(safe-area-inset-bottom, 0px));
      right: 1rem;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      border: 2.5px solid #fecaca;
      color: white;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.05rem;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(220, 38, 38, 0.35), 0 2px 6px rgba(0,0,0,0.15);
      transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s;
      font-family: 'DM Sans', 'Lexend', sans-serif;
    }
    .sos-fab:hover {
      transform: scale(1.08);
      box-shadow: 0 6px 24px rgba(220, 38, 38, 0.45), 0 4px 12px rgba(0,0,0,0.15);
    }
    .sos-fab:active { transform: scale(0.95); }
    .sos-fab-icon { font-size: 1.25rem; line-height: 1; }
    .sos-fab-label { font-size: 0.5rem; font-weight: 800; letter-spacing: 0.04em; line-height: 1; }

    /* â•â•â• Collapsible Info Panel â•â•â• */
    .info-collapse {
      border-radius: 0.75rem;
      overflow: hidden;
      transition: margin 0.2s;
    }
    .info-collapse-toggle {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 0.875rem;
      border: none;
      background: none;
      cursor: pointer;
      font-family: 'Lexend', sans-serif;
      font-size: 0.78rem;
      font-weight: 700;
      line-height: 1.3;
      text-align: left;
      transition: opacity 0.15s;
    }
    .info-collapse-toggle:hover { opacity: 0.8; }
    .info-collapse-arrow {
      font-size: 0.6rem;
      transition: transform 0.25s;
      flex-shrink: 0;
      margin-left: auto;
    }
    .info-collapse-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease, padding 0.3s ease;
      padding: 0 0.875rem;
    }
    .info-collapse.open .info-collapse-body {
      max-height: 600px;
      padding: 0 0.875rem 0.75rem;
    }
    .info-collapse.open .info-collapse-arrow {
      transform: rotate(180deg);
    }

    @media (max-width: 640px) {
      .tab-bar.top-tabs { display: none !important; }
      .bottom-nav { display: flex; gap: 0.125rem; }
      .sos-fab { display: flex; }
      .app-main-padding { padding-bottom: 80px !important; }
      .hero-pct { font-size: 1.5rem !important; }
      .hero-rank { font-size: 1rem !important; }
      .hero-banner { padding: 1rem !important; }
      .hero-meta { gap: 0.375rem !important; }
      .hero-tag { font-size: 0.68rem !important; padding: 0.2rem 0.5rem !important; }
    }
    @media (min-width: 641px) {
      .sos-fab {
        display: flex;
        bottom: 1.5rem;
        right: 1.5rem;
      }
    }

    @media (min-width: 641px) and (max-width: 900px) {
      .tab-bar.top-tabs { padding: 0.375rem 1rem 0.5rem; }
      .tab-btn { font-size: 0.78rem; padding: 0.4rem 0.875rem; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DÃ”LEÅ½ITÃ‰ KONTAKTY & VAROVNÃ‰ SIGNÃLY
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .ec-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 0.625rem;
    }
    .ec-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 1rem 0.625rem;
      border-radius: 1rem;
      background: var(--c-surface);
      border: 1.5px solid var(--c-border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
      text-decoration: none;
      color: var(--c-text);
      transition: transform 0.2s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.2s, border-color 0.2s;
      cursor: pointer;
    }
    .ec-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.10);
    }
    .ec-card:active { transform: translateY(-1px); }
    .ec-icon {
      width: 48px; height: 48px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.375rem;
      margin-bottom: 0.5rem;
      flex-shrink: 0;
    }
    .ec-card-label {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--c-text);
      line-height: 1.3;
    }
    .ec-card-number {
      font-size: 1rem;
      font-weight: 800;
      margin-top: 0.2rem;
      letter-spacing: -0.01em;
    }

    /* SirÃ©ny - vizualizÃ¡cia */
    .siren-card {
      background: var(--c-surface);
      border: 1.5px solid var(--c-border);
      border-radius: 1rem;
      padding: 1rem;
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.2s, border-color 0.2s;
    }
    .siren-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.10);
      border-color: var(--c-accent);
    }
    .siren-wave {
      height: 28px;
      border-radius: 0.375rem;
      overflow: hidden;
      position: relative;
      margin-top: 0.5rem;
    }
    .siren-wave-bar {
      position: absolute;
      bottom: 0;
      width: 3px;
      border-radius: 2px;
      animation: sirenPulse 1.5s ease-in-out infinite;
    }
    @keyframes sirenPulse {
      0%, 100% { transform: scaleY(0.3); }
      50% { transform: scaleY(1); }
    }
    .siren-wave-steady .siren-wave-bar {
      animation: sirenSteady 2s ease-in-out infinite;
    }
    @keyframes sirenSteady {
      0%, 100% { transform: scaleY(0.85); }
      50% { transform: scaleY(1); }
    }

    /* Postupy pri MU */
    .mu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.75rem;
    }
    .mu-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 1rem 0.5rem;
      border-radius: 1rem;
      cursor: pointer;
      transition: transform 0.2s cubic-bezier(0.34,1.56,0.64,1), box-shadow 0.2s, border-color 0.15s;
      background: var(--c-surface);
      border: 1.5px solid var(--c-border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .mu-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.10);
      border-color: var(--c-accent);
    }
    .mu-card:active { transform: translateY(-1px); }
    .mu-icon {
      width: 52px; height: 52px;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      flex-shrink: 0;
    }
    .mu-card-label {
      font-size: 0.72rem;
      font-weight: 600;
      color: var(--c-text);
      line-height: 1.3;
    }

    @media (max-width: 640px) {
      .ec-grid { grid-template-columns: repeat(3, 1fr); gap: 0.5rem; }
      .ec-icon { width: 40px; height: 40px; font-size: 1.125rem; }
      .ec-card { padding: 0.75rem 0.375rem; }
      .ec-card-label { font-size: 0.65rem; }
      .ec-card-number { font-size: 0.85rem; }
      .mu-grid { grid-template-columns: repeat(4, 1fr); gap: 0.5rem; }
      .mu-icon { width: 44px; height: 44px; font-size: 1.25rem; }
      .mu-card { padding: 0.75rem 0.375rem; }
      .mu-card-label { font-size: 0.65rem; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COOKIE BANNER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .cookie-banner {
      position: fixed; bottom: 0; left: 0; right: 0;
      z-index: 9999;
      background: #1a1612;
      color: rgba(255,255,255,0.85);
      border-top: 1px solid rgba(255,255,255,0.1);
      padding: 1rem 1.5rem;
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .cookie-banner.show { transform: none; }
    .cookie-banner-inner {
      max-width: 640px; margin: 0 auto;
      display: flex; align-items: center; gap: 1rem;
      flex-wrap: wrap;
    }
    .cookie-banner-text {
      flex: 1; min-width: 220px;
      font-size: 0.78rem; font-weight: 300; line-height: 1.6;
      font-family: 'DM Sans', 'Lexend', sans-serif;
    }
    .cookie-banner-text a { color: #c94f1a; text-decoration: underline; }
    .cookie-banner-actions { display: flex; gap: 0.5rem; flex-shrink: 0; }
    .cookie-btn {
      font-family: 'DM Sans', 'Lexend', sans-serif;
      font-size: 0.78rem; font-weight: 600;
      padding: 0.5rem 1.125rem;
      border-radius: 99px;
      cursor: pointer; border: none;
      transition: all 0.2s;
    }
    .cookie-btn-accept {
      background: #c94f1a; color: #fff;
    }
    .cookie-btn-accept:hover { background: #b5441a; }
    .cookie-btn-info {
      background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.7);
      border: 1px solid rgba(255,255,255,0.12);
      text-decoration: none; display: inline-flex; align-items: center;
    }
    .cookie-btn-info:hover { background: rgba(255,255,255,0.15); color: #fff; }
    @media (max-width: 640px) {
      .cookie-banner { padding: 0.875rem 1rem; }
      .cookie-banner-text { font-size: 0.72rem; min-width: 100%; }
      .cookie-banner-actions { width: 100%; }
      .cookie-btn { flex: 1; text-align: center; }
    }
  </style>
</head>
<body>

<!-- Skip to content (accessibility) -->
<a href="#appMain" class="skip-link" id="skipLink">PreskoÄiÅ¥ na obsah</a>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="login-screen">
  <div class="login-card">
    <h1 style="font-size:1.75rem; font-weight:800; margin-bottom:0.5rem; letter-spacing:-0.03em; font-family:'DM Sans','Lexend',sans-serif;">Gerlach</h1>
    <p style="color:var(--c-muted); font-size:0.9rem; margin-bottom:2rem; line-height:1.6;">
      PomÃ¡ha domÃ¡cnostiam na Slovensku<br>pripraviÅ¥ sa na krÃ­zovÃ© situÃ¡cie.
    </p>
    <button class="btn-google" id="btnGoogleLogin">
      <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      PokraÄovaÅ¥ cez Google
    </button>
    <div style="text-align:center; margin-top:0.5rem; font-size:0.7rem; color:var(--c-muted); line-height:1.4;">
      Ãºdaje sa uloÅ¾ia do vÃ¡Å¡ho ÃºÄtu a budÃº dostupnÃ© na kaÅ¾dom zariadenÃ­
    </div>

    <div style="display:flex; align-items:center; gap:0.75rem; margin-top:1rem;">
      <div style="flex:1; height:1px; background:var(--c-border);"></div>
      <span style="font-size:0.75rem; color:var(--c-muted); font-weight:400;">alebo</span>
      <div style="flex:1; height:1px; background:var(--c-border);"></div>
    </div>

    <button class="btn-google" id="btnDemoLogin" style="margin-top:1rem; border-color:#f59e0b; background:#fffbeb;">
      ğŸ” VyskÃºÅ¡aÅ¥ demo
    </button>
    <div style="text-align:center; margin-top:0.5rem; font-size:0.7rem; color:var(--c-muted); line-height:1.4;">
      dÃ¡ta sa vymaÅ¾Ãº po zatvorenÃ­ prehliadaÄa
    </div>

    <div id="loginError" style="margin-top:1rem; color:#991b1b; font-size:0.85rem; display:none;"></div>
  </div>
  <p style="margin-top:1.5rem; font-size:0.75rem; color:var(--c-muted);">
    Gerlach Â© <span class="js-year"></span> â€“ Zadarmo pre verejnosÅ¥
  </p>
  <p style="margin-top:0.375rem; font-size:0.65rem; color:var(--c-muted);">
    <a href="./pravne-info.html" style="color:var(--c-muted); text-decoration:underline; text-underline-offset:2px;">Podmienky pouÅ¾Ã­vania</a>
    &nbsp;Â·&nbsp;
    <a href="./pravne-info.html#ochrana-udajov" style="color:var(--c-muted); text-decoration:underline; text-underline-offset:2px;">Ochrana Ãºdajov</a>
  </p>
</div>

<!-- REGISTRATION CLOSED SCREEN -->
<div id="closedScreen" style="display:none;" class="login-screen">
    <h1 style="font-size:1.5rem; font-weight:800; margin-bottom:0.5rem;">RegistrÃ¡cia uzavretÃ¡</h1>
    <p style="color:var(--c-muted); font-size:0.9rem; line-height:1.6;">
      MomentÃ¡lne sme dosiahli maximÃ¡lny poÄet pouÅ¾Ã­vateÄ¾ov v beta verzii. SkÃºs to znova neskÃ´r.
    </p>
</div>

<!-- MAIN APP -->
<div id="appScreen" style="display:none;">

  <!-- Demo banner: viditeÄ¾nÃ½ len v demo reÅ¾ime -->
  <div class="demo-banner" id="demoBanner" role="alert">
    <span>ğŸ” <strong>Demo reÅ¾im</strong> â€” skÃºÅ¡ate si Gerlach bez registrÃ¡cie. VÅ¡etko funguje rovnako, iba dÃ¡ta sa uloÅ¾ia len do prehliadaÄa (zmaÅ¾Ãº sa po zatvorenÃ­ karty v prehliadaÄi).</span>
    <a href="#" id="demoBannerCreateAccount">VytvoriÅ¥ ÃºÄet zadarmo</a>
  </div>

  <!-- Header -->
  <header class="app-header">
    <div class="app-header-inner">
      <div style="display:flex; align-items:center; gap:0.625rem;">
        <span style="font-family:'DM Sans','Lexend',sans-serif; font-weight:700; font-size:1.0625rem; letter-spacing:-0.02em; cursor:pointer;" id="headerLogo" title="Gerlach">Gerlach</span>
        <span class="version-badge beta" id="versionBadge">Beta v0.1</span>
      </div>
      <div style="display:flex; align-items:center; gap:1rem;">
      <span class="sync-indicator">
        <span class="sync-dot" id="syncDot"></span>
        <span id="syncLabel" class="sync-label-text">â€“</span>
      </span>
      <div style="display:flex; align-items:center; gap:0.5rem; position:relative;">
        <div class="user-avatar" id="userAvatar" onclick="document.getElementById('userMenu').classList.toggle('open')" style="cursor:pointer;">?</div>
        <button class="btn-ghost" id="btnLogout" style="padding:0.375rem 0.75rem;">OdhlÃ¡siÅ¥</button>
        <button class="mobile-logout-btn" onclick="document.getElementById('btnLogout').click();" style="display:none; background:none; border:1px solid var(--c-border); border-radius:0.5rem; padding:0.375rem 0.75rem; font-size:0.875rem; cursor:pointer; color:var(--c-muted); font-family:'Lexend',sans-serif; align-items:center; gap:0.375rem; font-weight:500;">OdhlÃ¡siÅ¥</button>
        <!-- Mobile user menu -->
        <div id="userMenu" style="display:none; position:absolute; top:calc(100% + 8px); right:0; background:white; border:1.5px solid var(--c-border); border-radius:0.875rem; padding:0.5rem; min-width:160px; box-shadow:0 8px 24px rgba(0,0,0,0.12); z-index:200;">
          <div id="userMenuName" style="font-size:0.8rem; font-weight:600; padding:0.5rem 0.75rem; color:var(--c-muted); border-bottom:1px solid var(--c-border); margin-bottom:0.375rem;"></div>
          <button onclick="document.getElementById('userMenu').classList.remove('open'); document.getElementById('btnLogout').click();" style="width:100%; text-align:left; background:none; border:none; padding:0.5rem 0.75rem; font-size:0.875rem; cursor:pointer; border-radius:0.625rem; color:#dc2626; font-family:'Lexend',sans-serif; font-weight:500;">
            ğŸšª OdhlÃ¡siÅ¥ sa
          </button>
        </div>
      </div>
    </div>
    </div><!-- end app-header-inner -->
  </header>

  <!-- Tab Bar (Desktop) -->
  <div class="tab-bar top-tabs" style="position:sticky; top:60px; z-index:49;">
    <div class="tab-bar-inner">
    <button class="tab-btn active" data-tab="preparation" onclick="switchTab('preparation')">
      <span class="tab-emoji">ğŸ’</span> PrÃ­prava
    </button>
    <button class="tab-btn" data-tab="plan" onclick="switchTab('plan')">
      <span class="tab-emoji">ğŸ“‹</span> PlÃ¡n
    </button>
    <button class="tab-btn" data-tab="knowledge" onclick="switchTab('knowledge')">
      <span class="tab-emoji">ğŸ“–</span> Vedomosti
    </button>
    <button class="tab-btn" data-tab="contacts" onclick="switchTab('contacts')">
      <span class="tab-emoji">ğŸ“</span> Kontakty
    </button>
    </div>
  </div>

  <div class="app-main-padding" id="appMain" style="max-width:1100px; margin:0 auto; padding:1.5rem 1rem;">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB A: MOJA PRÃPRAVA â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-pane active" id="tabPreparation">

      <!-- Hero Banner (merged profile + progress) -->
      <div class="hero-banner" id="heroBanner"></div>

      <!-- Onboarding (for new users without profile) -->
      <div id="onboardingCard" style="display:none;">
        <div class="onboarding-card">
          <div style="font-size:3rem; margin-bottom:1rem;">ğŸ”ï¸</div>
          <h2>Vitajte v Gerlachu</h2>
          <p>ZaÄneme tÃ½m, Å¾e si nastavÃ­me vÃ¡Å¡ profil domÃ¡cnosti.<br>PodÄ¾a neho vypoÄÃ­tame, Äo presne potrebujete pripraviÅ¥.</p>
          <button class="btn-primary" onclick="openProfileEditor()">NastaviÅ¥ domÃ¡cnosÅ¥ â†’</button>
        </div>
      </div>

      <!-- Alerts -->
      <div class="card" id="alertsSection" style="display:none;">
        <h2 style="font-size:1rem; font-weight:700; margin-bottom:0.25rem;">âš ï¸ Upozornenia</h2>
        <p style="font-size:0.75rem; color:var(--c-muted); margin-bottom:0.75rem;">ÄŒo sa blÃ­Å¾i a oplatÃ­ sa rieÅ¡iÅ¥ teraz</p>
        <div id="alertsBox"></div>
      </div>

      <!-- Categories Grid -->
      <div id="onboardingTip" style="display:none; margin-bottom:0.75rem;">
        <div style="background:linear-gradient(135deg, #ecfdf5, #d1fae5); border:1.5px solid #6ee7b7; border-radius:1rem; padding:1rem 1.25rem; display:flex; align-items:center; gap:0.875rem; animation:tipSlideIn 0.4s ease-out; cursor:pointer;" onclick="this.parentElement.style.display='none'">
          <span style="font-size:1.5rem; flex-shrink:0;">ğŸ¯</span>
          <div>
            <div style="font-size:0.85rem; font-weight:700; color:#065f46; line-height:1.3;">VÃ½borne! Profil je nastavenÃ½.</div>
            <div style="font-size:0.75rem; color:#047857; margin-top:0.2rem; line-height:1.4;">Teraz kliknite na Ä¾ubovoÄ¾nÃº kategÃ³riu niÅ¾Å¡ie a zaÄnite pridÃ¡vaÅ¥ poloÅ¾ky. ZaÄnite tam, kde vÃ¡m to dÃ¡va najvÃ¤ÄÅ¡Ã­ zmysel.</div>
          </div>
          <span style="font-size:0.7rem; color:#6ee7b7; flex-shrink:0;">âœ•</span>
        </div>
      </div>
      <div id="categoriesSection">
        <h2 class="cats-heading" style="font-family:'Lexend',sans-serif; font-weight:700; font-size:1.275rem; margin-bottom:0.25rem;">ÄŒo maÅ¥ po ruke</h2>
        <p style="font-size:0.78rem; color:var(--c-muted); margin-bottom:0.75rem; line-height:1.4;">Nakupujte postupne, odÅ¡krtÃ¡vajte priebeÅ¾ne.</p>
        <div id="categoriesGrid" class="categories-grid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:0.75rem;"></div>
      </div>

    </div><!-- end tabPreparation -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB B: PLÃN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-pane" id="tabPlan">

      <div class="zone-intro">EvakuaÄnÃ© batohy a rodinnÃ½ krÃ­zovÃ½ plÃ¡n â€“ dohodnite sa vopred, pripravte sa vÄas.</div>

      <!-- EvakuaÄnÃ© batohy -->
      <div class="card" id="evacBagsSection">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:0.875rem; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <h2 style="font-size:1.2rem; font-weight:700;">ğŸ’ EvakuaÄnÃ© batohy</h2>
            <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">OsobnÃ½ evakuaÄnÃ½ batoh pre kaÅ¾dÃ©ho Älena domÃ¡cnosti â€“ pripravenÃ½, skontrolovanÃ½, pri dverÃ¡ch s topÃ¡nkami</p>
          </div>
          <button class="btn-ghost" id="btnRegenBags" style="font-size:0.72rem; padding:0.3rem 0.6rem; display:none;">ğŸ”„ PregenerovaÅ¥</button>
        </div>
        <div id="evacBagsContainer"></div>
      </div>

      <!-- RodinnÃ½ krÃ­zovÃ½ plÃ¡n -->
      <div class="card">
        <div style="margin-bottom:1rem;">
          <h2 style="font-size:1.2rem; font-weight:700;">ğŸ“‹ RodinnÃ½ krÃ­zovÃ½ plÃ¡n</h2>
          <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">Dohodnite sa vopred. KeÄ vypadne signÃ¡l a internet, budete vedieÅ¥ Äo robiÅ¥ a kde sa nÃ¡jsÅ¥.</p>
        </div>
        <div style="background:#fef2f2; border:1px solid #fecaca; border-radius:0.75rem; padding:0.625rem 0.875rem; margin-bottom:1rem; font-size:0.78rem; color:#991b1b; line-height:1.6;">
          <strong>âš ï¸</strong> MobilnÃ¡ sieÅ¥ je preÅ¥aÅ¾enÃ¡ do <strong>15â€“30 minÃºt</strong> od zaÄiatku krÃ­zy. Bez plÃ¡nu sa rodina nemusÃ­ nÃ¡jsÅ¥. <strong>VytlaÄte</strong> a dajte kÃ³piu kaÅ¾dÃ©mu Älenovi rodiny.
        </div>
        <div id="meetingPointBox"></div>
        <div style="margin-top:1rem;">
          <div class="section-label">KrÃ­zovÃ© scenÃ¡re â€“ kto, Äo, kam?</div>
          <div class="info-collapse" style="background:var(--c-bg); margin-bottom:0.75rem;">
            <button class="info-collapse-toggle" style="color:var(--c-text);" onclick="this.closest('.info-collapse').classList.toggle('open')">
              <span>ğŸ’¡ Ako pracovaÅ¥ so scenÃ¡rmi</span>
              <span class="info-collapse-arrow">â–¼</span>
            </button>
            <div class="info-collapse-body" style="font-size:0.75rem; color:var(--c-muted); line-height:1.6;">
              Prejdite si kaÅ¾dÃ½ scenÃ¡r a doplÅˆte konkrÃ©tne menÃ¡, miesta a Ãºlohy. KrÃ­zovÃ½ plÃ¡n funguje len ak ho <strong>poznajÃº vÅ¡etci Älenovia rodiny</strong> â€“ vrÃ¡tane detÃ­ od 6 rokov. IdeÃ¡lne si plÃ¡n <strong>raz za rok precviÄte</strong> (napr. pri skÃºÅ¡ke sirÃ©n).
            </div>
          </div>
          <div id="scenariosBox" style="display:flex; flex-direction:column; gap:0.75rem;"></div>
        </div>
        <div class="info-collapse" style="background:#eff6ff; border:1px solid #bfdbfe; margin-top:1rem;">
          <button class="info-collapse-toggle" style="color:#1e40af;" onclick="this.closest('.info-collapse').classList.toggle('open')">
            <span>ğŸ“± KomunikaÄnÃ½ plÃ¡n (ak telefÃ³ny nefungujÃº)</span>
            <span class="info-collapse-arrow">â–¼</span>
          </button>
          <div class="info-collapse-body" style="font-size:0.78rem; color:#1e40af; line-height:1.7;">
            <p style="margin:0 0 0.375rem;"><strong>1)</strong> PoÅ¡lite <strong>SMS</strong> â€“ prechÃ¡dza aj pri slabom signÃ¡li, keÄ hovory neprechÃ¡dzajÃº.</p>
            <p style="margin:0 0 0.375rem;"><strong>2)</strong> Dohodnite si <strong>kontaktnÃº osobu mimo regiÃ³nu</strong> â€“ cez Åˆu sa vÅ¡etci nahlÃ¡sia.</p>
            <p style="margin:0 0 0.375rem;"><strong>3)</strong> Nechajte <strong>lÃ­stok na dverÃ¡ch</strong> s informÃ¡ciou kedy a kam ste odiÅ¡li.</p>
            <p style="margin:0 0 0.375rem;"><strong>4)</strong> StretÃ¡vajte sa na <strong>dohodnutom mieste</strong> â€“ pravidlo: poÄkaj 30 min, prÃ­Ä znova o interval.</p>
            <p style="margin:0;"><strong>5)</strong> Ak mÃ¡te internet â€“ <strong>Google crisis response</strong>, sociÃ¡lne siete (status â€som v bezpeÄÃ­â€).</p>
          </div>
        </div>
      </div>


    </div><!-- end tabPlan -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB C: VEDOMOSTI â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-pane" id="tabKnowledge">

      <div class="zone-intro">NemusÃ­te si vÅ¡etko pamÃ¤taÅ¥ â€” staÄÃ­ vedieÅ¥, kde hÄ¾adaÅ¥.</div>

      <!-- PrvÃ¡ pomoc -->
      <div class="card">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.875rem; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <h2 style="font-size:1.2rem; font-weight:700;">ğŸ¥ PrvÃ¡ pomoc</h2>
            <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">ZÃ¡kladnÃ© postupy prvej pomoci, keÄ ide o minÃºty</p>
          </div>
          <div style="display:flex; gap:0.5rem; align-items:center;">
            <a href="tel:112" style="display:inline-flex; align-items:center; gap:0.375rem; background:#dc2626; color:white; border-radius:0.625rem; padding:0.4rem 0.75rem; font-size:0.78rem; font-weight:700; text-decoration:none; font-family:'Lexend',sans-serif;">ğŸ“ 112</a>
            <a href="tel:155" style="display:inline-flex; align-items:center; gap:0.375rem; background:#1e40af; color:white; border-radius:0.625rem; padding:0.4rem 0.75rem; font-size:0.78rem; font-weight:700; text-decoration:none; font-family:'Lexend',sans-serif;">ğŸš‘ 155</a>
          </div>
        </div>
        <div id="firstAidGrid" class="fa-grid"></div>
      </div>

      <!-- Postupy pri MU -->
      <div class="card">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.875rem; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <h2 style="font-size:1.2rem; font-weight:700;">âš ï¸ Postupy pri mimoriadnych udalostiach</h2>
            <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">PrehÄ¾adnÃ© odporÃºÄania, Äo robiÅ¥ krok po kroku</p>
          </div>
        </div>
        <div id="emergencyProcGrid" class="mu-grid"></div>
      </div>

      <!-- VarovnÃ© signÃ¡ly sirÃ©n -->
      <div class="card">
        <div style="margin-bottom:0.875rem;">
          <h2 style="font-size:1.2rem; font-weight:700;">ğŸ”” VarovnÃ© signÃ¡ly sirÃ©n</h2>
          <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">Rozoznajte signÃ¡ly, pochopte ich vÃ½znam a vedzte Äo robiÅ¥</p>
        </div>
        <div style="background:#fef2f2; border:1px solid #fecaca; border-radius:0.75rem; padding:0.625rem 0.875rem; margin-bottom:0.75rem; font-size:0.78rem; color:#991b1b; line-height:1.6;">
          <strong>âš ï¸</strong> Ak zaznie sirÃ©na a nie je oznÃ¡menÃ¡ skÃºÅ¡ka â€“ berte to vÃ¡Å¾ne. Vojdite do budovy a zapnite rÃ¡dio.
        </div>
        <div id="sirensGrid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:0.625rem;"></div>
        <div class="info-collapse" style="background:var(--c-bg); margin-top:0.75rem;">
          <button class="info-collapse-toggle" style="color:var(--c-text);" onclick="this.closest('.info-collapse').classList.toggle('open')">
            <span>ğŸ’¡ SkÃºÅ¡ka sirÃ©n a ÄalÅ¡ie informÃ¡cie</span>
            <span class="info-collapse-arrow">â–¼</span>
          </button>
          <div class="info-collapse-body" style="font-size:0.78rem; color:var(--c-muted); line-height:1.6;">
            <p style="margin:0 0 0.5rem;"><strong style="color:var(--c-text);">SkÃºÅ¡ka sirÃ©n:</strong> KaÅ¾dÃ½ <strong>druhÃ½ piatok v mesiaci o 12:00</strong> prebieha pravidelnÃ¡ skÃºÅ¡ka (2 min stÃ¡ly tÃ³n). O skÃºÅ¡kach informujÃº vopred mÃ©diÃ¡. Ak poÄujete sirÃ©nu mimo tohto termÃ­nu â€“ <strong>nie je to skÃºÅ¡ka</strong>.</p>
            <p style="margin:0; font-size:0.72rem;">Rozoznajte typ tÃ³nu: kolÃ­savÃ½ = vÅ¡eobecnÃ© ohrozenie, stÃ¡ly = koniec ohrozenia. Pri kolÃ­savom tÃ³ne vojdite do budovy, zatvorte oknÃ¡, zapnite rÃ¡dio.</p>
          </div>
        </div>
      </div>

      <!-- NÃºdzovÃ© vysielanie rÃ¡dia -->
      <div class="card">
        <div style="margin-bottom:0.875rem;">
          <h2 style="font-size:1.2rem; font-weight:700;">ğŸ“» NÃºdzovÃ© vysielanie rÃ¡dia</h2>
          <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">Frekvencie pre prÃ­jem krÃ­zovÃ½ch informÃ¡ciÃ­ â€“ fungujÃº aj bez internetu a mobilnej siete</p>
        </div>
        <div style="background:#fef2f2; border:1px solid #fecaca; border-radius:0.75rem; padding:0.625rem 0.875rem; margin-bottom:0.75rem; font-size:0.78rem; color:#991b1b; line-height:1.6;">
          <strong>ğŸ“¡</strong> Pri vÃ½padku elektriny a internetu je FM rÃ¡dio na batÃ©rie jedinÃ½ spoÄ¾ahlivÃ½ zdroj informÃ¡ciÃ­. <strong>RÃ¡dio na batÃ©rie patrÃ­ do kaÅ¾dej domÃ¡cnosti.</strong>
        </div>
        <div id="radioGrid" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:0.625rem;"></div>
        <div class="info-collapse" style="background:#eff6ff; border:1px solid #bfdbfe; margin-top:0.75rem;">
          <button class="info-collapse-toggle" style="color:#1e40af;" onclick="this.closest('.info-collapse').classList.toggle('open')">
            <span>â„¹ï¸ Tipy pre nÃºdzovÃ© rÃ¡dio</span>
            <span class="info-collapse-arrow">â–¼</span>
          </button>
          <div class="info-collapse-body" style="font-size:0.78rem; color:#1e40af; line-height:1.6;">
            <p style="margin:0 0 0.5rem;">ZapÃ­Å¡te si frekvenciu pre vÃ¡Å¡ regiÃ³n na papier a vloÅ¾te ho k rÃ¡diu na batÃ©rie. V krÃ­zovej situÃ¡cii nemusÃ­te niÄ hÄ¾adaÅ¥.</p>
            <p style="margin:0;"><strong>RÃ¡dio Slovensko</strong> a <strong>RÃ¡dio Regina</strong> sÃº prioritnÃ© stanice pre nÃºdzovÃ© hlÃ¡senia podÄ¾a ZÃ¡kona o civilnej ochrane. MobilnÃ¡ sieÅ¥ a internet mÃ´Å¾u zlyhaÅ¥ â€“ rÃ¡dio vysiela vÅ¾dy.</p>
          </div>
        </div>
      </div>

    </div><!-- end tabKnowledge -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TAB D: KONTAKTY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="tab-pane" id="tabContacts">

      <div class="zone-intro">TiesÅˆovÃ© linky, poruchovÃ© sluÅ¾by a vaÅ¡e osobnÃ© kontakty na jednom mieste â€“ offline prÃ­stupnÃ©, keÄ to najviac potrebujete.</div>

      <!-- DÃ´leÅ¾itÃ© kontakty (Å¡tÃ¡tne) -->
      <div class="card">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.875rem; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <h2 style="font-size:1.2rem; font-weight:700;">ğŸ“ TiesÅˆovÃ© kontakty</h2>
            <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">TiesÅˆovÃ© linky, poruchovÃ© sluÅ¾by a kÄ¾ÃºÄovÃ© inÅ¡titÃºcie SR</p>
          </div>
        </div>
        <div style="margin-bottom:1rem;">
          <div class="section-label">TiesÅˆovÃ© linky</div>
          <div class="ec-grid" id="emergencyLinesGrid"></div>
        </div>
        <div>
          <div class="section-label">InÅ¡titÃºcie, krÃ­zovÃ© linky a poruchovÃ© sluÅ¾by</div>
          <div id="institutionsGrid" style="display:flex; flex-direction:column; gap:0.5rem;"></div>
        </div>
      </div>

      <!-- OsobnÃ© kontakty -->
      <div class="card">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.875rem; flex-wrap:wrap; gap:0.5rem;">
          <div>
            <h2 style="font-size:1.2rem; font-weight:700;">ğŸ‘¤ OsobnÃ© kontakty</h2>
            <p style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">LekÃ¡ri, poisÅ¥ovne, sluÅ¾by a Ä¾udia, na ktorÃ½ch sa spoÄ¾ahnete</p>
          </div>
          <button class="btn-ghost" id="btnAddPersonalContact" style="font-size:0.78rem; padding:0.375rem 0.75rem;">+ PridaÅ¥ kontakt</button>
        </div>
        <div id="personalContactsGrid" style="display:flex; flex-direction:column; gap:0.5rem;"></div>
      </div>

    </div><!-- end tabContacts -->

  </div><!-- end app-main-padding -->

  <!-- Bottom Nav (Mobile) -->
  <div class="bottom-nav" id="bottomNav">
    <button class="tab-btn active" data-tab="preparation" onclick="switchTab('preparation')">
      <span class="tab-emoji">ğŸ’</span> PrÃ­prava
    </button>
    <button class="tab-btn" data-tab="plan" onclick="switchTab('plan')">
      <span class="tab-emoji">ğŸ“‹</span> PlÃ¡n
    </button>
    <button class="tab-btn" data-tab="knowledge" onclick="switchTab('knowledge')">
      <span class="tab-emoji">ğŸ“–</span> Vedomosti
    </button>
    <button class="tab-btn" data-tab="contacts" onclick="switchTab('contacts')">
      <span class="tab-emoji">ğŸ“</span> Kontakty
    </button>
  </div>

  <!-- SOS Floating Button (quick access to First Aid) -->
  <button class="sos-fab" id="sosFab" onclick="switchTab('knowledge'); setTimeout(() => { const fa = document.getElementById('firstAidGrid'); if(fa) fa.scrollIntoView({behavior:'smooth', block:'start'}); }, 150);" aria-label="SOS â€“ PrvÃ¡ pomoc">
    <span class="sos-fab-icon">ğŸ†˜</span>
    <span class="sos-fab-label">SOS</span>
  </button>

</div><!-- end appScreen -->

<!-- Modal: EmailJS technickÃ¡ konfigurÃ¡cia -->
<div class="modal-overlay" id="modalEmailJSInfo">
  <div class="modal-box" style="max-width:420px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem;">
      <h3 style="font-family:'Lexend',sans-serif; font-weight:700; font-size:1rem;">âš™ï¸ TechnickÃ¡ poznÃ¡mka pre sprÃ¡vcu</h3>
      <button data-close="modalEmailJSInfo" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem;">âœ•</button>
    </div>
    <div style="font-size:0.8rem; color:var(--c-muted); line-height:1.6;">
      <p style="margin-bottom:0.5rem;">EmailovÃ© pripomienky vyuÅ¾Ã­vajÃº sluÅ¾bu <strong>EmailJS</strong>. Pre aktivÃ¡ciu je potrebnÃ© nastaviÅ¥ konfigurÃ¡ciu:</p>
      <div style="background:var(--c-bg); border-radius:0.5rem; padding:0.75rem; margin:0.5rem 0; font-family:monospace; font-size:0.72rem; line-height:1.5;">
        publicKey: "S9KjZEwsiiUC69fX-XqbK"<br>
        serviceId: "service_h4jkdfs"
      </div>
      <p style="margin-top:0.5rem;">Email sa odosiela max 1Ã— za 24 hodÃ­n. Upozornenia na expirÃ¡ciu podÄ¾a nastavenÃ­ sledovania + nÃ¡kupnÃ½ zoznam (14 dnÃ­ pred).</p>
    </div>
  </div>
</div>

<!-- Modal: Profile -->
<div class="modal-overlay" id="modalProfile">
  <div class="modal-box" style="max-width:640px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1.5rem;">
      <div>
        <h3 style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.25rem; margin:0;">VaÅ¡a domÃ¡cnosÅ¥</h3>
        <p style="font-size:0.8rem; color:var(--c-muted); margin:0.25rem 0 0;">PodÄ¾a tÃ½chto Ãºdajov vypoÄÃ­tame, Äo mÃ¡ pre vaÅ¡u domÃ¡cnosÅ¥ zmysel pripraviÅ¥.</p>
      </div>
      <button data-close="modalProfile" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem; flex-shrink:0; margin-left:1rem;">âœ•</button>
    </div>

    <form id="profileForm" style="display:grid; gap:1rem;">

      <!-- â”€â”€ ZÃKLADNÃ‰ NASTAVENIA â”€â”€ -->

      <!-- PoÄet osÃ´b -->
      <div class="card-section">
        <div style="font-size:0.8rem; font-weight:700; color:var(--c-text); margin-bottom:0.75rem;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ PoÄet osÃ´b v domÃ¡cnosti</div>
        <div class="persons-grid" style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:0.625rem;">
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.3rem; white-space:nowrap;">DospelÃ­ (13â€“64)</label>
            <input name="adults" type="number" min="0" value="0"
              onfocus="if(this.value==='0')this.value=''"
              onblur="if(this.value==='')this.value='0'" style="text-align:center; font-weight:600; font-size:0.9rem;" />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.3rem; white-space:nowrap;">Deti (1â€“12)</label>
            <input name="kids" type="number" min="0" value="0"
              onfocus="if(this.value==='0')this.value=''"
              onblur="if(this.value==='')this.value='0'" style="text-align:center; font-weight:600; font-size:0.9rem;" />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.3rem; white-space:nowrap;">DojÄatÃ¡ (0â€“1)</label>
            <input name="infants" type="number" min="0" value="0"
              onfocus="if(this.value==='0')this.value=''"
              onblur="if(this.value==='')this.value='0'" style="text-align:center; font-weight:600; font-size:0.9rem;" />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.3rem; white-space:nowrap;">Seniori (65+)</label>
            <input name="seniors" type="number" min="0" value="0"
              onfocus="if(this.value==='0')this.value=''"
              onblur="if(this.value==='')this.value='0'" style="text-align:center; font-weight:600; font-size:0.9rem;" />
          </div>
        </div>
      </div>

      <!-- PoÄet dnÃ­ + Typ bÃ½vania -->
      <div class="profile-days-housing" style="display:grid; grid-template-columns:1fr 1fr; gap:0.75rem; align-items:start;">
        <!-- PoÄet dnÃ­ sebestaÄnosti -->
        <div class="prepdays-row" class="card-section">
          <div style="font-size:0.8rem; font-weight:700; color:var(--c-text);">ğŸ“… PoÄet dnÃ­ sebestaÄnosti</div>
          <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.2rem; margin-bottom:0.75rem; line-height:1.4;">Minimum 3 dni. Pre vÃ¤ÄÅ¡Ã­ pocit istoty odporÃºÄame 7 dnÃ­.</div>
          <input name="prepDays" type="number" min="1" max="30" value="3"
            onfocus="if(this.value==='3' && !this._touched)this.value=''"
            onblur="if(this.value===''){this.value='3'} this._touched=true;"
            style="width:100%; text-align:center; font-weight:600; font-size:0.9rem;" />
        </div>

        <!-- Typ bÃ½vania -->
        <div class="card-section">
          <div style="font-size:0.8rem; font-weight:700; color:var(--c-text); margin-bottom:0.2rem;">ğŸ  Typ bÃ½vania</div>
          <div style="font-size:0.72rem; color:var(--c-muted); margin-bottom:0.75rem; line-height:1.4;">OvplyvÅˆuje niektorÃ© odporÃºÄania.</div>
          <div style="display:flex; flex-direction:column; gap:0.5rem;">
            <label style="display:flex; align-items:center; gap:0.625rem; padding:0.5rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
              <input type="radio" name="housing" value="flat" style="accent-color:var(--c-accent); flex-shrink:0;" />
              <div style="font-size:0.78rem; font-weight:600; line-height:1.3;">Byt <span style="font-weight:400; color:var(--c-muted);">â€“ panelÃ¡k / bytovka</span></div>
            </label>
            <label style="display:flex; align-items:center; gap:0.625rem; padding:0.5rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
              <input type="radio" name="housing" value="rd" style="accent-color:var(--c-accent); flex-shrink:0;" />
              <div style="font-size:0.78rem; font-weight:600; line-height:1.3;">RodinnÃ½ dom</div>
            </label>
            <label style="display:flex; align-items:center; gap:0.625rem; padding:0.5rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
              <input type="radio" name="housing" value="rd_cellar" style="accent-color:var(--c-accent); flex-shrink:0;" />
              <div style="font-size:0.78rem; font-weight:600; line-height:1.3;">RD + pivnica <span style="font-weight:400; color:var(--c-muted);">/ garÃ¡Å¾</span></div>
            </label>
          </div>
        </div>
      </div>

      <!-- â”€â”€ POKROÄŒILÃ‰ NASTAVENIA (collapsible) â”€â”€ -->
      <div id="profileAdvanced">
        <button type="button" id="profileAdvancedToggle" style="width:100%; display:flex; align-items:center; justify-content:space-between; background:none; border:1.5px solid var(--c-border); border-radius:0.875rem; padding:0.75rem 1rem; cursor:pointer; font-family:'Lexend',sans-serif; font-size:0.82rem; font-weight:600; color:var(--c-muted); transition:background 0.15s, border-color 0.15s;" onmouseover="this.style.background='var(--c-bg)'" onmouseout="this.style.background='none'">
          <span>âš™ï¸ PokroÄilÃ© nastavenia</span>
          <span id="profileAdvancedArrow" style="font-size:0.7rem; transition:transform 0.25s;">â–¼</span>
        </button>
        <div id="profileAdvancedContent" style="display:none; margin-top:0.75rem; gap:0.75rem;">

          <!-- ÃšroveÅˆ + NÃ¡kladovosÅ¥ -->
          <div class="profile-3col" style="display:grid; grid-template-columns:1fr 1fr; gap:0.75rem; align-items:start;">
            <!-- ÃšroveÅˆ pripravenosti -->
            <div class="card-section">
              <div style="font-size:0.8rem; font-weight:700; color:var(--c-text); margin-bottom:0.2rem;">ğŸ›¡ï¸ ÃšroveÅˆ zÃ¡sob</div>
              <div style="font-size:0.72rem; color:var(--c-muted); margin-bottom:0.75rem; line-height:1.4;">UrÄuje vÃ½slednÃ½ komfort v Äase krÃ­zy.</div>
              <div style="display:flex; flex-direction:column; gap:0.5rem;">
                <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
                  <input type="radio" name="readiness" value="standard" style="accent-color:var(--c-accent); flex-shrink:0;" />
                  <div>
                    <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">OdporÃºÄanÃ¡</div>
                    <div style="font-size:0.7rem; color:var(--c-muted);">PodÄ¾a prÃ­ruÄiek</div>
                  </div>
                </label>
                <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
                  <input type="radio" name="readiness" value="enhanced" style="accent-color:var(--c-accent); flex-shrink:0;" />
                  <div>
                    <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">ZvÃ½Å¡enÃ¡</div>
                    <div style="font-size:0.7rem; color:var(--c-muted);">+30% viac zÃ¡sob</div>
                  </div>
                </label>
              </div>
            </div>

            <!-- NÃ¡kladovosÅ¥ -->
            <div class="card-section">
              <div style="font-size:0.8rem; font-weight:700; color:var(--c-text); margin-bottom:0.2rem;">ğŸ’° NÃ¡kladovosÅ¥</div>
              <div style="font-size:0.72rem; color:var(--c-muted); margin-bottom:0.75rem; line-height:1.4;">CenovÃ¡ kategÃ³ria odporÃºÄanÃ½ch produktov.</div>
              <div style="display:flex; flex-direction:column; gap:0.5rem;">
                <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
                  <input type="radio" name="budget" value="mid" style="accent-color:var(--c-accent); flex-shrink:0;" />
                  <div>
                    <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">ZÃ¡kladnÃ¡</div>
                    <div style="font-size:0.7rem; color:var(--c-muted);">Kvalita za rozumnÃº cenu</div>
                  </div>
                </label>
                <label style="display:flex; align-items:center; gap:0.625rem; padding:0.625rem 0.75rem; border-radius:0.75rem; border:1.5px solid var(--c-border); background:white; cursor:pointer;">
                  <input type="radio" name="budget" value="premium" style="accent-color:var(--c-accent); flex-shrink:0;" />
                  <div>
                    <div style="font-size:0.8rem; font-weight:600; line-height:1.2;">PrÃ©miovÃ¡</div>
                    <div style="font-size:0.7rem; color:var(--c-muted);">Bez kompromisov</div>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <!-- Nastavenia: Sledovanie expirÃ¡cie -->
          <div class="card-section">
            <div style="font-size:0.8rem; font-weight:700; color:var(--c-text); margin-bottom:0.2rem;">â° Sledovanie expirÃ¡cie</div>
            <div style="font-size:0.72rem; color:var(--c-muted); margin-bottom:0.75rem; line-height:1.4;">UpozornÃ­me vÃ¡s na poloÅ¾ky, ktorÃ½m sa blÃ­Å¾i dÃ¡tum spotreby.</div>
            <div style="display:flex; flex-wrap:wrap; gap:0.625rem;">
              <div style="display:flex; align-items:center; gap:0.375rem; background:#fef2f2; border:1px solid #fecaca; border-radius:0.625rem; padding:0.375rem 0.625rem;">
                <span style="font-size:0.75rem; font-weight:600; color:#dc2626;">ğŸ©º Lieky</span>
                <select id="alertDaysMeds" style="width:auto; font-size:0.75rem; padding:0.2rem 0.4rem; border-radius:0.375rem; border:1px solid #fecaca; background:white; color:#dc2626; font-weight:600;">
                  <option value="270">9 mesiacov</option>
                  <option value="180" selected>6 mesiacov</option>
                  <option value="90">3 mesiace</option>
                  <option value="30">1 mesiac</option>
                </select>
              </div>
              <div style="display:flex; align-items:center; gap:0.375rem; background:#eff6ff; border:1px solid #bfdbfe; border-radius:0.625rem; padding:0.375rem 0.625rem;">
                <span style="font-size:0.75rem; font-weight:600; color:#1e40af;">ğŸ¥« Potraviny a voda</span>
                <select id="alertDaysFood" style="width:auto; font-size:0.75rem; padding:0.2rem 0.4rem; border-radius:0.375rem; border:1px solid #bfdbfe; background:white; color:#1e40af; font-weight:600;">
                  <option value="270">9 mesiacov</option>
                  <option value="180">6 mesiacov</option>
                  <option value="90">3 mesiace</option>
                  <option value="30" selected>1 mesiac</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Nastavenia: EmailovÃ© pripomienky -->
          <div id="emailSettingsInProfile" class="card-section">
            <div style="display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:0.5rem;">
              <div>
                <div style="font-size:0.8rem; font-weight:700; color:var(--c-text);">âœ‰ï¸ EmailovÃ© pripomienky</div>
                <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.2rem;" id="emailNotifStatus">Pripomienky zatiaÄ¾ nie sÃº aktÃ­vne</div>
              </div>
              <div style="display:flex; gap:0.375rem;">
                <button type="button" id="btnTestEmail" onclick="sendTestNotification()" class="btn-ghost" style="font-size:0.72rem; padding:0.3rem 0.625rem;">TestovacÃ­ email</button>
                <button type="button" onclick="document.getElementById('modalEmailJSInfo').classList.add('open')" class="btn-ghost" style="font-size:0.65rem; padding:0.3rem 0.4rem; color:var(--c-muted);">âš™ï¸</button>
              </div>
            </div>
          </div>

        </div><!-- end profileAdvancedContent -->
      </div>

      <div style="display:flex; justify-content:flex-end; padding-top:0.25rem;">
        <button type="submit" class="btn-primary" style="padding:0.75rem 2.5rem; font-size:0.9375rem;">UloÅ¾iÅ¥ profil</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: KategÃ³ria Detail -->
<div class="modal-overlay" id="modalCategory">
  <div class="modal-box" style="max-width:680px;">
    <div class="modal-header">
      <div id="modalCatHeader" style="flex:1; min-width:0;"></div>
      <button data-close="modalCategory" class="modal-close">âœ•</button>
    </div>
    <div id="categoryDetail" style="max-height:65vh; overflow-y:auto; padding-right:0.25rem;"></div>
    <div style="display:flex; align-items:center; justify-content:space-between; padding-top:1rem; margin-top:0.5rem; border-top:1px solid var(--c-border);">
      <span id="modalCatProgress" style="font-size:0.8rem; color:var(--c-muted);"></span>
      <button class="btn-primary" id="btnAddItem" style="display:flex; align-items:center; gap:0.5rem;">
        <span style="font-size:1.1rem; line-height:1;">+</span> PridaÅ¥ poloÅ¾ku
      </button>
    </div>
  </div>
</div>

<!-- Modal: Add / Edit Item -->
<div class="modal-overlay" id="modalAddItem">
  <div class="modal-box" style="max-width:480px;">
    <div class="modal-header">
      <h3 id="itemModalTitle" style="font-family:'Lexend',sans-serif; font-weight:700; font-size:1.125rem;">PridaÅ¥ poloÅ¾ku</h3>
      <button data-close="modalAddItem" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem;">âœ•</button>
    </div>
    <form id="addItemForm" style="display:grid; gap:0.75rem;">
      <input type="hidden" name="editIndex" value="-1" />
      <div>
        <label id="itemLabelName" class="item-label-light">NÃ¡zov *</label>
        <input name="name" type="text" required />
      </div>
      <div id="itemFieldQtyRow" style="display:grid; grid-template-columns:1fr 1fr; gap:0.75rem;">
        <div id="itemFieldQty">
          <label id="itemLabelQty" class="item-label-light">MnoÅ¾stvo</label>
          <input name="qty" type="text" placeholder="napr. 5 ks" />
        </div>
        <div id="itemFieldExpiry">
          <label class="item-label-light">ExpirÃ¡cia</label>
          <input name="expiry" type="date" />
        </div>
      </div>
      <div id="itemFieldDocs" style="display:none;">
        <label class="item-label-light">Typ uloÅ¾enia</label>
        <input name="qty_docs" type="text" placeholder="napr. OriginÃ¡l + scan Cloud + USB kÄ¾ÃºÄ" />
      </div>
      <div id="itemFieldLink">
        <label class="item-label-light">Odkaz (URL)</label>
        <input name="link" type="url" placeholder="https://..." />
      </div>
      <div style="display:flex; justify-content:flex-end; padding-top:0.5rem;">
        <button type="submit" id="btnItemSubmit" class="btn-primary" style="padding:0.75rem 2rem;">PridaÅ¥</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Delete Item Confirmation -->
<div class="modal-overlay" id="modalDeleteItem">
  <div class="modal-box" style="max-width:420px; text-align:center;">
    <div style="font-size:2.5rem; margin-bottom:0.75rem;">ğŸ—‘ï¸</div>
    <h3 id="deleteItemTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0 0 0.5rem;">OdstrÃ¡niÅ¥ poloÅ¾ku?</h3>
    <p id="deleteItemText" style="font-size:0.85rem; color:var(--c-muted); margin:0 0 1.25rem; line-height:1.5;"></p>
    <div style="display:flex; gap:0.625rem; justify-content:center;">
      <button data-close="modalDeleteItem" class="btn-ghost" style="padding:0.625rem 1.5rem; font-size:0.85rem;">ZruÅ¡iÅ¥</button>
      <button id="btnConfirmDelete" class="btn-primary" style="padding:0.625rem 1.5rem; font-size:0.85rem; background:#dc2626;">OdstrÃ¡niÅ¥</button>
    </div>
  </div>
</div>

<!-- Modal: Edit Food Entry -->
<div class="modal-overlay" id="modalFoodEdit">
  <div class="modal-box" style="max-width:440px;">
    <div class="modal-header">
      <h3 style="font-family:'Lexend',sans-serif; font-weight:700; font-size:1.125rem;">âœï¸ UpraviÅ¥ jedlo</h3>
      <button data-close="modalFoodEdit" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem;">âœ•</button>
    </div>
    <form id="foodEditForm" style="display:grid; gap:0.75rem;">
      <input type="hidden" name="fe_catId" />
      <input type="hidden" name="fe_itemIdx" />
      <input type="hidden" name="fe_entryIdx" />
      <div>
        <label class="item-label-light">NÃ¡zov *</label>
        <input name="fe_name" type="text" required />
      </div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.75rem;">
        <div>
          <label class="item-label-light">kcal / kus *</label>
          <input name="fe_kcal" type="number" min="0" required />
        </div>
        <div>
          <label class="item-label-light">PoÄet</label>
          <input name="fe_qty" type="number" min="1" value="1" />
        </div>
      </div>
      <div>
        <label class="item-label-light">ExpirÃ¡cia *</label>
        <input name="fe_expiry" type="date" required />
      </div>
      <div style="display:flex; justify-content:flex-end; padding-top:0.5rem;">
        <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Edit Water Entry -->
<div class="modal-overlay" id="modalWaterEdit">
  <div class="modal-box" style="max-width:440px;">
    <div class="modal-header">
      <h3 style="font-family:'Lexend',sans-serif; font-weight:700; font-size:1.125rem;">âœï¸ UpraviÅ¥ vodu</h3>
      <button data-close="modalWaterEdit" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem;">âœ•</button>
    </div>
    <form id="waterEditForm" style="display:grid; gap:0.75rem;">
      <input type="hidden" name="we_catId" />
      <input type="hidden" name="we_itemIdx" />
      <input type="hidden" name="we_entryIdx" />
      <div>
        <label class="item-label-light">NÃ¡zov *</label>
        <input name="we_name" type="text" required />
      </div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.75rem;">
        <div>
          <label class="item-label-light">Litrov / kus *</label>
          <input name="we_liters" type="number" min="0" step="0.1" required />
        </div>
        <div>
          <label class="item-label-light">PoÄet</label>
          <input name="we_qty" type="number" min="1" value="1" />
        </div>
      </div>
      <div>
        <label class="item-label-light">ExpirÃ¡cia *</label>
        <input name="we_expiry" type="date" required />
      </div>
      <div style="display:flex; justify-content:flex-end; padding-top:0.5rem;">
        <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Edit Cash Entry -->
<div class="modal-overlay" id="modalCashEdit">
  <div class="modal-box" style="max-width:440px;">
    <div class="modal-header">
      <h3 style="font-family:'Lexend',sans-serif; font-weight:700; font-size:1.125rem;">âœï¸ UpraviÅ¥ hotovosÅ¥</h3>
      <button data-close="modalCashEdit" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem;">âœ•</button>
    </div>
    <form id="cashEditForm" style="display:grid; gap:0.75rem;">
      <input type="hidden" name="ce_catId" />
      <input type="hidden" name="ce_itemIdx" />
      <input type="hidden" name="ce_entryIdx" />
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.75rem;">
        <div>
          <label class="item-label-light">Typ</label>
          <select name="ce_type" style="font-size:0.9rem; padding:0.625rem 0.875rem;">
            <option value="bankovka">ğŸ’¶ Bankovka</option>
            <option value="minca">ğŸª™ Minca</option>
          </select>
        </div>
        <div>
          <label class="item-label-light">Hodnota (â‚¬) *</label>
          <input name="ce_value" type="number" min="0" step="0.01" required />
        </div>
      </div>
      <div>
        <label class="item-label-light">PoÄet kusov</label>
        <input name="ce_qty" type="number" min="1" value="1" />
      </div>
      <div style="display:flex; justify-content:flex-end; padding-top:0.5rem;">
        <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Validation Warning -->
<div class="modal-overlay" id="modalValidation">
  <div class="modal-box" style="max-width:400px; text-align:center;">
    <div style="font-size:2.5rem; margin-bottom:0.75rem;">âš ï¸</div>
    <h3 style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0 0 0.5rem;">ChÃ½bajÃºce Ãºdaje</h3>
    <p id="validationText" style="font-size:0.85rem; color:var(--c-muted); margin:0 0 1.25rem; line-height:1.5;"></p>
    <button data-close="modalValidation" class="btn-primary" style="padding:0.625rem 2rem; font-size:0.85rem;">Rozumiem</button>
  </div>
</div>

<!-- Modal: Postup pri MU detail -->
<div class="modal-overlay" id="modalEmergencyProc">
  <div class="modal-box" style="max-width:600px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem;">
      <div style="display:flex; align-items:center; gap:0.75rem; flex:1; min-width:0;">
        <div class="mu-icon" id="muModalIcon" style="flex-shrink:0;"></div>
        <div>
          <h3 id="muModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;"></h3>
          <p id="muModalSubtitle" style="font-size:0.78rem; color:var(--c-muted); margin:0.125rem 0 0;"></p>
        </div>
      </div>
      <button data-close="modalEmergencyProc" class="modal-close">âœ•</button>
    </div>
    <div id="muModalContent" style="max-height:65vh; overflow-y:auto; padding-right:0.25rem;"></div>
  </div>
</div>

<!-- Modal: VarovnÃ½ signÃ¡l detail -->
<div class="modal-overlay" id="modalSiren">
  <div class="modal-box" style="max-width:500px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem;">
      <h3 id="sirenModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;"></h3>
      <button data-close="modalSiren" class="modal-close">âœ•</button>
    </div>
    <div id="sirenModalContent" style="max-height:65vh; overflow-y:auto;"></div>
  </div>
</div>

<!-- Modal: PrvÃ¡ pomoc detail -->

<!-- Modal: OsobnÃ½ kontakt -->

<!-- Modal: EvakuaÄnÃ½ batoh detail -->
<div class="modal-overlay" id="modalEvacBag">
  <div class="modal-box" style="max-width:560px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem;">
      <div style="display:flex; align-items:center; gap:0.75rem; flex:1; min-width:0;">
        <div id="evacBagModalIcon" style="width:48px; height:48px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:1.375rem; flex-shrink:0;"></div>
        <div>
          <h3 id="evacBagModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;"></h3>
          <p id="evacBagModalSubtitle" style="font-size:0.78rem; color:var(--c-muted); margin:0.125rem 0 0;"></p>
        </div>
      </div>
      <button data-close="modalEvacBag" class="modal-close">âœ•</button>
    </div>
    <div id="evacBagModalContent" style="max-height:65vh; overflow-y:auto; padding-right:0.25rem;"></div>
  </div>
</div>

<!-- Modal: OsobnÃ½ kontakt -->
<div class="modal-overlay" id="modalPersonalContact">
  <div class="modal-box" style="max-width:500px;">
    <div class="modal-header">
      <div>
        <h3 id="pcModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;">ğŸ‘¤ NovÃ½ kontakt</h3>
        <p style="font-size:0.78rem; color:var(--c-muted); margin:0.25rem 0 0;">UloÅ¾te si dÃ´leÅ¾itÃ© ÄÃ­slo pre prÃ­pad nÃºdze</p>
      </div>
      <button data-close="modalPersonalContact" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem; flex-shrink:0; margin-left:1rem;">âœ•</button>
    </div>
    <form id="personalContactForm" style="display:grid; gap:1rem;">
      <input type="hidden" name="pc_editIndex" value="-1" />
      <div>
        <label class="item-label">Typ kontaktu *</label>
        <div id="pcCategoryPicker" style="display:flex; flex-wrap:wrap; gap:0.375rem; margin-bottom:0.5rem;"></div>
        <input name="pc_customType" type="text" id="pcCustomTypeInput" placeholder="VlastnÃ½ typ (napr. Susedka MÃ¡ria)" style="display:none;" />
      </div>
      <div>
        <label class="item-label">Meno / NÃ¡zov *</label>
        <input name="pc_name" type="text" required placeholder="napr. MUDr. KovÃ¡Ä, Allianz, Matka..." />
      </div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.625rem;">
        <div>
          <label class="item-label">TelefÃ³n *</label>
          <input name="pc_phone" type="tel" required placeholder="+421..." />
        </div>
        <div>
          <label class="item-label">TelefÃ³n 2 (zÃ¡loÅ¾nÃ½)</label>
          <input name="pc_phone2" type="tel" placeholder="" />
        </div>
      </div>
      <div>
        <label class="item-label">Adresa</label>
        <input name="pc_address" type="text" placeholder="napr. HlavnÃ¡ 15, Bratislava" />
      </div>
      <div>
        <label class="item-label">PoznÃ¡mka</label>
        <input name="pc_note" type="text" placeholder="napr. OrdinaÄnÃ© hodiny, ÄÃ­slo zmluvy..." />
      </div>
      <div style="display:flex; justify-content:flex-end; gap:0.5rem;">
        <button type="button" id="btnDeletePC" class="btn-ghost" style="padding:0.625rem 1.25rem; color:#dc2626; display:none;">OdstrÃ¡niÅ¥</button>
        <button type="submit" class="btn-primary" style="padding:0.625rem 2rem;">UloÅ¾iÅ¥</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: Miesto stretnutia -->
<div class="modal-overlay" id="modalMeetingPoint">
  <div class="modal-box" style="max-width:560px;">
    <div class="modal-header">
      <div>
        <h3 style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;">ğŸ“ Miesto stretnutia</h3>
        <p style="font-size:0.78rem; color:var(--c-muted); margin:0.25rem 0 0;">Kde sa stretnete, keÄ nebude signÃ¡l ani internet?</p>
      </div>
      <button data-close="modalMeetingPoint" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem; flex-shrink:0; margin-left:1rem;">âœ•</button>
    </div>
    <form id="meetingPointForm" style="display:grid; gap:1rem;">
      <div class="card-section">
        <div style="font-size:0.8rem; font-weight:700; margin-bottom:0.625rem;">HlavnÃ© miesto</div>
        <div style="display:grid; gap:0.625rem;">
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.25rem;">NÃ¡zov miesta *</label>
            <input name="mp_name" type="text" placeholder="napr. Hodiny na nÃ¡mestÃ­, Kostol sv. Martina..." required />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.25rem;">Adresa / popis polohy</label>
            <input name="mp_address" type="text" placeholder="napr. HlavnÃ© nÃ¡mestie 1, pri fontÃ¡ne" />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.25rem;">PoznÃ¡mka</label>
            <input name="mp_note" type="text" placeholder="napr. Vchod od parkoviska, pri laviÄkÃ¡ch" />
          </div>
        </div>
      </div>

      <div style="background:#eff6ff; border:1px solid #bfdbfe; border-radius:1rem; padding:1rem;">
        <div style="font-size:0.8rem; font-weight:700; color:#1e40af; margin-bottom:0.25rem;">â° ÄŒasy stretÃ¡vania</div>
        <div style="font-size:0.72rem; color:#2563eb; margin-bottom:0.625rem; line-height:1.5;">Kedy sa budete na mieste hÄ¾adaÅ¥? Napr. kaÅ¾dÃ© 4 hodiny. Ak tam druhÃ½ nie je, prÃ­Äte o ÄalÅ¡Ã­ interval.</div>
        <div id="meetingTimesEditor" style="display:flex; flex-wrap:wrap; gap:0.5rem; margin-bottom:0.5rem;"></div>
        <div style="display:flex; gap:0.5rem; align-items:center;">
          <input type="time" id="newMeetingTime" style="width:auto; font-size:0.85rem; padding:0.4rem 0.625rem;" />
          <button type="button" id="btnAddMeetingTime" class="btn-ghost" style="font-size:0.78rem; padding:0.4rem 0.75rem; white-space:nowrap;">+ PridaÅ¥ Äas</button>
        </div>
      </div>

      <div class="card-section">
        <div style="font-size:0.8rem; font-weight:700; margin-bottom:0.25rem;">ZÃ¡loÅ¾nÃ© miesto</div>
        <div style="font-size:0.72rem; color:var(--c-muted); margin-bottom:0.625rem;">Ak hlavnÃ© miesto nie je prÃ­stupnÃ©.</div>
        <div style="display:grid; gap:0.625rem;">
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.25rem;">NÃ¡zov zÃ¡loÅ¾nÃ©ho miesta</label>
            <input name="mp_backup_name" type="text" placeholder="napr. Dom starej mamy, Å¡kola..." />
          </div>
          <div>
            <label style="font-size:0.72rem; color:var(--c-muted); display:block; margin-bottom:0.25rem;">Adresa</label>
            <input name="mp_backup_address" type="text" placeholder="" />
          </div>
        </div>
      </div>

      <div style="display:flex; justify-content:flex-end;">
        <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal: ScenÃ¡r -->
<div class="modal-overlay" id="modalScenario">
  <div class="modal-box" style="max-width:600px;">
    <div class="modal-header">
      <div>
        <h3 id="scenarioModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;"></h3>
        <p id="scenarioModalSubtitle" style="font-size:0.78rem; color:var(--c-muted); margin:0.25rem 0 0;"></p>
      </div>
      <button data-close="modalScenario" style="background:none;border:none;cursor:pointer;color:var(--c-muted);font-size:1.25rem; flex-shrink:0; margin-left:1rem;">âœ•</button>
    </div>
    <div id="scenarioModalContent"></div>
  </div>
</div>
<div class="modal-overlay" id="modalFirstAid">
  <div class="modal-box" style="max-width:600px;">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:1rem;">
      <div style="display:flex; align-items:center; gap:0.75rem; flex:1; min-width:0;">
        <div class="fa-icon" id="faModalIcon" style="flex-shrink:0;"></div>
        <div>
          <h3 id="faModalTitle" style="font-family:'Lexend',sans-serif; font-weight:800; font-size:1.125rem; margin:0;"></h3>
          <p id="faModalSubtitle" style="font-size:0.78rem; color:var(--c-muted); margin:0.125rem 0 0;"></p>
        </div>
      </div>
      <button data-close="modalFirstAid" class="modal-close">âœ•</button>
    </div>
    <div id="faModalContent" style="max-height:65vh; overflow-y:auto; padding-right:0.25rem;"></div>
  </div>
</div>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  // â”€â”€ EmailJS konfigurÃ¡cia â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // POKYN: Zaregistruj sa na emailjs.com, vytvor service + template a vloÅ¾ ID sem
  const EMAILJS_CONFIG = {
    publicKey:   "S9KjZEwsiiUC69fX-XqbK",     // Account â†’ API Keys
    serviceId:   "service_h4jkdfs",             // Email Services â†’ Service ID
    template_expiry:  "template_expiry_warn", // Template ID pre upozornenie na expirÃ¡ciu
    template_shopping: "template_shopping_list" // Template ID pre nÃ¡kupnÃ½ zoznam
  };
  // Inicializuj EmailJS
  (function() {
    if (EMAILJS_CONFIG.publicKey !== "YOUR_EMAILJS_PUBLIC_KEY") {
      emailjs.init({ publicKey: EMAILJS_CONFIG.publicKey });
    }
  })();
</script>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged }
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, runTransaction }
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getAnalytics, logEvent, setAnalyticsCollectionEnabled }
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js";

  // â”€â”€ Firebase config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Demo mode: ?mode=demo v URL
  let isDemo = new URLSearchParams(location.search).get('mode') === 'demo';

  const firebaseConfig = {
    apiKey: "AIzaSyA5_U4_9La4JpK8wAXBqY6GmkKxCLkH8T4",
    authDomain: "bez-paniky.firebaseapp.com",
    projectId: "bez-paniky",
    storageBucket: "bez-paniky.firebasestorage.app",
    messagingSenderId: "539726693021",
    appId: "1:539726693021:web:123de9d93568a285e54a74",
    measurementId: "G-8CG5KPWS0V"
  };

  const MAX_USERS = 200; // Limit registrÃ¡ciÃ­

  // Firebase sa inicializuje VÅ½DY (aj v demo) â€” niektorÃ© funkcie ho potrebujÃº.
  // V demo reÅ¾ime sa preskoÄÃ­ len auth listener a ukladanie do Firestore.
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // â”€â”€ Firebase Analytics (consent-based) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Analytics sa inicializuje hneÄ, ale zber dÃ¡t je VYPNUTÃ.
  // Zapne sa aÅ¾ po sÃºhlase pouÅ¾Ã­vateÄ¾a cez cookie banner.
  const analytics = getAnalytics(app);
  setAnalyticsCollectionEnabled(analytics, false); // VypnutÃ© by default

  // Zapne analytics ak pouÅ¾Ã­vateÄ¾ uÅ¾ dal sÃºhlas
  if (localStorage.getItem('gerlach_cookie_analytics') === 'true') {
    setAnalyticsCollectionEnabled(analytics, true);
  }

  // Helper na logovanie eventov (bezpeÄnÃ½ â€” ak analytics vypnutÃ©, niÄ sa nestane)
  function trackEvent(name, params) {
    try { logEvent(analytics, name, params || {}); } catch(e) { /* ticho */ }
  }

  // Funkcia volanÃ¡ z cookie banneru po sÃºhlase
  window.enableAnalytics = function() {
    setAnalyticsCollectionEnabled(analytics, true);
    localStorage.setItem('gerlach_cookie_analytics', 'true');
  };
  window.disableAnalytics = function() {
    setAnalyticsCollectionEnabled(analytics, false);
    localStorage.removeItem('gerlach_cookie_analytics');
  };

  // â”€â”€ App state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const CATEGORIES = [
    { id: "food_water", name: "Jedlo a voda", emoji: "ğŸ¥«", weight: 1.2 },
    { id: "cash", name: "Peniaze", emoji: "ğŸ’µ", weight: 0.9 },
    { id: "medkit", name: "LekÃ¡rniÄka", emoji: "ğŸ©º", weight: 1.1 },
    { id: "hygiene", name: "Hygiena", emoji: "ğŸ§¼", weight: 0.8 },
    { id: "gear", name: "Vybavenie", emoji: "ğŸ”¦", weight: 1.0 },
    { id: "docs", name: "Doklady", emoji: "ğŸ“„", weight: 0.9 },
  ];

  // â”€â”€ Zdroje odporÃºÄanÃ­ pre kategÃ³rie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Tieto zdroje sÃº pouÅ¾itÃ© pri vÃ½poÄte mnoÅ¾stiev a vÃ½bere poloÅ¾iek
  const CATEGORY_SOURCES = {
    food_water: {
      note: "Voda: 2 l pitnej / osoba / de\u0148. Jedlo: 2000 kcal / de\u0148 dospel\u00FD (PAL 1.4, kr\u00EDzov\u00FD re\u017Eim)",
      sources: [
        { label: "WHO \u2013 Voda, hygiena a zdravie v n\u00FAdzov\u00FDch situ\u00E1ci\u00E1ch", url: "https://www.who.int/teams/environment-climate-change-and-health/water-sanitation-and-health" },
        { label: "EFSA \u2013 Referen\u010Dn\u00E9 hodnoty pre energetick\u00FD pr\u00EDjem (2013)", url: "https://www.efsa.europa.eu/en/efsajournal/pub/3005" },
        { label: "SK MINV \u2013 V pr\u00EDpade kr\u00EDzy alebo ozbrojen\u00E9ho konfliktu", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "UA DSNS \u2013 Pr\u00EDru\u010Dka pre pr\u00EDpad n\u00FAdze alebo vojny", url: "https://dovidka.info/" }
      ]
    },
    cash: {
      note: "\u20AC70\u2013100 / osobu na 72h, v mal\u00FDch nomin\u00E1loch (\u20AC5, \u20AC10, \u20AC20 + mince)",
      sources: [
        { label: "ECB \u2013 'Keep calm and carry cash' (2025)", url: "https://www.ecb.europa.eu/press/blog/date/2025/html/ecb.blog20250128~4b35e0ed27.en.html" },
        { label: "Rak\u00FAska iniciat\u00EDva 'Bargeld f\u00FCr alle F\u00E4lle'", url: "https://cashessentials.org/eu-recommends-including-cash-as-a-crucial-component-of-emergency-kits/" },
        { label: "EU Preparedness Union Strategy (2025)", url: "https://commission.europa.eu/topics/preparedness_en" }
      ]
    },
    medkit: {
      note: "Dom\u00E1ca lek\u00E1rni\u010Dka + n\u00FAdzov\u00E9 z\u00E1soby liekov na 7 dn\u00ED",
      sources: [
        { label: "CZ 72h pr\u00EDru\u010Dka (MV \u010CR, 2025)", url: "https://www.72h.gov.cz" },
        { label: "SK MINV \u2013 V pr\u00EDpade kr\u00EDzy alebo ozbrojen\u00E9ho konfliktu", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "UA DSNS \u2013 Pr\u00EDru\u010Dka pre pr\u00EDpad n\u00FAdze alebo vojny", url: "https://dovidka.info/" },
        { label: "IFRC \u2013 First Aid Recommendations", url: "https://www.ifrc.org/first-aid" }
      ]
    },
    hygiene: {
      note: "Min. 72h sebesta\u010Dnos\u0165 vr\u00E1tane hygienick\u00FDch potrieb",
      sources: [
        { label: "EU Preparedness Union Strategy (2025)", url: "https://commission.europa.eu/topics/preparedness_en" },
        { label: "CZ 72h pr\u00EDru\u010Dka (MV \u010CR, 2025)", url: "https://www.72h.gov.cz" },
        { label: "SK MINV \u2013 V pr\u00EDpade kr\u00EDzy alebo ozbrojen\u00E9ho konfliktu", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    gear: {
      note: "Komunik\u00E1cia, osvetlenie, varenie, n\u00E1stroje \u2013 sebesta\u010Dnos\u0165 min. 72h\u20137 dn\u00ED",
      sources: [
        { label: "\u0160v\u00E9dsko MSB \u2013 'Om krisen eller kriget kommer' (2024)", url: "https://www.msb.se/en/rad-till-privatpersoner/the-brochure-if-crisis-or-war-comes/" },
        { label: "CZ 72h pr\u00EDru\u010Dka (MV \u010CR, 2025)", url: "https://www.72h.gov.cz" },
        { label: "SK MINV \u2013 V pr\u00EDpade kr\u00EDzy alebo ozbrojen\u00E9ho konfliktu", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "UA DSNS \u2013 Pr\u00EDru\u010Dka pre pr\u00EDpad n\u00FAdze alebo vojny", url: "https://dovidka.info/" }
      ]
    }
  };

  const DEFAULT_ITEMS = {
    food_water: [
      { name: "ZÃ¡soby pitnej vody", isWaterItem: true, waterEntries: [] },
      { name: "ZÃ¡soby jedla", isFoodItem: true, foodEntries: [] },
    ],
    cash: [
      { name: "HotovosÅ¥ v domÃ¡cnosti", isCashItem: true, cashEntries: [] },
    ],
    medkit: [
      { name: "Lieky na predpis â€“ zÃ¡soba na 7 dnÃ­", done: false, qty: "", expiry: "", link: "" },
      { name: "Dezinfekcia na rany (Betadine / Skinsept)", done: false, qty: "1 ks", expiry: "", link: "" },
    ],
    hygiene: [
      { name: "ToaletnÃ½ papier", done: false, qty: "", expiry: "", link: "" },
      { name: "Mydlo", done: false, qty: "", expiry: "", link: "" },
    ],
    gear: [
      { name: "Baterka LED", done: false, qty: "", expiry: "", link: "" },
      { name: "RÃ¡dio na batÃ©rie AM/FM", done: false, qty: "1 ks", expiry: "", link: "" },
    ],
    docs: [
      // â”€â”€ OsobnÃ© dokumenty â”€â”€
      { name: "ObÄiansky preukaz / pas â€“ originÃ¡l", done: false, qty: "KaÅ¾dÃ½ Älen rodiny", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "ObÄiansky preukaz / pas â€“ kÃ³pia papier + scan", done: false, qty: "PDF: Cloud + USB", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "RodnÃ½ list â€“ originÃ¡l + Ãºradne overenÃ¡ kÃ³pia", done: false, qty: "1â€“2 ks overenÃ½ch", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "RodnÃ½ list â€“ scan na Cloud + USB", done: false, qty: "", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "SobÃ¡Å¡ny list / rozsudok o rozvode â€“ originÃ¡l", done: false, qty: "+ 1Ã— overenÃ¡ kÃ³pia", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "SobÃ¡Å¡ny list â€“ scan na Cloud + USB", done: false, qty: "", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "VodiÄskÃ½ preukaz â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      { name: "KartiÄka zdravotnej poisÅ¥ovne â€“ originÃ¡l", done: false, qty: "+ scan / fotka", expiry: "", link: "", docGroup: "OsobnÃ© dokumenty" },
      // â”€â”€ Majetok a bÃ½vanie â”€â”€
      { name: "List vlastnÃ­ctva â€“ vÃ½pis z katastra", done: false, qty: "+ 1Ã— overenÃ¡ kÃ³pia", expiry: "", link: "", docGroup: "Majetok a bÃ½vanie" },
      { name: "List vlastnÃ­ctva â€“ scan Cloud + USB", done: false, qty: "", expiry: "", link: "", docGroup: "Majetok a bÃ½vanie" },
      { name: "KÃºpna zmluva na nehnuteÄ¾nosÅ¥ â€“ originÃ¡l", done: false, qty: "+ 1Ã— overenÃ¡ kÃ³pia", expiry: "", link: "", docGroup: "Majetok a bÃ½vanie" },
      { name: "HypotekÃ¡rna / ÃºverovÃ¡ zmluva â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Majetok a bÃ½vanie" },
      { name: "NÃ¡jomnÃ¡ zmluva (ak prenajÃ­mate) â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Majetok a bÃ½vanie" },
      // â”€â”€ Auto / Doprava â”€â”€
      { name: "TechnickÃ½ preukaz (osvedÄenie) â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Auto a doprava" },
      { name: "Zmluva o kÃºpe vozidla â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Auto a doprava" },
      { name: "PZP + havarijnÃ© poistenie â€“ zmluva + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Auto a doprava" },
      // â”€â”€ Zamestnanie a vzdelanie â”€â”€
      { name: "Diplom / vysvedÄenia â€“ originÃ¡l", done: false, qty: "+ Ãºradne overenÃ¡ kÃ³pia", expiry: "", link: "", docGroup: "Vzdelanie a prÃ¡ca" },
      { name: "Diplom â€“ scan na Cloud + USB", done: false, qty: "", expiry: "", link: "", docGroup: "Vzdelanie a prÃ¡ca" },
      { name: "CertifikÃ¡cie / odbornÃ© oprÃ¡vnenia â€“ originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Vzdelanie a prÃ¡ca" },
      // â”€â”€ Financie â”€â”€
      { name: "BankovÃ© ÃºÄty â€“ zmluvy originÃ¡l + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Financie" },
      { name: "InvestiÄnÃ© zmluvy (broker, fondy) â€“ scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Financie" },
      { name: "Crypto seed / recovery frÃ¡za â€“ PAPIER offline", done: false, qty: "2Ã— na rÃ´znych miestach! Nikdy nescanovaÅ¥!", expiry: "", link: "", docGroup: "Financie" },
      { name: "Å½ivotnÃ¡ / ÃºrazovÃ¡ poistka â€“ zmluva + scan", done: false, qty: "Cloud + USB + poznÃ¡mka k podmienkam", expiry: "", link: "", docGroup: "Financie" },
      { name: "Poistenie domu / bytu â€“ zmluva + scan", done: false, qty: "Cloud + USB", expiry: "", link: "", docGroup: "Financie" },
      { name: "DaÅˆovÃ© dokumenty â€“ poslednÃ© 2â€“4 roky", done: false, qty: "Papier + scan", expiry: "", link: "", docGroup: "Financie" },
      // â”€â”€ ZdravotnÃ© dokumenty â”€â”€
      { name: "Karta pacienta â€“ scan + papierovÃ¡", done: false, qty: "", expiry: "", link: "", docGroup: "ZdravotnÃ© dokumenty" },
      { name: "LekÃ¡rske sprÃ¡vy (deti / chronickÃ­ pacienti)", done: false, qty: "Papier + Cloud + USB", expiry: "", link: "", docGroup: "ZdravotnÃ© dokumenty" },
      { name: "Alergie / lieky / kontakty â€“ 1Ã— A4 v lekÃ¡rniÄke", done: false, qty: "Papier v lekÃ¡rniÄke + batohu", expiry: "", link: "", docGroup: "ZdravotnÃ© dokumenty" },
      { name: "Darcu krvi / transplantÃ¡cie / dÃ´leÅ¾itÃ© med. info", done: false, qty: "Papier + scan", expiry: "", link: "", docGroup: "ZdravotnÃ© dokumenty" },
      // â”€â”€ KrÃ­zovÃ© dokumenty â”€â”€
      { name: "Plnomocenstvo â€“ NOTÃRSKY OVERENÃ‰", done: false, qty: "Na sprÃ¡vu majetku, bankovÃ© Ãºkony, poistky", expiry: "", link: "", docGroup: "KrÃ­zovÃ© dokumenty" },
      { name: "ZÃ¡vet / dediÄstvo â€“ originÃ¡l u notÃ¡ra", done: false, qty: "KÃ³pia pre rodinu. Scan neodporÃºÄanÃ½ ako dÃ´kaz!", expiry: "", link: "", docGroup: "KrÃ­zovÃ© dokumenty" },
      { name: "Zoznam kontaktov offline â€“ papier 1â€“2 strany", done: false, qty: "LekÃ¡r, prÃ¡vnik, banka, poisÅ¥ovne, hasiÄi, elektrikÃ¡r...", expiry: "", link: "", docGroup: "KrÃ­zovÃ© dokumenty" },
      { name: "USB kÄ¾ÃºÄ s dokumentmi â€“ pripravenÃ½ v batohu", done: false, qty: "Å ifrovanÃ½! + zÃ¡loha na Cloud", expiry: "", link: "", docGroup: "KrÃ­zovÃ© dokumenty" },
    ],
  };

  // â”€â”€ Dynamic item generation based on profile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function generateProfileItems(profile) {
    if (!profile) return {};
    const a = profile.adults || 0, k = profile.kids || 0, inf = profile.infants || 0, s = profile.seniors || 0;
    const persons = a + k + s; // Infants don't need most items separately
    const allP = a + k + inf + s;
    const days = profile.prepDays || 3;
    const c = profile.readinessCoeff || 1.0;
    const isPremium = profile.budget === "premium";
    const isEnhanced = profile.readiness === "enhanced";
    const ceil = Math.ceil;

    function q(val, unit) { return `${ceil(val * c)} ${unit}`; }
    function mk(name, qty, extra) { return { name, done: false, qty, expiry: "", link: "", ...extra }; }

    // â”€â”€ GEAR (Vybavenie) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Zdroje: SE MSB 2024, CZ 72h, SK MINV, UA DSNS, NO DSB
    const gear = [];
    // --- Osvetlenie (CZ, SK, UA, SE â€“ vÅ¡etky vyÅ¾adujÃº) ---
    gear.push(mk("Baterka LED + Äelovka", q(Math.max(persons, 1), "ks")));
    gear.push(mk("NÃ¡hradnÃ© batÃ©rie (AAA + AA mix)", q(ceil(Math.max(persons, 1) * days / 3) * 2, "ks")));
    gear.push(mk("SvieÄky (ÄajovÃ© + klasickÃ©)", q(ceil(days * 3), "ks"), {link:""}));
    // --- KomunikÃ¡cia (CZ, SK, UA, SE â€“ kritickÃ© pri vÃ½padku) ---
    gear.push(mk("RÃ¡dio na batÃ©rie AM/FM", "1 ks"));
    if (isPremium) gear.push(mk("RÃ¡dio nÃºdzovÃ© s kÄ¾ukou + solÃ¡rne (EtÃ³n / Sangean)", "1 ks"));
    gear.push(mk("NÃ¡hradnÃ© batÃ©rie AA do rÃ¡dia", q(ceil(days / 2) * 4, "ks")));
    // --- Energia (CZ, SK, UA, SE) ---
    gear.push(mk("Powerbanka min. 20 000 mAh", q(ceil(Math.max(allP, 1) / 2), "ks")));
    gear.push(mk("USB nabÃ­jacÃ­ kÃ¡bel (Lightning + USB-C + Micro)", "1 sada"));
    // --- Varenie (CZ, SK, UA â€“ variÄ + palivo) ---
    gear.push(mk("PlynovÃ½ kempingovÃ½ variÄ", "1 ks"));
    gear.push(mk("PlynovÃ© kartuÅ¡e (230 g)", q(ceil(days / 2), "ks")));
    gear.push(mk("ZÃ¡palky vodeodolnÃ© + zapaÄ¾ovaÄ", q(ceil(Math.max(persons, 1) / 2), "setov")));
    // --- Voda â€“ nÃ¡doby (CZ, SK, UA) ---
    const totalLitresDay = allP * 2;
    const bigCanisters = ceil(totalLitresDay * days / 10);
    gear.push(mk(
      `Kanister na vodu s ventilom ${allP <= 2 ? "5" : "10"} L`,
      `${bigCanisters} ks`
    ));
    if (isEnhanced) gear.push(mk("Kanister na vodu 5 L (zÃ¡loÅ¾nÃ½)", q(ceil(totalLitresDay / 5), "ks")));
    // --- NÃ¡stroje (CZ, UA, SE) ---
    gear.push(mk("MultifunkÄnÃ½ nÃ´Å¾ / multitool", "1 ks"));
    gear.push(mk("PevnÃ¡ lepiaca pÃ¡ska (duct tape)", q(ceil(Math.max(allP, 1) / 3), "ks")));
    gear.push(mk("Ceruzka + papier (blok A5)", "1 set"));
    gear.push(mk("PÃ­Å¡Å¥alka signalizaÄnÃ¡", q(Math.max(persons, 1), "ks")));
    gear.push(mk("Lano / paracord 15 m", "1 ks"));
    // --- Odpad + toaleta (CZ, SK â€“ nÃºdzovÃ¡ toaleta) ---
    gear.push(mk("Vrecia na odpad (60 L)", q(allP * ceil(days / 2), "ks")));
    // --- BezpeÄnosÅ¥ (CZ, SK â€“ hasiaci prÃ­stroj) ---
    gear.push(mk("Hasiaci prÃ­stroj prÃ¡Å¡kovÃ½ 2 kg alebo hasiaca deka", "1 ks"));
    // --- Ochrana (UA, SE â€“ fÃ³lia na oknÃ¡) ---
    gear.push(mk("IgelitovÃ¡ fÃ³lia (zakrytie okien / izolÃ¡cia)", "1 rolka"));
    // --- Dokumenty digitÃ¡lne (UA, CZ) ---
    gear.push(mk("USB kÄ¾ÃºÄ s kÃ³piami dokumentov (Å¡ifrovanÃ½)", "1 ks"));
    // --- ZvieratÃ¡ (CZ, SK, UA) ---
    gear.push(mk("Krmivo pre domÃ¡ce zvieratÃ¡", `podÄ¾a potreby na ${days} dnÃ­`));
    // --- KÄ¾ÃºÄe ---
    gear.push(mk("NÃ¡hradnÃ© kÄ¾ÃºÄe od bytu / domu / auta", "1 sada"));
    // --- Mapa (UA â€“ offline mapa) ---
    gear.push(mk("Mapa okolia (papierovÃ¡) + offline mapy v telefÃ³ne", "1 ks"));

    // â”€â”€ MEDKIT (LekÃ¡rniÄka) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Zdroje: CZ 72h (obsah domÃ¡cÃ­ lÃ©kÃ¡rniÄky), SK MINV, UA DSNS (2 lekÃ¡rniÄky),
    // SE MSB 2024, IFRC first aid recommendations
    const medkit = [];
    // --- Lieky na predpis (CZ, SK, UA â€“ zÃ¡soba na 7 dnÃ­) ---
    medkit.push(mk("Lieky na predpis â€“ zÃ¡soba na 7 dnÃ­", `+ popis: Äo, kedy, ako uÅ¾Ã­vate`, {expiry: ""}));
    // --- Dezinfekcia (CZ, SK, UA) ---
    medkit.push(mk("Dezinfekcia na rany (Betadine / Skinsept)", q(Math.max(ceil(allP / 3), 1), "ks")));
    medkit.push(mk("Dezinfekcia na ruky (gÃ©l, 100 ml)", q(Math.max(allP, 1), "ks")));
    // --- Lieky â€“ bolesÅ¥, horÃºÄka, trÃ¡viace (CZ, SK, UA) ---
    medkit.push(mk("Lieky proti bolesti â€“ Ibuprofen 400 mg", q(Math.max(persons, 1), "balenie")));
    medkit.push(mk("Lieky proti horÃºÄke â€“ Paralen 500 mg", q(Math.max(persons, 1), "balenie")));
    medkit.push(mk("Lieky proti hnaÄke â€“ Smecta / Imodium", q(Math.max(persons, 1), "balenie")));
    medkit.push(mk("Lieky proti nevoÄ¾nosti (Kinedryl)", q(Math.max(ceil(allP / 2), 1), "balenie")));
    medkit.push(mk("AktÃ­vne uhlie (Carbosorb) â€“ otrava", q(Math.max(ceil(allP / 2), 1), "balenie")));
    // --- Antihistaminikum (UA odporÃºÄanie) ---
    medkit.push(mk("Antihistaminikum (CetirizÃ­n / Zyrtec)", q(Math.max(ceil(allP / 2), 1), "balenie")));
    medkit.push(mk("Kvapky do oÄÃ­ (umelÃ© slzy)", "1 ks"));
    medkit.push(mk("Elektrolyty â€“ rehydrataÄnÃ© soli (ORS)", q(Math.max(allP, 1), "sÃ¡Äkov")));
    // --- ObvÃ¤zovÃ½ materiÃ¡l (CZ 72h detailnÃ½ zoznam) ---
    medkit.push(mk("ObvÃ¤zy elastickÃ© + gÃ¡za (sterilnÃ¡)", q(Math.max(ceil(allP / 2), 1), "set")));
    medkit.push(mk("NÃ¡plasti rÃ´zne veÄ¾kosti", q(Math.max(allP, 1), "balenie")));
    medkit.push(mk("TrojrohÃ¡ Å¡atka", q(2, "ks")));
    medkit.push(mk("JednorazovÃ© rukavice (nitrylovÃ©)", q(allP * 2, "pÃ¡rov")));
    // --- Trauma (CZ â€“ Å¡krtidlo, UA â€“ tourniquet, hemostatik) ---
    medkit.push(mk("Å krtidlo (CAT tourniquet)", q(Math.max(ceil(allP / 3), 1), "ks")));
    medkit.push(mk("ResuscitaÄnÃ¡ rÃºÅ¡ka s ventilom", "1 ks"));
    // --- NÃ¡stroje (CZ) ---
    medkit.push(mk("NoÅ¾nice (lekÃ¡rnickÃ© / atraumatickÃ©)", "1 ks"));
    medkit.push(mk("Pinzeta", "1 ks"));
    medkit.push(mk("Teplomer digitÃ¡lny", "1 ks"));
    // --- Ochrana (CZ, SK) ---
    medkit.push(mk("ZÃ¡chranÃ¡rska fÃ³lia (izotermickÃ¡ deka)", q(allP, "ks")));
    medkit.push(mk("RespirÃ¡tor FFP2", q(allP * 2, "ks")));
    // --- Deti (CZ, SK, UA) ---
    if (k > 0 || inf > 0) {
      medkit.push(mk("Paralen pre deti (ÄapÃ­ky alebo sirup)", q(k + inf, "balenie")));
      medkit.push(mk("Nurofen pre deti (sirup â€“ od 3 mesiacov)", q(k + inf, "balenie")));
      medkit.push(mk("Elektrolyty pre deti (rehydrataÄnÃ© soli)", q((k + inf) * 3, "sÃ¡Äkov")));
    }
    if (inf > 0) {
      medkit.push(mk("NosnÃ© kvapky pre bÃ¡bÃ¤tkÃ¡ (fyziologickÃ½ roztok)", q(inf, "ks")));
      medkit.push(mk("ZinkovÃ¡ masÅ¥ (ochrana pokoÅ¾ky dojÄaÅ¥a)", q(inf, "ks")));
      medkit.push(mk("Kvapky proti kolikÃ¡m (Espumisan / Sab Simplex)", q(inf, "ks")));
    }
    // --- RozÅ¡Ã­renÃ© (UA DSNS + ICRC) ---
    if (isEnhanced) {
      medkit.push(mk("ObvÃ¤z s hemostatikom (QuikClot / Celox)", q(Math.max(ceil(allP / 2), 1), "ks")));
      medkit.push(mk("Sam Splint â€“ dlahovacia pomÃ´cka", "1 ks"));
      medkit.push(mk("Chest seal â€“ okluzÃ­vna nÃ¡plasÅ¥ (pneumotorax)", "1 ks"));
      medkit.push(mk("RespirÃ¡tor FFP3", q(allP, "ks")));
    }

    // â”€â”€ HYGIENE (Hygiena) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Zdroje: CZ 72h, SK MINV, EU Preparedness Union Strategy
    const hygiene = [];
    hygiene.push(mk("ToaletnÃ½ papier", q(ceil(allP * days / 3), "roliek")));
    hygiene.push(mk("Mydlo / sprchovÃ½ gÃ©l", q(Math.max(ceil(allP / 2), 1), "ks")));
    hygiene.push(mk("VlhÄenÃ© utierky (veÄ¾kÃ© balenie)", q(Math.max(allP, 1), "balenie")));
    hygiene.push(mk("ZubnÃ¡ kefka + zubnÃ¡ pasta", q(allP, "ks + 1 pasta")));
    hygiene.push(mk("Å ampÃ³n (cestovnÃ© balenie)", q(Math.max(ceil(allP / 2), 1), "ks")));
    hygiene.push(mk("RuÄnÃ­k (rÃ½chloschnÃºci)", q(allP, "ks")));
    hygiene.push(mk("MenÅ¡truaÄnÃ© potreby (vloÅ¾ky / tampÃ³ny / kalÃ­Å¡ok)", "podÄ¾a potreby"));
    hygiene.push(mk("PapierovÃ© vreckovky", q(allP, "balenie")));
    hygiene.push(mk("Dezinfekcia na ruky (cestovnÃ© balenie 50 ml)", q(allP, "ks")));
    // --- NÃºdzovÃ¡ toaleta (CZ â€“ pytel do zÃ¡chodu, SK) ---
    hygiene.push(mk("KoÄkolit / absorpÄnÃ© vreckÃ¡ (nÃºdzovÃ¡ toaleta)", "1 balenie"));
    hygiene.push(mk("OdpadkovÃ© vreckÃ¡ na biologickÃ½ odpad", q(allP * ceil(days / 2), "ks")));
    // --- Deti (SK, CZ) ---
    if (inf > 0) {
      hygiene.push(mk("Plienky (jednorazovÃ©)", q(inf * days * 6, "ks")));
      hygiene.push(mk("DetskÃ© vlhÄenÃ© obrÃºsky", q(inf * 2, "balenie")));
      hygiene.push(mk("OchrannÃ½ krÃ©m na zadoÄek", q(inf, "ks")));
    }
    if (k > 0) {
      hygiene.push(mk("DetskÃ© vlhÄenÃ© obrÃºsky", q(k, "balenie")));
    }

    return { gear, medkit, hygiene };
  }

  // Regenerate items for dynamic categories, preserving done states and custom items
  function regenerateProfileBasedItems() {
    if (!state.profile) return;
    const generated = generateProfileItems(state.profile);
    ["gear", "medkit", "hygiene"].forEach(catId => {
      if (!generated[catId]) return;
      const existing = state.items[catId] || [];
      const doneMap = {};
      existing.forEach(it => { doneMap[it.name] = it.done; });
      // Generated item names set
      const genNames = new Set(generated[catId].map(it => it.name));
      // Custom items = items that exist but are NOT in generated list
      const custom = existing.filter(it => !genNames.has(it.name));
      state.items[catId] = [
        ...generated[catId].map(it => ({
          ...it,
          done: doneMap[it.name] !== undefined ? doneMap[it.name] : false
        })),
        ...custom
      ];
    });
  }

  // Funkcia na vytvorenie ÄistÃ©ho state - vÅ¾dy volaÅ¥ pri novom prihlÃ¡senÃ­
  function freshState() {
    return {
      profile: null,
      selectedCategoryId: "food_water",
      alertDaysMeds: 180,
      alertDaysFood: 30,
      items: structuredClone(DEFAULT_ITEMS),
      plans: {
        meetingPoint: {
          name: "",
          address: "",
          note: "",
          times: ["08:00", "12:00", "16:00", "20:00"],
          backup: { name: "", address: "" }
        },
        scenarios: {
          home: {
            steps: "1. Zachovajte pokoj \u2013 panika je v\u00e1\u0161 najv\u00e4\u010d\u0161\u00ed nepriate\u013e\n2. Zistite typ ohrozenia: zapnite r\u00e1dio (96,6 FM BA / 90,1 FM BB / 89,5 FM KE)\n3. Zatvorte a utesnite okn\u00e1, dvere, ventil\u00e1ciu (chemick\u00fd \u00fanik, radi\u00e1cia)\n4. Skontrolujte z\u00e1soby: voda, jedlo, lieky, baterky, r\u00e1dio\n5. Pripravte evaku\u00e1\u010dn\u00e9 batohy pri dver\u00e1ch + pev\u00fa obuv\n6. Po\u010dkajte na hovor. inform\u00e1ciu \u2013 \u00farady povedia \u010do robi\u0165\n7. Ak nariadili evaku\u00e1ciu: vypnite isti\u010d + plyn, zamknite, l\u00edstok na dvere\n8. I\u010fte na miesto stretnutia pe\u0161o (auto len ak cesta vo\u013en\u00e1)",
            evacPlace: "",
            note: ""
          },
          separated: {
            tasks: [],
            meetPlace: "",
            meetTime: "",
            note: ""
          },
          partial: {
            whoHome: "",
            whoWork: "",
            homeSteps: "1. Zabezpe\u010dte deti \u2013 upokojte, vysvetlite primerane veku\n2. Pripravte v\u0161etky evaku\u00e1\u010dn\u00e9 batohy (aj partnerov)\n3. Sledujte r\u00e1dio \u2013 R\u00e1dio Slovensko\n4. SMS partnerovi: kr\u00e1tka spr\u00e1va s va\u0161ou poz\u00edciou\n5. Ak sa partner neozval do 2h \u2192 i\u010fte na miesto stretnutia\n6. L\u00edstok na dvere: kto, kedy, kam",
            workSteps: "1. Bezpe\u010dne opustite pracovisko (kol\u00e1\u010d, ne\u010dakajte)\n2. SMS partnerovi: \u201eSom OK, idem dom/stretnutie\u201c\n3. Ak je cesta domov bezpe\u010dn\u00e1 \u2192 i\u010fte domov\n4. Ak nie \u2192 smerujte na miesto stretnutia\n5. Po ceste vyzvihnite bl\u00edzkych ak m\u00f4\u017eete",
            meetPlace: "",
            meetTime: "",
            note: ""
          },
          night: {
            steps: "1. Zobu\u010fte v\u0161etk\u00fdch \u2013 pokojne ale r\u00e1zne, najprv deti\n2. Oble\u010dte sa: tepl\u00e9 oble\u010denie + PEVN\u00c1 OBUV (pripraven\u00e1 pri batohu)\n3. \u010celovka/baterka na hlavu \u2013 ruky musia byti vo\u013en\u00e9\n4. Zapnite r\u00e1dio na bat\u00e9rie \u2013 zistite \u010do sa deje\n5. Evaku\u00e1\u010dny batoh je pri dver\u00e1ch \u2013 vezmite ho\n6. Deti: neste/ve\u010fte za ruku, star\u0161\u00edch podoprite\n7. NIKDY nehladajte veci po byte v tme \u2013 vezmite len to \u010do je pripraven\u00e9\n8. Mobil + k\u013e\u00fa\u010de + doklady = minimum",
            evacPlace: "",
            note: ""
          },
          travel: {
            whoTravels: "",
            contactPerson: "",
            contactPhone: "",
            stepsHome: "",
            stepsAway: "",
            note: ""
          }
        }
      },
      personalContacts: [],
      evacuationBags: {}
    };
  }

  let state = freshState();

  let currentUser = null;
  let saveTimeout = null;
  let syncStatus = "idle"; // idle | syncing | synced

  // â”€â”€ Firestore helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function userDocRef(uid) { return doc(db, "users", uid, "data", "main"); }
  function metaRef() { return doc(db, "meta", "stats"); }

  async function loadUserData(uid) {
    // Demo: naÄÃ­tame zo sessionStorage (ak tam nieÄo je)
    if (isDemo) {
      try {
        const saved = sessionStorage.getItem('gerlach_demo_state');
        if (saved) {
          const data = JSON.parse(saved);
          state = { ...state, ...data };
        }
      } catch(e) { console.warn("Demo load error", e); }
      setSyncStatus("synced");
      return;
    }
    setSyncStatus("syncing");
    try {
      const snap = await getDoc(userDocRef(uid));
      if (snap.exists()) {
        const data = snap.data();
        // Deep merge plans structure (handle old A/B/C format migration)
        const defaultPlans = freshState().plans;
        let mergedPlans = defaultPlans;
        if (data.plans) {
          if (data.plans.meetingPoint) {
            // New format â€“ deep merge
            mergedPlans = {
              meetingPoint: { ...defaultPlans.meetingPoint, ...(data.plans.meetingPoint || {}), backup: { ...defaultPlans.meetingPoint.backup, ...((data.plans.meetingPoint||{}).backup || {}) } },
              scenarios: {
                home: { ...defaultPlans.scenarios.home, ...((data.plans.scenarios||{}).home || {}) },
                separated: { ...defaultPlans.scenarios.separated, ...((data.plans.scenarios||{}).separated || {}), tasks: ((data.plans.scenarios||{}).separated||{}).tasks || [] },
                partial: { ...defaultPlans.scenarios.partial, ...((data.plans.scenarios||{}).partial || {}) },
                night: { ...defaultPlans.scenarios.night, ...((data.plans.scenarios||{}).night || {}) },
                travel: { ...defaultPlans.scenarios.travel, ...((data.plans.scenarios||{}).travel || {}) }
              }
            };
          }
          // else: old A/B/C format â€“ just use defaults, old data ignored
        }
        state = {
          ...state,
          ...data,
          items: { ...structuredClone(DEFAULT_ITEMS), ...(data.items || {}) },
          plans: mergedPlans,
          personalContacts: data.personalContacts || [],
          evacuationBags: data.evacuationBags || {}
        };
        // Migrate: ensure link field
        for (const cid of Object.keys(state.items)) {
          state.items[cid] = state.items[cid].map(it => ({ link: "", waterBottles: 0, isWaterItem: false, isFoodItem: false, isCashItem: false, ...it }));
        }
        // Migrate: docs category â€“ if old format (no docGroup), replace with new comprehensive list
        if (state.items.docs && state.items.docs.length > 0 && !state.items.docs[0].docGroup) {
          state.items.docs = structuredClone(DEFAULT_ITEMS.docs);
        }
        // Migrate: alertDays â†’ alertDaysMeds + alertDaysFood
        if (!data.alertDaysMeds && !data.alertDaysFood) {
          state.alertDaysMeds = 180;
          state.alertDaysFood = data.alertDays || 30;
        } else {
          state.alertDaysMeds = data.alertDaysMeds || 180;
          state.alertDaysFood = data.alertDaysFood || 30;
        }
        delete state.alertDays;
        // Migrate: budget "basic" (old ÃšspornÃ¡) â†’ "mid" (new ZÃ¡kladnÃ¡)
        if (state.profile && state.profile.budget === "basic") {
          state.profile.budget = "mid";
        }
        // Migrate: remove old default items from dynamic categories (replaced by profile-based generation)
        const OLD_DEFAULTS = {
          gear: ["Baterka + zÃ¡loÅ¾nÃ© batÃ©rie", "Powerbanka (min. 10 000 mAh)", "RÃ¡dio na batÃ©rie"],
          medkit: ["Lieky proti bolesti (Paralen, Ibuprofen)", "ObvÃ¤zy, dezinfekcia, rukavice", "Lieky na predpis â€“ zÃ¡loÅ¾nÃ¡ zÃ¡soba"],
          hygiene: ["ToaletnÃ½ papier / vlhÄenÃ© utierky", "Mydlo / dezinfekcia rÃºk"]
        };
        for (const [catId, oldNames] of Object.entries(OLD_DEFAULTS)) {
          if (state.items[catId]) {
            state.items[catId] = state.items[catId].filter(it => !oldNames.includes(it.name));
          }
        }
        // Migrate v22â†’v23: renamed items (preserve done state)
        const RENAME_MAP = {
          gear: {
            "Baterka LED": "Baterka LED + Äelovka",
            "NÃ¡hradnÃ© batÃ©rie AAA do baterky": "NÃ¡hradnÃ© batÃ©rie (AAA + AA mix)",
            "RÃ¡dio nÃºdzovÃ© EtÃ³n Odyssey (kÄ¾ukou + solÃ¡rne)": "RÃ¡dio nÃºdzovÃ© s kÄ¾ukou + solÃ¡rne (EtÃ³n / Sangean)",
            "ZÃ¡palky / zapaÄ¾ovaÄ": "ZÃ¡palky vodeodolnÃ© + zapaÄ¾ovaÄ",
            "MultifunkÄnÃ½ nÃ´Å¾": "MultifunkÄnÃ½ nÃ´Å¾ / multitool",
            "Ceruzka a papier (blok A5)": "Ceruzka + papier (blok A5)",
            "PÃ­Å¡Å¥alka (signalizaÄnÃ¡)": "PÃ­Å¡Å¥alka signalizaÄnÃ¡",
            "Paracord / lano 15 m": "Lano / paracord 15 m",
          },
          medkit: {
            "AktÃ­vne uhlie (Carbosorb)": "AktÃ­vne uhlie (Carbosorb) â€“ otrava",
            "Elektrolyty â€“ rehydrataÄnÃ© soli": "Elektrolyty â€“ rehydrataÄnÃ© soli (ORS)",
            "NoÅ¾nice (lekÃ¡rnickÃ©)": "NoÅ¾nice (lekÃ¡rnickÃ© / atraumatickÃ©)",
          },
          hygiene: {
            "DÃ¡mska hygiena (vloÅ¾ky / tampÃ³ny)": "MenÅ¡truaÄnÃ© potreby (vloÅ¾ky / tampÃ³ny / kalÃ­Å¡ok)",
          }
        };
        for (const [catId, renames] of Object.entries(RENAME_MAP)) {
          if (state.items[catId]) {
            state.items[catId].forEach(it => {
              if (renames[it.name]) it.name = renames[it.name];
            });
          }
        }
        // Also fix kanister name pattern (remove EDA suffix)
        if (state.items.gear) {
          state.items.gear.forEach(it => {
            if (it.name && it.name.includes("Kanister na vodu s ventilom") && it.name.includes("(EDA)")) {
              it.name = it.name.replace(" (EDA)", "");
            }
          });
        }
        // Regenerate dynamic items from profile
        regenerateProfileBasedItems();
        // Migrate: food_water â€“ remove old default items and ensure food+water trackers exist
        if (state.items.food_water) {
          const oldFoodNames = ["TrvanlivÃ© jedlo (min. 3 dni)", "OtvÃ¡raÄ / variÄ / palivo"];
          state.items.food_water = state.items.food_water.filter(it => !oldFoodNames.includes(it.name));
          // Migrate water items: waterBottles â†’ waterEntries
          state.items.food_water.forEach(it => {
            if (it.isWaterItem) {
              // Rename old "PitnÃ¡ voda" to "ZÃ¡soby pitnej vody"
              if (it.name === "PitnÃ¡ voda") it.name = "ZÃ¡soby pitnej vody";
              // Convert legacy waterBottles to waterEntries
              if (!it.waterEntries) it.waterEntries = [];
              if (it.waterBottles && it.waterBottles > 0 && it.waterEntries.length === 0) {
                it.waterEntries.push({
                  name: "FÄ¾aÅ¡a 1,5 l",
                  liters: 1.5,
                  qty: it.waterBottles,
                  expiry: ""
                });
              }
            }
          });
          // Ensure food tracker item exists
          if (!state.items.food_water.find(it => it.isFoodItem)) {
            state.items.food_water.push({ name: "ZÃ¡soby jedla", isFoodItem: true, foodEntries: [] });
          }
          // Ensure water tracker item exists
          if (!state.items.food_water.find(it => it.isWaterItem)) {
            state.items.food_water.unshift({ name: "ZÃ¡soby pitnej vody", isWaterItem: true, waterEntries: [] });
          }
          // Ensure foodEntries/waterEntries arrays exist
          state.items.food_water.forEach(it => {
            if (it.isFoodItem && !it.foodEntries) it.foodEntries = [];
            if (it.isWaterItem && !it.waterEntries) it.waterEntries = [];
          });
        }
        // Migrate: cash â€“ remove old items, ensure cash tracker exists
        if (state.items.cash) {
          const oldCashNames = ["HotovosÅ¥ na 3â€“7 dnÃ­", "DrobnÃ© mince"];
          state.items.cash = state.items.cash.filter(it => !oldCashNames.includes(it.name));
          if (!state.items.cash.find(it => it.isCashItem)) {
            state.items.cash.push({ name: "HotovosÅ¥ v domÃ¡cnosti", isCashItem: true, cashEntries: [] });
          }
          state.items.cash.forEach(it => {
            if (it.isCashItem && !it.cashEntries) it.cashEntries = [];
          });
        }
      }
      setSyncStatus("synced");
    } catch(e) {
      console.error("Load error", e);
      setSyncStatus("idle");
    }
  }

  async function saveUserData() {
    if (isDemo) {
      // Demo: ukladÃ¡me do sessionStorage (zmizne po zatvorenÃ­ tabu)
      try {
        sessionStorage.setItem('gerlach_demo_state', JSON.stringify(state));
        setSyncStatus("synced");
      } catch(e) { console.warn("Demo save error", e); }
      return;
    }
    if (!currentUser) return;
    setSyncStatus("syncing");
    try {
      await setDoc(userDocRef(currentUser.uid), state);
      setSyncStatus("synced");
    } catch(e) {
      console.error("Save error", e);
      setSyncStatus("idle");
    }
  }

  function scheduleSave() {
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(saveUserData, 1200);
  }

  function setSyncStatus(s) {
    syncStatus = s;
    const dot = document.getElementById("syncDot");
    const lbl = document.getElementById("syncLabel");
    if (!dot || !lbl) return;
    if (isDemo) {
      dot.className = "sync-dot";
      dot.style.background = "#f59e0b";
      lbl.textContent = s === "synced" ? "Demo Â· uloÅ¾enÃ©" : "Demo";
      return;
    }
    dot.style.background = "";
    dot.className = "sync-dot" + (s === "synced" ? " synced" : s === "syncing" ? " syncing" : "");
    lbl.textContent = s === "synced" ? "UloÅ¾enÃ©" : s === "syncing" ? "UkladÃ¡mâ€¦" : "";
  }

  // â”€â”€ Registration limit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function registerNewUser(uid) {
    try {
      const result = await runTransaction(db, async (tx) => {
        const meta = await tx.get(metaRef());
        const count = meta.exists() ? (meta.data().registeredUsers || 0) : 0;
        if (count >= MAX_USERS) throw new Error("LIMIT_REACHED");
        tx.set(metaRef(), { registeredUsers: count + 1 }, { merge: true });
        tx.set(userDocRef(uid), freshState());
        return true;
      });
      return result;
    } catch(e) {
      if (e.message === "LIMIT_REACHED") return false;
      throw e;
    }
  }

  // â”€â”€ Demo mode startup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Ak je ?mode=demo, preskoÄÃ­me celÃ½ Firebase Auth a spustÃ­me appku okamÅ¾ite
  function startDemoMode() {
    document.body.classList.add('is-demo');
    currentUser = { uid: 'demo', displayName: 'Demo pouÅ¾Ã­vateÄ¾', email: null, photoURL: null };

    // NaÄÃ­taj dÃ¡ta zo sessionStorage (ak user sa vrÃ¡til v tom istom tabe)
    loadUserData('demo');

    // UI: demo banner
    document.getElementById('demoBanner').classList.add('visible');

    // UI: version badge â†’ "Demo"
    const badge = document.getElementById('versionBadge');
    if (badge) {
      badge.textContent = 'Demo';
      badge.classList.remove('beta');
      badge.classList.add('demo-badge');
    }

    // UI: avatar
    const av = document.getElementById('userAvatar');
    if (av) av.textContent = 'D';

    // UI: sync indicator â€” show "Demo" instead of hiding
    const syncEl = document.querySelector('.sync-indicator');
    if (syncEl) {
      syncEl.style.display = '';
      const dot = document.getElementById('syncDot');
      const lbl = document.getElementById('syncLabel');
      if (dot) { dot.className = 'sync-dot'; dot.style.background = '#f59e0b'; }
      if (lbl) lbl.textContent = 'Demo';
    }

    // UI: logout â†’ "UkonÄiÅ¥ demo"
    const btnLO = document.getElementById('btnLogout');
    if (btnLO) { btnLO.textContent = 'UkonÄiÅ¥ demo'; btnLO.style.display = ''; }
    const mobileLO = document.querySelector('.mobile-logout-btn');
    if (mobileLO) { mobileLO.textContent = 'ğŸ” UkonÄiÅ¥ demo'; }

    showScreen('app');
    state._profileWasSet = !!state.profile;
    renderAll();
    setupLogoEasterEgg();
    trackEvent('demo_start');
    const emailSection = document.getElementById('emailSettingsInProfile');

    // Demo: "VytvoriÅ¥ ÃºÄet zadarmo" link v banneri â†’ ukonÄÃ­ demo a vrÃ¡ti na login
    const bannerLink = document.getElementById('demoBannerCreateAccount');
    if (bannerLink) {
      bannerLink.onclick = (e) => { e.preventDefault(); document.getElementById('btnLogout').click(); };
    }
    if (emailSection) {
      emailSection.innerHTML = `
        <div style="display:flex; align-items:center; gap:0.5rem;">
          <div>
            <div style="font-size:0.8rem; font-weight:700; color:var(--c-text);">âœ‰ï¸ EmailovÃ© pripomienky</div>
            <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.2rem;">V demo reÅ¾ime nie sÃº dostupnÃ©. UkonÄite demo a vytvorte si ÃºÄet pre emailovÃ© upozornenia na expirÃ¡cie.</div>
          </div>
        </div>`;
    }

    if (!state.profile) openModal('modalProfile');
  }

  // Ak isDemo (z ?mode=demo), spustÃ­me demo okamÅ¾ite
  if (isDemo) {
    startDemoMode();
  }

  // â”€â”€ Auth (len pre normÃ¡lny reÅ¾im) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById("btnGoogleLogin").onclick = async () => {
    if (isDemo) return; // V demo ignoruj Google login
    const provider = new GoogleAuthProvider();
    try {
      await signInWithPopup(auth, provider);
    } catch(e) {
      const err = document.getElementById("loginError");
      err.style.display = "block";
      err.textContent = "PrihlÃ¡senie zlyhalo. SkÃºs znova.";
    }
  };

  // Demo button na login screen
  document.getElementById("btnDemoLogin").onclick = () => {
    isDemo = true;
    startDemoMode();
  };

  document.getElementById("btnLogout").onclick = () => {
    if (isDemo) {
      // Demo: vymaÅ¾ sessionStorage, resetuj stav a vrÃ¡Å¥ na login
      sessionStorage.removeItem('gerlach_demo_state');
      isDemo = false;
      currentUser = null;
      state = freshState();
      // Reset UI demo prvkov
      document.body.classList.remove('is-demo');
      const badge = document.getElementById('versionBadge');
      if (badge) { badge.textContent = 'Beta v0.1'; badge.classList.remove('demo-badge'); badge.classList.add('beta'); }
      document.getElementById('demoBanner').classList.remove('visible');
      const btnLO = document.getElementById('btnLogout');
      if (btnLO) btnLO.textContent = 'OdhlÃ¡siÅ¥';
      const mobileLO = document.querySelector('.mobile-logout-btn');
      if (mobileLO) mobileLO.textContent = 'OdhlÃ¡siÅ¥';
      showScreen("login");
      return;
    }
    signOut(auth);
  };

  // Auth state listener â€” len v normÃ¡lnom reÅ¾ime
  if (!isDemo) {
    onAuthStateChanged(auth, async (user) => {
    // Ak medziÄasom uÅ¾Ã­vateÄ¾ spustil demo, nerob niÄ
    if (isDemo) return;
    if (!user) {
      currentUser = null;
      // Reset state pri odhlÃ¡senÃ­ - Å¾iadne dÃ¡ta nezostanÃº v pamÃ¤ti
      state = freshState();
      showScreen("login");
      return;
    }
    currentUser = user;
    // VÅ¾dy zaÄneme s ÄistÃ½m state pred naÄÃ­tanÃ­m dÃ¡t z Firestore
    state = freshState();
    // Check if user already has data
    const snap = await getDoc(userDocRef(user.uid));
    if (!snap.exists()) {
      // New user â€“ check limit
      const ok = await registerNewUser(user.uid);
      if (!ok) {
        showScreen("closed");
        await signOut(auth);
        return;
      }
    } else {
      await loadUserData(user.uid);
    }

    // Update avatar
    const av = document.getElementById("userAvatar");
    if (user.photoURL) {
      const img = document.createElement("img");
      img.src = user.photoURL;
      img.alt = "avatar";
      av.innerHTML = "";
      av.appendChild(img);
    } else {
      av.textContent = (user.displayName || user.email || "U")[0].toUpperCase();
    }

    showScreen("app");
    state._profileWasSet = !!state.profile;
    renderAll();
    setupLogoEasterEgg();
    trackEvent('login', { method: 'google', is_new: !snap.exists() });
    if (!state.profile) openModal("modalProfile");
    // Skontroluj expirÃ¡cie a poÅ¡li notifikÃ¡cie (ak treba)
    setTimeout(checkAndSendNotifications, 2000);
  });
  } // end if (!isDemo)

  function showScreen(name) {
    document.getElementById("loginScreen").style.display = name === "login" ? "flex" : "none";
    document.getElementById("closedScreen").style.display = name === "closed" ? "flex" : "none";
    document.getElementById("appScreen").style.display = name === "app" ? "block" : "none";
  }

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function esc(s) {
    return String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
  }

  function daysUntil(d) {
    const ms = new Date(d + "T00:00:00") - new Date();
    return Math.ceil(ms / 86400000);
  }

  function colorForPct(p) {
    // PlynulÃ½ prechod: 0% = ÄervenÃ¡ (hsl 0), 100% = zelenÃ¡ (hsl 120)
    const h = Math.round((Math.min(100, Math.max(0, p)) / 100) * 120);
    const s = 75;
    const l = p < 15 ? 42 : p > 85 ? 36 : 38;
    return `hsl(${h} ${s}% ${l}%)`;
  }

  function rankForPct(p) {
    if (p <= 20) return "Ste eÅ¡te na zaÄiatku";
    if (p <= 40) return "UÅ¾ mÃ¡te zÃ¡klad";
    if (p <= 60) return "DobrÃ½ zÃ¡klad";
    if (p <= 80) return "VeÄ¾mi sluÅ¡ne";
    return "VÃ½borne pripravenÃ­";
  }

  function emojiForPct(p) {
    return "";
  }

  // â”€â”€ Voda â€“ inteligentnÃ½ kalkulÃ¡tor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // OdporÃºÄania WHO pre nÃºdzovÃ© situÃ¡cie: min. 2,5â€“3 l na osobu/deÅˆ na pitie
  // Appka pouÅ¾Ã­va 2 l/deÅˆ dospelÃ½, 1.5 l dieÅ¥a, 1 l batoÄ¾a, 2 l senior (konzervat. odhad na pitie)
  // Zdroj: WHO Technical Notes on WASH in Emergencies (Technical Note No. 9)
  const WATER_SOURCE_URL = "https://www.who.int/teams/environment-climate-change-and-health/water-sanitation-and-health/environmental-health-in-emergencies/humanitarian-emergencies";
  const WATER_SOURCE_LABEL = "WHO â€“ Water, Sanitation and Health in Emergencies";

  function getDailyWaterNeed() {
    if (!state.profile) return 0;
    const p = state.profile;
    const coeff = p.readinessCoeff || 1.0;
    return ((p.adults||0)*2 + (p.kids||0)*1.5 + (p.infants||0)*1 + (p.seniors||0)*2) * coeff;
  }

  function getTotalWaterLiters(item) {
    if (!item.isWaterItem) return 0;
    // Support legacy waterBottles field
    if (item.waterBottles && (!item.waterEntries || item.waterEntries.length === 0)) {
      return (item.waterBottles || 0) * 1.5;
    }
    if (!item.waterEntries) return 0;
    return item.waterEntries.reduce((sum, e) => sum + ((e.liters||0) * (e.qty||1)), 0);
  }

  function calcWaterCompletion(item) {
    if (!item.isWaterItem || !state.profile) return item.done ? 100 : 0;
    const p = state.profile;
    const d = p.prepDays || 3;
    const total = getDailyWaterNeed() * d;
    if (!total) return 0;
    return Math.min(100, (getTotalWaterLiters(item) / total) * 100);
  }

  // â”€â”€ KalÃ³rie / Jedlo â€“ inteligentnÃ½ kalkulÃ¡tor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // OdporÃºÄanÃ© dennÃ© kcal podÄ¾a EFSA (European Food Safety Authority)
  // Scientific Opinion on Dietary Reference Values for Energy (2013)
  // PAL 1.4 (sedentÃ¡rna aktivita â€“ krÃ­zovÃ½ reÅ¾im), BMI 22 kg/mÂ²
  // Zdroj: EFSA Journal 2013;11(1):3005
  const KCAL_PER_DAY = {
    adult:  2000,  // priemer muÅ¾/Å¾ena, PAL 1.4 (sedentÃ¡rna)
    kid:    1500,  // deti 4â€“17 r., priemer
    infant: 1000,  // batoÄ¾atÃ¡ 0â€“3 r.
    senior: 1800   // seniori 65+, PAL 1.4
  };
  const KCAL_SOURCE_URL = "https://www.efsa.europa.eu/en/efsajournal/pub/3005";
  const KCAL_SOURCE_LABEL = "EFSA â€“ Dietary Reference Values for Energy (2013)";

  function getDailyKcalNeed() {
    if (!state.profile) return 0;
    const p = state.profile;
    const coeff = p.readinessCoeff || 1.0;
    return ((p.adults||0) * KCAL_PER_DAY.adult
          + (p.kids||0)   * KCAL_PER_DAY.kid
          + (p.infants||0)* KCAL_PER_DAY.infant
          + (p.seniors||0)* KCAL_PER_DAY.senior) * coeff;
  }

  function getTotalFoodKcal(item) {
    if (!item.isFoodItem || !item.foodEntries) return 0;
    return item.foodEntries.reduce((sum, e) => sum + ((e.kcal||0) * (e.qty||1)), 0);
  }

  function calcFoodCompletion(item) {
    if (!item.isFoodItem || !state.profile) return 0;
    const d = state.profile.prepDays || 3;
    const totalNeeded = getDailyKcalNeed() * d;
    if (!totalNeeded) return 0;
    return Math.min(100, (getTotalFoodKcal(item) / totalNeeded) * 100);
  }

  // â”€â”€ HotovosÅ¥ â€“ inteligentnÃ½ kalkulÃ¡tor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ECB Å¡tÃºdia "Keep calm and carry cash" (2025) odporÃºÄa â‚¬70â€“100 / osobu na 72h
  // RakÃºska iniciatÃ­va "Bargeld fÃ¼r alle FÃ¤lle": ~â‚¬100 / Älen domÃ¡cnosti
  // EU Preparedness Union Strategy (2025): 72h sebestaÄnosÅ¥ vrÃ¡tane hotovosti
  const CASH_PER_PERSON = 100; // â‚¬ na osobu
  const CASH_SOURCE_URL = "https://cashessentials.org/eu-recommends-including-cash-as-a-crucial-component-of-emergency-kits/";
  const CASH_SOURCE_LABEL = "ECB & EU â€“ HotovosÅ¥ ako sÃºÄasÅ¥ nÃºdzovÃ©ho vybavenia (2025)";

  function getRecommendedCash() {
    if (!state.profile) return 0;
    const p = state.profile;
    const totalPersons = (p.adults||0) + (p.kids||0) + (p.infants||0) + (p.seniors||0);
    return totalPersons * CASH_PER_PERSON;
  }

  function getTotalCash(item) {
    if (!item.isCashItem || !item.cashEntries) return 0;
    return item.cashEntries.reduce((sum, e) => sum + ((e.value||0) * (e.qty||1)), 0);
  }

  function calcCashCompletion(item) {
    if (!item.isCashItem || !state.profile) return 0;
    const needed = getRecommendedCash();
    if (!needed) return 0;
    return Math.min(100, (getTotalCash(item) / needed) * 100);
  }

  function categoryScore(catId) {
    const items = state.items[catId] || [];
    if (!items.length) return 0;
    return items.reduce((sum, it) => sum + (it.isWaterItem ? calcWaterCompletion(it) : it.isFoodItem ? calcFoodCompletion(it) : it.isCashItem ? calcCashCompletion(it) : it.done ? 100 : 0), 0) / items.length;
  }

  function overallScore() {
    const { sum, w } = CATEGORIES.reduce((acc, c) => ({
      sum: acc.sum + categoryScore(c.id) * c.weight,
      w: acc.w + c.weight
    }), { sum: 0, w: 0 });
    return w ? sum / w : 0;
  }

  function isValidUrl(u) {
    try { const url = new URL(u); return url.protocol === "https:" || url.protocol === "http:"; } catch { return false; }
  }

  // â”€â”€ Modal helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openModal(id) {
    const overlay = document.getElementById(id);
    overlay.classList.add("open");
    overlay.setAttribute("aria-modal", "true");
    overlay.setAttribute("role", "dialog");
    // Auto-detect label from first heading or title element in modal
    const box = overlay.querySelector(".modal-box");
    if (box) {
      const titleEl = box.querySelector("h3[id], [id*='Title'], [id*='ModalTitle']") || box.querySelector("h3");
      if (titleEl) {
        if (!titleEl.id) titleEl.id = id + "_autoTitle";
        overlay.setAttribute("aria-labelledby", titleEl.id);
      }
    }
    document.body.style.overflow = "hidden";
    // Store the element that opened the modal so we can restore focus
    overlay._previousFocus = document.activeElement;
    // Focus the first focusable element inside the modal (or close button)
    requestAnimationFrame(() => {
      if (box) {
        const firstFocusable = box.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if (firstFocusable) firstFocusable.focus();
      }
    });
  }
  function closeModal(id) {
    const overlay = document.getElementById(id);
    overlay.classList.remove("open");
    overlay.removeAttribute("aria-modal");
    overlay.removeAttribute("aria-labelledby");
    // Obnov scroll len ak Å¾iadny inÃ½ modal nie je otvorenÃ½
    if (!document.querySelector('.modal-overlay.open')) {
      document.body.style.overflow = "";
    }
    // Restore focus to the element that opened the modal
    if (overlay._previousFocus && typeof overlay._previousFocus.focus === 'function') {
      overlay._previousFocus.focus();
    }
  }
  document.querySelectorAll("[data-close]").forEach(b => b.onclick = () => closeModal(b.dataset.close));

  // â”€â”€ Escape key closes topmost modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      const openModals = [...document.querySelectorAll('.modal-overlay.open')];
      if (openModals.length > 0) {
        e.preventDefault();
        closeModal(openModals[openModals.length - 1].id);
      }
    }
  });

  // â”€â”€ Focus trap: keep Tab cycling within open modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener("keydown", (e) => {
    if (e.key !== "Tab") return;
    const openModal = document.querySelector('.modal-overlay.open');
    if (!openModal) return;
    const box = openModal.querySelector('.modal-box');
    if (!box) return;
    const focusable = [...box.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')].filter(el => {
      return !el.disabled && el.offsetParent !== null;
    });
    if (focusable.length === 0) return;
    const first = focusable[0];
    const last = focusable[focusable.length - 1];
    if (e.shiftKey) {
      if (document.activeElement === first || !box.contains(document.activeElement)) {
        e.preventDefault();
        last.focus();
      }
    } else {
      if (document.activeElement === last || !box.contains(document.activeElement)) {
        e.preventDefault();
        first.focus();
      }
    }
  });

  // â”€â”€ Swipe-to-dismiss for mobile modals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  (function() {
    const THRESHOLD = 80;  // px to dismiss
    const VELOCITY_THRESHOLD = 0.5; // px/ms for quick swipes
    let startY = 0, currentY = 0, startTime = 0, activeBox = null, activeOverlay = null;

    document.addEventListener("touchstart", (e) => {
      const overlay = e.target.closest(".modal-overlay.open");
      if (!overlay) return;
      const box = overlay.querySelector(".modal-box");
      if (!box) return;
      // Only start swipe from top 48px of modal (handle area) or if scrolled to top
      const touch = e.touches[0];
      const boxRect = box.getBoundingClientRect();
      const touchInHandle = touch.clientY - boxRect.top < 48;
      const scrolledToTop = box.scrollTop <= 0;
      if (!touchInHandle && !scrolledToTop) return;
      startY = touch.clientY;
      currentY = startY;
      startTime = Date.now();
      activeBox = box;
      activeOverlay = overlay;
      activeBox.style.transition = "none";
    }, { passive: true });

    document.addEventListener("touchmove", (e) => {
      if (!activeBox) return;
      currentY = e.touches[0].clientY;
      const dy = currentY - startY;
      if (dy > 0) {
        activeBox.style.transform = `translateY(${dy}px)`;
        activeOverlay.style.background = `rgba(0,0,0,${Math.max(0, 0.4 - dy * 0.002)})`;
      }
    }, { passive: true });

    document.addEventListener("touchend", () => {
      if (!activeBox) return;
      const dy = currentY - startY;
      const dt = Date.now() - startTime;
      const velocity = dy / Math.max(dt, 1);
      if (dy > THRESHOLD || velocity > VELOCITY_THRESHOLD) {
        // Dismiss
        activeBox.style.transition = "transform 0.25s ease-out";
        activeBox.style.transform = `translateY(100%)`;
        activeOverlay.style.transition = "background 0.25s";
        activeOverlay.style.background = "rgba(0,0,0,0)";
        const overlayId = activeOverlay.id;
        setTimeout(() => {
          closeModal(overlayId);
          const box = document.querySelector(`#${overlayId} .modal-box`);
          if (box) { box.style.transform = ""; box.style.transition = ""; }
          const ov = document.getElementById(overlayId);
          if (ov) { ov.style.background = ""; ov.style.transition = ""; }
        }, 260);
      } else {
        // Snap back
        activeBox.style.transition = "transform 0.2s ease";
        activeBox.style.transform = "";
        activeOverlay.style.transition = "background 0.2s";
        activeOverlay.style.background = "";
      }
      activeBox = null;
      activeOverlay = null;
    }, { passive: true });
  })();
  function makeAccessibleCard(el, label, handler) {
    el.setAttribute("tabindex", "0");
    el.setAttribute("role", "button");
    el.setAttribute("aria-label", label);
    el.onclick = handler;
    el.onkeydown = (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        handler();
      }
    };
  }

  // â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  // â”€â”€ Slovak Progress Milestones â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getMilestoneHtml(pct) {
    let msg = "";
    if (pct <= 5) return "";
    if (pct < 25) msg = "KaÅ¾dÃ½ krok sa poÄÃ­ta";
    else if (pct < 50) msg = "PrvÃ½ krok na Rysy â€” zÃ¡klad stojÃ­";
    else if (pct < 75) msg = "Pol cesty na KrivÃ¡Åˆ â€” ste Äalej neÅ¾ vÃ¤ÄÅ¡ina";
    else if (pct < 100) msg = "Sedlo pod Gerlachom â€” uÅ¾ len kÃºsok";
    else msg = "Na vrchole Gerlachu! ğŸ‡¸ğŸ‡°";
    return `<div class="hero-milestone">${msg}</div>`;
  }

  // â”€â”€ Confetti (Slovak flag colors) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let confettiTriggered = false;
  function triggerSlovakConfetti() {
    if (confettiTriggered) return;
    confettiTriggered = true;
    const canvas = document.createElement('canvas');
    canvas.id = 'confettiCanvas';
    document.body.appendChild(canvas);
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const colors = ['#ffffff', '#0b4ea2', '#ee1c25', '#ffffff', '#0b4ea2', '#ee1c25', '#ffd700'];
    const particles = [];
    for (let i = 0; i < 150; i++) {
      particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height - canvas.height,
        w: Math.random() * 8 + 4,
        h: Math.random() * 6 + 3,
        color: colors[Math.floor(Math.random() * colors.length)],
        vx: (Math.random() - 0.5) * 3,
        vy: Math.random() * 3 + 2,
        rot: Math.random() * Math.PI * 2,
        vr: (Math.random() - 0.5) * 0.15,
        opacity: 1
      });
    }

    let frame = 0;
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      let alive = false;
      particles.forEach(p => {
        if (p.opacity <= 0) return;
        alive = true;
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        p.vy += 0.05;
        if (frame > 120) p.opacity -= 0.015;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.globalAlpha = Math.max(0, p.opacity);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
        ctx.restore();
      });
      frame++;
      if (alive && frame < 300) {
        requestAnimationFrame(animate);
      } else {
        canvas.remove();
        // Reset after some time so it can trigger again if user drops below and returns
        setTimeout(() => { confettiTriggered = false; }, 60000);
      }
    }
    animate();
  }

  // â”€â”€ Easter Egg: Tatry Panorama (5 clicks on logo) â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let logoClicks = 0;
  let logoClickTimer = null;
  function setupLogoEasterEgg() {
    const logo = document.getElementById('headerLogo');
    if (!logo) return;
    logo.onclick = () => {
      logoClicks++;
      clearTimeout(logoClickTimer);
      logoClickTimer = setTimeout(() => { logoClicks = 0; }, 2000);
      if (logoClicks >= 5) {
        logoClicks = 0;
        showTatryEasterEgg();
      }
    };
  }

  function showTatryEasterEgg() {
    let el = document.getElementById('tatryEasterEgg');
    if (!el) {
      el = document.createElement('div');
      el.id = 'tatryEasterEgg';
      el.className = 'easter-tatry';
      el.innerHTML = `
        <svg class="easter-tatry-mountains" viewBox="0 0 800 200" fill="none" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="mt1" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#8fa4bf"/><stop offset="100%" stop-color="#4a6fa5"/></linearGradient>
            <linearGradient id="mt2" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#a0b4c8"/><stop offset="100%" stop-color="#5a7fb5"/></linearGradient>
            <linearGradient id="snow" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="white"/><stop offset="100%" stop-color="#c8d8e8"/></linearGradient>
          </defs>
          <!-- Back range -->
          <path d="M0 200 L50 120 L100 140 L180 70 L250 110 L320 50 L380 85 L430 30 L480 75 L530 45 L580 90 L640 60 L700 100 L750 75 L800 110 L800 200Z" fill="url(#mt1)" opacity="0.6"/>
          <!-- Front range -->
          <path d="M0 200 L80 130 L140 150 L220 80 L280 120 L350 55 L400 90 L450 35 L500 80 L550 50 L610 100 L660 70 L720 115 L780 90 L800 105 L800 200Z" fill="url(#mt2)"/>
          <!-- Snow caps -->
          <path d="M430 30 L445 50 L450 35 L460 55 L480 75 L470 60 L455 48 L440 55 L425 45Z" fill="url(#snow)" opacity="0.9"/>
          <path d="M350 55 L365 72 L370 60 L380 75 L380 85 L370 70 L358 65Z" fill="url(#snow)" opacity="0.8"/>
          <path d="M530 45 L545 62 L550 50 L560 68 L570 80 L555 65 L540 58Z" fill="url(#snow)" opacity="0.8"/>
          <!-- Stars -->
          <circle cx="100" cy="30" r="1.5" fill="white" opacity="0.8"/>
          <circle cx="250" cy="15" r="1" fill="white" opacity="0.6"/>
          <circle cx="600" cy="20" r="1.5" fill="white" opacity="0.7"/>
          <circle cx="700" cy="35" r="1" fill="white" opacity="0.5"/>
          <circle cx="400" cy="10" r="2" fill="white" opacity="0.9"/>
        </svg>
        <div class="easter-tatry-quote">â€Kto raz bol na Gerlachu,<br>zvlÃ¡dne vÅ¡etko.â€</div>
        <div class="easter-tatry-sub">Klikni kamkoÄ¾vek pre nÃ¡vrat</div>
      `;
      el.onclick = () => el.classList.remove('visible');
      document.body.appendChild(el);
    }
    el.classList.add('visible');
  }

  // â”€â”€ Tab Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function switchTab(tabName) {
    document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
    const paneMap = { preparation: 'tabPreparation', knowledge: 'tabKnowledge', plan: 'tabPlan', contacts: 'tabContacts' };
    const paneId = paneMap[tabName] || 'tabPreparation';
    document.getElementById(paneId).classList.add('active');
    document.querySelectorAll('.tab-btn').forEach(b => {
      b.classList.toggle('active', b.dataset.tab === tabName);
    });
    trackEvent('tab_switch', { tab: tabName });
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  window.switchTab = switchTab;

  // â”€â”€ Hero Banner (merged profile + progress) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderHeroBanner() {
    const box = document.getElementById("heroBanner");
    const onb = document.getElementById("onboardingCard");
    const catSection = document.getElementById("categoriesSection");

    if (!state.profile) {
      box.style.display = "none";
      if (onb) onb.style.display = "block";
      if (catSection) catSection.style.display = "none";
      return;
    }

    box.style.display = "block";
    if (onb) onb.style.display = "none";
    if (catSection) catSection.style.display = "block";

    const p = state.profile;
    const pct = overallScore();
    const col = colorForPct(pct);
    const rank = rankForPct(pct);
    const emoji = emojiForPct(pct);
    const d = p.prepDays || 3;
    const totalPersons = (p.adults||0)+(p.kids||0)+(p.infants||0)+(p.seniors||0);
    const housingMap = { flat: "Byt", rd: "RodinnÃ½ dom", rd_cellar: "RD + pivnica" };
    const budgetMap = { mid: "ZÃ¡kladnÃ¡", premium: "PrÃ©miovÃ¡" };

    box.innerHTML = `
      <div class="hero-top">
        <div class="hero-rank"><span>${rank}</span></div>
        <div style="display:flex; align-items:center; gap:0.75rem;">
          <span class="hero-pct" style="color:${col};">${Math.round(pct)}%</span>
          <button class="btn-ghost" id="btnEditProfile" style="font-size:0.78rem; padding:0.375rem 0.75rem;">UpraviÅ¥ âš™ï¸</button>
        </div>
      </div>
      <div class="progress-bar" style="height:10px; position:relative; z-index:1;">
        <div class="progress-fill" style="width:${Math.round(pct)}%; background:${col};"></div>
      </div>
      ${getMilestoneHtml(pct)}
      <div class="hero-meta">
        <span class="hero-tag">ğŸ‘¥ ${totalPersons} ${totalPersons === 1 ? "osoba" : totalPersons < 5 ? "osoby" : "osÃ´b"}</span>
        <span class="hero-tag">ğŸ“… ${d} ${d === 1 ? "deÅˆ" : d < 5 ? "dni" : "dnÃ­"}</span>
        <span class="hero-tag">ğŸ  ${housingMap[p.housing] || "â€“"}</span>
        <span class="hero-tag">ğŸ’° ${budgetMap[p.budget] || "â€“"}</span>
      </div>`;

    // Re-bind edit profile button
    document.getElementById("btnEditProfile").onclick = openProfileEditor;
  }

  function renderProfileCard() { renderHeroBanner(); }

  function renderOverall() {
    const pct = overallScore();
    const col = colorForPct(pct);
    const mobBar = document.getElementById("overallBarMobile");
    const mobPct = document.getElementById("overallPctMobile");
    if (mobBar) { mobBar.style.width = Math.min(100, pct) + "%"; mobBar.style.background = col; }
    if (mobPct) { mobPct.textContent = Math.round(pct) + "%"; mobPct.style.color = col; }
  }

  function renderCategories() {
    const grid = document.getElementById("categoriesGrid");
    grid.innerHTML = "";
    for (const c of CATEGORIES) {
      const pct = categoryScore(c.id);
      const isSel = state.selectedCategoryId === c.id;
      const col = colorForPct(pct);
      // DynamickÃ¡ farba karty podÄ¾a % - jemnÃ½ tint pozadia a border
      const hue = Math.round((Math.min(100, Math.max(0, pct)) / 100) * 120);
      const cardBg = pct === 0 ? "var(--c-surface)" : `hsl(${hue} 60% 97%)`;
      const cardBorder = isSel
        ? `hsl(${hue} 65% ${pct === 0 ? 55 : 48}%)`
        : pct === 0 ? "var(--c-border)" : `hsl(${hue} 50% 82%)`;
      const cardShadow = isSel
        ? `0 10px 28px hsl(${hue} 60% 40% / 0.18)`
        : "0 1px 3px rgba(0,0,0,0.04)";

      const card = document.createElement("div");
      card.className = "cat-card" + (isSel ? " selected" : "");
      card.style.cssText = `background:${cardBg}; border-color:${cardBorder}; box-shadow:${cardShadow};`;
      card.innerHTML = `
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
          <div style="font-size:1.375rem;">${c.emoji}</div>
          <span style="font-size:1.125rem; font-weight:800; color:${col}; letter-spacing:-0.02em;">${Math.round(pct)}%</span>
        </div>
        <div style="font-weight:700; font-size:0.9375rem; margin-bottom:0.2rem; color:var(--c-text);">${c.name}</div>
        <div style="font-size:0.72rem; color:${pct === 0 ? 'var(--c-muted)' : col}; margin-bottom:0.625rem; font-weight:500;">splnenÃ© na ${Math.round(pct)}%</div>
        <div class="progress-bar" style="height:6px;">
          <div class="progress-fill" style="width:${Math.min(100,pct)}%; background:${col};"></div>
        </div>`;
      card.onclick = () => {
        state.selectedCategoryId = c.id;
        scheduleSave();
        renderCategories();
        openCategoryModal(c);
      };
      card.setAttribute("tabindex", "0");
      card.setAttribute("role", "button");
      card.setAttribute("aria-label", c.name + " â€“ " + Math.round(pct) + "% splnenÃ©");
      card.onkeydown = (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          card.onclick();
        }
      };
      grid.appendChild(card);
    }
  }

  // OtvoriÅ¥ modÃ¡lne okno kategÃ³rie
  function openCategoryModal(cat) {
    renderCategoryDetail();
    openModal("modalCategory");
  }

  function renderCategoryDetail() {
    const catId = state.selectedCategoryId;
    const cat = CATEGORIES.find(c => c.id === catId);
    const items = state.items[catId] || [];
    const pct = categoryScore(catId);
    const detail = document.getElementById("categoryDetail");
    detail.innerHTML = "";

    // Hide "PridaÅ¥ poloÅ¾ku" button for categories with smart trackers
    const addBtn = document.getElementById("btnAddItem");
    if (addBtn) addBtn.style.display = (catId === "food_water" || catId === "cash") ? "none" : "flex";

    // Aktualizuj modal header
    const modalHeader = document.getElementById("modalCatHeader");
    if (modalHeader) {
      modalHeader.innerHTML = `
        <div style="display:flex; align-items:center; gap:0.875rem;">
          <div style="font-size:1.5rem;">${cat.emoji}</div>
          <div>
            <div style="font-size:1.125rem; font-weight:800; letter-spacing:-0.01em; line-height:1.2;">${cat.name}</div>
            <div style="font-size:0.78rem; color:var(--c-muted); margin-top:0.125rem;">${items.filter(i=>i.isWaterItem ? calcWaterCompletion(i)>=100 : i.isFoodItem ? calcFoodCompletion(i)>=100 : i.isCashItem ? calcCashCompletion(i)>=100 : i.done).length} / ${items.length} hotovo</div>
          </div>
          <div style="margin-left:auto; text-align:right; padding-right:0.5rem; line-height:1.1;">
            <div style="font-size:0.72rem; color:var(--c-muted);">splnenÃ© na</div>
            <div style="font-size:1.625rem; font-weight:800; color:${colorForPct(pct)}; letter-spacing:-0.03em;">${Math.round(pct)}%</div>
          </div>
        </div>
        <div style="margin-top:0.75rem;">
          <div class="progress-bar" style="height:6px;">
            <div class="progress-fill" style="width:${Math.min(100,pct)}%; background:${colorForPct(pct)};"></div>
          </div>
        </div>`;
    }

    // Progress v footer
    const modalProgress = document.getElementById("modalCatProgress");
    if (modalProgress) {
      modalProgress.textContent = `${items.filter(i=>i.isWaterItem ? calcWaterCompletion(i)>=100 : i.isFoodItem ? calcFoodCompletion(i)>=100 : i.isCashItem ? calcCashCompletion(i)>=100 : i.done).length} z ${items.length} poloÅ¾iek splnenÃ½ch`;
    }

    const list = document.createElement("div");
    list.style.cssText = "display:flex; flex-direction:column; gap:0.5rem;";

    // Docs category: info banner about storage strategy
    if (catId === "docs") {
      const banner = document.createElement("div");
      banner.innerHTML = `
        <div style="background:linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border:1.5px solid #bfdbfe; border-radius:1rem; padding:1rem; margin-bottom:1rem;">
          <div style="font-weight:700; font-size:0.85rem; color:#1e40af; margin-bottom:0.5rem;">ğŸ“‹ Kde uchovÃ¡vaÅ¥ dokumenty?</div>
          <div style="display:grid; grid-template-columns:repeat(2, 1fr); gap:0.375rem; font-size:0.72rem; line-height:1.5;">
            <div style="background:white; border-radius:0.5rem; padding:0.5rem 0.625rem; border:1px solid #bfdbfe;">
              <strong style="color:#1e40af;">ğŸ“ OriginÃ¡l</strong><br>
              <span style="color:var(--c-muted);">Doma v bezpeÄnom mieste (trezor, ohnivzdornÃ¡ schrÃ¡nka)</span>
            </div>
            <div style="background:white; border-radius:0.5rem; padding:0.5rem 0.625rem; border:1px solid #bfdbfe;">
              <strong style="color:#1e40af;">ğŸ“„ KÃ³pia</strong><br>
              <span style="color:var(--c-muted);">PapierovÃ¡ kÃ³pia v evakuaÄnom batohu + u prÃ­buznÃ½ch</span>
            </div>
            <div style="background:white; border-radius:0.5rem; padding:0.5rem 0.625rem; border:1px solid #bfdbfe;">
              <strong style="color:#1e40af;">ğŸ’¾ USB</strong><br>
              <span style="color:var(--c-muted);">Å ifrovanÃ½ USB kÄ¾ÃºÄ v batohu â€“ scany vÅ¡etkÃ½ch dokumentov</span>
            </div>
            <div style="background:white; border-radius:0.5rem; padding:0.5rem 0.625rem; border:1px solid #bfdbfe;">
              <strong style="color:#1e40af;">â˜ï¸ Cloud</strong><br>
              <span style="color:var(--c-muted);">Å ifrovanÃ© ÃºloÅ¾isko (Google Drive, iCloud) â€“ prÃ­stup odkiaÄ¾koÄ¾vek</span>
            </div>
          </div>
          <div style="margin-top:0.5rem; font-size:0.7rem; color:#2563eb; line-height:1.5; font-style:italic;">
            âš ï¸ Crypto seed / recovery frÃ¡zy NIKDY nescanovaÅ¥ a neukladaÅ¥ digitÃ¡lne! Iba papier na 2 odliÅ¡nÃ½ch miestach.
          </div>
        </div>`;
      list.appendChild(banner);
    }

    // Source info banner - stored for placement at bottom
    let srcBannerEl = null;
    if (catId !== "docs" && CATEGORY_SOURCES[catId]) {
      const src = CATEGORY_SOURCES[catId];
      srcBannerEl = document.createElement("div");
      const sourceColor = catId === "food_water" ? { bg1: "#f0fdf4", bg2: "#dcfce7", border: "#86efac", title: "#166534", text: "#15803d" }
        : catId === "medkit" ? { bg1: "#fef2f2", bg2: "#fee2e2", border: "#fca5a5", title: "#991b1b", text: "#b91c1c" }
        : catId === "cash" ? { bg1: "#fefce8", bg2: "#fef9c3", border: "#fde047", title: "#854d0e", text: "#854d0e" }
        : catId === "hygiene" ? { bg1: "#fdf4ff", bg2: "#fae8ff", border: "#e9d5ff", title: "#6b21a8", text: "#7c3aed" }
        : { bg1: "#eff6ff", bg2: "#dbeafe", border: "#93c5fd", title: "#1e40af", text: "#2563eb" };
      const linksHtml = src.sources.map(s =>
        `<div style="padding:0.125rem 0;">â†’ <a href="${s.url}" target="_blank" rel="noopener" style="color:#2563eb; text-decoration:underline;">${s.label}</a></div>`
      ).join("");
      srcBannerEl.innerHTML = `
        <div style="background:linear-gradient(135deg, ${sourceColor.bg1} 0%, ${sourceColor.bg2} 100%); border:1.5px solid ${sourceColor.border}; border-radius:1rem; padding:0.875rem; margin-top:1rem;">
          <div style="font-weight:700; font-size:0.8rem; color:${sourceColor.title}; margin-bottom:0.375rem;">ğŸ“š Zdroje odporÃºÄanÃ­</div>
          <div style="font-size:0.7rem; line-height:1.5; color:${sourceColor.text};">
            <div style="margin-bottom:0.375rem;">${src.note}</div>
            <div style="font-size:0.65rem; color:var(--c-muted);">${linksHtml}</div>
          </div>
        </div>`;
    }

    if (!items.length) {
      list.innerHTML = `<p style="color:var(--c-muted); font-size:0.875rem;">ZatiaÄ¾ Å¾iadne poloÅ¾ky.</p>`;
    } else {
      let lastDocGroup = "";
      items.forEach((it, idx) => {
        // Group headers for docs category
        if (catId === "docs" && it.docGroup && it.docGroup !== lastDocGroup) {
          lastDocGroup = it.docGroup;
          const groupEmojis = { "OsobnÃ© dokumenty": "ğŸªª", "Majetok a bÃ½vanie": "ğŸ ", "Auto a doprava": "ğŸš—", "Vzdelanie a prÃ¡ca": "ğŸ“", "Financie": "ğŸ’°", "ZdravotnÃ© dokumenty": "ğŸ¥", "KrÃ­zovÃ© dokumenty": "ğŸš¨" };
          const gh = document.createElement("div");
          gh.style.cssText = "padding:0.625rem 0 0.25rem; margin-top:0.375rem;";
          gh.innerHTML = `<div style="font-size:0.72rem; font-weight:700; color:var(--c-muted); text-transform:uppercase; letter-spacing:0.05em;">${groupEmojis[it.docGroup]||"ğŸ“‹"} ${it.docGroup}</div>`;
          list.appendChild(gh);
        }
        if (it.isWaterItem && state.profile) {
          const p = state.profile;
          const d = p.prepDays || 3;
          const dailyNeed = getDailyWaterNeed();
          const total = dailyNeed * d;
          const current = getTotalWaterLiters(it);
          const wpct = calcWaterCompletion(it);
          const wCol = colorForPct(wpct);
          const entries = it.waterEntries || [];

          // Duration calculation
          const totalHours = dailyNeed > 0 ? (current / dailyNeed) * 24 : 0;
          const durDays = Math.floor(totalHours / 24);
          const durHours = Math.round(totalHours % 24);

          let durText = "";
          if (current === 0) {
            durText = "Å½iadna zÃ¡soba";
          } else if (totalHours < 24) {
            const h = Math.round(totalHours);
            durText = h <= 0 ? "Menej ako hodinu" : h === 1 ? "1 hodinu" : h < 5 ? h + " hodiny" : h + " hodÃ­n";
          } else {
            const dayWord = durDays === 1 ? "deÅˆ" : durDays < 5 ? "dni" : "dnÃ­";
            const hourPart = durHours > 0 ? (" a " + durHours + (durHours === 1 ? " hodinu" : durHours < 5 ? " hodiny" : " hodÃ­n")) : "";
            durText = durDays + " " + dayWord + hourPart;
          }
          const durPct = Math.min(100, (totalHours / (d * 24)) * 100);
          const durHue = Math.round((Math.min(100, Math.max(0, durPct)) / 100) * 120);
          const durColor = `hsl(${durHue} 70% 34%)`;
          const durBg = `hsl(${durHue} 70% 96%)`;
          const durBorder = `hsl(${durHue} 60% 80%)`;

          // Water breakdown per person type
          const waterBreakdown = [];
          if (p.adults) waterBreakdown.push(`${p.adults}Ã— dospelÃ½: 2 l`);
          if (p.kids) waterBreakdown.push(`${p.kids}Ã— dieÅ¥a: 1,5 l`);
          if (p.infants) waterBreakdown.push(`${p.infants}Ã— batoÄ¾a: 1 l`);
          if (p.seniors) waterBreakdown.push(`${p.seniors}Ã— senior: 2 l`);

          // Water entries HTML
          let wEntriesHtml = "";
          if (entries.length === 0) {
            wEntriesHtml = `<div style="text-align:center; padding:1rem 0; color:var(--c-muted); font-size:0.82rem;">ZatiaÄ¾ Å¾iadna voda. Pridajte prvÃº poloÅ¾ku niÅ¾Å¡ie.</div>`;
          } else {
            wEntriesHtml = entries.map((e, ei) => {
              const eExp = e.expiry ? daysUntil(e.expiry) : null;
              const catAD = getAlertDaysForCategory("food_water");
              const eExpBadge = e.expiry
                ? (eExp < 0 ? `<span class="badge badge-red" style="font-size:0.62rem;">EXP</span>`
                  : eExp <= catAD ? `<span class="badge badge-amber" style="font-size:0.62rem;">${eExp}d</span>`
                  : `<span class="badge badge-gray" style="font-size:0.62rem;">${eExp}d</span>`)
                : "";
              const totalE = (e.liters||0)*(e.qty||1);
              return `<div style="display:flex; align-items:center; gap:0.5rem; padding:0.5rem 0.625rem; background:rgba(255,255,255,0.6); border-radius:0.5rem; border:1px solid rgba(59,130,246,0.15);">
                <div style="flex:1; min-width:0;">
                  <div style="font-weight:600; font-size:0.8rem; color:var(--c-text); display:flex; align-items:center; gap:0.375rem; flex-wrap:wrap;">
                    ${esc(e.name)} ${eExpBadge}
                  </div>
                  <div style="font-size:0.7rem; color:var(--c-muted); margin-top:0.125rem;">
                    ${e.qty||1}Ã— ${(e.liters||0)} l = <strong>${totalE.toFixed(1)} l</strong>${e.expiry ? " â€¢ " + e.expiry : ""}
                  </div>
                </div>
                <button class="btn-ghost" style="padding:0.25rem 0.5rem; font-size:0.7rem;" data-water-edit="${idx}:${ei}">âœï¸</button>
                <button style="background:none; border:none; cursor:pointer; font-size:0.85rem; padding:0.25rem; color:#991b1b;" data-water-del="${idx}:${ei}">âœ•</button>
              </div>`;
            }).join("");
          }

          const row = document.createElement("div");
          row.className = "water-card";
          row.innerHTML = `
            <div style="display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:0.875rem; gap:0.75rem;">
              <div style="font-weight:700; font-size:1rem;">ğŸ’§ ${esc(it.name)}</div>
              <span style="font-size:0.95rem; font-weight:700; color:${wCol}; flex-shrink:0;">${Math.round(wpct)}%</span>
            </div>

            <div class="water-info-grid" style="display:grid; grid-template-columns:1fr auto; gap:0.625rem; margin-bottom:0.875rem; align-items:stretch;">
              <div style="background:rgba(255,255,255,0.7); border-radius:0.625rem; padding:0.625rem 0.75rem;">
                <div style="font-size:0.7rem; color:#2563eb; font-weight:600; margin-bottom:0.2rem; text-transform:uppercase; letter-spacing:0.04em;">ZÃ¡soby</div>
                <div style="font-size:0.9rem; font-weight:700; color:#1e3a8a;">${litreSklon(current)}</div>
                <div style="font-size:0.72rem; color:#2563eb;">z potrebnÃ½ch ${litreSklon(total)} na ${d} ${d===1?"deÅˆ":d<5?"dni":"dnÃ­"}</div>
              </div>
              <div style="background:${durBg}; border:1px solid ${durBorder}; border-radius:0.625rem; padding:0.625rem 0.875rem; min-width:0; white-space:nowrap;">
                <div style="font-size:0.68rem; color:${durColor}; font-weight:600; margin-bottom:0.25rem; text-transform:uppercase; letter-spacing:0.04em;">VydrÅ¾Ã­ vÃ¡m na</div>
                <div style="font-size:0.95rem; font-weight:800; color:${durColor}; line-height:1.2;">${durText}</div>
                <div style="font-size:0.68rem; color:${durColor}; opacity:0.75; margin-top:0.2rem;">pri spotrebe ${dailyNeed.toFixed(1)} l/deÅˆ</div>
              </div>
            </div>

            <div class="progress-bar" style="margin-bottom:0.75rem; height:10px;">
              <div class="progress-fill" style="width:${Math.min(100,wpct)}%; background:${colorForPct(wpct)};"></div>
            </div>

            <!-- Water breakdown -->
            <div style="background:rgba(255,255,255,0.55); border-radius:0.5rem; padding:0.5rem 0.75rem; margin-bottom:0.875rem; font-size:0.7rem; color:#1e40af; line-height:1.6;">
              <strong>DennÃ¡ potreba domÃ¡cnosti:</strong> ${dailyNeed.toFixed(1)} l/deÅˆ
              <span style="opacity:0.7;">(${waterBreakdown.join(", ")})</span>
              <br>
              <a href="${WATER_SOURCE_URL}" target="_blank" rel="noopener" style="color:#2563eb; text-decoration:underline; font-size:0.65rem;">ğŸ“Š Zdroj: ${WATER_SOURCE_LABEL}</a>
            </div>

            <!-- Water entries list -->
            <div style="display:flex; flex-direction:column; gap:0.375rem; margin-bottom:0.875rem;" id="waterEntriesList_${idx}">
              ${wEntriesHtml}
            </div>

            <!-- Add water entry form -->
            <div style="background:rgba(255,255,255,0.7); border-radius:0.75rem; padding:0.75rem; border:1px dashed #93c5fd;">
              <div style="font-size:0.75rem; font-weight:600; color:#1e40af; margin-bottom:0.5rem;">+ PridaÅ¥ vodu</div>
              <div style="display:grid; grid-template-columns:1fr; gap:0.5rem;">
                <input type="text" placeholder="NÃ¡zov (napr. FÄ¾aÅ¡a 1,5 l, Kanister 5 l)" id="we_name_${idx}" style="font-size:0.82rem; padding:0.5rem 0.75rem;" required />
                <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:0.5rem;">
                  <div>
                    <label class="item-sublabel">Litrov / kus *</label>
                    <input type="number" min="0" step="0.1" placeholder="1.5" id="we_liters_${idx}" style="font-size:0.82rem; padding:0.5rem 0.625rem;" required />
                  </div>
                  <div>
                    <label class="item-sublabel">PoÄet</label>
                    <input type="number" min="1" value="1" id="we_qty_${idx}" style="font-size:0.82rem; padding:0.5rem 0.625rem;" />
                  </div>
                  <div>
                    <label class="item-sublabel">ExpirÃ¡cia *</label>
                    <input type="date" id="we_exp_${idx}" style="font-size:0.82rem; padding:0.5rem 0.625rem;" required />
                  </div>
                </div>
                <button class="btn-primary" style="padding:0.5rem 1rem; font-size:0.82rem; width:100%;" id="we_add_${idx}">PridaÅ¥ do zÃ¡sob</button>
              </div>
            </div>`;
          list.appendChild(row);

          // Bind water entry actions
          setTimeout(() => {
            // Add entry
            const addBtn = document.getElementById(`we_add_${idx}`);
            if (addBtn) addBtn.onclick = () => {
              const nameInp = document.getElementById(`we_name_${idx}`);
              const litersInp = document.getElementById(`we_liters_${idx}`);
              const qtyInp = document.getElementById(`we_qty_${idx}`);
              const expInp = document.getElementById(`we_exp_${idx}`);
              const eName = (nameInp.value||"").trim();
              const eLiters = Number(litersInp.value)||0;
              const eExpiry = (expInp.value||"").trim();
              if (!eName || !eLiters || !eExpiry) { showValidation("VyplÅˆte vÅ¡etky povinnÃ© polia: nÃ¡zov, litrov a expirÃ¡ciu."); return; }
              if (!state.items[catId][idx].waterEntries) state.items[catId][idx].waterEntries = [];
              state.items[catId][idx].waterEntries.push({
                name: eName,
                liters: eLiters,
                qty: Number(qtyInp.value)||1,
                expiry: expInp.value||""
              });
              scheduleSave(); renderAll();
            };
            // Delete entries
            row.querySelectorAll("[data-water-del]").forEach(btn => {
              btn.onclick = () => {
                const [itemI, entryI] = btn.dataset.waterDel.split(":").map(Number);
                if (state.items[catId][itemI] && state.items[catId][itemI].waterEntries) {
                  state.items[catId][itemI].waterEntries.splice(entryI, 1);
                  scheduleSave(); renderAll();
                }
              };
            });
            // Edit entries
            row.querySelectorAll("[data-water-edit]").forEach(btn => {
              btn.onclick = () => {
                const [itemI, entryI] = btn.dataset.waterEdit.split(":").map(Number);
                const entry = state.items[catId][itemI]?.waterEntries?.[entryI];
                if (!entry) return;
                openWaterEditModal(catId, itemI, entryI, entry);
              };
            });
          }, 0);
          return;
        }

        // â”€â”€ FOOD CARD (intelligent calorie tracker) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if (it.isFoodItem && state.profile) {
          const p = state.profile;
          const d = p.prepDays || 3;
          const dailyKcal = getDailyKcalNeed();
          const totalNeeded = dailyKcal * d;
          const currentKcal = getTotalFoodKcal(it);
          const fpct = calcFoodCompletion(it);
          const fCol = colorForPct(fpct);
          const entries = it.foodEntries || [];

          // Duration calculation
          const totalHoursFood = dailyKcal > 0 ? (currentKcal / dailyKcal) * 24 : 0;
          const fDurDays = Math.floor(totalHoursFood / 24);
          const fDurHours = Math.round(totalHoursFood % 24);

          let fDurText = "";
          if (currentKcal === 0) {
            fDurText = "Å½iadna zÃ¡soba";
          } else if (totalHoursFood < 24) {
            const h = Math.round(totalHoursFood);
            fDurText = h <= 0 ? "Menej ako hodinu" : h === 1 ? "1 hodinu" : h < 5 ? h + " hodiny" : h + " hodÃ­n";
          } else {
            const dayW = fDurDays === 1 ? "deÅˆ" : fDurDays < 5 ? "dni" : "dnÃ­";
            const hourP = fDurHours > 0 ? (" a " + fDurHours + (fDurHours === 1 ? " hodinu" : fDurHours < 5 ? " hodiny" : " hodÃ­n")) : "";
            fDurText = fDurDays + " " + dayW + hourP;
          }
          const fDurPct = Math.min(100, (totalHoursFood / (d * 24)) * 100);
          const fDurHue = Math.round((Math.min(100, Math.max(0, fDurPct)) / 100) * 120);
          const fDurColor = `hsl(${fDurHue} 70% 34%)`;
          const fDurBg = `hsl(${fDurHue} 70% 96%)`;
          const fDurBorder = `hsl(${fDurHue} 60% 80%)`;

          // Kcal breakdown per person type
          const kcalBreakdown = [];
          if (p.adults) kcalBreakdown.push(`${p.adults}Ã— dospelÃ½: ${KCAL_PER_DAY.adult} kcal`);
          if (p.kids) kcalBreakdown.push(`${p.kids}Ã— dieÅ¥a: ${KCAL_PER_DAY.kid} kcal`);
          if (p.infants) kcalBreakdown.push(`${p.infants}Ã— batoÄ¾a: ${KCAL_PER_DAY.infant} kcal`);
          if (p.seniors) kcalBreakdown.push(`${p.seniors}Ã— senior: ${KCAL_PER_DAY.senior} kcal`);

          // Food entries HTML
          let entriesHtml = "";
          if (entries.length === 0) {
            entriesHtml = `<div style="text-align:center; padding:1rem 0; color:var(--c-muted); font-size:0.82rem;">ZatiaÄ¾ Å¾iadne jedlo. Pridajte prvÃº poloÅ¾ku niÅ¾Å¡ie.</div>`;
          } else {
            entriesHtml = entries.map((e, ei) => {
              const eExp = e.expiry ? daysUntil(e.expiry) : null;
              const catAD = getAlertDaysForCategory("food_water");
              const eExpBadge = e.expiry
                ? (eExp < 0 ? `<span class="badge badge-red" style="font-size:0.62rem;">EXP</span>`
                  : eExp <= catAD ? `<span class="badge badge-amber" style="font-size:0.62rem;">${eExp}d</span>`
                  : `<span class="badge badge-gray" style="font-size:0.62rem;">${eExp}d</span>`)
                : "";
              const totalE = (e.kcal||0)*(e.qty||1);
              return `<div style="display:flex; align-items:center; gap:0.5rem; padding:0.5rem 0.625rem; background:rgba(255,255,255,0.6); border-radius:0.5rem; border:1px solid rgba(234,124,27,0.15);">
                <div style="flex:1; min-width:0;">
                  <div style="font-weight:600; font-size:0.8rem; color:var(--c-text); display:flex; align-items:center; gap:0.375rem; flex-wrap:wrap;">
                    ${esc(e.name)} ${eExpBadge}
                  </div>
                  <div style="font-size:0.7rem; color:var(--c-muted); margin-top:0.125rem;">
                    ${e.qty||1}Ã— ${(e.kcal||0).toLocaleString()} kcal = <strong>${totalE.toLocaleString()} kcal</strong>${e.expiry ? " â€¢ " + e.expiry : ""}
                  </div>
                </div>
                <button class="btn-ghost" style="padding:0.25rem 0.5rem; font-size:0.7rem;" data-food-edit="${idx}:${ei}">âœï¸</button>
                <button style="background:none; border:none; cursor:pointer; font-size:0.85rem; padding:0.25rem; color:#991b1b;" data-food-del="${idx}:${ei}">âœ•</button>
              </div>`;
            }).join("");
          }

          const row = document.createElement("div");
          row.style.cssText = "background:linear-gradient(135deg, #fef7ed 0%, #fef3c7 100%); border:1.5px solid #fcd34d; border-radius:1rem; padding:1.25rem;";
          row.innerHTML = `
            <div style="display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:0.875rem; gap:0.75rem;">
              <div style="font-weight:700; font-size:1rem;">ğŸ½ï¸ ${esc(it.name)}</div>
              <span style="font-size:0.95rem; font-weight:700; color:${fCol}; flex-shrink:0;">${Math.round(fpct)}%</span>
            </div>

            <div class="water-info-grid" style="display:grid; grid-template-columns:1fr auto; gap:0.625rem; margin-bottom:0.875rem; align-items:stretch;">
              <div style="background:rgba(255,255,255,0.7); border-radius:0.625rem; padding:0.625rem 0.75rem;">
                <div style="font-size:0.7rem; color:#b45309; font-weight:600; margin-bottom:0.2rem; text-transform:uppercase; letter-spacing:0.04em;">ZÃ¡soby</div>
                <div style="font-size:0.9rem; font-weight:700; color:#78350f;">${currentKcal.toLocaleString()} kcal</div>
                <div style="font-size:0.72rem; color:#b45309;">z potrebnÃ½ch ${totalNeeded.toLocaleString()} kcal na ${d} ${d===1?"deÅˆ":d<5?"dni":"dnÃ­"}</div>
              </div>
              <div style="background:${fDurBg}; border:1px solid ${fDurBorder}; border-radius:0.625rem; padding:0.625rem 0.875rem; min-width:0; white-space:nowrap;">
                <div style="font-size:0.68rem; color:${fDurColor}; font-weight:600; margin-bottom:0.25rem; text-transform:uppercase; letter-spacing:0.04em;">VydrÅ¾Ã­ vÃ¡m na</div>
                <div style="font-size:0.95rem; font-weight:800; color:${fDurColor}; line-height:1.2;">${fDurText}</div>
                <div style="font-size:0.68rem; color:${fDurColor}; opacity:0.75; margin-top:0.2rem;">pri ${dailyKcal.toLocaleString()} kcal/deÅˆ</div>
              </div>
            </div>

            <div class="progress-bar" style="margin-bottom:0.75rem; height:10px;">
              <div class="progress-fill" style="width:${Math.min(100,fpct)}%; background:${colorForPct(fpct)};"></div>
            </div>

            <!-- Kcal breakdown -->
            <div style="background:rgba(255,255,255,0.55); border-radius:0.5rem; padding:0.5rem 0.75rem; margin-bottom:0.875rem; font-size:0.7rem; color:#92400e; line-height:1.6;">
              <strong>DennÃ¡ potreba domÃ¡cnosti:</strong> ${dailyKcal.toLocaleString()} kcal/deÅˆ
              <span style="opacity:0.7;">(${kcalBreakdown.join(", ")})</span>
              <br>
              <a href="${KCAL_SOURCE_URL}" target="_blank" rel="noopener" style="color:#b45309; text-decoration:underline; font-size:0.65rem;">ğŸ“Š Zdroj: ${KCAL_SOURCE_LABEL}</a>
            </div>

            <!-- Food entries list -->
            <div style="display:flex; flex-direction:column; gap:0.375rem; margin-bottom:0.875rem;" id="foodEntriesList_${idx}">
              ${entriesHtml}
            </div>

            <!-- Add food entry form -->
            <div style="background:rgba(255,255,255,0.7); border-radius:0.75rem; padding:0.75rem; border:1px dashed #fbbf24;">
              <div style="font-size:0.75rem; font-weight:600; color:#92400e; margin-bottom:0.5rem;">+ PridaÅ¥ jedlo</div>
              <div style="display:grid; grid-template-columns:1fr; gap:0.5rem;">
                <input type="text" placeholder="NÃ¡zov (napr. FazuÄ¾a v konzerve)" id="fe_name_${idx}" style="font-size:0.82rem; padding:0.5rem 0.75rem;" required />
                <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:0.5rem;">
                  <div>
                    <label class="item-sublabel">kcal / kus *</label>
                    <input type="number" min="0" placeholder="350" id="fe_kcal_${idx}" style="font-size:0.82rem; padding:0.5rem 0.625rem;" required />
                  </div>
                  <div>
                    <label class="item-sublabel">PoÄet</label>
                    <input type="number" min="1" value="1" id="fe_qty_${idx}" style="font-size:0.82rem; padding:0.5rem 0.625rem;" />
                  </div>
                  <div>
                    <label class="item-sublabel">ExpirÃ¡cia *</label>
                    <input type="date" id="fe_exp_${idx}" style="font-size:0.82rem; padding:0.5rem 0.625rem;" required />
                  </div>
                </div>
                <button class="btn-primary" style="padding:0.5rem 1rem; font-size:0.82rem; width:100%;" id="fe_add_${idx}">PridaÅ¥ do zÃ¡sob</button>
              </div>
            </div>`;
          list.appendChild(row);

          // Bind food entry actions
          setTimeout(() => {
            // Add entry
            const addBtn = document.getElementById(`fe_add_${idx}`);
            if (addBtn) addBtn.onclick = () => {
              const nameInp = document.getElementById(`fe_name_${idx}`);
              const kcalInp = document.getElementById(`fe_kcal_${idx}`);
              const qtyInp = document.getElementById(`fe_qty_${idx}`);
              const expInp = document.getElementById(`fe_exp_${idx}`);
              const eName = (nameInp.value||"").trim();
              const eKcal = Number(kcalInp.value)||0;
              const eExpiry = (expInp.value||"").trim();
              if (!eName || !eKcal || !eExpiry) { showValidation("VyplÅˆte vÅ¡etky povinnÃ© polia: nÃ¡zov, kalÃ³rie a expirÃ¡ciu."); return; }
              if (!state.items[catId][idx].foodEntries) state.items[catId][idx].foodEntries = [];
              state.items[catId][idx].foodEntries.push({
                name: eName,
                kcal: eKcal,
                qty: Number(qtyInp.value)||1,
                expiry: expInp.value||""
              });
              scheduleSave(); renderAll();
            };
            // Delete entries
            row.querySelectorAll("[data-food-del]").forEach(btn => {
              btn.onclick = () => {
                const [itemI, entryI] = btn.dataset.foodDel.split(":").map(Number);
                if (state.items[catId][itemI] && state.items[catId][itemI].foodEntries) {
                  state.items[catId][itemI].foodEntries.splice(entryI, 1);
                  scheduleSave(); renderAll();
                }
              };
            });
            // Edit entries
            row.querySelectorAll("[data-food-edit]").forEach(btn => {
              btn.onclick = () => {
                const [itemI, entryI] = btn.dataset.foodEdit.split(":").map(Number);
                const entry = state.items[catId][itemI]?.foodEntries?.[entryI];
                if (!entry) return;
                openFoodEditModal(catId, itemI, entryI, entry);
              };
            });
          }, 0);
          return;
        }

        // â”€â”€ CASH CARD (intelligent cash tracker) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if (it.isCashItem && state.profile) {
          const p = state.profile;
          const totalPersons = (p.adults||0) + (p.kids||0) + (p.infants||0) + (p.seniors||0);
          const recommended = getRecommendedCash();
          const currentCash = getTotalCash(it);
          const cpct = calcCashCompletion(it);
          const cCol = colorForPct(cpct);
          const entries = it.cashEntries || [];

          // Entries HTML
          let cEntriesHtml = "";
          if (entries.length === 0) {
            cEntriesHtml = `<div style="text-align:center; padding:1rem 0; color:var(--c-muted); font-size:0.82rem;">ZatiaÄ¾ Å¾iadna hotovosÅ¥. Pridajte bankovky a mince niÅ¾Å¡ie.</div>`;
          } else {
            // Group by type
            const bankovky = entries.filter(e => e.type === "bankovka");
            const mince = entries.filter(e => e.type === "minca");
            const renderGroup = (groupEntries, label, emoji) => {
              if (!groupEntries.length) return "";
              const groupTotal = groupEntries.reduce((s, e) => s + (e.value||0)*(e.qty||1), 0);
              return `<div style="margin-bottom:0.5rem;">
                <div style="font-size:0.7rem; font-weight:700; color:var(--c-muted); text-transform:uppercase; letter-spacing:0.04em; margin-bottom:0.25rem;">${emoji} ${label} â€” ${groupTotal.toFixed(2)} â‚¬</div>
                ${groupEntries.map((e, ei) => {
                  const realIdx = entries.indexOf(e);
                  const totalE = (e.value||0)*(e.qty||1);
                  return `<div style="display:flex; align-items:center; gap:0.5rem; padding:0.375rem 0.5rem; background:rgba(255,255,255,0.6); border-radius:0.5rem; border:1px solid rgba(42,122,75,0.15); margin-bottom:0.25rem;">
                    <div style="flex:1; min-width:0;">
                      <div style="font-weight:600; font-size:0.78rem; color:var(--c-text);">${(e.value||0)} â‚¬ Ã— ${e.qty||1}</div>
                      <div style="font-size:0.68rem; color:var(--c-muted);">= ${totalE.toFixed(2)} â‚¬</div>
                    </div>
                    <button class="btn-ghost" style="padding:0.25rem 0.5rem; font-size:0.7rem;" data-cash-edit="${idx}:${realIdx}">âœï¸</button>
                    <button style="background:none; border:none; cursor:pointer; font-size:0.85rem; padding:0.25rem; color:#991b1b;" data-cash-del="${idx}:${realIdx}">âœ•</button>
                  </div>`;
                }).join("")}
              </div>`;
            };
            cEntriesHtml = renderGroup(bankovky, "Bankovky", "ğŸ’¶") + renderGroup(mince, "Mince", "ğŸª™");
          }

          const row = document.createElement("div");
          row.style.cssText = "background:linear-gradient(135deg, #eaf4ee 0%, #d1fae5 100%); border:1.5px solid #86efac; border-radius:1rem; padding:1.25rem;";
          row.innerHTML = `
            <div style="display:flex; align-items:flex-start; justify-content:space-between; margin-bottom:0.875rem; gap:0.75rem;">
              <div style="font-weight:700; font-size:1rem;">ğŸ’µ ${esc(it.name)}</div>
              <span style="font-size:0.95rem; font-weight:700; color:${cCol}; flex-shrink:0;">${Math.round(cpct)}%</span>
            </div>

            <div class="water-info-grid" style="display:grid; grid-template-columns:1fr auto; gap:0.625rem; margin-bottom:0.875rem; align-items:stretch;">
              <div style="background:rgba(255,255,255,0.7); border-radius:0.625rem; padding:0.625rem 0.75rem;">
                <div style="font-size:0.7rem; color:var(--c-green); font-weight:600; margin-bottom:0.2rem; text-transform:uppercase; letter-spacing:0.04em;">VaÅ¡a hotovosÅ¥</div>
                <div style="font-size:0.9rem; font-weight:700; color:#14532d;">${currentCash.toFixed(2)} â‚¬</div>
                <div style="font-size:0.72rem; color:var(--c-green);">z odporÃºÄanÃ½ch ${recommended} â‚¬ (${totalPersons} ${totalPersons === 1 ? "osoba" : totalPersons < 5 ? "osoby" : "osÃ´b"} Ã— ${CASH_PER_PERSON} â‚¬)</div>
              </div>
              <div style="background:rgba(255,255,255,0.7); border-radius:0.625rem; padding:0.625rem 0.875rem; min-width:0;">
                <div style="font-size:0.68rem; color:var(--c-green); font-weight:600; margin-bottom:0.25rem; text-transform:uppercase; letter-spacing:0.04em;">OdporÃºÄanie</div>
                <div style="font-size:0.82rem; font-weight:700; color:#14532d; line-height:1.3;">â‚¬70â€“100 / osobu</div>
                <div style="font-size:0.68rem; color:var(--c-green); opacity:0.75; margin-top:0.2rem;">v malÃ½ch nominÃ¡loch</div>
              </div>
            </div>

            <div class="progress-bar" style="margin-bottom:0.75rem; height:10px;">
              <div class="progress-fill" style="width:${Math.min(100,cpct)}%; background:${colorForPct(cpct)};"></div>
            </div>

            <!-- Source -->
            <div style="background:rgba(255,255,255,0.55); border-radius:0.5rem; padding:0.5rem 0.75rem; margin-bottom:0.875rem; font-size:0.7rem; color:#166534; line-height:1.6;">
              <strong>PreÄo hotovosÅ¥?</strong> Pri vÃ½padku elektriny, kybernetickÃ½ch Ãºtokoch alebo Å¾ivelnÃ½ch pohromÃ¡ch platobnÃ© terminÃ¡ly nefungujÃº. ECB odporÃºÄa maÅ¥ doma â‚¬70â€“100 na osobu v malÃ½ch bankovkÃ¡ch a minciach.
              <br>
              <a href="${CASH_SOURCE_URL}" target="_blank" rel="noopener" style="color:var(--c-green); text-decoration:underline; font-size:0.65rem;">ğŸ“Š Zdroj: ${CASH_SOURCE_LABEL}</a>
            </div>

            <!-- Entries -->
            <div style="display:flex; flex-direction:column; gap:0.25rem; margin-bottom:0.875rem;" id="cashEntriesList_${idx}">
              ${cEntriesHtml}
            </div>

            <!-- Add cash entry form -->
            <div style="background:rgba(255,255,255,0.7); border-radius:0.75rem; padding:0.75rem; border:1px dashed #86efac;">
              <div style="font-size:0.75rem; font-weight:600; color:#166534; margin-bottom:0.5rem;">+ PridaÅ¥ hotovosÅ¥</div>
              <div style="display:grid; grid-template-columns:1fr; gap:0.5rem;">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem;">
                  <div>
                    <label class="item-sublabel">Typ</label>
                    <select id="ce_type_${idx}" style="font-size:0.82rem; padding:0.5rem 0.625rem;">
                      <option value="bankovka">ğŸ’¶ Bankovka</option>
                      <option value="minca">ğŸª™ Minca</option>
                    </select>
                  </div>
                  <div>
                    <label class="item-sublabel">Hodnota (â‚¬)</label>
                    <select id="ce_value_${idx}" style="font-size:0.82rem; padding:0.5rem 0.625rem;">
                      <optgroup label="Bankovky">
                        <option value="5">5 â‚¬</option>
                        <option value="10" selected>10 â‚¬</option>
                        <option value="20">20 â‚¬</option>
                        <option value="50">50 â‚¬</option>
                        <option value="100">100 â‚¬</option>
                        <option value="200">200 â‚¬</option>
                      </optgroup>
                      <optgroup label="Mince">
                        <option value="0.01">0,01 â‚¬</option>
                        <option value="0.02">0,02 â‚¬</option>
                        <option value="0.05">0,05 â‚¬</option>
                        <option value="0.10">0,10 â‚¬</option>
                        <option value="0.20">0,20 â‚¬</option>
                        <option value="0.50">0,50 â‚¬</option>
                        <option value="1">1 â‚¬</option>
                        <option value="2">2 â‚¬</option>
                      </optgroup>
                    </select>
                  </div>
                </div>
                <div>
                  <label class="item-sublabel">PoÄet kusov</label>
                  <input type="number" min="1" value="1" id="ce_qty_${idx}" style="font-size:0.82rem; padding:0.5rem 0.625rem;" />
                </div>
                <button class="btn-primary" style="padding:0.5rem 1rem; font-size:0.82rem; width:100%;" id="ce_add_${idx}">PridaÅ¥ do zÃ¡sob</button>
              </div>
            </div>`;
          list.appendChild(row);

          // Bind cash entry actions
          setTimeout(() => {
            const addBtn = document.getElementById(`ce_add_${idx}`);
            if (addBtn) addBtn.onclick = () => {
              const typeInp = document.getElementById(`ce_type_${idx}`);
              const valueInp = document.getElementById(`ce_value_${idx}`);
              const qtyInp = document.getElementById(`ce_qty_${idx}`);
              const eValue = Number(valueInp.value)||0;
              const eQty = Number(qtyInp.value)||1;
              if (!eValue) return;
              if (!state.items[catId][idx].cashEntries) state.items[catId][idx].cashEntries = [];
              state.items[catId][idx].cashEntries.push({
                type: typeInp.value,
                value: eValue,
                qty: eQty
              });
              scheduleSave(); renderAll();
            };
            // Delete entries
            row.querySelectorAll("[data-cash-del]").forEach(btn => {
              btn.onclick = () => {
                const [itemI, entryI] = btn.dataset.cashDel.split(":").map(Number);
                if (state.items[catId][itemI] && state.items[catId][itemI].cashEntries) {
                  state.items[catId][itemI].cashEntries.splice(entryI, 1);
                  scheduleSave(); renderAll();
                }
              };
            });
            // Edit entries
            row.querySelectorAll("[data-cash-edit]").forEach(btn => {
              btn.onclick = () => {
                const [itemI, entryI] = btn.dataset.cashEdit.split(":").map(Number);
                const entry = state.items[catId][itemI]?.cashEntries?.[entryI];
                if (!entry) return;
                openCashEditModal(catId, itemI, entryI, entry);
              };
            });
          }, 0);
          return;
        }

        const exp = it.expiry ? daysUntil(it.expiry) : null;
        const catAlertDays = getAlertDaysForCategory(catId);
        const expBadge = it.expiry
          ? (exp < 0 ? `<span class="badge badge-red">EXPIROVANÃ‰</span>`
            : exp <= catAlertDays ? `<span class="badge badge-amber">za ${exp} dnÃ­</span>`
            : `<span class="badge badge-gray">za ${exp} dnÃ­</span>`)
          : "";
        const linkBtn = (it.link && isValidUrl(it.link))
          ? `<a href="${esc(it.link)}" target="_blank" rel="noopener" class="btn-ghost" style="padding:0.375rem 0.625rem; text-decoration:none;">ğŸ”—</a>`
          : "";

        const row = document.createElement("div");
        row.className = "item-row";
        row.innerHTML = `
          <input type="checkbox" style="margin-top:2px; width:16px; height:16px; accent-color:var(--c-green); flex-shrink:0;" ${it.done?"checked":""} data-toggle="${catId}:${idx}" />
          <div style="flex:1; min-width:0;">
            <div style="font-weight:500; font-size:0.875rem; ${it.done?"text-decoration:line-through; color:var(--c-muted)":""}">${esc(it.name)} ${expBadge}</div>
            <div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.125rem;">${it.qty||"â€”"}${it.expiry ? " â€¢ " + it.expiry : ""}</div>
          </div>
          <div style="display:flex; gap:0.375rem; flex-shrink:0;">
            ${linkBtn}
            <button class="btn-ghost item-btn-edit" style="padding:0.375rem 0.625rem; font-size:0.75rem;" data-edit="${catId}:${idx}">UpraviÅ¥</button>
            <button class="btn-danger item-btn-del" style="padding:0.375rem 0.625rem;" data-del="${catId}:${idx}">âœ•</button>
          </div>`;
        list.appendChild(row);
      });
    }

    detail.appendChild(list);

    // Append source banner at the bottom (after all items)
    if (srcBannerEl) {
      detail.appendChild(srcBannerEl);
    }

    // Bind item actions
    detail.querySelectorAll("[data-toggle]").forEach(el => {
      el.onchange = () => {
        const [cid, i] = el.dataset.toggle.split(":");
        state.items[cid][+i].done = el.checked;
        scheduleSave(); renderAll();
      };
    });
    detail.querySelectorAll("[data-del]").forEach(el => {
      el.onclick = () => {
        const [cid, i] = el.dataset.del.split(":");
        openDeleteConfirmation(cid, +i);
      };
    });
    detail.querySelectorAll("[data-edit]").forEach(el => {
      el.onclick = () => {
        const [cid, i] = el.dataset.edit.split(":");
        openItemModal(cid, +i);
      };
    });
  }

  function renderPlans() {
    renderMeetingPoint();
    renderScenarios();
  }

  // â”€â”€ Miesto stretnutia â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderMeetingPoint() {
    const box = document.getElementById("meetingPointBox");
    if (!box) return;
    const mp = state.plans.meetingPoint;
    const hasData = mp.name && mp.name.trim();
    const hasTimes = mp.times && mp.times.length > 0;
    const hasBackup = mp.backup && mp.backup.name && mp.backup.name.trim();

    if (!hasData) {
      box.innerHTML = `
        <div style="background:linear-gradient(135deg, #fef3c7 0%, #fef9c3 100%); border:1.5px solid #fcd34d; border-radius:1rem; padding:1.25rem; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;" tabindex="0" role="button" aria-label="NastaviÅ¥ miesto stretnutia" onclick="openMeetingPointModal()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();openMeetingPointModal()}" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 18px rgba(0,0,0,0.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
          <div style="display:flex; align-items:center; gap:0.75rem;">
            <div style="width:48px; height:48px; border-radius:50%; background:#fbbf24; display:flex; align-items:center; justify-content:center; font-size:1.375rem; flex-shrink:0;">ğŸ“</div>
            <div style="flex:1;">
              <div style="font-weight:700; font-size:0.95rem; color:#92400e;">Nastavte miesto stretnutia</div>
              <div style="font-size:0.78rem; color:#854d0e; line-height:1.5; margin-top:0.2rem;">Kde sa stretnete, keÄ vypadne signÃ¡l a internet? Vyberte miesto, ktorÃ©: <strong>vÅ¡etci poznajÃº</strong> (kostol, pamÃ¤tnÃ­k, Å¡kola), je <strong>peÅ¡o do 30 min</strong>, na <strong>otvorenom priestranstve</strong> (nie v budove), a <strong>Äaleko od rizÃ­k</strong> (nie most, nie pod svahom, nie v ÃºdolÃ­). Nastavte aj <strong>zÃ¡loÅ¾nÃ© miesto</strong> pre prÃ­pad, Å¾e primÃ¡rne je nedostupnÃ©.</div>
            </div>
            <div style="font-size:1.25rem; color:#854d0e; flex-shrink:0;">â†’</div>
          </div>
        </div>`;
      return;
    }

    let timesHtml = "";
    if (hasTimes) {
      timesHtml = `<div style="display:flex; flex-wrap:wrap; gap:0.375rem; margin-top:0.625rem;">` +
        mp.times.sort().map(t => `<span style="background:#eff6ff; border:1px solid #bfdbfe; color:#1e40af; border-radius:0.5rem; padding:0.2rem 0.5rem; font-size:0.75rem; font-weight:700; font-family:'Lexend',sans-serif;">${t}</span>`).join("") +
        `</div>`;
    }

    let backupHtml = "";
    if (hasBackup) {
      backupHtml = `
        <div style="margin-top:0.75rem; padding-top:0.75rem; border-top:1px dashed #bfdbfe;">
          <div style="font-size:0.72rem; font-weight:600; color:#2563eb; text-transform:uppercase; letter-spacing:0.04em; margin-bottom:0.25rem;">ZÃ¡loÅ¾nÃ© miesto</div>
          <div style="font-weight:600; font-size:0.85rem;">${esc(mp.backup.name)}</div>
          ${mp.backup.address ? `<div style="font-size:0.75rem; color:var(--c-muted);">${esc(mp.backup.address)}</div>` : ""}
        </div>`;
    }

    box.innerHTML = `
      <div style="background:linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border:1.5px solid #bfdbfe; border-radius:1rem; padding:1.25rem;">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:0.75rem;">
          <div style="display:flex; align-items:flex-start; gap:0.75rem; flex:1; min-width:0;">
            <div style="width:48px; height:48px; border-radius:50%; background:#3b82f6; display:flex; align-items:center; justify-content:center; font-size:1.375rem; flex-shrink:0; color:white;">ğŸ“</div>
            <div style="flex:1; min-width:0;">
              <div style="font-size:0.68rem; font-weight:600; color:#2563eb; text-transform:uppercase; letter-spacing:0.04em;">Miesto stretnutia</div>
              <div style="font-weight:800; font-size:1.0625rem; color:var(--c-text); margin-top:0.125rem;">${esc(mp.name)}</div>
              ${mp.address ? `<div style="font-size:0.8rem; color:var(--c-muted); margin-top:0.125rem;">ğŸ“Œ ${esc(mp.address)}</div>` : ""}
              ${mp.note ? `<div style="font-size:0.78rem; color:var(--c-muted); margin-top:0.25rem; font-style:italic;">${esc(mp.note)}</div>` : ""}
              ${hasTimes ? `<div style="margin-top:0.5rem;"><div style="font-size:0.68rem; font-weight:600; color:#2563eb; margin-bottom:0.25rem;">â° ÄŒASY STRETÃVANIA</div>${timesHtml}</div>` : ""}
            </div>
          </div>
          <button class="btn-ghost" onclick="openMeetingPointModal()" style="font-size:0.78rem; padding:0.375rem 0.75rem; flex-shrink:0;">UpraviÅ¥</button>
        </div>
        ${backupHtml}
        <div style="background:rgba(255,255,255,0.6); border-radius:0.625rem; padding:0.625rem 0.75rem; margin-top:0.75rem; font-size:0.75rem; color:#1e40af; line-height:1.5;">
          ğŸ’¡ <strong>Pravidlo:</strong> Ak tam ten druhÃ½ nie je, poÄkajte 30 minÃºt a prÃ­Äte znova o ÄalÅ¡Ã­ interval. Ak sa nestretnete ani na 3. pokus â€“ prejdite na <strong>zÃ¡loÅ¾nÃ© miesto</strong>.
        </div>
      </div>`;
  }

  // â”€â”€ KrÃ­zovÃ© scenÃ¡re â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const SCENARIO_DEFS = [
    {
      id: "home",
      emoji: "\ud83c\udfe0",
      title: "CelÃ¡ rodina je doma",
      subtitle: "KrÃ­za zastihne vÅ¡etkÃ½ch doma \u2013 postup od momentu varovania po rozhodnutie zostaÅ¥ alebo evakuovaÅ¥",
      color: "#2a7a4b",
      bg: "#eaf4ee",
      border: "#86efac"
    },
    {
      id: "separated",
      emoji: "\ud83c\udfeb",
      title: "RodiÄia v prÃ¡ci, deti v Å¡kole",
      subtitle: "Rodina je rozdelenÃ¡ na 2\u20133 miesta \u2013 kto ide pre koho, odkiaÄ¾, v akom poradÃ­, zÃ¡loÅ¾nÃ½ plÃ¡n",
      color: "#b45309",
      bg: "#fef3c7",
      border: "#fcd34d"
    },
    {
      id: "partial",
      emoji: "\ud83d\udc68\u200d\ud83d\udc67",
      title: "Jeden rodiÄ doma, druh\u00fd v pr\u00e1ci",
      subtitle: "Rozdelenie \u00faloh \u2013 kto zabezpeÄÃ­ deti, kto batoh, kto ide na miesto stretnutia",
      color: "#1e40af",
      bg: "#eff6ff",
      border: "#bfdbfe"
    },
    {
      id: "night",
      emoji: "\ud83c\udf19",
      title: "Kr\u00edzov\u00e1 situ\u00e1cia v noci",
      subtitle: "Sir\u00e9na o 3:00 r\u00e1no \u2013 orientÃ¡cia v tme, obleÄenie, deti, Äo vziaÅ¥, kam Ã­sÅ¥",
      color: "#6b21a8",
      bg: "#faf5ff",
      border: "#e9d5ff"
    },
    {
      id: "travel",
      emoji: "\u2708\ufe0f",
      title: "ÄŒlen rodiny je mimo mesto",
      subtitle: "SluÅ¾obnÃ¡ cesta, dovolenka, zahraniÄie \u2013 kontaktnÃ¡ osoba, komunikÃ¡cia, nÃ¡hradnÃ© rieÅ¡enia",
      color: "#be185d",
      bg: "#fdf2f8",
      border: "#fbcfe8"
    }
  ];

  function renderScenarios() {
    const box = document.getElementById("scenariosBox");
    if (!box) return;
    box.innerHTML = "";
    SCENARIO_DEFS.forEach(def => {
      const scenario = state.plans.scenarios[def.id];
      const filled = isScenarioFilled(def.id, scenario);
      const card = document.createElement("div");
      card.style.cssText = `background:${def.bg}; border:1.5px solid ${def.border}; border-radius:1rem; padding:1rem; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;`;
      card.onmouseover = () => { card.style.transform = "translateY(-2px)"; card.style.boxShadow = "0 6px 18px rgba(0,0,0,0.08)"; };
      card.onmouseout = () => { card.style.transform = ""; card.style.boxShadow = ""; };

      let previewHtml = "";
      if (filled) {
        previewHtml = getScenarioPreview(def.id, scenario);
      } else {
        previewHtml = `<div style="font-size:0.78rem; color:${def.color}; opacity:0.7; margin-top:0.375rem;">DoplniÅ¥ plÃ¡n pre tento scenÃ¡r â†’</div>`;
      }

      card.innerHTML = `
        <div style="display:flex; align-items:flex-start; gap:0.75rem;">
          <div style="width:40px; height:40px; border-radius:50%; background:white; border:1.5px solid ${def.border}; display:flex; align-items:center; justify-content:center; font-size:1.125rem; flex-shrink:0;">${def.emoji}</div>
          <div style="flex:1; min-width:0;">
            <div style="display:flex; align-items:center; gap:0.5rem;">
              <div style="font-weight:700; font-size:0.9rem; color:${def.color};">${def.title}</div>
              ${filled ? `<span style="background:white; border:1px solid ${def.border}; border-radius:999px; padding:0.1rem 0.4rem; font-size:0.625rem; font-weight:700; color:${def.color};">âœ“ HOTOVO</span>` : ""}
            </div>
            <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.125rem;">${def.subtitle}</div>
            ${previewHtml}
          </div>
        </div>`;
      card.onclick = () => openScenarioModal(def.id);
      card.setAttribute("tabindex", "0");
      card.setAttribute("role", "button");
      card.setAttribute("aria-label", def.title + (filled ? " â€“ hotovo" : " â€“ doplniÅ¥ plÃ¡n"));
      card.onkeydown = (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openScenarioModal(def.id);
        }
      };
      box.appendChild(card);
    });
  }

  function isScenarioFilled(id, s) {
    if (id === "home") return !!(s.steps && s.steps.trim());
    if (id === "separated") return (s.tasks && s.tasks.length > 0) || !!(s.meetPlace && s.meetPlace.trim());
    if (id === "partial") return !!(s.whoHome && s.whoHome.trim()) || !!(s.whoWork && s.whoWork.trim());
    if (id === "night") return !!(s.steps && s.steps.trim());
    if (id === "travel") return !!(s.contactPerson && s.contactPerson.trim()) || !!(s.steps && s.steps.trim());
    return false;
  }

  function getScenarioPreview(id, s) {
    if (id === "home") {
      const lines = (s.steps||"").split("\n").filter(l => l.trim()).slice(0, 2);
      return `<div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.375rem; line-height:1.5;">${lines.map(l => esc(l)).join("<br>")}</div>`;
    }
    if (id === "separated") {
      const taskCount = (s.tasks||[]).length;
      const taskPrev = (s.tasks||[]).slice(0, 2).map(t => `<strong>${esc(t.person||"?")}</strong> \u2192 vyzdvihne <strong>${esc(t.picksUp||"?")}</strong> z ${esc(t.from||"?")}`).join("; ");
      return `<div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.375rem; line-height:1.5;">${taskCount > 0 ? taskPrev : ""}${s.meetPlace ? `<br>Stretnutie: <strong>${esc(s.meetPlace)}</strong>` : ""}${s.meetTime ? ` o <strong>${esc(s.meetTime)}</strong>` : ""}</div>`;
    }
    if (id === "partial") {
      return `<div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.375rem; line-height:1.5;">${s.whoHome ? `Doma: <strong>${esc(s.whoHome)}</strong>` : ""}${s.whoWork ? ` | V pr\u00e1ci: <strong>${esc(s.whoWork)}</strong>` : ""}</div>`;
    }
    if (id === "night") {
      const lines = (s.steps||"").split("\n").filter(l => l.trim()).slice(0, 2);
      return `<div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.375rem; line-height:1.5;">${lines.map(l => esc(l)).join("<br>")}</div>`;
    }
    if (id === "travel") {
      return `<div style="font-size:0.75rem; color:var(--c-muted); margin-top:0.375rem; line-height:1.5;">${s.contactPerson ? `Kontaktn\u00e1 osoba: <strong>${esc(s.contactPerson)}</strong>` : ""}${s.whoTravels ? ` | Cestuje: <strong>${esc(s.whoTravels)}</strong>` : ""}</div>`;
    }
    return "";
  }

  // â”€â”€ Meeting point modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let tempMeetingTimes = [];

  function openMeetingPointModal() {
    const mp = state.plans.meetingPoint;
    const f = document.getElementById("meetingPointForm");
    f.elements["mp_name"].value = mp.name || "";
    f.elements["mp_address"].value = mp.address || "";
    f.elements["mp_note"].value = mp.note || "";
    f.elements["mp_backup_name"].value = (mp.backup||{}).name || "";
    f.elements["mp_backup_address"].value = (mp.backup||{}).address || "";
    tempMeetingTimes = [...(mp.times || [])];
    renderMeetingTimesEditor();
    openModal("modalMeetingPoint");
  }

  function renderMeetingTimesEditor() {
    const box = document.getElementById("meetingTimesEditor");
    if (!box) return;
    box.innerHTML = tempMeetingTimes.sort().map((t, i) => `
      <span style="display:inline-flex; align-items:center; gap:0.25rem; background:white; border:1.5px solid #bfdbfe; border-radius:0.5rem; padding:0.25rem 0.375rem 0.25rem 0.5rem; font-size:0.8rem; font-weight:700; color:#1e40af; font-family:'Lexend',sans-serif;">
        ${t}
        <button type="button" onclick="removeMeetingTime(${i})" style="background:none; border:none; cursor:pointer; color:#93c5fd; font-size:1rem; line-height:1; padding:0 0.125rem;" title="OdstrÃ¡niÅ¥">âœ•</button>
      </span>
    `).join("");
  }

  function removeMeetingTime(i) {
    tempMeetingTimes.splice(i, 1);
    renderMeetingTimesEditor();
  }
  // expose to onclick
  window.removeMeetingTime = removeMeetingTime;
  window.openMeetingPointModal = openMeetingPointModal;

  document.getElementById("btnAddMeetingTime").onclick = () => {
    const inp = document.getElementById("newMeetingTime");
    if (inp.value && !tempMeetingTimes.includes(inp.value)) {
      tempMeetingTimes.push(inp.value);
      inp.value = "";
      renderMeetingTimesEditor();
    }
  };

  document.getElementById("meetingPointForm").onsubmit = (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    state.plans.meetingPoint = {
      name: String(fd.get("mp_name")||"").trim(),
      address: String(fd.get("mp_address")||"").trim(),
      note: String(fd.get("mp_note")||"").trim(),
      times: [...tempMeetingTimes],
      backup: {
        name: String(fd.get("mp_backup_name")||"").trim(),
        address: String(fd.get("mp_backup_address")||"").trim()
      }
    };
    closeModal("modalMeetingPoint");
    scheduleSave(); renderPlans();
  };

  // â”€â”€ Scenario modals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openScenarioModal(scenarioId) {
    const def = SCENARIO_DEFS.find(d => d.id === scenarioId);
    const s = state.plans.scenarios[scenarioId];
    document.getElementById("scenarioModalTitle").textContent = def.emoji + " " + def.title;
    document.getElementById("scenarioModalSubtitle").textContent = def.subtitle;
    const content = document.getElementById("scenarioModalContent");

    if (scenarioId === "home") {
      content.innerHTML = `
        <form id="scenarioHomeForm" style="display:grid; gap:1rem;">
          <div style="background:${def.bg}; border:1px solid ${def.border}; border-radius:0.75rem; padding:0.75rem 1rem; font-size:0.78rem; color:${def.color}; line-height:1.6;">
            <strong>SituÃ¡cia:</strong> CelÃ¡ rodina je doma keÄ nastane krÃ­za (sirÃ©na, vÃ½buch, zemetrasenie). PrepÃ­Å¡te alebo doplÅˆte kroky podÄ¾a vaÅ¡ej domÃ¡cnosti.
            <div style="margin-top:0.375rem; font-size:0.72rem; opacity:0.8;">ğŸ’¡ <em>Kde mÃ¡te hlavnÃ½ istiÄ? PlynovÃ½ uzÃ¡ver? Batoh? ZapÃ­Å¡te si to \u2013 v strese si nepamÃ¤tÃ¡te ani jednoduchÃ© veci.</em></div>
          </div>
          <div>
            <label class="item-label">Postup krok za krokom</label>
            <textarea name="steps" rows="8" style="line-height:1.6; font-size:0.85rem;" placeholder="1. ZostaÅˆte pokojnÃ­ â€“ panika je najvÃ¤ÄÅ¡Ã­ nepriateÄ¾&#10;2. Zapnite rÃ¡dio (RÃ¡dio Slovensko 96,6 FM)&#10;3. Skontrolujte zÃ¡soby a evakuaÄnÃ© batohy&#10;4. ZabezpeÄte dom: oknÃ¡, dvere, plyn&#10;5. Ak treba evakuovaÅ¥: batoh + doklady â†’ miesto stretnutia&#10;6. Nechajte lÃ­stok na dverÃ¡ch kam idete">${esc(s.steps||"")}</textarea>
          </div>
          <div>
            <label class="item-label">Kam evakuujete? (ak treba opustiÅ¥ dom)</label>
            <input name="evacPlace" type="text" value="${esc(s.evacPlace||"")}" placeholder="napr. K starÃ½m rodiÄom, na chatu, na miesto stretnutia..." />
          </div>
          <div>
            <label class="item-label">PoznÃ¡mka</label>
            <input name="note" type="text" value="${esc(s.note||"")}" placeholder="napr. Kto vezme maÄku, kto uzamkne dom, kde sÃº kÄ¾ÃºÄe..." />
          </div>
          <div style="display:flex; justify-content:flex-end;">
            <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
          </div>
        </form>`;
      content.querySelector("#scenarioHomeForm").onsubmit = (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        state.plans.scenarios.home = {
          steps: String(fd.get("steps")||"").trim(),
          evacPlace: String(fd.get("evacPlace")||"").trim(),
          note: String(fd.get("note")||"").trim()
        };
        closeModal("modalScenario");
        scheduleSave(); renderPlans();
      };
    }

    else if (scenarioId === "night") {
      content.innerHTML = `
        <form id="scenarioNightForm" style="display:grid; gap:1rem;">
          <div style="background:${def.bg}; border:1px solid ${def.border}; border-radius:0.75rem; padding:0.75rem 1rem; font-size:0.78rem; color:${def.color}; line-height:1.6;">
            <strong>SituÃ¡cia:</strong> Je 3:00 v noci, zaznie sirÃ©na alebo vÃ¡s zobudÃ­ zemetrasenie. Je tma, ste dezorientovanÃ­.
            <div style="margin-top:0.375rem; font-size:0.72rem; opacity:0.8;">ğŸ’¡ <em>MaÅ¥ Äelovku a topÃ¡nky pri posteli nie je paranoia â€“ je to pripravenosÅ¥. V tme na rozbitÃ© sklo stÃºpite skÃ´r neÅ¾ si to uvedomÃ­te.</em></div>
          </div>
          <div>
            <label class="item-label">Postup krok za krokom</label>
            <textarea name="steps" rows="7" style="line-height:1.6; font-size:0.85rem;" placeholder="1. ZobuÄte vÅ¡etkÃ½ch â€“ pokojne ale rÃ¡zne&#10;2. ÄŒelovka/baterka + topÃ¡nky (HNEÄ)&#10;3. ObleÄte sa teplÃ© obleÄenie&#10;4. Zapnite rÃ¡dio na batÃ©rie&#10;5. Vezmite batoh od dverÃ­&#10;6. Ak treba evakuovaÅ¥: deti neste/veÄte">${esc(s.steps||"")}</textarea>
          </div>
          <div>
            <label class="item-label">Kam evakuujete v noci?</label>
            <input name="evacPlace" type="text" value="${esc(s.evacPlace||"")}" placeholder="napr. RovnakÃ© miesto ako cez deÅˆ, alebo najbliÅ¾Å¡Ã­ Ãºkryt..." />
          </div>
          <div>
            <label class="item-label">PoznÃ¡mka</label>
            <input name="note" type="text" value="${esc(s.note||"")}" placeholder="napr. ÄŒelovka v noÄnom stolÃ­ku, topÃ¡nky pod posteÄ¾ou..." />
          </div>
          <div style="display:flex; justify-content:flex-end;">
            <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
          </div>
        </form>`;
      content.querySelector("#scenarioNightForm").onsubmit = (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        state.plans.scenarios.night = {
          steps: String(fd.get("steps")||"").trim(),
          evacPlace: String(fd.get("evacPlace")||"").trim(),
          note: String(fd.get("note")||"").trim()
        };
        closeModal("modalScenario");
        scheduleSave(); renderPlans();
      };
    }

    else if (scenarioId === "travel") {
      content.innerHTML = `
        <form id="scenarioTravelForm" style="display:grid; gap:1rem;">
          <div style="background:${def.bg}; border:1px solid ${def.border}; border-radius:0.75rem; padding:0.75rem 1rem; font-size:0.78rem; color:${def.color}; line-height:1.6;">
            <strong>SituÃ¡cia:</strong> Jeden Älen rodiny je na sluÅ¾obnej ceste alebo na dovolenke â€“ koordinÃ¡cia na diaÄ¾ku.
            <div style="margin-top:0.375rem; font-size:0.72rem; opacity:0.8;">ğŸ’¡ <em>Dohodnite si kontaktnÃº osobu mimo ohrozenÃ©ho regiÃ³nu (napr. prÃ­buznÃ­ v inom meste). Cez Åˆu sa rodina navzÃ¡jom nÃ¡jde aj keÄ lokÃ¡lne siete zlyhajÃº.</em></div>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.625rem;">
            <div>
              <label class="item-label">Kto cestuje?</label>
              <input name="whoTravels" type="text" value="${esc(s.whoTravels||"")}" placeholder="napr. Ocko, Mama..." />
            </div>
            <div>
              <label class="item-label">KontaktnÃ¡ osoba mimo regiÃ³nu</label>
              <input name="contactPerson" type="text" value="${esc(s.contactPerson||"")}" placeholder="napr. StrÃ½ko Jano v Prahe" />
            </div>
          </div>
          <div>
            <label class="item-label">TelefÃ³n kontaktnej osoby</label>
            <input name="contactPhone" type="text" value="${esc(s.contactPhone||"")}" placeholder="napr. +421 9XX XXX XXX" />
          </div>
          <div>
            <label class="item-label">ÄŒo robÃ­ rodina doma?</label>
            <textarea name="stepsHome" rows="3" style="line-height:1.6; font-size:0.85rem;" placeholder="ZabezpeÄÃ­ dom, ide na miesto stretnutia, ohlÃ¡si sa kontaktnej osobe...">${esc(s.stepsHome||"")}</textarea>
          </div>
          <div>
            <label class="item-label">ÄŒo robÃ­ ten, kto je preÄ?</label>
            <textarea name="stepsAway" rows="3" style="line-height:1.6; font-size:0.85rem;" placeholder="OhlÃ¡si sa kontaktnej osobe, smeruje domov ak to je moÅ¾nÃ©, kontaktuje ambasÃ¡du ak je v zahraniÄÃ­...">${esc(s.stepsAway||"")}</textarea>
          </div>
          <div>
            <label class="item-label">PoznÃ¡mka</label>
            <input name="note" type="text" value="${esc(s.note||"")}" placeholder="napr. ÄŒÃ­slo ambasÃ¡dy, poistenie na cestu..." />
          </div>
          <div style="display:flex; justify-content:flex-end;">
            <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
          </div>
        </form>`;
      content.querySelector("#scenarioTravelForm").onsubmit = (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        state.plans.scenarios.travel = {
          whoTravels: String(fd.get("whoTravels")||"").trim(),
          contactPerson: String(fd.get("contactPerson")||"").trim(),
          contactPhone: String(fd.get("contactPhone")||"").trim(),
          stepsHome: String(fd.get("stepsHome")||"").trim(),
          stepsAway: String(fd.get("stepsAway")||"").trim(),
          note: String(fd.get("note")||"").trim()
        };
        closeModal("modalScenario");
        scheduleSave(); renderPlans();
      };
    }

    else if (scenarioId === "separated") {
      const tasks = s.tasks || [];
      let tasksHtml = "";
      tasks.forEach((t, i) => {
        tasksHtml += `
          <div class="sep-task-row" style="background:white; border:1.5px solid ${def.border}; border-radius:0.875rem; padding:0.875rem; position:relative;">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
              <div style="font-weight:700; font-size:0.8rem; color:${def.color};">Ãšloha ${i+1}</div>
              <button type="button" data-removetask="${i}" style="background:none; border:none; cursor:pointer; color:#dc2626; font-size:0.8rem; font-weight:600; font-family:'Lexend',sans-serif;">OdstrÃ¡niÅ¥</button>
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem;">
              <div>
                <label class="item-sublabel">Kto ide?</label>
                <input name="task_person_${i}" type="text" value="${esc(t.person||"")}" placeholder="napr. Mama, Ocko, Babka..." style="font-size:0.85rem;" />
              </div>
              <div>
                <label class="item-sublabel">Vyzdvihne koho?</label>
                <input name="task_picksUp_${i}" type="text" value="${esc(t.picksUp||"")}" placeholder="napr. Jakub, Ema..." style="font-size:0.85rem;" />
              </div>
              <div>
                <label class="item-sublabel">OdkiaÄ¾?</label>
                <input name="task_from_${i}" type="text" value="${esc(t.from||"")}" placeholder="napr. ZÅ  PartizÃ¡nska, MÅ  LÃºÄka..." style="font-size:0.85rem;" />
              </div>
              <div>
                <label class="item-sublabel">PoznÃ¡mka</label>
                <input name="task_note_${i}" type="text" value="${esc(t.note||"")}" placeholder="napr. BoÄnÃ½ vchod, trieda 3.A" style="font-size:0.85rem;" />
              </div>
            </div>
          </div>`;
      });

      content.innerHTML = `
        <form id="scenarioSepForm" style="display:grid; gap:1rem;">
          <div style="background:${def.bg}; border:1px solid ${def.border}; border-radius:0.75rem; padding:0.75rem 1rem; font-size:0.78rem; color:${def.color}; line-height:1.6;">
            <strong>SituÃ¡cia:</strong> RodiÄia sÃº v prÃ¡ci, deti v Å¡kole/Å¡kÃ´lke/krÃºÅ¾koch. Kto ide pre koho?
            <div style="margin-top:0.375rem; font-size:0.72rem; opacity:0.8;">ğŸ’¡ <em>Å koly majÃº vlastnÃ© krÃ­zovÃ© plÃ¡ny \u2013 deti sÃº v bezpeÄÃ­. NepanikÃ¡rte, ale majte jasnÃ©: kto ide kam, v akom poradÃ­, a Äo ak primÃ¡rna osoba nemÃ´Å¾e. Dohodnite zÃ¡loÅ¾nÃ©ho vyzberaÄa!</em></div>
            <div style="margin-top:0.375rem; font-size:0.72rem; opacity:0.8;">ğŸ’¡ <em>Å koly majÃº vlastnÃ© krÃ­zovÃ© plÃ¡ny â€“ deti nevydajÃº neautorizovanÃ½m osobÃ¡m. Overte vopred, kto je oprÃ¡vnenÃ½ vyzdvihnÃºÅ¥ vaÅ¡e dieÅ¥a (a zapÃ­Å¡te to aj v Å¡kole).</em></div>
          </div>
          <div>
            <div style="font-size:0.78rem; font-weight:700; margin-bottom:0.5rem;">Rozdelenie Ãºloh</div>
            <div id="sepTasksList" style="display:flex; flex-direction:column; gap:0.625rem;">${tasksHtml}</div>
            <button type="button" id="btnAddSepTask" class="btn-ghost" style="margin-top:0.625rem; font-size:0.78rem; padding:0.5rem 1rem; width:100%; text-align:center;">+ PridaÅ¥ Ãºlohu (kto ide pre koho)</button>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.625rem;">
            <div>
              <label class="item-label">Kde sa vÅ¡etci stretnete?</label>
              <input name="meetPlace" type="text" value="${esc(s.meetPlace||"")}" placeholder="napr. Doma, alebo miesto stretnutia" />
            </div>
            <div>
              <label class="item-label">O koÄ¾kej najneskÃ´r?</label>
              <input name="meetTime" type="text" value="${esc(s.meetTime||"")}" placeholder="napr. Do 2 hodÃ­n, o 15:00..." />
            </div>
          </div>
          <div>
            <label class="item-label">PoznÃ¡mka</label>
            <input name="note" type="text" value="${esc(s.note||"")}" placeholder="napr. Ak sa nedÃ¡ vyzdvihnÃºÅ¥ do 1h, volaÅ¥ babku..." />
          </div>
          <div style="display:flex; justify-content:flex-end;">
            <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
          </div>
        </form>`;

      let taskCount = tasks.length;
      const addTaskBtn = content.querySelector("#btnAddSepTask");
      const tasksList = content.querySelector("#sepTasksList");
      addTaskBtn.onclick = () => {
        const i = taskCount++;
        const row = document.createElement("div");
        row.className = "sep-task-row";
        row.style.cssText = `background:white; border:1.5px solid ${def.border}; border-radius:0.875rem; padding:0.875rem; position:relative;`;
        row.innerHTML = `
          <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
            <div style="font-weight:700; font-size:0.8rem; color:${def.color};">Ãšloha ${i+1}</div>
            <button type="button" data-removetask="${i}" style="background:none; border:none; cursor:pointer; color:#dc2626; font-size:0.8rem; font-weight:600; font-family:'Lexend',sans-serif;">OdstrÃ¡niÅ¥</button>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem;">
            <div><label class="item-sublabel">Kto ide?</label><input name="task_person_${i}" type="text" placeholder="napr. Mama, Ocko, Babka..." style="font-size:0.85rem;" /></div>
            <div><label class="item-sublabel">Vyzdvihne koho?</label><input name="task_picksUp_${i}" type="text" placeholder="napr. Jakub, Ema..." style="font-size:0.85rem;" /></div>
            <div><label class="item-sublabel">OdkiaÄ¾?</label><input name="task_from_${i}" type="text" placeholder="napr. ZÅ  PartizÃ¡nska, MÅ  LÃºÄka..." style="font-size:0.85rem;" /></div>
            <div><label class="item-sublabel">PoznÃ¡mka</label><input name="task_note_${i}" type="text" placeholder="" style="font-size:0.85rem;" /></div>
          </div>`;
        tasksList.appendChild(row);
        bindRemoveButtons();
      };

      function bindRemoveButtons() {
        content.querySelectorAll("[data-removetask]").forEach(b => {
          b.onclick = () => { b.closest(".sep-task-row").remove(); };
        });
      }
      bindRemoveButtons();

      content.querySelector("#scenarioSepForm").onsubmit = (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        const newTasks = [];
        const rows = content.querySelectorAll(".sep-task-row");
        rows.forEach(row => {
          const inputs = row.querySelectorAll("input");
          if (inputs.length >= 2) {
            const task = {
              person: (inputs[0]?.value||"").trim(),
              picksUp: (inputs[1]?.value||"").trim(),
              from: (inputs[2]?.value||"").trim(),
              note: (inputs[3]?.value||"").trim()
            };
            if (task.person || task.picksUp) newTasks.push(task);
          }
        });
        state.plans.scenarios.separated = {
          tasks: newTasks,
          meetPlace: String(fd.get("meetPlace")||"").trim(),
          meetTime: String(fd.get("meetTime")||"").trim(),
          note: String(fd.get("note")||"").trim()
        };
        closeModal("modalScenario");
        scheduleSave(); renderPlans();
      };
    }

    else if (scenarioId === "partial") {
      content.innerHTML = `
        <form id="scenarioPartForm" style="display:grid; gap:1rem;">
          <div style="background:${def.bg}; border:1px solid ${def.border}; border-radius:0.75rem; padding:0.75rem 1rem; font-size:0.78rem; color:${def.color}; line-height:1.6;">
            <strong>SituÃ¡cia:</strong> Jeden z partnerov je doma s deÅ¥mi, druhÃ½ je v prÃ¡ci. ÄŒo robÃ­ kaÅ¾dÃ½?
            <div style="margin-top:0.375rem; font-size:0.72rem; opacity:0.8;">ğŸ’¡ <em>Dohodnite si jasnÃ© pravidlo: ak sa nedÃ¡ spojiÅ¥ do X minÃºt, kaÅ¾dÃ½ konÃ¡ podÄ¾a plÃ¡nu a smeruje na miesto stretnutia. NeÄakajte na potvrdenie â€“ konajte.</em></div>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.625rem;">
            <div>
              <label class="item-label">Kto je doma?</label>
              <input name="whoHome" type="text" value="${esc(s.whoHome||"")}" placeholder="napr. Mama, MiÅ¡o..." />
            </div>
            <div>
              <label class="item-label">Kto je v prÃ¡ci?</label>
              <input name="whoWork" type="text" value="${esc(s.whoWork||"")}" placeholder="napr. Ocko, Katka..." />
            </div>
          </div>
          <div>
            <label class="item-label">ÄŒo robÃ­ ten doma?</label>
            <textarea name="homeSteps" rows="3" style="line-height:1.6; font-size:0.85rem;" placeholder="PripravÃ­ batoh, zabezpeÄÃ­ deti, ide na miesto stretnutia...">${esc(s.homeSteps||"")}</textarea>
          </div>
          <div>
            <label class="item-label">ÄŒo robÃ­ ten v prÃ¡ci?</label>
            <textarea name="workSteps" rows="3" style="line-height:1.6; font-size:0.85rem;" placeholder="BezpeÄne opustÃ­ pracovisko, smeruje domov alebo na miesto stretnutia...">${esc(s.workSteps||"")}</textarea>
          </div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.625rem;">
            <div>
              <label class="item-label">Kde sa stretnete?</label>
              <input name="meetPlace" type="text" value="${esc(s.meetPlace||"")}" placeholder="napr. Doma, alebo miesto stretnutia" />
            </div>
            <div>
              <label class="item-label">O koÄ¾kej najneskÃ´r?</label>
              <input name="meetTime" type="text" value="${esc(s.meetTime||"")}" placeholder="napr. Do 2 hodÃ­n, ASAP..." />
            </div>
          </div>
          <div>
            <label class="item-label">PoznÃ¡mka</label>
            <input name="note" type="text" value="${esc(s.note||"")}" placeholder="napr. KÄ¾ÃºÄe od auta â€“ v Å¡uflÃ­ku v chodbe..." />
          </div>
          <div style="display:flex; justify-content:flex-end;">
            <button type="submit" class="btn-primary" style="padding:0.75rem 2rem;">UloÅ¾iÅ¥</button>
          </div>
        </form>`;
      content.querySelector("#scenarioPartForm").onsubmit = (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        state.plans.scenarios.partial = {
          whoHome: String(fd.get("whoHome")||"").trim(),
          whoWork: String(fd.get("whoWork")||"").trim(),
          homeSteps: String(fd.get("homeSteps")||"").trim(),
          workSteps: String(fd.get("workSteps")||"").trim(),
          meetPlace: String(fd.get("meetPlace")||"").trim(),
          meetTime: String(fd.get("meetTime")||"").trim(),
          note: String(fd.get("note")||"").trim()
        };
        closeModal("modalScenario");
        scheduleSave(); renderPlans();
      };
    }

    openModal("modalScenario");
  }

  function getAlertDaysForCategory(catId) {
    if (catId === "medkit") return state.alertDaysMeds || 180;
    if (catId === "food_water") return state.alertDaysFood || 30;
    return state.alertDaysFood || 30;
  }

  function renderAlerts() {
    // Sync select values from state
    const selMeds = document.getElementById("alertDaysMeds");
    const selFood = document.getElementById("alertDaysFood");
    if (selMeds) selMeds.value = state.alertDaysMeds || 180;
    if (selFood) selFood.value = state.alertDaysFood || 30;

    const alerts = [];
    for (const c of CATEGORIES) {
      const threshold = getAlertDaysForCategory(c.id);
      (state.items[c.id]||[]).forEach((it, idx) => {
        // Food entries: check each entry's expiry
        if (it.isFoodItem && it.foodEntries) {
          it.foodEntries.forEach(fe => {
            if (!fe.expiry) return;
            const d = daysUntil(fe.expiry);
            if (d <= threshold) alerts.push({ name: fe.name, expiry: fe.expiry, catName: c.name, catId: c.id, idx, days: d, threshold });
          });
          return;
        }
        // Water entries: check each entry's expiry
        if (it.isWaterItem && it.waterEntries) {
          it.waterEntries.forEach(we => {
            if (!we.expiry) return;
            const d = daysUntil(we.expiry);
            if (d <= threshold) alerts.push({ name: we.name, expiry: we.expiry, catName: c.name, catId: c.id, idx, days: d, threshold });
          });
          return;
        }
        if (!it.expiry) return;
        const d = daysUntil(it.expiry);
        if (d <= threshold) alerts.push({ ...it, catName: c.name, catId: c.id, idx, days: d, threshold });
      });
    }
    alerts.sort((a,b) => a.days - b.days);
    const section = document.getElementById("alertsSection");
    const box = document.getElementById("alertsBox");
    // Email notif status â€“ update in profile modal
    const emailStatus = document.getElementById("emailNotifStatus");
    if (emailStatus) {
      const configured = EMAILJS_CONFIG.publicKey !== "YOUR_EMAILJS_PUBLIC_KEY";
      emailStatus.textContent = configured
        ? `âœ… AktÃ­vne â€“ pripomienky na ${currentUser?.email || "vÃ¡Å¡ email"}`
        : "Pripomienky zatiaÄ¾ nie sÃº aktÃ­vne";
      emailStatus.style.color = configured ? "var(--c-green)" : "var(--c-muted)";
    }

    if (!alerts.length) { section.style.display = "none"; return; }
    section.style.display = "block";
    box.innerHTML = alerts.slice(0,6).map(a => `
      <div style="display:flex; align-items:center; justify-content:space-between; padding:0.625rem 0; border-bottom:1px solid var(--c-border);">
        <div>
          <div style="font-weight:500; font-size:0.875rem;">${esc(a.name)}</div>
          <div style="font-size:0.75rem; color:var(--c-muted);">${esc(a.catName)} â€¢ ${esc(a.expiry)}</div>
        </div>
        <span class="badge ${a.days < 0 ? 'badge-red' : 'badge-amber'}">${a.days < 0 ? 'EXPIROVANÃ‰' : 'za ' + a.days + ' dnÃ­'}</span>
      </div>`).join("");
  }


  // Zobrazenie litrov - vÅ¾dy len ÄÃ­slo + "l"
  function litreSklon(val) {
    const n = parseFloat(val);
    return n.toFixed(1) + " l";
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // PRVÃ POMOC â€“ dÃ¡ta podÄ¾a ERC Guidelines 2025 + prÃ­ruÄka MV SR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const FIRST_AID_DATA = [
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Å½IVOT OHROZUJÃšCE STAVY
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      id: "cardiac_arrest",
      emoji: "â¤ï¸",
      title: "ZÃ¡stava srdca (KPR)",
      subtitle: "KardiopulmonÃ¡lna resuscitÃ¡cia â€“ kaÅ¾dÃ¡ sekunda rozhoduje",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { header: "Rozpoznanie" },
        { text: "<strong>Zavolajte na osobu a potriaste za ramenÃ¡.</strong> Ak nereaguje â€“ skontrolujte dÃ½chanie: zakloÅˆte hlavu, zdvihnite bradu, priblÃ­Å¾te ucho k Ãºstam na max. 10 sekÃºnd." },
        { text: "<strong>Ak nedÃ½cha alebo dÃ½cha abnormÃ¡lne</strong> (lapavÃ©, chrÄivÃ© â€“ tzv. agonÃ¡lne dÃ½chanie) â€“ ide o zÃ¡stavu srdca. Konajte ihneÄ." },
        { warn: "AgonÃ¡lne dÃ½chanie (nepravidelnÃ© lapanie po dychu) NIE JE normÃ¡lne dÃ½chanie. Je to znÃ¡mka zÃ¡stavy srdca â€“ zaÄnite KPR!" },
        { header: "AktivÃ¡cia pomoci" },
        { text: "<strong>Zavolajte 155 alebo 112</strong> â€“ ak ste sami, zavolajte na hlasitÃ½ odposluch a zaÄnite resuscitÃ¡ciu. Ak je prÃ­tomnÃ½ niekto ÄalÅ¡Ã­, poÅ¡lite ho zavolaÅ¥ a priniesÅ¥ AED." },
        { header: "StlaÄovanie hrudnÃ­ka (30 stlaÄenÃ­)" },
        { text: "<strong>PoloÅ¾te osobu na tvrdÃ½ podklad</strong> na chrbÃ¡t. KÄ¾aknite si zboku." },
        { text: "<strong>PoloÅ¾te zÃ¡pÃ¤stie jednej ruky do stredu hrudnÃ­ka</strong> (dolnÃ¡ polovica hrudnej kosti). DruhÃº ruku poloÅ¾te na Åˆu, prepleÅ¥te prsty." },
        { text: "<strong>StlÃ¡Äajte kolmo nadol:</strong> hÄºbka <strong>5â€“6 cm</strong>, rÃ½chlosÅ¥ <strong>100â€“120/min</strong> (rytmus piesne Stayin' Alive). Po kaÅ¾dom stlaÄenÃ­ hrudnÃ­k Ãºplne uvoÄ¾nite â€“ nesedajte na Åˆom." },
        { header: "Vdychy (2 vdychy)" },
        { text: "<strong>Po 30 stlaÄeniach:</strong> zakloÅˆte hlavu, zdvihnite bradu, zatlaÄte nos a 2Ã— vdÃ½chnite do Ãºst (kaÅ¾dÃ½ vdych ~1 sekunda, hrudnÃ­k sa musÃ­ zdvihnÃºÅ¥)." },
        { text: "<strong>PokraÄujte 30:2</strong> â€“ nepreruÅ¡ujte stlaÄovanie na dlhÅ¡ie ako 10 sekÃºnd." },
        { note: "Ak nemÃ´Å¾ete alebo nechcete dÃ½chaÅ¥ z Ãºst do Ãºst â€“ robte aspoÅˆ nepretrÅ¾itÃ© stlaÄovanie hrudnÃ­ka. Aj to zachraÅˆuje Å¾ivoty!" },
        { header: "AED (automatickÃ½ externÃ½ defibrilÃ¡tor)" },
        { text: "<strong>Ak je AED dostupnÃ½ â€“ zapnite ho a nalepte elektrÃ³dy</strong> na holÃ½, suchÃ½ hrudnÃ­k podÄ¾a obrÃ¡zkov. AED mÃ´Å¾e pouÅ¾iÅ¥ ktokoÄ¾vek â€“ riaÄte sa hlasovÃ½mi pokynmi." },
        { text: "<strong>PoÄas analÃ½zy a vÃ½boja sa osoby nedotÃ½kajte.</strong> IhneÄ po vÃ½boji pokraÄujte v KPR." },
        { note: "ERC 2025: AED lokality majÃº byÅ¥ oznaÄenÃ© jasnÃ½m signalizaÄnÃ½m znakom. AED je bezpeÄnÃ½ â€“ prÃ­stroj rozhodne, Äi vÃ½boj podÃ¡." },
        { header: "Kedy prestaÅ¥" },
        { text: "<strong>PokraÄujte v resuscitÃ¡cii</strong> kÃ½m: 1) neprÃ­de zÃ¡chranka, 2) osoba nezaÄne normÃ¡lne dÃ½chaÅ¥, 3) ste Ãºplne vyÄerpanÃ­ (striedajte sa po 2 min.)." }
      ],
      warning: "Ak si nie ste istÃ­ dÃ½chanÃ­m â€“ zaÄnite resuscitÃ¡ciu. LepÅ¡ie zbytoÄnÃ¡ KPR na Å¾ivom ako Å¾iadna na mÅ•tvom. KaÅ¾dÃ¡ minÃºta bez KPR zniÅ¾uje Å¡ancu na preÅ¾itie o 10%.",
      info: "TiesÅˆovÃ© ÄÃ­sla SR: <strong>112</strong> (univerzÃ¡lna), <strong>155</strong> (zÃ¡chranka). Na 112 je moÅ¾nÃ© zaslaÅ¥ aj SMS. DispeÄer vÃ¡s bude navigovaÅ¥ cez telefÃ³n.",
      source: "ERC 2025 BLS",
      sources: [
        { label: "ERC Guidelines 2025 â€“ Adult Basic Life Support (Smyth et al.)", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00283-7/fulltext" },
        { label: "SK MINV â€“ Ochrana obyvateÄ¾stva", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    {
      id: "bleeding",
      emoji: "ğŸ©¸",
      title: "SilnÃ© krvÃ¡canie",
      subtitle: "Å½ivot ohrozujÃºce vonkajÅ¡ie krvÃ¡canie",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { header: "Rozpoznanie masÃ­vneho krvÃ¡cania" },
        { text: "<strong>Krv strieka alebo vytekÃ¡va prÃºdom,</strong> obleÄenie je rÃ½chlo nasiaknutÃ©, na zemi sa tvorÃ­ kaluÅ¾. Toto krvÃ¡canie zabÃ­ja v minÃºtach â€“ konajte okamÅ¾ite." },
        { header: "Zastavenie krvÃ¡cania" },
        { text: "<strong>1. Priamy tlak na ranu</strong> â€“ pritlaÄte ÄistÃº tkaninu, obvÃ¤z alebo priamo ruku (ideÃ¡lne s rukavicami) na krvÃ¡cajÃºce miesto. TlaÄte pevne a nepretrÅ¾ite min. 5â€“10 minÃºt." },
        { text: "<strong>2. Wound packing (vyplnenie rany)</strong> â€“ ak je rana hlbokÃ¡ a priamy tlak nestaÄÃ­: vtlaÄte do rany obvÃ¤z alebo ÄistÃº tkaninu Äo najhlbÅ¡ie a pokraÄujte v tlaku na Åˆu." },
        { text: "<strong>3. TlakovÃ½ obvÃ¤z</strong> â€“ keÄ krvÃ¡canie ustÃ¡va, zabezpeÄte ranu tlakovÃ½m obvÃ¤zom. Ak sa presiaknÃº â€“ NEODSTRAÅ‡UJTE, pridajte ÄalÅ¡iu vrstvu." },
        { header: "Turniket (Å¡krtidlo)" },
        { text: "<strong>Pri masÃ­vnom krvÃ¡canÃ­ z konÄatiny</strong> â€“ ak priamy tlak nestaÄÃ­, priloÅ¾te turniket 5â€“7 cm nad ranu (medzi ranou a srdcom)." },
        { text: "<strong>UÅ¥ahujte, kÃ½m krvÃ¡canie neprestane.</strong> Turniket bolÃ­ â€“ to je normÃ¡lne a sprÃ¡vne." },
        { text: "<strong>ZapÃ­Å¡te Äas priloÅ¾enia</strong> fixkou priamo na turniket aj na telo/Äelo. TCCC: ak nie je viditeÄ¾nÃ½ zdroj krvÃ¡cania, aplikujte turniket Äo najvyÅ¡Å¡ie na konÄatine." },
        { warn: "Turniket NIKDY neuvoÄ¾Åˆujte â€“ to je prÃ¡ca lekÃ¡ra. NesprÃ¡vne uvoÄ¾nenie mÃ´Å¾e spÃ´sobiÅ¥ opÃ¤tovnÃ© krvÃ¡canie alebo uvoÄ¾nenie toxÃ­nov do obehu." },
        { header: "Miesta kde turniket nejde pouÅ¾iÅ¥" },
        { text: "<strong>Krk, podpazuÅ¡ie, slabiny, brucho:</strong> vtlaÄte hemostatickÃ½ obvÃ¤z (QuikClot, Celox) alebo ÄistÃº tkaninu priamo do rany a drÅ¾te pevnÃ½ tlak min. 3 minÃºty." },
        { header: "Po zastavenÃ­ krvÃ¡cania" },
        { text: "<strong>Zavolajte 155 / 112.</strong> UloÅ¾te osobu na chrbÃ¡t, zdvihnite nohy (ak nemÃ¡ poranenie nÃ´h). UdrÅ¾ujte teplo â€“ prikryte dekou, izolujte od zeme." },
        { text: "<strong>Monitorujte vedomie a dÃ½chanie</strong> â€“ ak stratÃ­ vedomie a dÃ½cha, uloÅ¾te do stabilizovanej polohy." }
      ],
      warning: "ERC 2025: NepouÅ¾Ã­vajte tlakovÃ© body â€“ nie sÃº ÃºÄinnÃ©. Priamo tlaÄte na ranu. MasÃ­vna strata krvi (>1 liter) vedie k Å¡oku â€“ kaÅ¾dÃ¡ sekunda sa poÄÃ­ta.",
      info: null,
      source: "ERC 2025 + TCCC 2024",
      sources: [
        { label: "ERC Guidelines 2025 â€“ First Aid: Life-threatening bleeding (DjÃ¤rv et al.)", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00264-3/fulltext" },
        { label: "ILCOR CoSTR 2025 â€“ Control of life-threatening bleeding", url: "https://ilcor.org/" },
        { label: "TCCC Guidelines 2024 â€“ Hemorrhage control", url: "https://books.allogy.com/web/tenant/8/books/b729b76a-1a34-4bf7-b76b-66bb2072b2a7/" }
      ]
    },
    {
      id: "choking",
      emoji: "ğŸ˜¤",
      title: "Dusenie (cudzie teleso)",
      subtitle: "Upchatie dÃ½chacÃ­ch ciest â€“ okamÅ¾itÃ½ zÃ¡sah",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { header: "Rozpoznanie" },
        { text: "<strong>Osoba sa nÃ¡hle nemÃ´Å¾e rozprÃ¡vaÅ¥, kaÅ¡laÅ¥ ani dÃ½chaÅ¥.</strong> ÄŒasto sa chytÃ¡ za hrdlo. KoÅ¾a modrie." },
        { text: "<strong>Ak mÃ´Å¾e kaÅ¡laÅ¥</strong> â€“ povzbudzujte ju nech kaÅ¡le. Nezasahujte, kaÅ¡eÄ¾ je najÃºÄinnejÅ¡Ã­ mechanizmus." },
        { header: "Ak NEMÃ”Å½E kaÅ¡laÅ¥ (Å¥aÅ¾kÃ¡ obÅ¡trukcia)" },
        { text: "<strong>5 Ãºderov medzi lopatky:</strong> PredkloÅˆte osobu (jednou rukou podoprite hrudnÃ­k). Druhou rukou udrite 5Ã— medzi lopatky pÃ¤tou dlane. KaÅ¾dÃ½ Ãºder musÃ­ byÅ¥ silnÃ½ a samostatnÃ½." },
        { text: "<strong>5 stlaÄenÃ­ brucha (Heimlichov manÃ©ver):</strong> Postavte sa za osobu, objÃ­mte ju okolo pÃ¡sa. Zatnite pÃ¤sÅ¥ a umiestnite ju medzi pupok a rebrovÃº oblasÅ¥. Druhou rukou priloÅ¾te na pÃ¤sÅ¥. Prudko zatlaÄte dovnÃºtra a nahor 5Ã—." },
        { text: "<strong>Striedajte 5 Ãºderov a 5 stlaÄenÃ­</strong> kÃ½m sa predmet neuvoÄ¾nÃ­ alebo osoba nestratÃ­ vedomie." },
        { warn: "<strong>U tehotnÃ½ch a obÃ©znych:</strong> namiesto stlaÄenÃ­ brucha pouÅ¾ite stlaÄenia hrudnÃ­ka (ruky na strednÃº ÄasÅ¥ hrudnej kosti)." },
        { header: "Ak stratÃ­ vedomie" },
        { text: "<strong>Opatrne poloÅ¾te na zem.</strong> IhneÄ volajte 155/112." },
        { text: "<strong>ZaÄnite KPR</strong> â€“ stlaÄovanie hrudnÃ­ka mÃ´Å¾e pomÃ´cÅ¥ uvoÄ¾niÅ¥ predmet." },
        { text: "<strong>Pred kaÅ¾dÃ½m vdychom</strong> skontrolujte Ãºsta â€“ ak vidÃ­te predmet, vyberte ho. NevhÅ•Åˆajte prsty naslepo." },
        { header: "Dusenie u bÃ¡bÃ¤tiek (do 1 roka)" },
        { text: "<strong>PoloÅ¾te dieÅ¥a tvÃ¡rou nadol na predlaktie</strong> (hlaviÄka niÅ¾Å¡ie) a podpierajte mu hlaviÄku. 5Ã— udrite medzi lopatky." },
        { text: "<strong>Ak nepomÃ´Å¾e:</strong> otoÄte na chrbÃ¡tik, 5Ã— stlaÄte hrudnÃ­k dvoma prstami (stred hrudnÃ­ka, pod prsnÃ­kmi)." },
        { text: "<strong>Striedajte 5/5</strong> kÃ½m sa predmet neuvoÄ¾nÃ­. Pri bezvedomÃ­ zaÄnite KPR pre dojÄatÃ¡." }
      ],
      warning: "KaÅ¾dÃ½, kto bol oÅ¡etrenÃ½ stlaÄeniami brucha, musÃ­ byÅ¥ nÃ¡sledne vyÅ¡etrenÃ½ lekÃ¡rom â€“ hrozÃ­ vnÃºtornÃ© poranenie orgÃ¡nov.",
      info: null,
      source: "ERC 2025 First Aid",
      sources: [
        { label: "ERC Guidelines 2025 â€“ First Aid: Choking / FBAO (DjÃ¤rv et al.)", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00264-3/fulltext" },
        { label: "ERC Guidelines 2025 â€“ Basic Life Support", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00283-7/fulltext" }
      ]
    },
    {
      id: "anaphylaxis",
      emoji: "ğŸ’œ",
      title: "Anafylaxia",
      subtitle: "Å¤aÅ¾kÃ¡ alergickÃ¡ reakcia â€“ Å¾ivot ohrozujÃºci stav",
      iconBg: "#fdf4ff",
      iconBorder: "#e9d5ff",
      steps: [
        { header: "Rozpoznanie (prÃ­znaky sa rozvÃ­jajÃº v minÃºtach)" },
        { text: "<strong>KoÅ¾a:</strong> nÃ¡hly Å¾ihÄ¾avÃ½ vyrÃ¡Å¾ka, sÄervenanie, opuch tvÃ¡re/pier/jazyka." },
        { text: "<strong>DÃ½chanie:</strong> Å¥aÅ¾kosti s dÃ½chanÃ­m, piskanie, chrÄanie, pocit upchatÃ©ho hrdla." },
        { text: "<strong>Obeh:</strong> zÃ¡vraty, mdloby, rÃ½chly slabÃ½ pulz, bledosÅ¥ (anafylaktickÃ½ Å¡ok)." },
        { text: "<strong>TrÃ¡viaci trakt:</strong> nevoÄ¾nosÅ¥, zvracanie, kÅ•ÄovitÃ¡ bolesÅ¥ brucha." },
        { warn: "Anafylaxia sa vyvÃ­ja veÄ¾mi rÃ½chlo â€“ minÃºty rozhodujÃº o Å¾ivote." },
        { header: "LieÄba" },
        { text: "<strong>Zavolajte 155 alebo 112</strong> â€“ ihneÄ." },
        { text: "<strong>AdrenalÃ­n (EpiPen / Anapen)</strong> â€“ ak mÃ¡ osoba autoinjekÄnÃ½ adrenalÃ­n, pomÃ´Å¾te jej ho pouÅ¾iÅ¥:<br>â€¢ Odistite poistku<br>â€¢ Aplikujte do vonkajÅ¡ej strany stehna (cez obleÄenie je OK)<br>â€¢ DrÅ¾te 10 sekÃºnd<br>â€¢ MasÃ­rujte miesto vpichu" },
        { note: "ERC 2025: AdrenalÃ­n je JEDINÃ ÃºÄinnÃ½ liek pri anafylaxii. AntihistaminikÃ¡ (Zyrtec, Zodac) sÃº prÃ­liÅ¡ pomalÃ© a neÃºÄinnÃ© pri Å¾ivot ohrozujÃºcom stave." },
        { text: "<strong>Poloha podÄ¾a stavu:</strong><br>â€¢ Å¤aÅ¾kosti s dÃ½chanÃ­m â†’ nechajte sedieÅ¥<br>â€¢ Å ok (zÃ¡vraty, bledosÅ¥) â†’ na chrbÃ¡t, nohy hore<br>â€¢ Bezvedomie, dÃ½cha â†’ stabilizovanÃ¡ poloha<br>â€¢ NedÃ½cha â†’ KPR" },
        { text: "<strong>DruhÃ¡ dÃ¡vka adrenalÃ­nu</strong> â€“ ak sa stav do 5â€“10 minÃºt nezlepÅ¡Ã­, aplikujte druhÃ½ autoinjekÄnÃ½ adrenalÃ­n (ak je dostupnÃ½)." },
        { header: "Po stabilizÃ¡cii" },
        { text: "<strong>KaÅ¾dÃ½ po anafylaxii musÃ­ do nemocnice</strong> â€“ aj keÄ sa stav zlepÅ¡il. HrozÃ­ bifÃ¡zickÃ¡ reakcia (nÃ¡vrat prÃ­znakov po 4â€“12 hodinÃ¡ch)." }
      ],
      warning: "Ak mÃ¡te v rodine alergika â€“ zabezpeÄte aby mal autoinjekÄnÃ½ adrenalÃ­n VÅ½DY po ruke (EpiPen / Anapen). NauÄte vÅ¡etkÃ½ch Älenov rodiny, ako ho pouÅ¾iÅ¥. NajÄastejÅ¡ie spÃºÅ¡Å¥aÄe: orechy, hmyzÃ­ bodnutie, lieky, morskÃ© plody.",
      info: null,
      source: "ERC 2025 First Aid",
      sources: [
        { label: "ERC Guidelines 2025 â€“ First Aid: Anaphylaxis (DjÃ¤rv et al.)", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00264-3/fulltext" },
        { label: "ILCOR CoSTR 2025 â€“ First Aid", url: "https://ilcor.org/" }
      ]
    },
    {
      id: "stroke",
      emoji: "ğŸ§ ",
      title: "Cievna mozgovÃ¡ prÃ­hoda",
      subtitle: "MozgovÃ¡ porÃ¡Å¾ka â€“ kaÅ¾dÃ¡ minÃºta rozhoduje",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { header: "Test FAST (rozpoznanie)" },
        { text: "<strong>F â€“ Face (tvÃ¡r):</strong> PoÅ¾iadajte osobu, aby sa usmiala. Pokles jednej strany tvÃ¡re? KÃºtik Ãºst padÃ¡?" },
        { text: "<strong>A â€“ Arms (ruky):</strong> PoÅ¾iadajte zdvihnÃºÅ¥ obe ruky a vydrÅ¾aÅ¥. Jedna ruka klesÃ¡ alebo ju nevlÃ¡dze zdvihnÃºÅ¥?" },
        { text: "<strong>S â€“ Speech (reÄ):</strong> PoÅ¾iadajte zopakovaÅ¥ jednoduchÃº vetu (napr. â€Dnes je peknÃ½ deÅˆâ€). ReÄ je nezrozumiteÄ¾nÃ¡, pomalÃ¡, zmieÅ¡anÃ¡?" },
        { text: "<strong>T â€“ Time (Äas):</strong> Ak je ÄŒOKOÄ½VEK z toho prÃ­tomnÃ© â†’ okamÅ¾ite volajte <strong>155!</strong>" },
        { warn: "ERC 2025: PouÅ¾itie Å¡kÃ¡ly na rozpoznanie mÅ•tvice (FAST) skracuje Äas do zaÄiatku lieÄby. KaÅ¾dÃ¡ minÃºta bez lieÄby niÄÃ­ ~1.9 miliÃ³na mozgovÃ½ch buniek." },
        { header: "ÄalÅ¡ie prÃ­znaky" },
        { text: "<strong>NÃ¡hla silnÃ¡ bolesÅ¥ hlavy</strong> bez zjavnej prÃ­Äiny, nÃ¡hle problÃ©my s videnÃ­m (na jedno alebo obe oÄi), nÃ¡hle zÃ¡vrate a strata rovnovÃ¡hy, nÃ¡hle znecitlivenie tvÃ¡re/ruky/nohy (zvyÄajne na jednej strane)." },
        { header: "ÄŒo robiÅ¥" },
        { text: "<strong>Zavolajte 155 IHNEÄ</strong> â€“ povedzte dispeÄerovi: â€Podozrenie na mÅ•tvicu, pozitÃ­vny test FAST.â€" },
        { text: "<strong>Zaznamenajte Äas</strong> kedy sa prÃ­znaky zaÄali â€“ tÃ¡to informÃ¡cia je kÄ¾ÃºÄovÃ¡ pre lekÃ¡rov (rozhoduje o type lieÄby)." },
        { text: "<strong>UloÅ¾te osobu do pohodlnej polohy</strong> â€“ ideÃ¡lne polosediaÄka s podopretou hlavou." },
        { text: "<strong>NiÄ nepodÃ¡vajte Ãºstami</strong> â€“ Å¾iadne jedlo, pitie ani lieky. PrehÄºtanie mÃ´Å¾e byÅ¥ poruÅ¡enÃ©." },
        { text: "<strong>Ak stratÃ­ vedomie ale dÃ½cha</strong> â†’ stabilizovanÃ¡ poloha. Ak nedÃ½cha â†’ KPR." }
      ],
      warning: "NIKDY neÄakajte Äi prÃ­znaky ustÃºpia â€“ pri mÅ•tvici platÃ­ â€Äas je mozogâ€. NepodÃ¡vajte aspirÃ­n â€“ neviete, Äi ide o upchatie cievy alebo krvÃ¡canie v mozgu (aspirÃ­n pri krvÃ¡canÃ­ zhorÅ¡uje stav).",
      info: null,
      source: "ERC 2025 First Aid",
      sources: [
        { label: "ERC Guidelines 2025 â€“ First Aid: Stroke recognition (DjÃ¤rv et al.)", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00264-3/fulltext" },
        { label: "ILCOR CoSTR 2025 â€“ First Aid: Stroke", url: "https://ilcor.org/" }
      ]
    },
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ÃšRAZY A ZRANENIA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      id: "burns",
      emoji: "ğŸ”¥",
      title: "PopÃ¡leniny",
      subtitle: "TermickÃ© popÃ¡leniny, obareniny a chemickÃ© popÃ¡leniny",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { header: "OkamÅ¾itÃ½ postup" },
        { text: "<strong>Zastavte pÃ´sobenie tepla</strong> â€“ odstrÃ¡Åˆte osobu od zdroja. Ak horÃ­ obleÄenie: <strong>STOP â€“ DROP â€“ ROLL</strong> (zastavte, poloÅ¾te na zem, vÃ¡Ä¾ajte)." },
        { text: "<strong>ChlaÄte teÄÃºcou vodou 20 minÃºt</strong> â€“ ihneÄ, vodou izbovej teploty (15â€“25Â°C). ERC 2025 silnÃ© odporÃºÄanie: chladenie je ÃºÄinnÃ© aj do 3 hodÃ­n po popÃ¡lenÃ­." },
        { text: "<strong>OdstrÃ¡Åˆte obleÄenie a Å¡perky</strong> â€“ opatrne ich zloÅ¾te z popÃ¡lenej oblasti ak nie sÃº prilepenÃ©. Prstene a hodinky zloÅ¾te kÃ½m opuch neznemoÅ¾nÃ­." },
        { warn: "NIKDY nepouÅ¾Ã­vajte: Ä¾ad, maslo, zubnÃº pastu, olej, mÃºku, med. NepouÅ¾Ã­vajte veÄ¾mi studenÃº vodu â€“ hrozÃ­ podchladenie (hlavne u detÃ­)." },
        { header: "Po chladenÃ­" },
        { text: "<strong>Zakryte ranu</strong> voÄ¾ne Äistou, nelepivou tkaninou alebo potravinÃ¡rskou fÃ³liou (horizontÃ¡lne pruhy, nie tesnÃ© omotanie)." },
        { text: "<strong>Neprepichujte pÄ¾uzgiere</strong> â€“ chrÃ¡nia ranu pred infekciou." },
        { header: "Kedy volaÅ¥ 155/112" },
        { text: "<strong>VÅ¾dy volajte pri:</strong> popÃ¡lenine vÃ¤ÄÅ¡ej ako dlaÅˆ postihnutÃ©ho, popÃ¡lenine tvÃ¡re/rÃºk/kÄºbov/genitÃ¡liÃ­, hlbokÃ½ch popÃ¡leninÃ¡ch (biela/hnedÃ¡ koÅ¾a, necitlivosÅ¥), detskÃ½ch popÃ¡leninÃ¡ch, chemickÃ½ch a elektrickÃ½ch popÃ¡leninÃ¡ch, vdÃ½chnutÃ­ horÃºceho dymu." },
        { header: "ChemickÃ© popÃ¡leniny" },
        { text: "<strong>Oplachujte veÄ¾kÃ½m mnoÅ¾stvom vody</strong> min. 20 minÃºt. OdstrÃ¡Åˆte kontaminovanÃ½ odev (chrÃ¡Åˆte seba â€“ rukavice!)." },
        { text: "<strong>SuchÃ© chemikÃ¡lie</strong> (prÃ¡Å¡ok) â€“ najprv oprÃ¡Å¡te, potom oplachujte vodou." },
        { header: "ElektrickÃ© popÃ¡leniny" },
        { text: "<strong>Najprv odpojte zdroj prÃºdu!</strong> NedotÃ½kajte sa osoby kÃ½m je v kontakte s elektrinou. Volajte 155 â€“ elektrickÃ© popÃ¡leniny majÃº skrytÃ© vnÃºtornÃ© poÅ¡kodenie." }
      ],
      warning: "PopÃ¡leniny >20% povrchu tela (u dospelÃ©ho = celÃ¡ ruka+hrudnÃ­k) sÃº Å¾ivot ohrozujÃºce â€“ hrozÃ­ Å¡ok z tekutinovÃ½ch strÃ¡t. ERC 2025: aktÃ­vne chladenie je najdÃ´leÅ¾itejÅ¡Ã­ krok prvej pomoci pri popÃ¡leninÃ¡ch.",
      info: null,
      source: "ERC 2025 + ILCOR",
      sources: [
        { label: "ERC Guidelines 2025 â€“ First Aid: Burns (DjÃ¤rv et al.)", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00264-3/fulltext" },
        { label: "ILCOR CoSTR 2025 â€“ Active cooling of thermal burns", url: "https://ilcor.org/" }
      ]
    },
    {
      id: "fractures",
      emoji: "ğŸ¦´",
      title: "Zlomeniny a poranenia chrbtice",
      subtitle: "Zlomeniny kostÃ­, vyvrtnutia a poranenia kÄºbov",
      iconBg: "#f5f3ee",
      iconBorder: "#e2ddd5",
      steps: [
        { header: "Rozpoznanie zlomeniny" },
        { text: "<strong>PrÃ­znaky:</strong> silnÃ¡ bolesÅ¥ (zosilnenÃ¡ pohybom), opuch, deformÃ¡cia, nemoÅ¾nosÅ¥ hÃ½baÅ¥ konÄatinou, prasknutie pri Ãºraze, modriny." },
        { header: "ZÃ¡kladnÃ½ postup" },
        { text: "<strong>PostihnutÃ©ho zbytoÄne nehÃ½bte.</strong> Ak hrozÃ­ nebezpeÄenstvo (poÅ¾iar, doprava), premiestnite ho Äo nejopatrnejÅ¡ie s fixÃ¡ciou." },
        { text: "<strong>Znehybnite poranenÃº oblasÅ¥</strong> v polohe, v akej sa nachÃ¡dza. Fixujte kÄºb NAD aj POD zlomeninou. Na dlahu pouÅ¾ite ÄokoÄ¾vek tvrdÃ© (doska, palica, zrolovanÃ½ Äasopis) alebo fixujte k telu." },
        { text: "<strong>StudenÃ½ obklad</strong> â€“ zabalenÃ½ v tkanine na opuchnutÃ© miesto, 15â€“20 min. Priamo na koÅ¾u Ä¾ad nedÃ¡vajte." },
        { text: "<strong>Zavolajte 155/112</strong> â€“ pri podozrenÃ­ na zlomeninu, deformÃ¡cii, neschopnosti pohybu." },
        { header: "OtvorenÃ¡ zlomenina (kosÅ¥ preÄnieva)" },
        { text: "<strong>Ranu voÄ¾ne prikryte</strong> Äistou tkaninou. S kosÅ¥ou nemanipulujte â€“ nesnaÅ¾te sa ju vtlaÄiÅ¥ spÃ¤Å¥." },
        { text: "<strong>Ak silne krvÃ¡ca</strong> â€“ zastavte krvÃ¡canie tlakom okolo (nie na) kosÅ¥. Volajte 155." },
        { header: "âš ï¸ Podozrenie na poranenie chrbtice" },
        { text: "<strong>Kedy podozrievaÅ¥:</strong> pÃ¡d z vÃ½Å¡ky, dopravnÃ¡ nehoda, skok do vody, priamy Ãºder do chrbta, Å¡portovÃ½ Ãºraz." },
        { text: "<strong>NEHÃBTE osobou</strong> pokiaÄ¾ to nie je absolÃºtne nevyhnutnÃ© (priame ohrozenie Å¾ivota). ÄŒakajte na zÃ¡chranÃ¡rov." },
        { text: "<strong>Ak musÃ­te presunÃºÅ¥:</strong> udrÅ¾ujte hlavu, krk a chrbÃ¡t v jednej lÃ­nii. IdeÃ¡lne viacerÃ­ Ä¾udia koordinovane." },
        { text: "<strong>Stabilizujte hlavu</strong> â€“ rukami fixujte hlavu z oboch strÃ¡n a zabrÃ¡Åˆte akÃ©mukoÄ¾vek pohybu krku." },
        { warn: "ERC 2025: Pri podozrenÃ­ na poranenie krÄnej chrbtice minimalizujte pohyb krku. NesprÃ¡vna manipulÃ¡cia mÃ´Å¾e spÃ´sobiÅ¥ trvalÃ© ochrnutie." }
      ],
      warning: "NepokÃºÅ¡ajte sa naprÃ¡vaÅ¥ zlomeninu ani vyvrtnutÃ½ kÄºb â€“ to je prÃ¡ca lekÃ¡ra. ZnehybnÃ­te a Äakajte na pomoc.",
      info: null,
      source: "ERC 2025 First Aid",
      sources: [
        { label: "ERC Guidelines 2025 â€“ First Aid: Cervical spinal motion restriction (DjÃ¤rv et al.)", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00264-3/fulltext" }
      ]
    },
    {
      id: "chest_wound",
      emoji: "ğŸ©¸",
      title: "OtvorenÃ¡ rana hrudnÃ­ka",
      subtitle: "PenetrujÃºce poranenie hrudnÃ­ka (pneumotorax)",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { header: "Rozpoznanie" },
        { text: "<strong>PrÃ­znaky:</strong> rana na hrudnÃ­ku (bodnÃ¡, strelnÃ¡, Å¡rapnelovÃ¡), bublanie alebo satie vzduchu z rany pri dÃ½chanÃ­, dÃ½chaviÄnosÅ¥, bolesÅ¥, kaÅ¡eÄ¾ s krvou." },
        { warn: "OtvorenÃ¡ rana hrudnÃ­ka je Å½IVOT ohrozujÃºci stav. Vzduch vnikÃ¡ do hrudnÃ­ka a stlÃ¡Äa pÄ¾Ãºca." },
        { header: "OkamÅ¾itÃ½ postup" },
        { text: "<strong>Zavolajte 155 alebo 112</strong> â€“ ihneÄ." },
        { text: "<strong>Zakryte ranu ventilovou nÃ¡plasÅ¥ou (chest seal)</strong> â€“ ak mÃ¡te: prilepte priamo na ranu. Ventil umoÅ¾nÃ­ vzduchu unikaÅ¥ z hrudnÃ­ka, ale nie vnikaÅ¥." },
        { text: "<strong>Ak nemÃ¡te chest seal â€“ improvizujte:</strong> pouÅ¾ite potravinÃ¡rsku fÃ³liu alebo ÄistÃ½ igelit. Prilepte ho z <strong>troch strÃ¡n</strong> lepenkou a nechajte <strong>jednu stranu voÄ¾nÃº</strong> (jednosmernÃ½ ventil)." },
        { text: "<strong>Skontrolujte aj chrbÃ¡t</strong> â€“ strela alebo Ärepina mÃ´Å¾e maÅ¥ vÃ½stupnÃ½ otvor. Ak Ã¡no, zakryte aj tento otvor rovnakÃ½m spÃ´sobom." },
        { header: "Poloha a monitoring" },
        { text: "<strong>Poloha:</strong> ak je pri vedomÃ­, nechajte v polohe kde sa najlepÅ¡ie dÃ½cha (zvyÄajne polased). PoranenÃº stranu orientujte nadol." },
        { text: "<strong>Ak sa stav zhorÅ¡uje</strong> (zrÃ½chlenÃ© dÃ½chanie, modranie, opuch krÄnej Å¾ily) â€“ mÃ´Å¾e sa vyvÃ­jaÅ¥ tenznÃ½ pneumotorax. Stiahnite nÃ¡plasÅ¥ na chvÃ­Ä¾u, aby mohol ujsÅ¥ tlak, potom znova prilepte." },
        { warn: "NIKDY z rany neodstraÅˆujte zaklÃ­nenÃ½ predmet (nÃ´Å¾, Ärepina). Zafixujte ho obvÃ¤zom a Äakajte na zÃ¡chranku." }
      ],
      warning: "Pri penetrujÃºcom poranenÃ­ hrudnÃ­ka je kÄ¾ÃºÄovÃ© utesniÅ¥ ranu a zabezpeÄiÅ¥ jednosmernÃ½ ventil. TCCC 2024: pouÅ¾ite ventilovÃº nÃ¡plasÅ¥ prednostne pred neventilovÃº.",
      info: null,
      source: "ERC 2025 + TCCC 2024",
      sources: [
        { label: "ERC Guidelines 2025 â€“ First Aid: Open chest wounds (DjÃ¤rv et al.)", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00264-3/fulltext" },
        { label: "TCCC Guidelines 2024 â€“ Tactical Field Care: Chest injuries", url: "https://books.allogy.com/web/tenant/8/books/b729b76a-1a34-4bf7-b76b-66bb2072b2a7/" }
      ]
    },
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ÄALÅ IE STAVY
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      id: "shock",
      emoji: "ğŸ˜°",
      title: "Å ok",
      subtitle: "ObehovÃ½ Å¡ok â€“ zlyhanie krvnÃ©ho obehu",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { header: "Rozpoznanie Å¡oku" },
        { text: "<strong>KoÅ¾a:</strong> bledÃ¡, studenÃ¡, spotenÃ¡ (lepkavÃ¡)." },
        { text: "<strong>Pulz:</strong> rÃ½chly a slabÃ½ (>100/min)." },
        { text: "<strong>DÃ½chanie:</strong> zrÃ½chlenÃ© a plytkÃ©." },
        { text: "<strong>Psychika:</strong> ÃºzkosÅ¥, zmÃ¤tenosÅ¥, ospalosÅ¥, smÃ¤d." },
        { text: "<strong>ÄalÅ¡ie:</strong> zÃ¡vraty, mdloby, studenÃ© konÄatiny, oneskorenÃ© plnenie kapilÃ¡r (stlaÄte necht â€“ biela Å¡kvrna trvÃ¡ >2 sekundy)." },
        { warn: "Å ok je Å¾ivot ohrozujÃºci stav â€“ orgÃ¡ny nedostÃ¡vajÃº dosÅ¥ krvi a kyslÃ­ka. Bez lieÄby vedie k smrti." },
        { header: "Postup" },
        { text: "<strong>Zavolajte 155 / 112</strong> â€“ ihneÄ." },
        { text: "<strong>OÅ¡etrite prÃ­Äinu:</strong> ak je prÃ­Äinou krvÃ¡canie â€“ ZASTAVTE ho (pozri SilnÃ© krvÃ¡canie). Ak anafylaxia â€“ adrenalÃ­n. Ak popÃ¡leniny â€“ chladenie." },
        { text: "<strong>UloÅ¾te na chrbÃ¡t, zdvihnite nohy</strong> 30â€“40 cm (podloÅ¾te batohom, obleÄenÃ­m, vankÃºÅ¡om). VÃ½nimky: poranenie nÃ´h, poranenie chrbtice, Å¥aÅ¾kosti s dÃ½chanÃ­m â†’ nechajte v polohe, ktorÃ¡ je najpohodlnejÅ¡ia." },
        { text: "<strong>UdrÅ¾ujte teplo</strong> â€“ prikryte dekou, kabÃ¡tom. Izolujte od studenÃ©ho povrchu (kartÃ³n, karimatka)." },
        { text: "<strong>NepodÃ¡vajte jedlo ani pitie</strong> â€“ hrozÃ­ aspirÃ¡cia (vdÃ½chnutie). Ak je veÄ¾mi smÃ¤dnÃ½, navlhÄite pery." },
        { text: "<strong>Monitorujte vedomie a dÃ½chanie</strong> â€“ ak stratÃ­ vedomie: stabilizovanÃ¡ poloha. Ak nedÃ½cha: KPR." },
        { text: "<strong>Hovorte s postihnutÃ½m</strong> â€“ upokojte ho, vysvetlite Äo robÃ­te. PsychickÃ¡ podpora zniÅ¾uje stres a spomaÄ¾uje Å¡ok." }
      ],
      warning: "Å ok sa mÃ´Å¾e rozvinÃºÅ¥ aj desiatky minÃºt po Ãºraze â€“ aj keÄ osoba vyzerÃ¡ dobre, monitorujte ju. PrÃ­Äiny: krvÃ¡canie, Å¥aÅ¾kÃ¡ alergia, popÃ¡leniny, infekcia, srdcovÃ½ problÃ©m.",
      info: null,
      source: "ERC 2025 First Aid",
      sources: [
        { label: "ERC Guidelines 2025 â€“ First Aid: Shock management (DjÃ¤rv et al.)", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00264-3/fulltext" }
      ]
    },
    {
      id: "hypothermia",
      emoji: "ğŸ¥¶",
      title: "Podchladenie",
      subtitle: "Pokles telesnej teploty pod 35Â°C",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { header: "Rozpoznanie" },
        { text: "<strong>Mierne (35â€“32Â°C):</strong> triaÅ¡ka, husacia koÅ¾a, studenÃ© ruky a nohy, Å¥aÅ¾kopÃ¡dna reÄ, zmÃ¤tenosÅ¥." },
        { text: "<strong>StrednÃ© (32â€“28Â°C):</strong> triaÅ¡ka ustÃ¡va (!), ospalosÅ¥, strata koordinÃ¡cie, iracionÃ¡lne sprÃ¡vanie (paradoxnÃ© vyzliekanie)." },
        { text: "<strong>Å¤aÅ¾kÃ© (<28Â°C):</strong> strata vedomia, sotva hmatateÄ¾nÃ½ pulz, nehybnosÅ¥ â€“ mÃ´Å¾e vyzeraÅ¥ ako mÅ•tvy, ale NEMUSÃ byÅ¥." },
        { warn: "ERC 2025: â€Nikto nie je mÅ•tvy, kÃ½m nie je teplÃ½ a mÅ•tvy.â€ Pri Å¥aÅ¾kom podchladenÃ­ vÅ¾dy zaÄnite KPR ak nedÃ½cha â€“ aj pri zdanlivo beznÃ¡dejnom stave." },
        { header: "Postup" },
        { text: "<strong>PresuÅˆte do tepla</strong> â€“ ak to nie je moÅ¾nÃ©, chrÃ¡Åˆte pred vetrom, daÅ¾Äom a chladom (prÃ­streÅ¡ok, izolÃ¡cia od zeme)." },
        { text: "<strong>VyzleÄte mokrÃ© obleÄenie</strong> â€“ opatrne! NahraÄte suchÃ½m. Osoba sa nesmie sama prezliekaÅ¥ ani veÄ¾a hÃ½baÅ¥." },
        { text: "<strong>Zahrievajte postupne a pasÃ­vne:</strong> zabaÄ¾te do diek, spacÃ¡ku, izotermickej fÃ³lie (striebornou stranou dovnÃºtra)." },
        { text: "<strong>AktÃ­vne teplo na trup:</strong> teplÃ© (nie horÃºce!) obklady alebo fÄ¾aÅ¡e s teplou vodou na hrudnÃ­k, podpazuÅ¡ie, slabiny â€“ zabalenÃ© v tkanine." },
        { text: "<strong>TeplÃ© sladkÃ© nÃ¡poje</strong> â€“ ak je pri vedomÃ­ a dokÃ¡Å¾e prehÄºtaÅ¥. <strong>NepodÃ¡vajte alkohol</strong> â€“ rozÅ¡iruje cievy a zvyÅ¡uje straty tepla." },
        { text: "<strong>Zavolajte 155/112</strong> â€“ pri strednom a Å¥aÅ¾kom podchladenÃ­ vÅ¾dy." },
        { header: "KritickÃ© chyby" },
        { text: "<strong>Nezahrievajte nÃ¡hle</strong> (horÃºca vaÅˆa, horÃºci radiÃ¡tor) â€“ studenÃ¡ krv z konÄatÃ­n naplavÃ­ srdce a mÃ´Å¾e spÃ´sobiÅ¥ zÃ¡stavu." },
        { text: "<strong>NetrieÅ¥e konÄatiny</strong> a nemasÃ­rujte â€“ hrozÃ­ srdcovÃ¡ arytmia." },
        { text: "<strong>ZaobchÃ¡dzajte veÄ¾mi jemne</strong> â€“ prudkÃ½ pohyb pri Å¥aÅ¾kom podchladenÃ­ mÃ´Å¾e spustiÅ¥ fibrilÃ¡ciu srdca." }
      ],
      warning: "S Å¥aÅ¾ko podchladenou osobou zaobchÃ¡dzajte ako s â€surovÃ½m vajÃ­Äkomâ€ â€“ kaÅ¾dÃ½ prudkÃ½ pohyb mÃ´Å¾e spÃ´sobiÅ¥ srdcovÃº arytmiu. Zahrievajte len trup, nie konÄatiny.",
      info: null,
      source: "ERC 2025 + SK MINV",
      sources: [
        { label: "ERC Guidelines 2025 â€“ Special Circumstances: Hypothermia", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00265-5/fulltext" },
        { label: "SK MINV â€“ Ochrana obyvateÄ¾stva: NÃ­zke teploty", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    {
      id: "poisoning",
      emoji: "â˜ ï¸",
      title: "Otrava",
      subtitle: "PoÅ¾itie, vdÃ½chnutie alebo kontakt s jedom",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { header: "BezpeÄnosÅ¥ najprv" },
        { text: "<strong>Uistite sa, Å¾e miesto je bezpeÄnÃ© pre vÃ¡s.</strong> Pri otrave plynom/chemikÃ¡liou â€“ nevchÃ¡dzajte bez ochrany. OdveÄte osobu na ÄerstvÃ½ vzduch." },
        { header: "AktivÃ¡cia pomoci" },
        { text: "<strong>Zavolajte 155 alebo 112.</strong> Alebo volajte priamo:<br>â€¢ <strong>NTIC: <a href='tel:+421254774166' style='color:#1e40af;'>+421 2 5477 4166</a></strong> (24/7, nonstop)<br>â€¢ <strong>Mobil: <a href='tel:+421911166066' style='color:#1e40af;'>0911 166 066</a></strong>" },
        { note: "NÃ¡rodnÃ© toxikologickÃ© informaÄnÃ© centrum (NTIC) poskytuje odbornÃ© rady pri otravÃ¡ch pre lekÃ¡rov aj verejnosÅ¥ â€“ 24 hodÃ­n denne." },
        { header: "Zistite okolnosti" },
        { text: "<strong>ÄŒo, koÄ¾ko a kedy</strong> â€“ zistite akÃº lÃ¡tku osoba poÅ¾ila/vdÃ½chla, pribliÅ¾nÃ© mnoÅ¾stvo a Äas. Zachovajte obal, zvyÅ¡ok lÃ¡tky alebo zvratky pre zÃ¡chranÃ¡rov." },
        { header: "ÄŒo robiÅ¥ a Äo NIE" },
        { text: "<strong>NevyvolÃ¡vajte zvracanie</strong> â€“ pokiaÄ¾ to vÃ½slovne neodporuÄÃ­ lekÃ¡r alebo toxikolÃ³g. Pri Å¾ieravÃ½ch lÃ¡tkach (kyseliny, lÃºhy, Domestos) by zvracanie spÃ´sobilo ÄalÅ¡ie poleptanie." },
        { text: "<strong>NepodÃ¡vajte niÄ Ãºstami</strong> (mlieko, uhlie, vodu) bez konzultÃ¡cie s lekÃ¡rom." },
        { text: "<strong>Ak je pri vedomÃ­</strong> â€“ udrÅ¾ujte v pokoji, monitorujte stav." },
        { text: "<strong>Ak je v bezvedomÃ­ a dÃ½cha</strong> â€“ uloÅ¾te do stabilizovanej polohy (aby sa nezadusila zvratkami)." },
        { text: "<strong>Ak nedÃ½cha</strong> â€“ zaÄnite KPR. Pozor: pri otrave cez Ãºsta zvÃ¡Å¾te riziko kontaminÃ¡cie â€“ pouÅ¾ite bariÃ©rovÃ½ prostriedok alebo robte len stlaÄovanie hrudnÃ­ka." },
        { header: "Kontakt s chemikÃ¡liou na koÅ¾i/v oÄiach" },
        { text: "<strong>Vyplachujte postihnutÃ© miesto</strong> veÄ¾kÃ½m mnoÅ¾stvom Äistej teÄÃºcej vody minimÃ¡lne <strong>15â€“20 minÃºt</strong>. OdstrÃ¡Åˆte kontaminovanÃ½ odev." }
      ],
      warning: "Pri otrave nebezpeÄnÃ½mi lÃ¡tkami â€“ chrÃ¡Åˆte si dÃ½chacie cesty a oÄi, opustite ohrozenÃ½ priestor. NiektorÃ© lÃ¡tky (hubky, metanol) majÃº oneskorenÃ½ ÃºÄinok â€“ vyhÄ¾adajte lekÃ¡ra aj keÄ sa cÃ­tite dobre.",
      info: "NÃ¡rodnÃ© toxikologickÃ© informaÄnÃ© centrum (NTIC): <strong><a href='tel:+421254774166' style='color:#1e40af;'>+421 2 5477 4166</a></strong> alebo <strong><a href='tel:+421911166066' style='color:#1e40af;'>0911 166 066</a></strong> (24/7, nonstop).",
      source: "ERC 2025 + NTIC + SK MINV",
      sources: [
        { label: "ERC Guidelines 2025 â€“ Special Circumstances: Toxic agents", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00265-5/fulltext" },
        { label: "NÃ¡rodnÃ© toxikologickÃ© informaÄnÃ© centrum (NTIC)", url: "https://www.ntic.sk/" },
        { label: "SK MINV â€“ Ãšnik nebezpeÄnÃ½ch chemickÃ½ch lÃ¡tok", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // VOJNOVÃ‰ ZRANENIA (TCCC PRE CIVILISTOV)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      id: "war_injuries",
      emoji: "ğŸ¯",
      title: "VojnovÃ© zranenia",
      subtitle: "StrelnÃ©, Å¡rapnelovÃ© a vÃ½buchovÃ© zranenia â€“ TCCC pre civilistov",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { header: "âš ï¸ BEZPEÄŒNOSÅ¤ NAJPRV" },
        { text: "<strong>Nikdy nepomÃ¡hajte pod paÄ¾bou.</strong> VaÅ¡a smrÅ¥ neznamenÃ¡a viac zÃ¡chrancov. PoÄkajte kÃ½m je bezpeÄne, alebo prenÃ¡Å¡ajte zranenÃ©ho do Ãºkrytu." },
        { text: "<strong>Ak je zranenÃ½ pri vedomÃ­</strong> â€“ komunikujte: â€Som tu, pomÃ´Å¾em ti. MusÃ­Å¡ sa presunÃºÅ¥ ku mne.â€ Navigujte ho do bezpeÄia." },
        { header: "Protokol M.A.R.C.H. (NATO / UA Å¡tandard)" },
        { note: "MARCH je poradie priorÃ­t â€“ rieÅ¡te prvÃ½ problÃ©m ktorÃ½ nÃ¡jdete, potom pokraÄujte Äalej." },
        { text: "<strong>M â€“ Massive bleeding (masÃ­vne krvÃ¡canie)</strong><br>â†’ Turniket na konÄatiny (5â€“7 cm nad ranu, uÅ¥ahovaÅ¥ kÃ½m neprestane krvÃ¡canie)<br>â†’ Wound packing pre neturniketovateÄ¾nÃ© oblasti (krk, podpazuÅ¡ie, slabiny)<br>â†’ <strong>ZapÃ­Å¡te Äas</strong> fixkou na turniket aj na telo/Äelo" },
        { text: "<strong>A â€“ Airway (dÃ½chacie cesty)</strong><br>â†’ Ak je pri vedomÃ­ â€“ nechajte v polohe kde sa mu najlepÅ¡ie dÃ½cha (aj sediaÄky)<br>â†’ Ak je v bezvedomÃ­ â€“ zÃ¡klon hlavy, zdvihnutie brady, stabilizovanÃ¡ poloha" },
        { text: "<strong>R â€“ Respiration (dÃ½chanie)</strong><br>â†’ Skontrolujte hrudnÃ­k â€“ otvorenej rane priloÅ¾te chest seal alebo fÃ³liu z 3 strÃ¡n<br>â†’ Skontrolujte aj chrbÃ¡t (vÃ½stupnÃ½ otvor)" },
        { text: "<strong>C â€“ Circulation (obeh/Å¡ok)</strong><br>â†’ Skontrolujte ÄalÅ¡ie krvÃ¡canie po celom tele<br>â†’ UloÅ¾te na chrbÃ¡t, zdvihnite nohy<br>â†’ UdrÅ¾ujte teplo" },
        { text: "<strong>H â€“ Hypothermia (podchladenie)</strong><br>â†’ ZranenÃ½ strÃ¡ca teplo veÄ¾mi rÃ½chlo â€“ zabaÄ¾te do izotermickej fÃ³lie alebo ÄohokoÄ¾vek<br>â†’ Izolujte od zeme (kartÃ³n, karimatka, obleÄenie)" },
        { header: "VÃ½buchovÃ© zranenia (blast)" },
        { text: "<strong>VÃ½buch spÃ´sobuje viacero typov zranenÃ­:</strong><br>â€¢ TlakovÃ¡ vlna â€“ poÅ¡kodenie pÄ¾Ãºc, uÅ¡Ã­ (hluchota), vnÃºtornÃ© orgÃ¡ny<br>â€¢ ÄŒrepiny/Å¡rapnel â€“ penetrujÃºce rany<br>â€¢ Odhodenie telom â€“ tupÃ© zranenia, zlomeniny<br>â€¢ PopÃ¡leniny â€“ termickÃ© a chemickÃ©" },
        { text: "<strong>OÅ¡etrite Äo vidÃ­te:</strong> zastavte krvÃ¡canie, zakryte otvorenÃ© rany, chrÃ¡Åˆte pred podchladenÃ­m." },
        { warn: "Po vÃ½buchu: skontrolujte uÅ¡i (krvÃ¡canie = barotrauma), dÃ½chanie (piskanie = poÅ¡kodenie pÄ¾Ãºc). Aj â€dobre vyzerajÃºciâ€ zranenÃ­ mÃ´Å¾u maÅ¥ skrytÃ© vnÃºtornÃ© zranenia." },
        { header: "StrelnÃ© rany" },
        { text: "<strong>VstupnÃ½ aj vÃ½stupnÃ½ otvor:</strong> strela vytvÃ¡ra vstupnÃ½ otvor (menÅ¡Ã­) a vÃ½stupnÃ½ (vÃ¤ÄÅ¡Ã­, nepravidelnÃ½). OÅ¡etrite obe rany." },
        { text: "<strong>Na konÄatinÃ¡ch:</strong> turniket je prvÃ¡ voÄ¾ba. Na trupe: wound packing + priamy tlak." },
        { text: "<strong>Z rany niÄ nevyÅ¥ahujte</strong> â€“ zaklÃ­nenÃ½ predmet zabraÅˆuje vÃ¤ÄÅ¡iemu krvÃ¡caniu." },
        { header: "Zavolajte pomoc" },
        { text: "<strong>112</strong> â€“ a Äakajte na zÃ¡chranku. Ak ste v oblasti konfliktu, presÃºÅˆte zranenÃ©ho do bezpeÄnÃ©ho miesta." }
      ],
      warning: "Turniket neuvoÄ¾Åˆujte â€“ to je prÃ¡ca lekÃ¡ra v nemocnici. NedotÃ½kajte sa neznÃ¡mych predmetov â€“ mÃ´Å¾e Ã­sÅ¥ o nevybuchnutÃº munÃ­ciu. Pri blast zraneniach â€“ aj keÄ osoba vyzerÃ¡ dobre, VÅ½DY volajte zÃ¡chranku.",
      info: "TCCC (Tactical Combat Casualty Care) je medzinÃ¡rodne uznÃ¡vanÃ½ Å¡tandard pre oÅ¡etrenie bojovÃ½ch zranenÃ­, pouÅ¾Ã­vanÃ½ v Ukrajine a NATO. Tieto postupy sÃº adaptovanÃ© pre civilistov â€“ Å¾iadne lieky, len zÃ¡kladnÃ© manuÃ¡lne zÃ¡kroky.",
      source: "TCCC 2024 + ERC 2025 + UA DSNS",
      sources: [
        { label: "TCCC Guidelines 2024 â€“ Tactical Combat Casualty Care", url: "https://books.allogy.com/web/tenant/8/books/b729b76a-1a34-4bf7-b76b-66bb2072b2a7/" },
        { label: "TCCC Ukrajina â€“ TaktickÃ¡ medicÃ­na pre civilistov", url: "https://tccc.org.ua/en" },
        { label: "ERC Guidelines 2025 â€“ First Aid: Life-threatening bleeding", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00264-3/fulltext" },
        { label: "UA DSNS â€“ NÃºdzovÃ¡ prÃ­ruÄka: PrvÃ¡ pomoc", url: "https://dovidka.info/" }
      ]
    }
  ];


  function renderFirstAid() {
    const grid = document.getElementById("firstAidGrid");
    if (!grid) return;
    grid.innerHTML = "";
    FIRST_AID_DATA.forEach(item => {
      const card = document.createElement("div");
      card.className = "fa-card";
      card.setAttribute("role", "button");
      card.setAttribute("tabindex", "0");
      card.setAttribute("aria-label", item.title + " â€“ zobraziÅ¥ postup prvej pomoci");
      card.innerHTML = `
        <div class="fa-icon" style="background:${item.iconBg}; border:1.5px solid ${item.iconBorder};">
          ${item.emoji}
        </div>
        <div class="fa-card-label">${item.title}</div>`;
      card.onclick = () => openFirstAidModal(item);
      card.onkeydown = (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); openFirstAidModal(item); }};
      grid.appendChild(card);
    });
  }

  function openFirstAidModal(item) {
    const icon = document.getElementById("faModalIcon");
    const title = document.getElementById("faModalTitle");
    const subtitle = document.getElementById("faModalSubtitle");
    const content = document.getElementById("faModalContent");

    icon.style.background = item.iconBg;
    icon.style.border = `1.5px solid ${item.iconBorder}`;
    icon.textContent = item.emoji;
    title.textContent = item.title;
    subtitle.textContent = item.subtitle;

    let html = `<div class="fa-emergency-bar">ğŸ“ TiesÅˆovÃ© ÄÃ­slo: <a href="tel:112">112</a> &nbsp;|&nbsp; ZÃ¡chranka: <a href="tel:155">155</a></div>`;

    // Count real steps (text steps only, not headers/notes/warnings)
    const QUICK_VIEW_LIMIT = 3;
    const realSteps = item.steps.filter(s => s.text);
    const hasMoreSteps = realSteps.length > QUICK_VIEW_LIMIT;

    // Build steps HTML â€” split into quick-view and rest
    let stepNum = 0;
    let realStepCount = 0;
    let inHidden = false;

    html += `<div style="margin-bottom:0.5rem;">`;
    item.steps.forEach(step => {
      // When we hit the limit, start the hidden section
      if (hasMoreSteps && !inHidden && step.text && realStepCount === QUICK_VIEW_LIMIT) {
        html += `</div><div id="faFullSteps" style="display:none;"><div style="margin-bottom:0.5rem;">`;
        inHidden = true;
        stepNum = 0; // Reset if new header section is in hidden part
      }
      if (step.header) {
        html += `<div style="font-size:0.82rem; font-weight:700; color:var(--c-text); margin:1rem 0 0.5rem; padding-bottom:0.375rem; border-bottom:1.5px solid var(--c-border);">${step.header}</div>`;
        stepNum = 0;
        return;
      }
      if (step.note) {
        html += `<div style="background:#fef3c7; border:1px solid #fcd34d; border-radius:0.75rem; padding:0.75rem; margin:0.5rem 0; font-size:0.78rem; line-height:1.6; color:#92400e;"><strong>ğŸ’¡</strong> ${step.note}</div>`;
        return;
      }
      if (step.warn) {
        html += `<div style="background:#fef2f2; border:1px solid #fecaca; border-radius:0.75rem; padding:0.75rem; margin:0.5rem 0; font-size:0.78rem; line-height:1.6; color:#991b1b;"><strong>âš ï¸</strong> ${step.warn}</div>`;
        return;
      }
      stepNum++;
      realStepCount++;
      html += `<div class="fa-modal-step">
        <div class="fa-step-num">${stepNum}</div>
        <div class="fa-step-text">${step.text}</div>
      </div>`;
    });

    if (inHidden) {
      html += `</div>`; // close inner margin div
      // Warning, info, source inside hidden section
      if (item.warning) html += `<div class="fa-warning"><strong>âš ï¸ DÃ´leÅ¾itÃ©:</strong> ${item.warning}</div>`;
      if (item.info) html += `<div class="fa-info"><strong>â„¹ï¸ Tip:</strong> ${item.info}</div>`;
      if (Array.isArray(item.sources)) {
        html += `<div class="fa-source"><strong>Zdroje:</strong><br>${item.sources.map(s =>
          s.url ? `<a href="${s.url}" target="_blank" rel="noopener" style="color:#2563eb; text-decoration:underline;">${s.label}</a>` : s.label
        ).join("<br>")}</div>`;
      } else if (item.source) {
        html += `<div class="fa-source"><strong>Zdroj:</strong> ${item.source}</div>`;
      }
      html += `</div>`; // close faFullSteps

      // Expand button
      html += `<button id="faExpandBtn" onclick="document.getElementById('faFullSteps').style.display='block'; this.style.display='none';" style="width:100%; margin-top:0.5rem; padding:0.75rem; background:linear-gradient(135deg, #eff6ff, #dbeafe); border:1.5px solid #93c5fd; border-radius:0.875rem; font-family:'Lexend',sans-serif; font-size:0.82rem; font-weight:700; color:#1e40af; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;" onmouseover="this.style.transform='translateY(-1px)';this.style.boxShadow='0 4px 12px rgba(59,130,246,0.15)'" onmouseout="this.style.transform='';this.style.boxShadow=''">ZobraziÅ¥ celÃ½ postup (${realSteps.length} krokov) â†’</button>`;
    } else {
      html += `</div>`; // close margin div (no hidden section)
      // Warning, info, source in normal flow
      if (item.warning) html += `<div class="fa-warning"><strong>âš ï¸ DÃ´leÅ¾itÃ©:</strong> ${item.warning}</div>`;
      if (item.info) html += `<div class="fa-info"><strong>â„¹ï¸ Tip:</strong> ${item.info}</div>`;
      if (Array.isArray(item.sources)) {
        html += `<div class="fa-source"><strong>Zdroje:</strong><br>${item.sources.map(s =>
          s.url ? `<a href="${s.url}" target="_blank" rel="noopener" style="color:#2563eb; text-decoration:underline;">${s.label}</a>` : s.label
        ).join("<br>")}</div>`;
      } else if (item.source) {
        html += `<div class="fa-source"><strong>Zdroj:</strong> ${item.source}</div>`;
      }
    }

    content.innerHTML = html;
    openModal("modalFirstAid");
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DÃ”LEÅ½ITÃ‰ KONTAKTY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const EMERGENCY_LINES = [
    { number: "112", label: "TiesÅˆovÃ¡ linka", desc: "UniverzÃ¡lna eurÃ³pska tiesÅˆovÃ¡ linka (24/7). Funguje aj bez SIM karty a bez kreditu. MoÅ¾no zaslaÅ¥ aj SMS. OperÃ¡tor hovorÃ­ anglicky. Volajte ak neviete, ktorÃº zloÅ¾ku potrebujete.", emoji: "ğŸ†˜", bg: "#fef2f2", border: "#fecaca", color: "#dc2626" },
    { number: "150", label: "HasiÄi (HaZZ)", desc: "HasiÄskÃ½ a zÃ¡chrannÃ½ zbor SR. Volajte pri poÅ¾iari, Ãºniku chemikÃ¡liÃ­ alebo plynu, dopravnej nehode, zÃ¡chrane osÃ´b z vÃ½Å¡ky/hÄºbky, zÃ¡plavÃ¡ch a technickÃ½ch zÃ¡sahoch.", emoji: "ğŸš’", bg: "#fef2f2", border: "#fecaca", color: "#dc2626" },
    { number: "155", label: "ZÃ¡chranka (ZZS)", desc: "ZÃ¡chrannÃ¡ zdravotnÃ¡ sluÅ¾ba. Volajte pri bezvedomÃ­, zÃ¡stave dÃ½chania, silnom krvÃ¡canÃ­, bolesti na hrudnÃ­ku, podozrenÃ­ na mÅ•tvicu, Å¥aÅ¾kÃ½ch Ãºrazoch, otravÃ¡ch a popÃ¡leninÃ¡ch.", emoji: "ğŸš‘", bg: "#eff6ff", border: "#bfdbfe", color: "#1e40af" },
    { number: "158", label: "PolÃ­cia (PZ SR)", desc: "PolicajnÃ½ zbor SR. Volajte pri trestnom Äine, dopravnej nehode, ohrozenÃ­ bezpeÄnosti, krÃ¡deÅ¾i, nÃ¡silÃ­, podozrivej Äinnosti alebo nÃ¡leze podozrivÃ©ho predmetu.", emoji: "ğŸš”", bg: "#eff6ff", border: "#bfdbfe", color: "#1e40af" },
    { number: "159", label: "MestskÃ¡ polÃ­cia", desc: "ObecnÃ¡ / mestskÃ¡ polÃ­cia. VerejnÃ½ poriadok, parkovanie, ruÅ¡enie noÄnÃ©ho kÄ¾udu, tÃºlavÃ© zvieratÃ¡, Äierne sklÃ¡dky.", emoji: "ğŸ‘®", bg: "#f5f3ee", border: "#e2ddd5", color: "#6b6560" },
    { number: "18 300", label: "HorskÃ¡ sluÅ¾ba", desc: "HorskÃ¡ zÃ¡chrannÃ¡ sluÅ¾ba (HZS). Volajte pri Ãºraze alebo stratenÃ­ v horÃ¡ch. Funguje celoroÄne. Ak nemÃ¡te signÃ¡l, skÃºste SMS na 112.", emoji: "â›°ï¸", bg: "#eaf4ee", border: "#86efac", color: "#2a7a4b" },
  ];

  const INSTITUTIONS = [
    // ZdravotnÃ­ctvo a toxikolÃ³gia
    { name: "NÃ¡rodnÃ© toxikologickÃ© informaÄnÃ© centrum (NTIC)", phone: "+421 2 5477 4166", phone2: "0911 166 066", desc: "24/7 nonstop â€“ odbornÃ© rady pri otravÃ¡ch pre lekÃ¡rov aj verejnosÅ¥. Volajte pri poÅ¾itÃ­ liekov, chemikÃ¡liÃ­, hÃºb, Äistiacich prostriedkov.", emoji: "â˜ ï¸" },
    { name: "Ãšrad verejnÃ©ho zdravotnÃ­ctva SR", phone: "+421 2 4928 4111", url: "https://www.uvzsr.sk", desc: "EpidemiologickÃ© ohrozenia, oÄkovanie, kvalita pitnej vody, ochrana zdravia.", emoji: "ğŸ¥" },
    // KrÃ­zovÃ© a psychologickÃ© linky
    { name: "Linka dÃ´very", phone: "0800 500 333", desc: "BezplatnÃ¡, nonstop, anonymnÃ¡. EmocionÃ¡lna podpora, krÃ­zy, myÅ¡lienky na sebapoÅ¡kodenie. Pre dospelÃ½ch aj mladistvÃ½ch.", emoji: "ğŸ’š" },
    { name: "Linka pomoci", phone: "116 123", desc: "EmocionÃ¡lna podpora a pomoc v krÃ­zovÃ½ch situÃ¡ciÃ¡ch. BezplatnÃ¡ linka.", emoji: "ğŸ¤" },
    { name: "Linka pre Å¾eny zaÅ¾Ã­vajÃºce nÃ¡silie", phone: "0800 212 212", desc: "BezplatnÃ¡, anonymnÃ¡, 24/7. Pomoc pre obete domÃ¡ceho nÃ¡silia.", emoji: "ğŸ›¡ï¸" },
    // CivilnÃ¡ ochrana a poÄasie
    { name: "MV SR â€“ CivilnÃ¡ ochrana", url: "https://www.minv.sk/?ochrana-obyvatelstva", desc: "Varovanie obyvateÄ¾stva, evakuÃ¡cia, krÃ­zovÃ© riadenie. OficiÃ¡lne informÃ¡cie pri mimoriadnych udalostiach.", emoji: "ğŸ›¡ï¸" },
    { name: "SHMÃš â€“ VÃ½strahy a poÄasie", url: "https://www.shmu.sk", desc: "MeteorologickÃ© a hydrologickÃ© vÃ½strahy, predpovede poÄasia, povodÅˆovÃ¡ aktivita, kvalita ovzduÅ¡ia.", emoji: "ğŸŒ¦ï¸" },
    // HumanitÃ¡rna pomoc
    { name: "SlovenskÃ½ ÄŒervenÃ½ krÃ­Å¾", phone: "+421 2 5441 3868", url: "https://www.redcross.sk", desc: "HumanitÃ¡rna pomoc, prvÃ¡ pomoc, kurzy prvej pomoci, vyhÄ¾adÃ¡vanie osÃ´b, psychosociÃ¡lna podpora.", emoji: "âœš" },
    // PoruchovÃ© linky â€“ energie
    { name: "SPP â€“ PoruchovÃ¡ linka PLYN", phone: "0850 111 727", desc: "24/7, celÃ© Slovensko. Volajte ihneÄ pri Ãºniku plynu, zÃ¡pachu, poÅ¡kodenÃ­ plynovÃ©ho zariadenia.", emoji: "ğŸ”¥", highlight: true },
    { name: "Poruchy elektriny â€“ ZSD (zÃ¡pad)", phone: "0800 111 567", desc: "ZÃ¡padoslovenskÃ¡ distribuÄnÃ¡. BratislavskÃ½, TrnavskÃ½, Nitriansky kraj. BezplatnÃ¡ linka.", emoji: "âš¡" },
    { name: "Poruchy elektriny â€“ SSD (stred)", phone: "0800 159 000", desc: "StredoslovenskÃ¡ distribuÄnÃ¡. Å½ilinskÃ½, BanskobystrickÃ½ kraj. BezplatnÃ¡ linka.", emoji: "âš¡" },
    { name: "Poruchy elektriny â€“ VSD (vÃ½chod)", phone: "0800 123 332", desc: "VÃ½chodoslovenskÃ¡ distribuÄnÃ¡. PreÅ¡ovskÃ½, KoÅ¡ickÃ½ kraj. BezplatnÃ¡ linka.", emoji: "âš¡" },
  ];

  function renderEmergencyContacts() {
    // TiesÅˆovÃ© linky
    const linesGrid = document.getElementById("emergencyLinesGrid");
    if (!linesGrid) return;
    linesGrid.innerHTML = "";
    EMERGENCY_LINES.forEach(line => {
      const card = document.createElement("a");
      card.href = `tel:${line.number.replace(/\s/g, "")}`;
      card.className = "ec-card";
      card.title = line.desc;
      card.innerHTML = `
        <div class="ec-icon" style="background:${line.bg}; border:1.5px solid ${line.border};">${line.emoji}</div>
        <div class="ec-card-label">${line.label}</div>
        <div class="ec-card-number" style="color:${line.color};">${line.number}</div>`;
      linesGrid.appendChild(card);
    });

    // InÅ¡titÃºcie â€“ with group headers
    const instGrid = document.getElementById("institutionsGrid");
    if (!instGrid) return;
    instGrid.innerHTML = "";
    
    const instGroups = [
      { label: "Zdravie a toxikolÃ³gia", indices: [0, 1] },
      { label: "KrÃ­zovÃ© a psychologickÃ© linky", indices: [2, 3, 4] },
      { label: "CivilnÃ¡ ochrana a poÄasie", indices: [5, 6] },
      { label: "HumanitÃ¡rna pomoc", indices: [7] },
      { label: "PoruchovÃ© linky â€“ energie (24/7)", indices: [8, 9, 10, 11] },
    ];
    
    instGroups.forEach(group => {
      const groupHeader = document.createElement("div");
      groupHeader.style.cssText = "font-size:0.72rem; font-weight:700; color:var(--c-muted); text-transform:uppercase; letter-spacing:0.04em; margin:0.75rem 0 0.375rem; padding-top:0.5rem; border-top:1px solid var(--c-border);";
      groupHeader.textContent = group.label;
      instGrid.appendChild(groupHeader);
      
      group.indices.forEach(idx => {
        const inst = INSTITUTIONS[idx];
        if (!inst) return;
        const row = document.createElement("div");
        row.style.cssText = "display:flex; align-items:flex-start; gap:0.75rem; padding:0.75rem 0.875rem; background:var(--c-bg); border-radius:0.875rem;";
        let actions = "";
        if (inst.phone) actions += `<a href="tel:${inst.phone.replace(/\s/g, "")}" style="display:inline-flex; align-items:center; gap:0.25rem; background:${inst.highlight ? '#fef2f2' : '#eaf4ee'}; color:${inst.highlight ? '#dc2626' : '#2a7a4b'}; border:1px solid ${inst.highlight ? '#fecaca' : '#86efac'}; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; text-decoration:none; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ“ ${inst.phone}</a> `;
        if (inst.phone2) actions += `<a href="tel:${inst.phone2.replace(/\s/g, "")}" style="display:inline-flex; align-items:center; gap:0.25rem; background:#eaf4ee; color:#2a7a4b; border:1px solid #86efac; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; text-decoration:none; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ“ ${inst.phone2}</a> `;
        if (inst.url) actions += `<a href="${inst.url}" target="_blank" rel="noopener" style="display:inline-flex; align-items:center; gap:0.25rem; background:#eff6ff; color:#1e40af; border:1px solid #bfdbfe; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; text-decoration:none; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ”— Web</a>`;
        row.innerHTML = `
          <div style="font-size:1.25rem; flex-shrink:0; margin-top:0.125rem;">${inst.emoji}</div>
          <div style="flex:1; min-width:0;">
            <div style="font-weight:700; font-size:0.85rem; line-height:1.3;">${inst.name}</div>
            <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.15rem; line-height:1.5;">${inst.desc}</div>
            <div style="display:flex; flex-wrap:wrap; gap:0.375rem; margin-top:0.5rem;">${actions}</div>
          </div>`;
        instGrid.appendChild(row);
      });
    });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // OSOBNÃ‰ KONTAKTY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const PC_CATEGORIES = [
    // Rodina a blÃ­zki
    { id: "family",      emoji: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§", label: "Rodina",              placeholder: "Mama, otec, babka, dedko..." },
    { id: "neighbor",    emoji: "ğŸ˜ï¸", label: "Sused / susedka",     placeholder: "PÃ¡n HorvÃ¡th, 3. poschodie" },
    { id: "friend",      emoji: "ğŸ«‚", label: "BlÃ­zky priateÄ¾",      placeholder: "KamarÃ¡t, ktorÃ½ vie pomÃ´cÅ¥" },
    { id: "work",        emoji: "ğŸ’¼", label: "PrÃ¡ca / zamestnÃ¡vateÄ¾", placeholder: "HR, Å¡Ã©f, kolega..." },
    { id: "school",      emoji: "ğŸ’", label: "Å kola / Å¡kÃ´lka",      placeholder: "ZÅ  PartizÃ¡nska, triedna uÄiteÄ¾ka" },
    // Zdravie
    { id: "doctor",      emoji: "ğŸ©º", label: "VÅ¡eobecnÃ½ lekÃ¡r",     placeholder: "MUDr. KovÃ¡Ä, praktickÃ½ lekÃ¡r" },
    { id: "doctor_kid",  emoji: "ğŸ‘¶", label: "Pediater",            placeholder: "MUDr. NovÃ¡, detskÃ¡ ambulancia" },
    { id: "dentist",     emoji: "ğŸ¦·", label: "ZubÃ¡r",               placeholder: "MDDr. HorvÃ¡t" },
    { id: "specialist",  emoji: "ğŸ¥", label: "Å pecialista",         placeholder: "KardiolÃ³g, alergolÃ³g, psychiater..." },
    { id: "pharmacy",    emoji: "ğŸ’Š", label: "LekÃ¡reÅˆ",             placeholder: "LekÃ¡reÅˆ pri nemocnici, non-stop" },
    // Financie a prÃ¡vo
    { id: "bank",        emoji: "ğŸ¦", label: "Banka",               placeholder: "SlovenskÃ¡ sporiteÄ¾Åˆa, poboÄka..." },
    { id: "lawyer",      emoji: "âš–ï¸", label: "PrÃ¡vnik / notÃ¡r",     placeholder: "JUDr. NovÃ¡k" },
    { id: "ins_life",    emoji: "ğŸ›¡ï¸", label: "Å½ivotnÃ¡ poisÅ¥ovÅˆa",   placeholder: "Allianz â€“ ÄÃ­slo zmluvy..." },
    { id: "ins_car",     emoji: "ğŸš—", label: "Autopoistenie",       placeholder: "Generali â€“ PZP / havarijnÃ©" },
    { id: "ins_home",    emoji: "ğŸ ", label: "Poistenie bytu/domu", placeholder: "ÄŒSOB PoisÅ¥ovÅˆa â€“ domÃ¡cnosÅ¥" },
    // SluÅ¾by pre domÃ¡cnosÅ¥
    { id: "electric",    emoji: "âš¡", label: "ElektrikÃ¡r",           placeholder: "PoruchovÃ¡ linka / sÃºkromnÃ½" },
    { id: "gas",         emoji: "ğŸ”¥", label: "PlynÃ¡r / SPP",        placeholder: "SPP poruchovÃ¡: 0850 111 727" },
    { id: "water",       emoji: "ğŸ’§", label: "VodÃ¡r / vodÃ¡reÅˆ",     placeholder: "BVS, TVVK â€“ poruchovÃ¡ linka" },
    { id: "locksmith",   emoji: "ğŸ”‘", label: "ZÃ¡moÄnÃ­k",            placeholder: "Non-stop zÃ¡moÄnÃ­cka sluÅ¾ba" },
    { id: "vet",         emoji: "ğŸ¾", label: "VeterinÃ¡r",           placeholder: "MVDr. HorvÃ¡th, veterinÃ¡rna klinika" },
    // Ãšrady a ostatnÃ©
    { id: "embassy",     emoji: "ğŸ›ï¸", label: "AmbasÃ¡da / konzulÃ¡t", placeholder: "ZastupiteÄ¾skÃ½ Ãºrad..." },
    { id: "civil_def",   emoji: "ğŸ“¢", label: "CivilnÃ¡ ochrana / obec", placeholder: "ObecnÃ½ Ãºrad, krÃ­zovÃ½ Å¡tÃ¡b..." },
    { id: "other",       emoji: "ğŸ“", label: "InÃ½ kontakt",         placeholder: "" },
  ];

  let pcSelectedCategoryId = "";

  function renderPersonalContacts() {
    const grid = document.getElementById("personalContactsGrid");
    if (!grid) return;
    const contacts = state.personalContacts || [];

    if (contacts.length === 0) {
      grid.innerHTML = `
        <div onclick="openPersonalContactModal(-1)" tabindex="0" role="button" aria-label="PridaÅ¥ osobnÃ½ kontakt" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();openPersonalContactModal(-1)}" style="background:linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%); border:1.5px dashed #86efac; border-radius:1rem; padding:1.25rem; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 18px rgba(0,0,0,0.06)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
          <div style="display:flex; align-items:center; gap:0.75rem;">
            <div style="width:44px; height:44px; border-radius:50%; background:#86efac; display:flex; align-items:center; justify-content:center; font-size:1.25rem; flex-shrink:0;">+</div>
            <div>
              <div style="font-weight:700; font-size:0.9rem; color:#166534;">Pridajte si osobnÃ© kontakty</div>
              <div style="font-size:0.75rem; color:#22c55e; line-height:1.5; margin-top:0.125rem;">LekÃ¡r, rodina, sused, poisÅ¥ovÅˆa, elektrikÃ¡r, Å¡kola â€“ vÅ¡etko na jednom mieste, offline prÃ­stupnÃ© aj bez internetu a signÃ¡lu.</div>
            </div>
          </div>
        </div>`;
      return;
    }

    // Group contacts by category
    const grouped = {};
    contacts.forEach((c, idx) => {
      const catId = c.categoryId || "other";
      if (!grouped[catId]) grouped[catId] = [];
      grouped[catId].push({ ...c, _idx: idx });
    });

    let html = "";
    // Sort groups by PC_CATEGORIES order
    const catOrder = PC_CATEGORIES.map(c => c.id);
    const sortedKeys = Object.keys(grouped).sort((a, b) => catOrder.indexOf(a) - catOrder.indexOf(b));

    sortedKeys.forEach(catId => {
      const cat = PC_CATEGORIES.find(c => c.id === catId) || { emoji: "ğŸ“", label: "InÃ½" };
      const items = grouped[catId];
      items.forEach(c => {
        const phoneClean = (c.phone||"").replace(/\s/g, "");
        const phone2Clean = (c.phone2||"").replace(/\s/g, "");
        html += `
          <div style="display:flex; align-items:flex-start; gap:0.75rem; padding:0.75rem 0.875rem; background:var(--c-bg); border-radius:0.875rem; cursor:pointer; transition:background 0.15s;" tabindex="0" role="button" aria-label="${esc(c.name||'')} â€“ ${cat.label}" onclick="openPersonalContactModal(${c._idx})" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();openPersonalContactModal(${c._idx})}" onmouseover="this.style.background='#f0fdf4'" onmouseout="this.style.background='var(--c-bg)'">
            <div style="font-size:1.25rem; flex-shrink:0; margin-top:0.125rem;">${cat.emoji}</div>
            <div style="flex:1; min-width:0;">
              <div style="display:flex; align-items:center; gap:0.375rem; flex-wrap:wrap;">
                <span style="font-weight:700; font-size:0.85rem; line-height:1.3;">${esc(c.name||"")}</span>
                <span style="font-size:0.65rem; font-weight:600; color:var(--c-muted); background:var(--c-surface); border:1px solid var(--c-border); border-radius:0.375rem; padding:0.1rem 0.375rem;">${cat.label}${c.customType ? " â€“ " + esc(c.customType) : ""}</span>
              </div>
              ${c.note ? `<div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.15rem; line-height:1.4;">${esc(c.note)}</div>` : ""}
              <div style="display:flex; flex-wrap:wrap; gap:0.375rem; margin-top:0.5rem;" onclick="event.stopPropagation()">
                <a href="tel:${phoneClean}" style="display:inline-flex; align-items:center; gap:0.25rem; background:#eaf4ee; color:#2a7a4b; border:1px solid #86efac; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; text-decoration:none; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ“ ${esc(c.phone||"")}</a>
                ${c.phone2 ? `<a href="tel:${phone2Clean}" style="display:inline-flex; align-items:center; gap:0.25rem; background:#eaf4ee; color:#2a7a4b; border:1px solid #86efac; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; text-decoration:none; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ“ ${esc(c.phone2)}</a>` : ""}
                ${c.address ? `<span style="display:inline-flex; align-items:center; gap:0.25rem; background:#eff6ff; color:#1e40af; border:1px solid #bfdbfe; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.7rem; font-weight:600; font-family:'Lexend',sans-serif; white-space:nowrap;">ğŸ“Œ ${esc(c.address)}</span>` : ""}
              </div>
            </div>
            <div style="color:var(--c-muted); font-size:0.8rem; flex-shrink:0; margin-top:0.25rem;">âœï¸</div>
          </div>`;
      });
    });

    grid.innerHTML = html;
  }

  // â”€â”€ Personal contact modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openPersonalContactModal(editIndex) {
    const f = document.getElementById("personalContactForm");
    const isEdit = editIndex >= 0 && editIndex < (state.personalContacts||[]).length;
    const c = isEdit ? state.personalContacts[editIndex] : {};

    document.getElementById("pcModalTitle").textContent = isEdit ? "âœï¸ UpraviÅ¥ kontakt" : "ğŸ‘¤ NovÃ½ kontakt";
    f.elements["pc_editIndex"].value = editIndex;
    f.elements["pc_name"].value = c.name || "";
    f.elements["pc_phone"].value = c.phone || "";
    f.elements["pc_phone2"].value = c.phone2 || "";
    f.elements["pc_address"].value = c.address || "";
    f.elements["pc_note"].value = c.note || "";
    document.getElementById("pcCustomTypeInput").value = c.customType || "";
    document.getElementById("pcCustomTypeInput").style.display = (c.categoryId === "other") ? "block" : "none";
    document.getElementById("btnDeletePC").style.display = isEdit ? "inline-flex" : "none";

    pcSelectedCategoryId = c.categoryId || "";
    renderPCCategoryPicker();
    openModal("modalPersonalContact");
  }
  window.openPersonalContactModal = openPersonalContactModal;

  function renderPCCategoryPicker() {
    const box = document.getElementById("pcCategoryPicker");
    if (!box) return;
    box.innerHTML = PC_CATEGORIES.map(cat => {
      const sel = pcSelectedCategoryId === cat.id;
      return `<button type="button" data-pccat="${cat.id}" style="display:inline-flex; align-items:center; gap:0.25rem; padding:0.3rem 0.5rem; border-radius:0.5rem; font-size:0.72rem; font-weight:600; font-family:'Lexend',sans-serif; cursor:pointer; transition:all 0.15s; border:1.5px solid ${sel ? '#2a7a4b' : 'var(--c-border)'}; background:${sel ? '#eaf4ee' : 'var(--c-surface)'}; color:${sel ? '#2a7a4b' : 'var(--c-muted)'};" title="${cat.label}">${cat.emoji} ${cat.label}</button>`;
    }).join("");
    box.querySelectorAll("[data-pccat]").forEach(btn => {
      btn.onclick = () => {
        pcSelectedCategoryId = btn.dataset.pccat;
        renderPCCategoryPicker();
        const custom = document.getElementById("pcCustomTypeInput");
        custom.style.display = pcSelectedCategoryId === "other" ? "block" : "none";
        // Pre-fill name placeholder
        const cat = PC_CATEGORIES.find(c => c.id === pcSelectedCategoryId);
        if (cat && cat.placeholder) {
          document.querySelector("[name='pc_name']").placeholder = cat.placeholder;
        }
      };
    });
  }

  document.getElementById("btnAddPersonalContact").onclick = () => openPersonalContactModal(-1);

  document.getElementById("personalContactForm").onsubmit = (e) => {
    e.preventDefault();
    if (!pcSelectedCategoryId) { alert("Vyberte typ kontaktu."); return; }
    const fd = new FormData(e.target);
    const idx = parseInt(fd.get("pc_editIndex"));
    const contact = {
      categoryId: pcSelectedCategoryId,
      customType: pcSelectedCategoryId === "other" ? String(fd.get("pc_customType")||"").trim() : "",
      name: String(fd.get("pc_name")||"").trim(),
      phone: String(fd.get("pc_phone")||"").trim(),
      phone2: String(fd.get("pc_phone2")||"").trim(),
      address: String(fd.get("pc_address")||"").trim(),
      note: String(fd.get("pc_note")||"").trim()
    };
    if (!state.personalContacts) state.personalContacts = [];
    if (idx >= 0 && idx < state.personalContacts.length) {
      state.personalContacts[idx] = contact;
    } else {
      state.personalContacts.push(contact);
    }
    closeModal("modalPersonalContact");
    scheduleSave(); renderPersonalContacts();
  };

  document.getElementById("btnDeletePC").onclick = () => {
    const idx = parseInt(document.getElementById("personalContactForm").elements["pc_editIndex"].value);
    if (idx >= 0 && idx < (state.personalContacts||[]).length) {
      if (confirm("OdstrÃ¡niÅ¥ tento kontakt?")) {
        state.personalContacts.splice(idx, 1);
        closeModal("modalPersonalContact");
        scheduleSave(); renderPersonalContacts();
      }
    }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EVAKUAÄŒNÃ‰ BATOÅ½INY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const EVAC_BAG_TYPES = {
    adult:  { emoji: "ğŸ§‘", label: "DospelÃ½", maxKg: 25, kcalDay: 2000, color: "#1e40af", bg: "#eff6ff", border: "#bfdbfe" },
    kid:    { emoji: "ğŸ§’", label: "DieÅ¥a",   maxKg: 15, kcalDay: 1500, color: "#b45309", bg: "#fef3c7", border: "#fcd34d" },
    infant: { emoji: "ğŸ‘¶", label: "BÃ¡bÃ¤tko", maxKg: 5,  kcalDay: 800,  color: "#be185d", bg: "#fdf2f8", border: "#fbcfe8" },
    senior: { emoji: "ğŸ‘´", label: "Senior",  maxKg: 20, kcalDay: 1800, color: "#2a7a4b", bg: "#eaf4ee", border: "#86efac" },
    pet:    { emoji: "ğŸ¾", label: "DomÃ¡ce zviera", maxKg: 10, kcalDay: 0, color: "#6b6560", bg: "#f5f3ee", border: "#e2ddd5" },
  };

  function getEvacBagItems(type) {
    const t = EVAC_BAG_TYPES[type];
    const kcal = t.kcalDay;
    const items = [];

    // â”€â”€ DomÃ¡ce zviera â€“ odliÅ¡nÃ½ obsah â”€â”€
    if (type === "pet") {
      items.push({ cat: "IdentifikÃ¡cia", items: [
        { name: "OÄkovacÃ­ preukaz zvieraÅ¥a", note: "OriginÃ¡l alebo kÃ³pia â€“ niektorÃ© Ãºtulky neprijmÃº zviera bez neho" },
        { name: "Fotografia zvieraÅ¥a (aktuÃ¡lna)", note: "Na papieri aj v telefÃ³ne â€“ pre prÃ­pad straty" },
        { name: "AdresnÃ¡ znÃ¡mka / mikroÄip", note: "Overte aktuÃ¡lnosÅ¥ Ãºdajov v registri (CRSZ)" },
        { name: "KÃ³pia registrÃ¡cie / pedigree", note: "Ak je zviera registrovanÃ©" },
      ]});
      items.push({ cat: "Krmivo a voda", items: [
        { name: "SuchÃ© krmivo (zÃ¡soba na 3â€“5 dnÃ­)", note: "V uzatvÃ¡rateÄ¾nom vodotesnom vrecku" },
        { name: "Konzervy / mokrÃ© krmivo (3 dni)", note: "Nezabudnite na otvÃ¡raÄ" },
        { name: "Voda pre zviera (1â€“2 litre)", note: "ZvieratÃ¡ nemÃ´Å¾u piÅ¥ kontaminovanÃº vodu" },
        { name: "Skladacia miska na jedlo a vodu", note: "SilikÃ³novÃ¡ / plastovÃ¡ â€“ skladnÃ¡" },
      ]});
      items.push({ cat: "Zdravie", items: [
        { name: "Pravidelne uÅ¾Ã­vanÃ© lieky", note: "AntiparazitikÃ¡, srdcovÃ© lieky â€“ zÃ¡soba na 7 dnÃ­" },
        { name: "Kontakt na veterinÃ¡ra (na papieri)", note: "MobilnÃ¡ sieÅ¥ nemusÃ­ fungovaÅ¥" },
        { name: "ObvÃ¤z, dezinfekcia pre zviera", note: "ZÃ¡kladnÃ¡ veterinÃ¡rna lekÃ¡rniÄka" },
      ]});
      items.push({ cat: "Transport a bezpeÄnosÅ¥", items: [
        { name: "Prepravka / klietka", note: "PrimeranÃ¡ veÄ¾kosÅ¥ â€“ zviera musÃ­ maÅ¥ pohodlie. Pre maÄky nevyhnutnÃ¡" },
        { name: "VodÃ­tko + obojok + nÃ¡hubok", note: "Aj kÄ¾udnÃ© zvieratÃ¡ mÃ´Å¾u v strese reagovaÅ¥ nepredvÃ­dateÄ¾ne" },
        { name: "PodloÅ¾ka / deka (znÃ¡my pach)", note: "ZnÃ­Å¾enie stresu â€“ zviera cÃ­ti domov" },
        { name: "HraÄka / predmet s vÃ´Åˆou domova", note: "Na upokojenie" },
        { name: "IgelitovÃ© vreckÃ¡ na exkrementy", note: "Min. 10 ks" },
        { name: "PodloÅ¾ky na uÄenie (Å¡teÅˆatÃ¡/maÄky)", note: "Ak nemÃ¡te prÃ­stup von" },
      ]});
      return items;
    }

    // â”€â”€ Doklady & peniaze â”€â”€
    items.push({ cat: "Doklady a peniaze", items: [
      { name: "ObÄiansky preukaz / pas", note: "OriginÃ¡l â€“ vÅ¾dy maÅ¥ pri sebe. Pas ak hrozÃ­ cezhraniÄnÃ¡ evakuÃ¡cia. Deti: rodnÃ½ list + OP dieÅ¥aÅ¥a" },
      { name: "KartiÄka zdravotnej poisÅ¥ovne", note: "OriginÃ¡l + EHIC karta (EurÃ³psky preukaz). ZapÃ­Å¡te si ÄÃ­slo poisÅ¥ovne aj na papier" },
      { name: "KÃ³pie dÃ´leÅ¾itÃ½ch dokumentov (papier)", note: "RodnÃ½ list, sobÃ¡Å¡ny list, poistnÃ© zmluvy, list vlastnÃ­ctva, zmluvy â€“ vo vodotesnom zipovom vrecku" },
      { name: "Å ifrovanÃ½ USB kÄ¾ÃºÄ so scanmi dokumentov", note: "VÅ¡etky doklady v PDF â€“ zÃ¡loha na USB aj v cloude. Heslo si pamÃ¤tajte alebo dajte blÃ­zkej osobe" },
      { name: "KÄ¾ÃºÄe (dom, auto, pivnica, garÃ¡Å¾)", note: "Na jednom krÃºÅ¾ku pri batohu. NÃ¡hradnÃ½ kÄ¾ÃºÄ u dÃ´veryhodnej osoby mimo vÃ¡Å¡ho regiÃ³nu" },
      { name: "HotovosÅ¥", note: "Min. 200â€“300 â‚¬ v drobnÃ½ch (5, 10, 20 â‚¬). Bankomaty a terminÃ¡ly zlyhajÃº pri vÃ½padku elektriny. Mince na automaty" },
      { name: "PlatobnÃ© karty", note: "Visa/Mastercard od dvoch rÃ´znych bÃ¡nk. ZapÃ­Å¡te si ÄÃ­sla na blokovanie kariet na papier" },
      { name: "Zoznam kontaktov na papieri", note: "Rodina, lekÃ¡r, prÃ¡vnik, banka, poisÅ¥ovÅˆa, zamestnÃ¡vateÄ¾, Å¡kola, ambasÃ¡da â€“ telefÃ³n nemusÃ­ fungovaÅ¥" },
      { name: "ZdravotnÃ½ info list", note: "KrvnÃ¡ skupina, alergie, uÅ¾Ã­vanÃ© lieky, chronickÃ© ochorenia, kontakt na lekÃ¡ra â€“ laminovanÃ½ 1Ã— A4, v batohu aj peÅˆaÅ¾enke" },
    ]});

    // â”€â”€ Zdravie â”€â”€
    const healthItems = [
      { name: "OsobnÃ¡ lekÃ¡rniÄka", note: "SterilnÃ© obvÃ¤zy 3 veÄ¾kosti, gÃ¡za, nÃ¡plaste, elastickÃ½ obvÃ¤z, trojcÃ­py Å¡atka, noÅ¾nice, pinzeta, latexovÃ© rukavice (5 pÃ¡rov), izotermickÃ¡ fÃ³lia" },
      { name: "Dezinfekcia (rany)", note: "Betadine, Cutasept alebo peroxid vodÃ­ka â€“ na oÅ¡etrenie otvorenÃ½ch poranenÃ­. Skontrolujte exspirÃ¡ciu!" },
      { name: "Pravidelne uÅ¾Ã­vanÃ© lieky", note: "ZÃ¡soby na minimÃ¡lne 7â€“14 dnÃ­ + kÃ³pia receptu / nÃ¡zov lieku na papieri. InzulÃ­n: chladiace puzdro FRIO" },
      { name: "VoÄ¾nopredajnÃ© lieky", note: "Ibuprofen/Paralen (bolesÅ¥, teplota), Smecta/aktÃ­vne uhlie (hnaÄka), Cerucal (nevoÄ¾nosÅ¥), antihistaminikum (alergia), Immodium, Endiaron" },
      { name: "Dezinfekcia na ruky", note: "GÃ©l alebo sprej â€“ min. 60% alkohol, 100 ml. Bez Äistej vody je to jedinÃ¡ hygiena rÃºk" },
      { name: "OchrannÃ© rÃºÅ¡ka FFP2 (2 ks)", note: "Ochrana pred prachom, dymom, chemikÃ¡liami, infekciami. FFP2 chrÃ¡ni aj pred vÃ­rusmi" },
      { name: "OpaÄ¾ovacÃ­ krÃ©m SPF 30+", note: "Pri dlhÅ¡ej evakuÃ¡cii vonku â€“ spÃ¡lenie zniÅ¾uje odolnosÅ¥ organizmu" },
    ];
    if (type !== "infant") {
      healthItems.push({ name: "Okuliare / kontaktnÃ© Å¡oÅ¡ovky", note: "NÃ¡hradnÃ©! Bez okuliarov ste v krÃ­ze vÃ½razne zraniteÄ¾nejÅ¡Ã­. ÄŒistiaci sprej/ubrÃºsky" });
    }
    if (type === "infant") {
      healthItems.push({ name: "Plienky a vlhÄenÃ© utierky", note: "ZÃ¡soba na min. 3â€“5 dnÃ­ (15â€“25 ks plienok). Vezmite aj vreckÃ¡ na pouÅ¾itÃ© plienky" });
      healthItems.push({ name: "DojÄenskÃ¡ vÃ½Å¾iva / mlieko", note: "PrÃ¡Å¡kovÃ© mlieko + sterilizovanÃ¡ fÄ¾aÅ¡ka s cumlÃ­kom + ÄistÃ¡ voda. HotovÃ© mlieÄka v Tetrapaku sÃº najpohodlnejÅ¡ie" });
      healthItems.push({ name: "CumlÃ­k a obÄ¾ÃºbenÃ¡ hraÄka", note: "Na upokojenie â€“ stres bÃ¡bÃ¤tko cÃ­ti od rodiÄa. Vezmite 2 kusy cumlÃ­ka (jeden sa stratÃ­)" });
      healthItems.push({ name: "DetskÃ½ krÃ©m / zinkovÃ¡ masÅ¥", note: "Ochrana pred opruzeninami pri dlhÅ¡om pobyte bez kÃºpania" });
      healthItems.push({ name: "Teplomer", note: "DigitÃ¡lny, bezortuÅ¥ovÃ½. HorÃºÄka u bÃ¡bÃ¤tka je vÅ¾dy urgentnÃ¡!" });
    }
    items.push({ cat: "Zdravie a hygiena", items: healthItems });

    // â”€â”€ Jedlo a voda â”€â”€
    const foodItems = [
      { name: "BalenÃ¡ pitnÃ¡ voda (min. 1,5 l)", note: "1,5â€“2 l na osobu na 24 hodÃ­n. MalÃ© fÄ¾aÅ¡e 0,5 l sÃº praktickejÅ¡ie â€“ Ä¾ahÅ¡ie sa nesÃº a delia" },
    ];
    if (type === "adult" || type === "senior") {
      foodItems.push({ name: "Tablety na Äistenie vody", note: "Micropur, Aquatabs â€“ 1 tableta = 1 liter. Na nÃºdzovÃº Ãºpravu vody z neznÃ¡meho zdroja. ÃšÄinkujÃº 30 min" });
    }
    foodItems.push({ name: `TrvanlivÃ© jedlo na 24 h (~${kcal} kcal)`, note: type === "infant" ? "DetskÃ¡ vÃ½Å¾iva v pohÃ¡riku, instantnÃ¡ kaÅ¡a, keksÃ­ky, banÃ¡n" : type === "kid" ? "EnergetickÃ© tyÄinky, orechy, suÅ¡enÃ© ovocie, keksÃ­ky, konzervy s krÃºÅ¾kom, mÃ¼sli tyÄinky" : "EnergetickÃ© tyÄinky, orechy, konzervy s krÃºÅ¾kom, suÅ¡enÃ© mÃ¤so (jerky), ÄokolÃ¡da, instantnÃ¡ polievka, araÅ¡idovÃ© maslo" });
    if (type !== "infant") {
      foodItems.push({ name: "HrnÄek + lyÅ¾ica", note: "Ä½ahkÃ½ plastovÃ½ alebo titÃ¡novÃ½. LyÅ¾ica je najdÃ´leÅ¾itejÅ¡ia â€“ konzervu zjete aj bez vidliÄky" });
      foodItems.push({ name: "MultifunkÄnÃ½ nÃ´Å¾", note: "S otvÃ¡raÄ na konzervy, noÅ¾om, skrutkovaÄom â€“ napr. Victorinox. Nenoste v prÃ­ruÄnej batoÅ¾ine lietadla" });
    }
    if (type === "adult" || type === "senior") {
      foodItems.push({ name: "SoÄ¾ a cukor (malÃ© balenia)", note: "SoÄ¾: na dehydratÃ¡ciu, cukor: na rÃ½chlu energiu. MalÃ© vrecÃºÅ¡ka z reÅ¡taurÃ¡cie sÃº ideÃ¡lne" });
    }
    items.push({ cat: "Jedlo a voda", items: foodItems });

    // â”€â”€ ObleÄenie â”€â”€
    const clothItems = [
      { name: "PevnÃ¡ obuv (PRI BATOHU!)", note: "NepremokavÃ¡, ÄlenkovÃ©, pohodlnÃ¡ â€“ pripravte VEDÄ½A batohu. V panike na Åˆu nemÃ¡te Äas hÄ¾adaÅ¥. NajÄastejÅ¡ia chyba evakuÃ¡cie!" },
      { name: "PlÃ¡Å¡tenka / nepremokavÃ¡ bunda", note: "Ä½ahkÃ¡, skladnÃ¡ â€“ ochrana pred daÅ¾Äom, vetrom aj chladnou nocou. Poncho pokryje aj batoh" },
      { name: "NÃ¡hradnÃ© obleÄenie (1 sada)", note: type === "infant" ? "2Ã— body, Äiapka, ponoÅ¾ky, teplÃ¡ kombinÃ©za, overal" : "TriÄko, nohavice, mikina, Äiapka â€“ podÄ¾a roÄnÃ©ho obdobia. RadÅ¡ej vrstvy ako jednu hrubÃº vestu" },
      { name: "SpodnÃ© prÃ¡dlo a ponoÅ¾ky (2 sady)", note: "SuchÃ© ponoÅ¾ky = prevencia pÄ¾uzgierov a podchladenia. Merino vlna je ideÃ¡lna â€“ rÃ½chlo schne, nesmrdÃ­" },
    ];
    if (type === "adult" || type === "senior") {
      clothItems.push({ name: "PracovnÃ© rukavice", note: "KoÅ¾enÃ© alebo mechanickÃ© â€“ ochrana rÃºk pri pohybe v troskÃ¡ch, skle, drÃ´toch. NepouÅ¾Ã­vajte textilnÃ©" });
      clothItems.push({ name: "OchrannÃ© okuliare / lyÅ¾iarske okuliare", note: "Proti prachu, dymu a Ãºlomkom â€“ dÃ´leÅ¾itÃ© pri pohybe v poÅ¡kodenÃ½ch budovÃ¡ch" });
    }
    items.push({ cat: "ObleÄenie", items: clothItems });

    // â”€â”€ Spanie a teplo â”€â”€
    const sleepItems = [
      { name: "SpacÃ¡k alebo teplÃ¡ deka", note: "KompaktnÃ½, Ä¾ahkÃ½ â€“ teplota komfortu min. 5\u00b0C. SyntetickÃ½ schne rÃ½chlejÅ¡ie ako pÃ¡perovÃ½" },
      { name: "IzotermickÃ¡ (z\u00e1chranÃ¡rska) fÃ³lia (2 ks)", note: "ZlatÃ¡/striebornÃ¡ â€“ vÃ¡Å¾i 50 g, zachrÃ¡ni Å¾ivot pri podchladenÃ­. StriebornÃ¡ strana k telu = teplo dovnÃºtra. Balte 2 ks pre istotu" },
    ];
    if (type !== "infant") {
      sleepItems.push({ name: "Karimatka", note: "Skladacia penovÃ¡ alebo nafukovacia â€“ izolÃ¡cia od studenej/mokrej zeme je kritickÃ¡. Zem odÄerpÃ¡va teplo 25Ã— rÃ½chlejÅ¡ie ako vzduch" });
    }
    if (type === "infant") {
      sleepItems.push({ name: "ZavinovaÄka / detskÃ¡ deka", note: "BÃ¡bÃ¤tko strÃ¡ca teplo rÃ½chlejÅ¡ie ako dospelÃ½ â€“ veÄ¾kÃ½ povrch tela voÄi hmotnosti. VÅ¾dy kontrolujte teplotu krku" });
    }
    if (type === "adult") {
      sleepItems.push({ name: "SvieÄka v plechovke + zapaÄ¾ovaÄ", note: "ÄŒajovÃ¡ svieÄka v konzerve = nÃºdzovÃ© svetlo aj teplo (zvÃ½Å¡i teplotu malÃ©ho priestoru o 2â€“3\u00b0C). Pozor na vetranie!" });
    }
    items.push({ cat: "Spanie a teplo", items: sleepItems });

    // â”€â”€ Technika a komunikÃ¡cia â”€â”€
    const techItems = [];
    if (type !== "infant") {
      techItems.push({ name: "MobilnÃ½ telefÃ³n + nabÃ­jaÄka + kÃ¡bel", note: "Nabite na 100% IHNEÄ pri varovnÃ½ch sprÃ¡vach. Zapnite Å¡etriÄ batÃ©rie, vypnite WiFi/Bluetooth, znÃ­Å¾te jas" });
      techItems.push({ name: "NabitÃ¡ power banka (min. 10 000 mAh)", note: "Pravidelne dobÃ­jajte 1\u00d7 mesaÄne. Skontrolujte kompatibilitu kÃ¡bla. SolÃ¡rna power banka = bonus" });
    }
    if (type === "adult" || type === "senior") {
      techItems.push({ name: "RÃ¡dio na batÃ©rie / kÄ¾uÄkou", note: "JedinÃ½ spoÄ¾ahlivÃ½ zdroj informÃ¡ciÃ­ pri vÃ½padku elektriny a internetu. NalaÄte RÃ¡dio Slovensko (96,6 FM BA / 90,1 FM BB / 89,5 FM KE)" });
      techItems.push({ name: "NÃ¡hradnÃ© batÃ©rie (AA, AAA)", note: "Pre rÃ¡dio a baterku. LithiovÃ© batÃ©rie vydrÅ¾ia dlhÅ¡ie a nekorodujÃº. Skontrolujte akÃ½ typ potrebujete" });
    }
    techItems.push({ name: "Baterka / Äelovka", note: "LED, s nÃ¡hradnÃ½mi batÃ©riami. ÄŒelovka uvoÄ¾nÃ­ obe ruky â€“ zÃ¡sadnÃ¡ vÃ½hoda pri pohybe v tme" });
    if (type === "adult" || type === "kid") {
      techItems.push({ name: "PÃ­Å¡Å¥alka", note: "Na privolanie pomoci â€“ poÄuÅ¥ ju na 1+ km, aj keÄ nemÃ¡te silu kriÄaÅ¥. KaÅ¾dÃ½ Älen rodiny by mal maÅ¥ svoju" });
    }
    if (type !== "infant") {
      techItems.push({ name: "Papier, ceruzka, permanentnÃ¡ fixka", note: "Na poznÃ¡mky, sprÃ¡vy pre rodinu, oznaÄenie dverÃ­ pri evakuÃ¡cii. Fixka pÃ­Å¡e aj na mokrÃ½ povrch" });
    }
    if (type === "adult") {
      techItems.push({ name: "Mapa regiÃ³nu (papierovÃ¡)", note: "GPS nemusÃ­ fungovaÅ¥. PapierovÃ¡ mapa kraja s vyznaÄenÃ½mi evakuaÄnÃ½mi trasami a Ãºkrytmi" });
    }
    if (techItems.length) items.push({ cat: "Technika a komunikÃ¡cia", items: techItems });

    // â”€â”€ Hygiena â”€â”€
    const hygieneItems = [
      { name: "ToaletnÃ½ papier (kompaktnÃ½)", note: "StlaÄte rolku, vyberte dutinku â€“ zaberÃ¡ polovicu miesta" },
      { name: "UterÃ¡k z mikrovlÃ¡kna", note: "SkladacÃ­, rÃ½chloschnÃºci â€“ zaberÃ¡ minimum miesta" },
    ];
    if (type !== "infant") {
      hygieneItems.push({ name: "ZubnÃ¡ kefka + mini pasta", note: "" });
      hygieneItems.push({ name: "VlhÄenÃ© utierky", note: "Na rÃ½chlu hygienu bez vody" });
    }
    if (type === "adult" || type === "senior") {
      hygieneItems.push({ name: "MenÅ¡truaÄnÃ© pomÃ´cky", note: "Ak relevantnÃ© â€“ kalÃ­Å¡ok alebo vloÅ¾ky na 3â€“5 dnÃ­" });
    }
    items.push({ cat: "Hygiena", items: hygieneItems });

    // â”€â”€ RÃ´zne â”€â”€
    const miscItems = [];
    if (type === "kid") {
      miscItems.push({ name: "HraÄka / plyÅ¡iak / hra", note: "Na upokojenie a rozptÃ½lenie â€“ stres preÅ¾Ã­vajÃº aj deti. ObÄ¾ÃºbenÃ¡ vec = pocit bezpeÄia" });
      miscItems.push({ name: "Kniha / omaÄ¾ovÃ¡nky + ceruzky", note: "DlhÃ© Äakanie je pre deti najÅ¥aÅ¾Å¡ie. MalÃ½ zÃ¡pisnÃ­k a fixky zaberÃº minimum miesta" });
      miscItems.push({ name: "KartiÄka s menom a kontaktom", note: "Meno dieÅ¥aÅ¥a, menÃ¡ rodiÄov, telefÃ³n, adresa, krvnÃ¡ skupina â€“ do vrecka kabÃ¡ta aj do batohu. LaminovanÃ¡!" });
      miscItems.push({ name: "MalÃ½ snack navyÅ¡e", note: "HladnÃ© dieÅ¥a = nespokojnÃ© dieÅ¥a. MÃ¼sli tyÄinka, suÅ¡ienky, orechy â€“ nieÄo Äo mÃ¡ rado" });
    } else if (type === "adult") {
      miscItems.push({ name: "IgelitovÃ© vreckÃ¡ (5â€“10 ks)", note: "Na odpadky, mokrÃ© veci, improvizovanÃ¡ ochrana, zber vody, na nohy cez topÃ¡nky pri brodenÃ­" });
      miscItems.push({ name: "PÃ¡ska lepiaca (duct tape)", note: "Opravy, utesÅˆovanie okien, oznaÄovanie, improvizovanÃ© obvÃ¤zy, oprava stanu. NaviÅˆte 3â€“5 m na kreditku" });
      miscItems.push({ name: "Lano / paracord (10 m)", note: "SuÅ¡enie obleÄenia, improvizovanÃ½ prÃ­streÅ¡ok, zÃ¡chrannÃ© ÃºÄely, nosnosÅ¥ paracordu: 250 kg" });
      miscItems.push({ name: "ZapaÄ¾ovaÄ + zÃ¡palky (vodotesnÃ©)", note: "NÃºdzovÃ½ oheÅˆ na varenie, signalizÃ¡ciu, teplo. ZapaÄ¾ovaÄ + zÃ¡loha zÃ¡palky vo vodotesnom obale" });
      miscItems.push({ name: "Kniha / karty / hra", note: "PsychickÃ¡ pohoda je dÃ´leÅ¾itÃ¡ â€“ dlhÃ© Äakanie bez aktivity je psychicky vyÄerpÃ¡vajÃºce" });
      miscItems.push({ name: "KabÃ­nkovÃ© vrecko na cennosti", note: "Pod obleÄenie â€“ pas, peniaze, kÄ¾ÃºÄe na tele. Pri evakuÃ¡cii sa batoh mÃ´Å¾e stratiÅ¥" });
    } else if (type === "senior") {
      miscItems.push({ name: "Skladacia palica / sedaÄka", note: "Ak pouÅ¾Ã­vate â€“ pri dlhom presune nevyhnutnÃ¡. TrojnoÅ¾ka je Ä¾ahkÃ¡ a skladnÃ¡" });
      miscItems.push({ name: "Kniha / karty / sudoku", note: "Na udrÅ¾anie psychickej pohody a mentÃ¡lnej aktivity" });
      miscItems.push({ name: "NaslÃºchadlo + batÃ©rie", note: "Ak pouÅ¾Ã­vate â€“ nÃ¡hradnÃ© batÃ©rie a Äistiaca pomÃ´cka" });
    }
    if (miscItems.length) items.push({ cat: "RÃ´zne", items: miscItems });

    return items;
  }

  function generateEvacBags() {
    const p = state.profile;
    if (!p) return;
    const bags = {};
    let idx = 0;
    for (let i = 0; i < (p.adults||0); i++) {
      const id = "adult_" + i;
      const existing = state.evacuationBags[id];
      bags[id] = {
        type: "adult",
        label: (p.adults > 1) ? `DospelÃ½ ${i + 1}` : "DospelÃ½",
        checked: existing ? existing.checked : {}
      };
      idx++;
    }
    for (let i = 0; i < (p.kids||0); i++) {
      const id = "kid_" + i;
      const existing = state.evacuationBags[id];
      bags[id] = {
        type: "kid",
        label: (p.kids > 1) ? `DieÅ¥a ${i + 1}` : "DieÅ¥a",
        checked: existing ? existing.checked : {}
      };
    }
    for (let i = 0; i < (p.infants||0); i++) {
      const id = "infant_" + i;
      const existing = state.evacuationBags[id];
      bags[id] = {
        type: "infant",
        label: (p.infants > 1) ? `BÃ¡bÃ¤tko ${i + 1}` : "BÃ¡bÃ¤tko",
        checked: existing ? existing.checked : {}
      };
    }
    for (let i = 0; i < (p.seniors||0); i++) {
      const id = "senior_" + i;
      const existing = state.evacuationBags[id];
      bags[id] = {
        type: "senior",
        label: (p.seniors > 1) ? `Senior ${i + 1}` : "Senior",
        checked: existing ? existing.checked : {}
      };
    }
    if (p.pets && p.pets > 0) {
      for (let i = 0; i < p.pets; i++) {
        const id = "pet_" + i;
        const existing = state.evacuationBags[id];
        bags[id] = {
          type: "pet",
          label: (p.pets > 1) ? `Zviera ${i + 1}` : "DomÃ¡ce zviera",
          checked: existing ? existing.checked : {}
        };
      }
    }
    state.evacuationBags = bags;
  }

  function getBagProgress(bagId) {
    const bag = state.evacuationBags[bagId];
    if (!bag) return { done: 0, total: 0, pct: 0 };
    const sections = getEvacBagItems(bag.type);
    let total = 0, done = 0;
    sections.forEach(sec => sec.items.forEach(item => {
      total++;
      if (bag.checked && bag.checked[item.name]) done++;
    }));
    return { done, total, pct: total ? Math.round((done / total) * 100) : 0 };
  }

  function renderEvacBags() {
    const container = document.getElementById("evacBagsContainer");
    const regenBtn = document.getElementById("btnRegenBags");
    if (!container) return;

    if (!state.profile) {
      container.innerHTML = `
        <div style="background:var(--c-bg); border-radius:1rem; padding:1.25rem; text-align:center;">
          <div style="font-size:2rem; margin-bottom:0.5rem;">ğŸ’</div>
          <div style="font-weight:600; font-size:0.9rem; margin-bottom:0.25rem;">Najprv vyplÅˆte profil domÃ¡cnosti</div>
          <div style="font-size:0.78rem; color:var(--c-muted);">BatoÅ¾iny sa vygenerujÃº podÄ¾a poÄtu a typu Älenov vaÅ¡ej rodiny.</div>
        </div>`;
      if (regenBtn) regenBtn.style.display = "none";
      return;
    }

    // Auto-generate if empty or profile changed
    const bagKeys = Object.keys(state.evacuationBags);
    const expectedCount = (state.profile.adults||0) + (state.profile.kids||0) + (state.profile.infants||0) + (state.profile.seniors||0) + (state.profile.pets||0);
    if (bagKeys.length === 0 || bagKeys.length !== expectedCount) {
      generateEvacBags();
      scheduleSave();
    }
    if (regenBtn) regenBtn.style.display = "inline-flex";

    // BYOB info - collapsible
    let html = `
      <div style="background:#fef3c7; border:1px solid #fcd34d; border-radius:0.75rem; padding:0.625rem 0.875rem; margin-bottom:0.75rem; font-size:0.78rem; color:#92400e; line-height:1.6;">
        <strong>ğŸ’¡</strong> Pri evakuÃ¡cii mÃ¡te Äasto len <strong>5â€“15 minÃºt</strong>. KaÅ¾dÃ½ Älen domÃ¡cnosti potrebuje <strong>vlastnÃ½ batoh pri dverÃ¡ch</strong>. Kontrola 2Ã— roÄne.
      </div>
      <div class="info-collapse" style="background:var(--c-bg); margin-bottom:1rem;">
        <button class="info-collapse-toggle" style="color:var(--c-text);" onclick="this.closest('.info-collapse').classList.toggle('open')">
          <span>âš ï¸ PravidlÃ¡ batohu a podrobnosti</span>
          <span class="info-collapse-arrow">â–¼</span>
        </button>
        <div class="info-collapse-body" style="font-size:0.75rem; color:var(--c-muted); line-height:1.6;">
          <p style="margin:0 0 0.5rem; color:#991b1b;"><strong>PravidlÃ¡:</strong> 1) Batoh <strong>pri dverÃ¡ch</strong>, nie v skrini. 2) <strong>TopÃ¡nky vedÄ¾a batohu</strong>. 3) KaÅ¾dÃ½ Älen rodiny musÃ­ <strong>vedieÅ¥ kde batoh je</strong>. 4) Deti od 6 r. â€“ <strong>vedieÅ¥ batoh otvoriÅ¥ a niesÅ¥</strong>. 5) <strong>KartiÄka s kontaktom</strong> vo vrecku kabÃ¡ta.</p>
          <p style="margin:0 0 0.5rem;">Bez pripravenÃ©ho batohu zabudnete lieky, doklady alebo vodu. Batoh by mal byÅ¥ <strong>samostatnÃ½</strong> â€“ nebalte veci, ktorÃ© denne pouÅ¾Ã­vate.</p>
          <p style="margin:0 0 0.375rem; font-weight:600; color:#92400e;">Max. hmotnosÅ¥: DospelÃ½ 25 kg &nbsp;|Â  Senior 20 kg &nbsp;|Â  DieÅ¥a 15 kg &nbsp;|Â  BÃ¡bÃ¤tko 5 kg (nosÃ­ rodiÄ)</p>
          <p style="margin:0; font-size:0.68rem;">Zdroj: CZ 72h (MV ÄŒR, 2025), SK MINV, UA DSNS, SE MSB (2024)</p>
        </div>
      </div>`;

    // Bag cards
    html += `<div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(220px, 1fr)); gap:0.625rem;">`;
    Object.keys(state.evacuationBags).forEach(bagId => {
      const bag = state.evacuationBags[bagId];
      const t = EVAC_BAG_TYPES[bag.type];
      const prog = getBagProgress(bagId);
      const progressColor = colorForPct(prog.pct);

      html += `
        <div onclick="openEvacBagModal('${bagId}')" tabindex="0" role="button" aria-label="${esc(bag.label)} â€“ ${prog.done} z ${prog.total}" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();openEvacBagModal('${bagId}')}" style="background:${t.bg}; border:1.5px solid ${t.border}; border-radius:1rem; padding:1rem; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 6px 18px rgba(0,0,0,0.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
          <div style="display:flex; align-items:center; gap:0.625rem; margin-bottom:0.75rem;">
            <div style="width:40px; height:40px; border-radius:50%; background:white; border:1.5px solid ${t.border}; display:flex; align-items:center; justify-content:center; font-size:1.125rem; flex-shrink:0;">${t.emoji}</div>
            <div>
              <div style="font-weight:700; font-size:0.9rem; color:${t.color};">${esc(bag.label)}</div>
              <div style="font-size:0.68rem; color:var(--c-muted);">max ${t.maxKg} kg &nbsp;Â·&nbsp; ${t.kcalDay} kcal/deÅˆ</div>
            </div>
          </div>
          <div style="display:flex; align-items:center; gap:0.5rem;">
            <div class="progress-bar" style="flex:1; height:6px; margin:0;">
              <div class="progress-fill" style="width:${prog.pct}%; background:${progressColor}; transition:width 0.4s ease;"></div>
            </div>
            <span style="font-size:0.75rem; font-weight:700; color:${progressColor}; white-space:nowrap;">${prog.done}/${prog.total}</span>
          </div>
          ${prog.pct === 100 ? `<div style="text-align:center; margin-top:0.5rem; font-size:0.72rem; font-weight:700; color:#2a7a4b;">âœ“ KompletnÃ¡</div>` : ""}
        </div>`;
    });
    html += `</div>`;

    container.innerHTML = html;
  }

  function openEvacBagModal(bagId) {
    const bag = state.evacuationBags[bagId];
    if (!bag) return;
    const t = EVAC_BAG_TYPES[bag.type];
    const sections = getEvacBagItems(bag.type);
    const prog = getBagProgress(bagId);

    const icon = document.getElementById("evacBagModalIcon");
    icon.style.background = t.bg;
    icon.style.border = `1.5px solid ${t.border}`;
    icon.textContent = t.emoji;
    document.getElementById("evacBagModalTitle").textContent = "ğŸ’ " + bag.label;
    document.getElementById("evacBagModalSubtitle").textContent = `Max ${t.maxKg} kg Â· ${t.kcalDay} kcal/deÅˆ Â· ${prog.done}/${prog.total} poloÅ¾iek`;

    let html = `
      <div style="display:flex; align-items:center; gap:0.625rem; margin-bottom:1rem;">
        <div class="progress-bar" style="flex:1; height:8px; margin:0;">
          <div class="progress-fill" style="width:${prog.pct}%; background:${colorForPct(prog.pct)}; transition:width 0.3s;"></div>
        </div>
        <span style="font-size:0.9rem; font-weight:800; color:${colorForPct(prog.pct)};">${prog.pct}%</span>
      </div>`;

    sections.forEach(sec => {
      html += `<div style="margin-bottom:1rem;">
        <div style="font-size:0.72rem; font-weight:700; color:var(--c-muted); text-transform:uppercase; letter-spacing:0.05em; margin-bottom:0.5rem;">${sec.cat}</div>`;
      sec.items.forEach(item => {
        const checked = bag.checked && bag.checked[item.name];
        html += `
          <div data-evacitem="${esc(item.name)}" data-evacbag="${bagId}" style="display:flex; align-items:flex-start; gap:0.625rem; padding:0.5rem 0.625rem; border-radius:0.625rem; cursor:pointer; transition:background 0.15s; ${checked ? 'opacity:0.6;' : ''}" onmouseover="this.style.background='var(--c-bg)'" onmouseout="this.style.background='transparent'">
            <div style="width:22px; height:22px; border-radius:0.375rem; border:2px solid ${checked ? '#2a7a4b' : 'var(--c-border)'}; background:${checked ? '#2a7a4b' : 'white'}; display:flex; align-items:center; justify-content:center; flex-shrink:0; margin-top:0.0625rem; transition:all 0.15s;">
              ${checked ? '<span style="color:white; font-size:0.75rem; font-weight:700;">âœ“</span>' : ''}
            </div>
            <div style="flex:1; min-width:0;">
              <div style="font-size:0.85rem; font-weight:600; ${checked ? 'text-decoration:line-through; color:var(--c-muted);' : 'color:var(--c-text);'}">${esc(item.name)}</div>
              ${item.note ? `<div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.1rem; line-height:1.4;">${esc(item.note)}</div>` : ""}
            </div>
          </div>`;
      });
      html += `</div>`;
    });

    html += `
      <div style="display:flex; justify-content:space-between; align-items:center; padding-top:0.75rem; border-top:1px solid var(--c-border); margin-top:0.5rem;">
        <button type="button" onclick="toggleAllEvacItems('${bagId}', true)" class="btn-ghost" style="font-size:0.72rem; padding:0.375rem 0.75rem;">âœ“ OznaÄiÅ¥ vÅ¡etko</button>
        <button type="button" onclick="toggleAllEvacItems('${bagId}', false)" class="btn-ghost" style="font-size:0.72rem; padding:0.375rem 0.75rem; color:#dc2626;">âœ• OdznaÄiÅ¥ vÅ¡etko</button>
      </div>`;

    const content = document.getElementById("evacBagModalContent");
    content.innerHTML = html;

    // Bind item clicks
    content.querySelectorAll("[data-evacitem]").forEach(el => {
      el.onclick = () => {
        const itemName = el.dataset.evacitem;
        const bId = el.dataset.evacbag;
        if (!state.evacuationBags[bId].checked) state.evacuationBags[bId].checked = {};
        state.evacuationBags[bId].checked[itemName] = !state.evacuationBags[bId].checked[itemName];
        scheduleSave();
        // Re-render modal in place
        openEvacBagModal(bId);
        renderEvacBags();
      };
    });

    openModal("modalEvacBag");
  }
  window.openEvacBagModal = openEvacBagModal;

  function toggleAllEvacItems(bagId, val) {
    const bag = state.evacuationBags[bagId];
    if (!bag) return;
    const sections = getEvacBagItems(bag.type);
    if (!bag.checked) bag.checked = {};
    sections.forEach(sec => sec.items.forEach(item => {
      bag.checked[item.name] = val;
    }));
    scheduleSave();
    openEvacBagModal(bagId);
    renderEvacBags();
  }
  window.toggleAllEvacItems = toggleAllEvacItems;

  document.getElementById("btnRegenBags").onclick = () => {
    if (confirm("PregenerovaÅ¥ batohy podÄ¾a aktuÃ¡lneho profilu? ZaÅ¡krtnutÃ© poloÅ¾ky sa zachovajÃº.")) {
      generateEvacBags();
      scheduleSave();
      renderEvacBags();
    }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // VAROVNÃ‰ SIGNÃLY SIRÃ‰N
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const SIRENS_DATA = [
    {
      id: "general",
      title: "VÅ¡eobecnÃ© ohrozenie",
      duration: "2 minÃºty",
      type: "kolÃ­savÃ½ tÃ³n",
      color: "#dc2626",
      bg: "#fef2f2",
      border: "#fecaca",
      wave: "oscillating",
      meaning: "Signalizuje ohrozenie alebo vznik mimoriadnej udalosti (chemickÃ½ Ãºnik, radiÃ¡cia, priemyselnÃ¡ havÃ¡ria, teroristickÃ½ Ãºtok), ako aj moÅ¾nosÅ¥ rozÅ¡Ã­renia jej nÃ¡sledkov. TÃ³n stÃºpa a klesÃ¡ po dobu 2 minÃºt.",
      howToRecognize: "KolÃ­savÃ½ (stÃºpajÃºci a klesajÃºci) tÃ³n sirÃ©ny trvajÃºci presne 2 minÃºty. Zvuk pripomÃ­na vlnenie â€“ striedavo zosilÅˆuje a zoslabuje. JednoznaÄne odlÃ­Å¡iteÄ¾nÃ½ od stÃ¡leho tÃ³nu skÃºÅ¡ky.",
      actions: [
        { header: "OkamÅ¾itÃ© kroky (prvÃ© 2 minÃºty)" },
        { text: "<strong>Vojdite do najbliÅ¾Å¡ej budovy</strong> â€“ nepokÃºÅ¡ajte sa dostaÅ¥ domov, vojdite do najbliÅ¾Å¡ieho murovanÃ©ho objektu." },
        { text: "<strong>Zatvorte a utesnite oknÃ¡, dvere a ventilaÄnÃ© otvory.</strong> Netesnosti prelepte lepiacou pÃ¡skou, vÃ¤ÄÅ¡ie otvory utesnite mokrÃ½mi handradami alebo fÃ³liou." },
        { text: "<strong>Vypnite klimatizÃ¡ciu a ventilÃ¡tory</strong> â€“ zastavte akÃºkoÄ¾vek vÃ½menu vzduchu s vonkajÅ¡Ã­m prostredÃ­m." },
        { text: "<strong>PresuÅˆte sa do vnÃºtornej miestnosti</strong> bez okien (chodba, kÃºpeÄ¾Åˆa). Ak hrozÃ­ chemickÃ¡ kontaminÃ¡cia, choÄte do vyÅ¡Å¡Ã­ch poschodÃ­ (vÃ¤ÄÅ¡ina chemikÃ¡liÃ­ je Å¥aÅ¾Å¡ia ako vzduch)." },
        { header: "Informovanie sa" },
        { text: "<strong>Zapnite RÃ¡dio Slovensko</strong> (96,6 FM Bratislava, 90,1 FM B. Bystrica, 89,5 FM KoÅ¡ice) alebo RÃ¡dio Regina â€“ dozviete sa Äo sa stalo a Äo robiÅ¥." },
        { text: "<strong>Ak nemÃ¡te elektriku</strong>, pouÅ¾ite rÃ¡dio na batÃ©rie alebo v aute." },
        { text: "<strong>Netelefonujte zbytoÄne</strong> â€“ nezaÅ¥aÅ¾ujte tiesÅˆovÃ© linky. Volajte len ak potrebujete zÃ¡chranu alebo mÃ¡te informÃ¡cie pre zÃ¡chrannÃ© zloÅ¾ky." },
        { warn: "VarovnÃ½ signÃ¡l sa ihneÄ po skonÄenÃ­ dopÄºÅˆa <strong>hovorenou informÃ¡ciou</strong> v rozhlase a TV â€“ obsahuje miesto, Äas, druh ohrozenia, veÄ¾kosÅ¥ ohrozenÃ©ho Ãºzemia a pokyny. PoÄkajte na Åˆu!" },
        { header: "ÄŒomu sa vyhnÃºÅ¥" },
        { text: "<strong>NeotvÃ¡rajte oknÃ¡ â€pozrieÅ¥ sa Äo sa dejeâ€</strong> â€“ prÃ¡ve to je najnebezpeÄnejÅ¡ie pri chemickom Ãºniku." },
        { text: "<strong>NevychÃ¡dzajte von</strong> kÃ½m nedostanete pokyn od zÃ¡chrannÃ½ch zloÅ¾iek. Budova je vÃ¡Å¡ najlepÅ¡Ã­ Ãºkryt." },
        { text: "<strong>Nevyzdvihujte deti zo Å¡kÃ´l</strong> â€“ Å¡koly majÃº vlastnÃ© ochrannÃ© postupy a vaÅ¡e cestovanie vÃ¡s mÃ´Å¾e ohroziÅ¥." }
      ],
      note: "PoÄas vojnovÃ©ho stavu alebo vojny sa rovnakÃ½m kolÃ­savÃ½m tÃ³nom (2 min) vyhlasuje aj <strong>VZDUÅ NÃ POPLACH</strong>. SlovnÃ¡ informÃ¡cia potom obsahuje vymedzenie ohrozenÃ©ho Ãºzemia a vÃ½raz â€vzduÅ¡nÃ½ poplachâ€.",
      sources: [
        { label: "ZÃ¡kon Ä. 42/1994 Z.z. o civilnej ochrane obyvateÄ¾stva, Â§ 18", url: "https://www.slov-lex.sk/pravne-predpisy/SK/ZZ/1994/42/" },
        { label: "SK MINV â€“ VarovnÃ© signÃ¡ly civilnej ochrany", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "CivilnÃ¡ ochrana KoÅ¡ice â€“ ÄŒo robiÅ¥ keÄ zaznie sirÃ©na", url: "https://www.cokosice.sk/-co-robit-ked-zaznie-sirena" }
      ]
    },
    {
      id: "water",
      title: "Ohrozenie vodou",
      duration: "6 minÃºt",
      type: "stÃ¡ly tÃ³n",
      color: "#1e40af",
      bg: "#eff6ff",
      border: "#bfdbfe",
      wave: "steady",
      meaning: "Signalizuje ohrozenie niÄivÃ½mi ÃºÄinkami vody â€“ hroziace povodne, pretrhnutie priehrady, nÃ¡hla prÃ­valovÃ¡ vlna. Je najdlhÅ¡Ã­ signÃ¡l (6 minÃºt), aby bol jednoznaÄne odlÃ­Å¡iteÄ¾nÃ½.",
      howToRecognize: "NepreruÅ¡ovanÃ½ stÃ¡ly tÃ³n sirÃ©ny trvajÃºci celÃ½ch 6 minÃºt. Je to najdlhÅ¡Ã­ varovnÃ½ signÃ¡l v systÃ©me â€“ jeho dÄºÅ¾ka sama o sebe signalizuje vodnÃº hrozbu.",
      actions: [
        { header: "OkamÅ¾itÃ© kroky" },
        { text: "<strong>OkamÅ¾ite sa presuÅˆte na vyvÃ½Å¡enÃ© miesto</strong> â€“ vyÅ¡Å¡ie poschodie, kopec, vyvÃ½Å¡enÃ½ terÃ©n. KaÅ¾dÃ¡ minÃºta sa poÄÃ­ta." },
        { warn: "<strong>NEUKRÃVAJTE SA v pivnici ani suterÃ©ne!</strong> Pri ohrozenÃ­ vodou je Ãºkryt v nÃ­zko poloÅ¾enÃ½ch priestoroch smrteÄ¾ne nebezpeÄnÃ½." },
        { text: "<strong>Nevstupujte do zatopenÃ©ho priestoru</strong> â€“ staÄÃ­ 15 cm teÄÃºcej vody na zhodenie dospelÃ©ho Äloveka, 30 cm odplÃ¡vi auto." },
        { text: "<strong>Ak ste v aute</strong> a voda stÃºpa â€“ ihneÄ vystÃºpte a presuÅˆte sa peÅ¡i na vyÅ¡Å¡ie miesto. Auto nie je bezpeÄnÃ©." },
        { header: "PrÃ­prava na evakuÃ¡ciu" },
        { text: "<strong>Vezmite si evakuaÄnÃ½ batoh, doklady, lieky.</strong> Doklady uloÅ¾te do vodotesnÃ©ho obalu (igelitovÃ½ vrecko)." },
        { text: "<strong>Vypnite hlavnÃ½ istiÄ, plyn a vodu</strong> ak mÃ¡te Äas â€“ predÃ­dete elektrickÃ©mu Å¡oku a Ãºniku plynu." },
        { text: "<strong>Varujte susedov</strong>, najmÃ¤ starÅ¡Ã­ch, imobilnÃ½ch a Ä¾udÃ­ s malÃ½mi deÅ¥mi." },
        { header: "ÄŒo robiÅ¥ Äalej" },
        { text: "<strong>Sledujte rozhlasovÃ© vysielanie</strong> â€“ dozviete sa smer a rÃ½chlosÅ¥ postupu vody, evakuaÄnÃ© trasy." },
        { text: "<strong>RiaÄte sa pokynmi zÃ¡chrannÃ½ch zloÅ¾iek</strong> a miestnych Ãºradov. NepodceÅˆujte situÃ¡ciu." },
        { text: "<strong>Nepite vodu z vodovodu</strong> â€“ vodovod mÃ´Å¾e byÅ¥ kontaminovanÃ½ zÃ¡plavovou vodou." }
      ],
      note: null,
      sources: [
        { label: "ZÃ¡kon Ä. 42/1994 Z.z. o civilnej ochrane obyvateÄ¾stva, Â§ 18", url: "https://www.slov-lex.sk/pravne-predpisy/SK/ZZ/1994/42/" },
        { label: "SK MINV â€“ VarovnÃ© signÃ¡ly: Ohrozenie vodou", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    {
      id: "end",
      title: "Koniec ohrozenia",
      duration: "2 minÃºty",
      type: "stÃ¡ly tÃ³n (bez opakovania)",
      color: "#2a7a4b",
      bg: "#eaf4ee",
      border: "#86efac",
      wave: "steady",
      meaning: "Signalizuje koniec ohrozenia alebo koniec pÃ´sobenia nÃ¡sledkov mimoriadnej udalosti. Vysiela sa jednorazovo, bez opakovania.",
      howToRecognize: "NepreruÅ¡ovanÃ½ stÃ¡ly tÃ³n trvajÃºci 2 minÃºty, ktorÃ½ zaznie <strong>iba raz</strong> (bez opakovania). OdlÃ­Å¡enie od skÃºÅ¡ky: pred skÃºÅ¡kou sÃº Ä¾udia vopred informovanÃ­ mÃ©diami.",
      actions: [
        { header: "Po zaznenÃ­ signÃ¡lu" },
        { text: "<strong>PoÄkajte na hovorenÃº informÃ¡ciu</strong> v rozhlase, televÃ­zii alebo miestnom rozhlase â€“ potvrdÃ­ koniec ohrozenia a dÃ¡ ÄalÅ¡ie pokyny." },
        { text: "<strong>Vyvetrajte miestnosÅ¥</strong> â€“ otvorte oknÃ¡, pustite ventilÃ¡ciu a obnovte cirkulÃ¡ciu vzduchu." },
        { text: "<strong>RiaÄte sa pokynmi zÃ¡chrannÃ½ch zloÅ¾iek</strong> â€“ niektorÃ© oblasti mÃ´Å¾u byÅ¥ stÃ¡le nebezpeÄnÃ©." },
        { header: "OpatrnosÅ¥ po odvolanÃ­" },
        { text: "<strong>Nevracajte sa do ohrozenej oblasti</strong> kÃ½m to nebude vÃ½slovne povolenÃ©. MÃ´Å¾u pretrvÃ¡vaÅ¥ skrytÃ© nebezpeÄenstvÃ¡ (kontaminÃ¡cia, nestabilnÃ© konÅ¡trukcie)." },
        { text: "<strong>Skontrolujte stav bytu/domu</strong> â€“ rozvody plynu, elektriny, vody. Pri pochybnostiach volajte poruchovÃ© linky." },
        { text: "<strong>Skontrolujte blÃ­zkych a susedov</strong> â€“ overte Äi sÃº v poriadku, najmÃ¤ starÅ¡Ã­ a zraniteÄ¾nÃ­ Ä¾udia." }
      ],
      note: "SignÃ¡l â€Koniec ohrozeniaâ€ sa vÅ¾dy dopÄºÅˆa hovorenou informÃ¡ciou â€“ sledujte mÃ©diÃ¡ aj po jeho odznenÃ­.",
      sources: [
        { label: "ZÃ¡kon Ä. 42/1994 Z.z. o civilnej ochrane obyvateÄ¾stva, Â§ 18", url: "https://www.slov-lex.sk/pravne-predpisy/SK/ZZ/1994/42/" }
      ]
    },
    {
      id: "test",
      title: "SkÃºÅ¡ka sirÃ©n",
      duration: "2 minÃºty",
      type: "stÃ¡ly tÃ³n",
      color: "#6b6560",
      bg: "#f5f3ee",
      border: "#e2ddd5",
      wave: "steady",
      meaning: "PravidelnÃ© preskÃºÅ¡anie funkÄnosti varovnÃ©ho systÃ©mu. NejednÃ¡ sa o skutoÄnÃ© ohrozenie â€“ Å¾iadna akcia nie je potrebnÃ¡.",
      howToRecognize: "StÃ¡ly nepreruÅ¡ovanÃ½ tÃ³n, 2 minÃºty. KonÃ¡ sa <strong>pravidelne kaÅ¾dÃ½ druhÃ½ piatok v mesiaci o 12:00</strong>. O skÃºÅ¡ke vopred informujÃº mÃ©diÃ¡ a miestny rozhlas.",
      actions: [
        { header: "Å½iadna akcia nie je potrebnÃ¡" },
        { text: "<strong>SkÃºÅ¡ky sÃº vopred oznÃ¡menÃ©</strong> v mÃ©diÃ¡ch. Ak ste si istÃ­, Å¾e je piatok a napoludnie â€“ ide o pravidelnÃº skÃºÅ¡ku." },
        { text: "<strong>Ak poÄujete sirÃ©nu mimo pravidelnÃ©ho termÃ­nu</strong> a neboli ste o skÃºÅ¡ke informovanÃ­ â€“ berichte to vÃ¡Å¾ne a postupujte podÄ¾a typu signÃ¡lu." },
        { note: "SkÃºÅ¡ky sirÃ©n sa na Slovensku vykonÃ¡vajÃº od roku 1996 na zÃ¡klade ZÃ¡kona Ä. 42/1994 Z.z. o civilnej ochrane obyvateÄ¾stva. Okrem pravidelnÃ½ch mesaÄnÃ½ch skÃºÅ¡ok sa mÃ´Å¾u uskutoÄniÅ¥ aj mimoriadne skÃºÅ¡ky â€“ o tÃ½ch sa dozvÃ­te z mÃ©diÃ­ vopred." }
      ],
      note: null,
      sources: [
        { label: "ZÃ¡kon Ä. 42/1994 Z.z. o civilnej ochrane obyvateÄ¾stva", url: "https://www.slov-lex.sk/pravne-predpisy/SK/ZZ/1994/42/" }
      ]
    }
  ];

  function renderSirens() {
    const grid = document.getElementById("sirensGrid");
    if (!grid) return;
    grid.innerHTML = "";
    SIRENS_DATA.forEach(siren => {
      const card = document.createElement("div");
      card.className = "siren-card";
      // Generuj wave bars
      const barCount = 20;
      let bars = "";
      for (let i = 0; i < barCount; i++) {
        const delay = siren.wave === "oscillating"
          ? (Math.sin(i * 0.6) * 0.4 + 0.3).toFixed(2)
          : (0.1 * (i % 3)).toFixed(2);
        const height = siren.wave === "oscillating"
          ? Math.round(40 + Math.sin(i * 0.8) * 35)
          : Math.round(70 + Math.sin(i * 0.2) * 10);
        bars += `<div class="siren-wave-bar" style="left:${(i / barCount) * 100}%; height:${height}%; background:${siren.color}; opacity:0.6; animation-delay:${delay}s;"></div>`;
      }
      card.innerHTML = `
        <div style="display:flex; align-items:center; justify-content:space-between; gap:0.5rem;">
          <div>
            <div style="font-weight:700; font-size:0.9rem; color:${siren.color};">${siren.title}</div>
            <div style="font-size:0.72rem; color:var(--c-muted); margin-top:0.125rem;">${siren.duration} â€“ ${siren.type}</div>
          </div>
          <div style="background:${siren.bg}; border:1px solid ${siren.border}; border-radius:0.5rem; padding:0.25rem 0.5rem; font-size:0.68rem; font-weight:700; color:${siren.color}; white-space:nowrap;">${siren.duration}</div>
        </div>
        <div class="siren-wave ${siren.wave === 'steady' ? 'siren-wave-steady' : ''}" style="background:${siren.bg}; border:1px solid ${siren.border};">${bars}</div>`;
      card.onclick = () => openSirenModal(siren);
      card.setAttribute("tabindex", "0");
      card.setAttribute("role", "button");
      card.setAttribute("aria-label", siren.title + " â€“ " + siren.duration);
      card.onkeydown = (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openSirenModal(siren);
        }
      };
      grid.appendChild(card);
    });
  }

  function openSirenModal(siren) {
    document.getElementById("sirenModalTitle").textContent = "\ud83d\udd14 " + siren.title;
    let html = `
      <div style="background:${siren.bg}; border:1.5px solid ${siren.border}; border-radius:1rem; padding:1rem; margin-bottom:1rem;">
        <div style="display:flex; align-items:center; gap:0.75rem; margin-bottom:0.5rem;">
          <div style="font-size:1.75rem; font-weight:800; color:${siren.color};">${siren.duration}</div>
          <div>
            <div style="font-weight:700; color:${siren.color}; font-size:0.9rem;">${siren.type.charAt(0).toUpperCase() + siren.type.slice(1)}</div>
            <div style="font-size:0.75rem; color:var(--c-muted);">trvanie sign\u00e1lu</div>
          </div>
        </div>
      </div>

      <div style="margin-bottom:1rem;">
        <div style="font-weight:700; font-size:0.85rem; margin-bottom:0.375rem;">\ud83d\udcd6 V\u00fdznam</div>
        <div style="font-size:0.85rem; color:var(--c-text); line-height:1.6;">${siren.meaning}</div>
      </div>`;

    if (siren.howToRecognize) {
      html += `<div style="margin-bottom:1rem;">
        <div style="font-weight:700; font-size:0.85rem; margin-bottom:0.375rem;">\ud83d\udd0a Ako rozozna\u0165</div>
        <div style="font-size:0.85rem; color:var(--c-text); line-height:1.6;">${siren.howToRecognize}</div>
      </div>`;
    }

    // Render structured actions (array) or legacy string
    if (Array.isArray(siren.actions)) {
      html += `<div style="margin-bottom:1rem;">
        <div style="font-weight:700; font-size:0.85rem; margin-bottom:0.5rem;">\u2705 \u010co robi\u0165</div>`;
      let stepNum = 0;
      siren.actions.forEach(item => {
        if (item.header) {
          html += `<div style="font-weight:700; font-size:0.8rem; color:${siren.color}; margin:0.75rem 0 0.375rem; padding-top:0.375rem; border-top:1px solid ${siren.border};">${item.header}</div>`;
        } else if (item.warn) {
          html += `<div class="fa-warning"><strong>\u26a0\ufe0f</strong> ${item.warn}</div>`;
        } else if (item.note) {
          html += `<div class="fa-info"><strong>\u2139\ufe0f</strong> ${item.note}</div>`;
        } else if (item.text) {
          stepNum++;
          html += `<div style="display:flex; gap:0.5rem; margin-bottom:0.5rem; font-size:0.85rem; line-height:1.6;">
            <span style="font-weight:700; color:${siren.color}; flex-shrink:0; min-width:1.25rem;">${stepNum}.</span>
            <span style="color:var(--c-text);">${item.text}</span>
          </div>`;
        }
      });
      html += `</div>`;
    } else if (siren.action) {
      html += `<div style="margin-bottom:1rem;">
        <div style="font-weight:700; font-size:0.85rem; margin-bottom:0.375rem;">\u2705 \u010co robi\u0165</div>
        <div style="font-size:0.85rem; color:var(--c-text); line-height:1.6;">${siren.action}</div>
      </div>`;
    }

    if (siren.note) {
      html += `<div class="fa-info"><strong>\u2139\ufe0f Pozn\u00e1mka:</strong> ${siren.note}</div>`;
    }

    // Render sources array or fallback
    if (siren.sources && siren.sources.length > 0) {
      html += `<div style="margin-top:1rem; padding-top:0.75rem; border-top:1px solid var(--c-border);">
        <div style="font-size:0.72rem; font-weight:700; color:var(--c-muted); margin-bottom:0.375rem;">ZDROJE</div>`;
      siren.sources.forEach(src => {
        html += `<div style="margin-bottom:0.25rem;"><a href="${src.url}" target="_blank" rel="noopener" style="color:#2563eb; font-size:0.75rem; text-decoration:underline;">${src.label}</a></div>`;
      });
      html += `</div>`;
    }

    document.getElementById("sirenModalContent").innerHTML = html;
    openModal("modalSiren");
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // NÃšDZOVÃ‰ VYSIELANIE RÃDIA
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const RADIO_DATA = [
    {
      name: "RÃ¡dio Slovensko",
      desc: "HlavnÃ½ kanÃ¡l STVR pre nÃºdzovÃ© hlÃ¡senia a pokyny zÃ¡chrannÃ½ch zloÅ¾iek. Pri mimoriadnej udalosti preruÅ¡uje beÅ¾nÃ½ program a vysiela krÃ­zovÃ© informÃ¡cie pre celÃ© Slovensko.",
      emoji: "ğŸ“¡",
      bg: "#fef2f2",
      border: "#fecaca",
      priority: true,
      frequencies: [
        { region: "Bratislava", fm: "96,6 MHz", note: "KamzÃ­k, 50 kW" },
        { region: "BanskÃ¡ Bystrica", fm: "90,1 MHz", note: "SuchÃ¡ hora, 100 kW" },
        { region: "KoÅ¡ice", fm: "89,5 MHz", note: "Humenec, 50 kW" },
        { region: "Å½ilina", fm: "104,8 MHz", note: "" },
        { region: "Nitra", fm: "91,2 MHz", note: "Zobor, 10 kW" },
        { region: "PreÅ¡ov", fm: "100,3 MHz", note: "" },
        { region: "TrenÄÃ­n", fm: "92,7 MHz", note: "" },
        { region: "Trnava", fm: "101,1 MHz", note: "" },
        { region: "Poprad", fm: "92,2 MHz", note: "KrÃ¡Ä¾ova hoÄ¾a, 30 kW" },
        { region: "StarÃ¡ Ä½ubovÅˆa", fm: "89,1 MHz", note: "" },
      ]
    },
    {
      name: "RÃ¡dio Regina",
      desc: "RegionÃ¡lne vysielanie STVR s lokÃ¡lnymi nÃºdzovÃ½mi informÃ¡ciami, varovaniami a pokynmi. Tri samostatnÃ© okruhy pokrÃ½vajÃº celÃ© Slovensko s regionÃ¡lne relevantnÃ½mi informÃ¡ciami.",
      emoji: "ğŸ”ï¸",
      bg: "#eff6ff",
      border: "#bfdbfe",
      priority: true,
      frequencies: [
        { region: "Regina ZÃ¡pad (BA, TT, TN, NR)", fm: "99,3 MHz", note: "KamzÃ­k, BA" },
        { region: "Regina Stred (BB, ZA)", fm: "101,5 MHz", note: "SuchÃ¡ hora, BB" },
        { region: "Regina VÃ½chod (KE, PO)", fm: "100,3 MHz", note: "Humenec, KE" },
      ]
    },
    {
      name: "RÃ¡dio Patria",
      desc: "Vysielanie STVR v maÄarskom jazyku. NÃºdzovÃ© hlÃ¡senia pre obyvateÄ¾ov juÅ¾nÃ©ho Slovenska, ktorÃ­ preferujÃº maÄarskÃ½ jazyk.",
      emoji: "ğŸŒ",
      bg: "#eaf4ee",
      border: "#86efac",
      priority: false,
      frequencies: [
        { region: "Bratislava", fm: "98,9 MHz", note: "" },
        { region: "KomÃ¡rno", fm: "96,2 MHz", note: "" },
        { region: "RimavskÃ¡ Sobota", fm: "105,5 MHz", note: "" },
        { region: "KoÅ¡ice", fm: "91,1 MHz", note: "" },
      ]
    },
    {
      name: "RÃ¡dio DevÃ­n",
      desc: "KultÃºrny okruh STVR â€“ v prÃ­pade krÃ­zy sa zapÃ¡ja do nÃºdzovÃ©ho vysielania ako zÃ¡loha hlavnÃ©ho okruhu RÃ¡dio Slovensko.",
      emoji: "ğŸµ",
      bg: "#f5f3ee",
      border: "#e2ddd5",
      priority: false,
      frequencies: [
        { region: "Bratislava", fm: "101,4 MHz", note: "" },
        { region: "BanskÃ¡ Bystrica", fm: "88,8 MHz", note: "" },
        { region: "KoÅ¡ice", fm: "96,4 MHz", note: "" },
      ]
    }
  ];

  function renderRadio() {
    const grid = document.getElementById("radioGrid");
    if (!grid) return;
    grid.innerHTML = "";
    RADIO_DATA.forEach(radio => {
      const card = document.createElement("div");
      card.style.cssText = `background:${radio.bg}; border:1.5px solid ${radio.border}; border-radius:1rem; padding:1rem;`;
      let freqHtml = radio.frequencies.map(f =>
        `<div style="display:flex; justify-content:space-between; align-items:center; padding:0.3rem 0; border-bottom:1px solid ${radio.border};">
          <span style="font-size:0.78rem; color:var(--c-muted);">${f.region}</span>
          <div style="display:flex; align-items:center; gap:0.375rem;">
            <span style="font-size:0.82rem; font-weight:700; color:var(--c-text); font-family:'Lexend',sans-serif;">${f.fm}</span>
          </div>
        </div>`
      ).join("");
      const priorityBadge = radio.priority
        ? `<span style="display:inline-block; background:#dc2626; color:#fff; font-size:0.6rem; font-weight:700; padding:0.1rem 0.375rem; border-radius:0.25rem; vertical-align:middle; margin-left:0.375rem;">PRIORITA</span>`
        : "";
      card.innerHTML = `
        <div style="display:flex; align-items:center; gap:0.625rem; margin-bottom:0.625rem;">
          <span style="font-size:1.25rem;">${radio.emoji}</span>
          <div>
            <div style="font-weight:700; font-size:0.875rem;">${radio.name}${priorityBadge}</div>
            <div style="font-size:0.7rem; color:var(--c-muted); line-height:1.4; margin-top:0.1rem;">${radio.desc}</div>
          </div>
        </div>
        <div>${freqHtml}</div>`;
      grid.appendChild(card);
    });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // POSTUPY PRI MIMORIADNYCH UDALOSTIACH
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const EMERGENCY_PROC_DATA = [
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PRÃRODNÃ‰ HROZBY
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      id: "flood",
      emoji: "ğŸŒŠ",
      title: "Povodne",
      subtitle: "SilnÃ© daÅ¾de, zÃ¡plavy a stÃºpanie hladÃ­n",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { header: "Pred povodÅˆou (keÄ hrozÃ­)" },
        { text: "<strong>Sledujte vÃ½strahy SHMÃš</strong> (shmu.sk) a sprÃ¡vy z oficiÃ¡lnych kanÃ¡lov. StupeÅˆ povodÅˆovej aktivity naznaÄuje zÃ¡vaÅ¾nosÅ¥." },
        { text: "<strong>Pripravte si evakuaÄnÃ½ batoh</strong> \u2013 doklady v nepremokavom obale, lieky, voda, potraviny, nabÃ­jaÄka, baterka." },
        { text: "<strong>PresuÅˆte cennosti do vyÅ¡Å¡Ã­ch poschodÃ­</strong> \u2013 doklady, elektroniku, lieky, dÃ´leÅ¾itÃ© dokumenty." },
        { text: "<strong>Pripravte si nÃ¡doby na pitnÃº vodu</strong> \u2013 kanistre alebo uzatvÃ¡rateÄ¾nÃ© nÃ¡doby na odber vody z cisterien, ak bude preruÅ¡enÃ½ vodovod." },
        { text: "<strong>OdstrÃ¡Åˆte nebezpeÄnÃ© lÃ¡tky</strong> \u2013 jedy, kyseliny a Å¾ieraviny z miest, kam mÃ´Å¾e dosiahnuÅ¥ voda." },
        { header: "PoÄas povodne" },
        { text: "<strong>Vypnite elektrinu (hlavnÃ½ istiÄ), plyn a vodu.</strong> PredÃ­dete Ãºrazom elektrickÃ½m prÃºdom a Ãºniku plynu." },
        { text: "<strong>Zatvorte vÅ¡etky oknÃ¡ a dvere.</strong> Utesnite prÃ­vod vody do pivnice ak je to moÅ¾nÃ©." },
        { text: "<strong>PresuÅˆte sa na vyvÃ½Å¡enÃ© miesto</strong> \u2013 vyÅ¡Å¡ie poschodie, podkrovie. V prÃ­pade Äasovej tiesne okamÅ¾ite preruÅ¡te vÅ¡etky aktivity." },
        { text: "<strong>Nejazdite cez zaplavenÃ© cesty</strong> \u2013 staÄÃ­ 30 cm vody na odplavenie auta. Ak voda stÃºpa v aute, ihneÄ vystÃºpte a presÃºvajte sa peÅ¡i na vyvÃ½Å¡enÃ© miesto." },
        { warn: "<strong>ZÃ¡plavovÃ¡ voda je kontaminovanÃ¡</strong> \u2013 kanalizÃ¡cia, chemikÃ¡lie, baktÃ©rie. Vyhnite sa kontaktu, nepite ju." },
        { header: "Po povodni" },
        { text: "<strong>Nevstupujte do zaplavenÃ½ch budov</strong> kÃ½m nie sÃº skontrolovanÃ© \u2013 hrozÃ­ zrÃºtenie, kontaminÃ¡cia, Ãºraz elektrickÃ½m prÃºdom." },
        { text: "<strong>Nepite vodu z kohÃºtika</strong> kÃ½m Ãºrady nepotvrdia jej bezpeÄnosÅ¥. PouÅ¾Ã­vajte len balenÃº vodu." },
        { text: "<strong>VyfoÅ¥te Å¡kody</strong> pre poisÅ¥ovÅˆu eÅ¡te pred upratovanÃ­m. Dokumentujte stav." },
        { text: "<strong>VyveÅ¥rajte a vysuÅ¡te priestory</strong> \u2013 plesne sa tvoria do 24\u201348 hodÃ­n." }
      ],
      warning: "Pri 3. stupni povodÅˆovej aktivity buÄte pripravenÃ­ na okamÅ¾itÃº evakuÃ¡ciu. Uistite sa, Å¾e vaÅ¡i blÃ­zki a susedia (hlavne starÅ¡Ã­) majÃº vÅ¡etky informÃ¡cie.",
      source: "CZ 72h + SK MINV",
      sources: [
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025) \u2013 Voda a zÃ¡plavy", url: "https://www.72h.gov.cz" },
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: Povodne", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    {
      id: "earthquake",
      emoji: "ğŸ«¨",
      title: "Zemetrasenie",
      subtitle: "SeizmickÃ¡ aktivita a otrasy",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { header: "PoÄas otrasov" },
        { text: "<strong>DROP \u2013 COVER \u2013 HOLD ON</strong> (Padnite \u2013 Ukryte sa \u2013 DrÅ¾te sa): Padnite na kolenÃ¡, ukryte sa pod pevnÃ½ stÃ´l alebo nÃ¡bytok, drÅ¾te sa nohy stola a chrÃ¡Åˆte hlavu a krk." },
        { text: "<strong>Ak nie je nÃ¡bytok poruke</strong> \u2013 kÄ¾aknite si k vnÃºtornej nosnej stene, skrÄte sa a chrÃ¡Åˆte hlavu rukami. Nikdy nie k oknu." },
        { text: "<strong>V budove zostaÅˆte vo vnÃºtri, mimo budovu zostaÅˆte vonku</strong> \u2013 najviac Ãºrazov sa stÃ¡va pri panickÃ½ch presunoch poÄas otrasov." },
        { text: "<strong>Nevstupujte do vÃ½Å¥ahu</strong> \u2013 pri otrasoch sa mÃ´Å¾e zaseknÃºÅ¥." },
        { text: "<strong>Vonku sa zdrÅ¾iavajte Äalej</strong> od budov, elektrickÃ©ho vedenia, stromov a billboardov." },
        { text: "<strong>V aute zastavte</strong> na otvorenom priestranstve, zapnite vÃ½straÅ¾nÃ© svetlÃ¡ a nevystupujte poÄas otrasov. Vyhnite sa mostom a nadjazdom." },
        { header: "Po otrasoch" },
        { text: "<strong>OÄakÃ¡vajte dotrasovanie</strong> (aftershocks) \u2013 mÃ´Å¾u byÅ¥ takmer rovnako silnÃ© a prichÃ¡dzajÃº minÃºty aÅ¾ dni po hlavnom otrase." },
        { text: "<strong>Skontrolujte rozvody plynu</strong> \u2013 ak cÃ­tite plyn, otvorte oknÃ¡, opustite budovu a zavolajte hasieb (150). NepouÅ¾Ã­vajte otvorenÃ½ oheÅˆ ani elektrickÃ© spÃ­naÄe." },
        { text: "<strong>Skontrolujte blÃ­zkych a susedov.</strong> PomÃ´Å¾te zranenÃ½m ak tÃ½m neohrozÃ­te seba." },
        { text: "<strong>Opatrne opustite poÅ¡kodenÃº budovu</strong> \u2013 pozor na uvoÄ¾nenÃ© konÅ¡trukcie, rozbitÃ© sklo a spadnutÃ© vedenie." },
        { text: "<strong>Nepite vodu z vodovodu</strong> kÃ½m nie je overenÃ¡ \u2013 potrubie mÃ´Å¾e byÅ¥ poÅ¡kodenÃ©." }
      ],
      warning: "Na Slovensku sÃº najrizikovejÅ¡ie oblasti KomÃ¡rno, DobrÃ¡ Voda, Å½ilina. Aj malÃ© otrasy mÃ´Å¾u poÅ¡kodiÅ¥ statiku budovy \u2013 po zemetrasenÃ­ nechajte budovu skontrolovaÅ¥ odbornÃ­kom.",
      source: "SK MINV",
      sources: [
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: Zemetrasenie", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    {
      id: "storm",
      emoji: "ğŸŒªï¸",
      title: "VÃ­chrica / bÃºrka",
      subtitle: "SilnÃ½ vietor, bÃºrky, krupobitie a tornÃ¡do",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { header: "Pred bÃºrkou" },
        { text: "<strong>Sledujte vÃ½strahy SHMÃš</strong> \u2013 varovanie 2. a 3. stupÅˆa znamenÃ¡ vÃ¡Å¾ne nebezpeÄenstvo." },
        { text: "<strong>ZabezpeÄte voÄ¾nÃ© predmety</strong> na dvoroch a balkÃ³noch \u2013 zÃ¡hradnÃ½ nÃ¡bytok, kvetinÃ¡Äe, odpadkovÃ© koÅ¡e sa mÃ´Å¾u staÅ¥ smrteÄ¾nÃ½mi projektilmi." },
        { text: "<strong>Zatvorte a zabezpeÄte vÅ¡etky oknÃ¡ a dvere.</strong> Stiahnite rolety alebo Å¾alÃºzie." },
        { text: "<strong>Neparkujte pod stromami</strong> a pri chatrnÃ½ch budovÃ¡ch alebo billboardoch." },
        { header: "PoÄas bÃºrky" },
        { text: "<strong>ZostaÅˆte vnÃºtri.</strong> NezdrÅ¾iavajte sa pri oknÃ¡ch." },
        { text: "<strong>Vonku vyhÄ¾adajte pevnÃº budovu</strong> \u2013 vyhnite sa voÄ¾nÃ½m plochÃ¡m, horÃ¡m, parkom, izolovanÃ½m stromom." },
        { text: "<strong>Pri blesku</strong> \u2013 ak ste vonku, skrÄte sa Äo najniÅ¾Å¡ie (nie na zem naplocho). Vyhnite sa kovovÃ½m konÅ¡trukciÃ¡m, vode a vyvÃ½Å¡enÃ½m miestam." },
        { text: "<strong>V aute zostaÅˆte v aute</strong> \u2013 je relatÃ­vne bezpeÄnÃ½m Ãºkrytom (Faradayova klietka). Zastavte mimo stromy a vedenie." },
        { warn: "<strong>Pri tornÃ¡de:</strong> IhneÄ do pivnice alebo vnÃºtornej miestnosti bez okien v najniÅ¾Å¡om podlaÅ¾Ã­. Ä½ahnite si na zem a zakryte hlavu." },
        { header: "Po bÃºrke" },
        { text: "<strong>Pozor na spadnutÃ© vedenie</strong> \u2013 nepribliÅ¾ujte sa. Zavolajte 112." },
        { text: "<strong>Nejazdite cez zaplavenÃ© Ãºseky ciest.</strong>" },
        { text: "<strong>Skontrolujte strechu a oknÃ¡</strong> \u2013 dokumentujte Å¡kody pre poisÅ¥ovÅˆu." }
      ],
      warning: "ZabezpeÄte domÃ¡ce zvieratÃ¡. Nejazdite s Ä¾ahkÃ½mi vozidlami po otvorenÃ½ch veternÃ½ch plochÃ¡ch. Å vÃ©dsko MSB odporÃºÄa: majte doma rÃ¡dio na batÃ©rie \u2013 pri vÃ½padku prÃºdu je to Äasto jedinÃ½ zdroj informÃ¡ciÃ­.",
      source: "SK MINV + SE MSB",
      sources: [
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: VÃ­chrica", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "Å vÃ©dsko MSB \u2013 Om krisen eller kriget kommer (2024)", url: "https://www.msb.se/en/rad-till-privatpersoner/the-brochure-if-crisis-or-war-comes/" }
      ]
    },
    {
      id: "landslide",
      emoji: "â›°ï¸",
      title: "Zosuv pÃ´dy",
      subtitle: "Zosuvy pÃ´dy, bahno a skalnÃ© zrÃºtenia",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>Sledujte varovnÃ© znaky</strong> \u2013 neobvyklÃ© zvuky (praskanie stromov, skÃ¡l), nÃ¡hle zmeny hladiny tokov, praskliny v zemi alebo na stenÃ¡ch, naklonenÃ© stromy alebo stÄºpy." },
        { text: "<strong>Pri prÃ­valovom daÅ¾di</strong> v horskom alebo kopcovitom terÃ©ne buÄte v strehu \u2013 najvÃ¤ÄÅ¡ie riziko zosuvu je keÄ je zem nasiaknutÃ¡ po dlhotrvajÃºcich daÅ¾Äoch." },
        { text: "<strong>Ak poÄujete huÄanie alebo vidÃ­te pohyb zeme \u2013 okamÅ¾ite utekajte</strong> kolmo na smer zosuvu, na najbliÅ¾Å¡ie vyvÃ½Å¡enÃ© miesto." },
        { text: "<strong>V budove sa presuÅˆte</strong> na vyÅ¡Å¡ie poschodie, Äo najÄalej od strany budovy smerujÃºcej k svahu." },
        { text: "<strong>Ak nemÃ´Å¾ete uniknÃºÅ¥</strong> \u2013 skrÄte sa za skupinu vÃ¤ÄÅ¡Ã­ch stromov alebo v najodolnejÅ¡ej Äasti budovy, chrÃ¡Åˆte si hlavu." },
        { text: "<strong>Po zosuve</strong> \u2013 nepribliÅ¾ujte sa k okraju. HÄ¾adajte zranenÃ½ch, ale nevstupujte do nestabilnÃ©ho terÃ©nu. Zavolajte 112." }
      ],
      warning: "Zosuv sa pohybuje rÃ½chlosÅ¥ou aÅ¾ 50 km/h \u2013 reagujte okamÅ¾ite, neÄakajte. Nikdy sa nevracajte po cestu zosuvu.",
      source: "SK MINV",
      sources: [
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: Zosuvy pÃ´dy", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    {
      id: "heat",
      emoji: "ğŸŒ¡ï¸",
      title: "ExtrÃ©mne horÃºÄavy",
      subtitle: "Vlny horÃºÄav a tepelnÃ© ohrozenie",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { header: "Prevencia" },
        { text: "<strong>Pite dostatoÄne</strong> \u2013 min. 2\u20133 litre vody denne, aj keÄ nemÃ¡te smÃ¤d. VyhÃ½bajte sa alkoholu a kofeÃ­nu." },
        { text: "<strong>ZdrÅ¾iavajte sa v tieni a klimatizovanÃ½ch priestoroch</strong> \u2013 hlavne medzi 11:00\u201316:00." },
        { text: "<strong>ObleÄenie:</strong> Ä¾ahkÃ©, vzduÅ¡nÃ©, svetlÃ½ch farieb. PokrÃ½vka hlavy, slneÄnÃ© okuliare." },
        { text: "<strong>TieÅˆte oknÃ¡</strong> Å¾alÃºziami alebo roletami \u2013 cez deÅˆ neotvÃ¡rajte oknÃ¡ na slneÄnej strane, veÅ¥rajte v noci a rÃ¡no." },
        { text: "<strong>NenechÃ¡vajte NIKDY deti a zvieratÃ¡</strong> v zaparkovanom aute \u2013 teplota vnÃºtri stÃºpne za 10 minÃºt o 20Â°C." },
        { header: "Rozpoznajte tepelnÃ½ Ãºpal (stav ohrozenia Å¾ivota)" },
        { text: "<strong>PrÃ­znaky:</strong> teplota nad 40Â°C, horÃºca suchÃ¡ koÅ¾a (bez potenia!), zmÃ¤tenosÅ¥, strata vedomia, kÅ•Äe." },
        { text: "<strong>Volajte 155</strong> \u2013 ide o Å¾ivot ohrozujÃºci stav." },
        { text: "<strong>ChlaÄte postihnutÃ©ho</strong> \u2013 presuÅˆte do tieÅˆa/chladu, zabaÄ¾te do mokrÃ½ch handier, prikladajte Ä¾ad na krk, podpazuÅ¡ie a slabiny." },
        { warn: "TepelnÃ½ Ãºpal â‰  ÃºÅ¾eh. Pri Ãºpale telo PRESTANE regulovaÅ¥ teplotu. Bez pomoci je smrteÄ¾nÃ½." },
        { header: "RizikovÃ¡ skupina" },
        { text: "<strong>Seniori, malÃ© deti, chronicky chorÃ­ a Ä¾udia na liekoch</strong> (diuretikÃ¡, beta-blokÃ¡tory) sÃº najviac ohrozenÃ­ \u2013 kontrolujte ich stav." }
      ],
      warning: "ERC 2025 odporÃºÄa pri prehriatÃ­: aktÃ­vne chladenie (studenÃ¡ voda, Ä¾ad) Äo najrÃ½chlejÅ¡ie. Pri teplotÃ¡ch nad 35Â°C v tieni sledujte vÃ½strahy SHMÃš a obmedzte pobyt vonku na minimum.",
      source: "SK MINV + ERC 2025",
      sources: [
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: HorÃºÄavy", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "ERC Guidelines 2025 \u2013 Special Circumstances: Hyperthermia", url: "https://www.resuscitationjournal.com/article/S0300-9572(25)00265-5/fulltext" }
      ]
    },
    {
      id: "snow",
      emoji: "â„ï¸",
      title: "SnehovÃ¡ kalamita",
      subtitle: "ExtrÃ©mne sneÅ¾enie, Ä¾adovica a nÃ­zke teploty",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { header: "Doma" },
        { text: "<strong>Majte zÃ¡soby jedla, vody a liekov</strong> min. na 3 dni \u2013 obchody a lekÃ¡rne mÃ´Å¾u byÅ¥ nedostupnÃ©." },
        { text: "<strong>Pripravte si alternatÃ­vne vykurovanie</strong> \u2013 ak mÃ¡te krb alebo piecku, majte zÃ¡sobu dreva. Nikdy nekÃºrte grilom ani plynovÃ½m variÄom vnÃºtri (otrava CO!)." },
        { text: "<strong>Obliekajte sa do vrstiev</strong> \u2013 teplÃ© ponoÅ¾ky, Äiapka, Å¡Ã¡l, rukavice. SpodnÃ¡ vrstva termoprÃ¡dlo, strednÃ¡ fleece, vonkajÅ¡ia vetru-odolnÃ¡." },
        { text: "<strong>ChrÃ¡Åˆte vodovodnÃ© potrubie pred zamrznutÃ­m</strong> \u2013 nechajte vodu mierne kvapkaÅ¥, izolujte trÃºbky." },
        { header: "Vonku a v aute" },
        { text: "<strong>Obmedzte jazdu autom.</strong> Ak musÃ­te Ã­sÅ¥, vezmite si: teplÃº deku, sviecu v plechovke (ohreje interiÃ©r), lopatu, trakÄnÃ½ posyp, nabitÃ© telefÃ³ny, teplÃ© obleÄenie." },
        { text: "<strong>Ak uviazne auto v snehu \u2013 zostaÅˆte v aute.</strong> ZapÃ­najte kÃºrenie len na krÃ¡tke intervaly a pootvorte okno (prevencia otravy CO z vÃ½fuku zasypanÃ©ho snehom)." },
        { text: "<strong>NezdrÅ¾iavajte sa dlho na mraze</strong> \u2013 omrzliny vznikajÃº rÃ½chlejÅ¡ie neÅ¾ si myslÃ­te, hlavne na uÅ¡iach, nose, prstoch." },
        { warn: "<strong>Rozpoznajte omrzliny:</strong> biela/voskovÃ¡ koÅ¾a, necitlivosÅ¥, pichanie. Zahrejte postihnutÃ© miesto telesnÃ½m teplom (podpazuÅ¡ie). NIKDY netrte snehom!" },
        { header: "Ak vypadne kÃºrenie" },
        { text: "<strong>ZhromaÅ¾dite sa v jednej miestnosti.</strong> Utesnite dvere do ostatnÃ½ch miestnostÃ­ dekami." },
        { text: "<strong>Na podlahu poloÅ¾te koberce/deky,</strong> presuÅˆte posteÄ¾ na najteplejÅ¡ie miesto. Spite spoloÄne \u2013 zdieÄ¾anÃ© teplo je najÃºÄinnejÅ¡ie." }
      ],
      warning: "NedotÃ½kajte sa namrznutÃ½ch kovovÃ½ch predmetov holÃ½mi rukami. VÅ¾dy majte rezervnÃ© suchÃ© obleÄenie. Alkohol zahrieva len krÃ¡tkodobo a potom zvyÅ¡uje stratu tepla \u2013 v zime sa mu vyhnite.",
      source: "SK MINV + SE MSB + CZ 72h",
      sources: [
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: SnehovÃ¡ kalamita", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "Å vÃ©dsko MSB \u2013 Om krisen eller kriget kommer (2024)", url: "https://www.msb.se/en/rad-till-privatpersoner/the-brochure-if-crisis-or-war-comes/" },
        { label: "CZ 72h prÃ­ruÄka \u2013 Ako zostaÅ¥ v teple", url: "https://www.72h.gov.cz" }
      ]
    },
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // HAVÃRIE A OHROZENIA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      id: "fire",
      emoji: "ğŸ”¥",
      title: "PoÅ¾iar",
      subtitle: "PoÅ¾iar v budove alebo okolÃ­",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { header: "Ãšnik z horiaceho priestoru" },
        { text: "<strong>OhlÃ¡ste poÅ¾iar na 150 alebo 112</strong> \u2013 aj keÄ si myslÃ­te, Å¾e ho zvlÃ¡dnete uhasiÅ¥ sami." },
        { text: "<strong>Pred otvorenÃ­m dverÃ­ priloÅ¾te dlaÅˆ na kÄ¾uÄku</strong> \u2013 ak je horÃºca, za dverami je oheÅˆ. NeotvÃ¡rajte a hÄ¾adajte inÃº cestu." },
        { text: "<strong>Pohybujte sa pri zemi</strong> \u2013 dym stÃºpa hore, pri podlahe je lepÅ¡Ã­ vzduch. PlazenÃ­m k vÃ½chodu." },
        { text: "<strong>Zakryte si nos a Ãºsta</strong> navlhÄenou tkaninou \u2013 zmenÅ¡Ã­te vdÃ½chnutie toxickÃ½ch splodÃ­n." },
        { text: "<strong>ZatvÃ¡rajte za sebou dvere</strong> (nezamykajte) \u2013 spomaÄ¾uje to Å¡Ã­renie ohÅˆa a dymu." },
        { text: "<strong>Nikdy sa nevracajte do horiaceho objektu</strong> \u2013 za Å¾iadnych okolnostÃ­." },
        { header: "Ak nemÃ´Å¾ete uniknÃºÅ¥" },
        { text: "<strong>Zavrite dvere miestnosti,</strong> utesnite Å¡pÃ¡ry mokrÃ½mi handramÃ­ alebo obleÄenÃ­m." },
        { text: "<strong>Dajte o sebe vedieÅ¥</strong> \u2013 volajte z okna, svieÅ¥te telefÃ³nom, klopte na stenu." },
        { text: "<strong>NeotvÃ¡rajte oknÃ¡ dokorÃ¡n</strong> \u2013 privan vzduch podporÃ­ oheÅˆ. Pootvorte len na dÃ½chanie." },
        { header: "PrvotnÃ© hasenie (ak je bezpeÄnÃ©)" },
        { text: "<strong>MalÃ½ poÅ¾iar (do 1 mÂ²)</strong> \u2013 pouÅ¾ite hasiaci prÃ­stroj alebo mokrÃº deku. Smerujte prÃºd na zÃ¡kladÅˆu plameÅˆa." },
        { text: "<strong>Olej na panvici</strong> \u2013 NIKDY nelejte vodu! Prikryte pokrievkou alebo mokrou handrou. Vypnite sporÃ¡k." },
        { text: "<strong>Elektrika</strong> \u2013 najprv vypnite istiÄ, potom haste. Nikdy nehaste vodou zapojenÃ© zariadenia." },
        { text: "<strong>Uzavrite prÃ­vod plynu.</strong>" },
        { text: "<strong>UvoÄ¾nite prÃ­stupovÃ© cesty hasiÄom</strong> \u2013 minimÃ¡lne 3 metre." }
      ],
      warning: "Dym zabÃ­ja rÃ½chlejÅ¡ie ako oheÅˆ \u2013 3 nÃ¡dychy toxickÃ©ho dymu mÃ´Å¾u spÃ´sobiÅ¥ bezvedomie. CZ prÃ­ruÄka 72h: majte doma funkÄnÃ½ hasiaci prÃ­stroj a detektor dymu.",
      source: "SK MINV + CZ 72h",
      sources: [
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: PoÅ¾iar", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025) \u2013 PoÅ¾iar", url: "https://www.72h.gov.cz" }
      ]
    },
    {
      id: "blackout",
      emoji: "ğŸ”Œ",
      title: "VÃ½padok elektriny",
      subtitle: "ÄŒo robiÅ¥ keÄ vypadne elektrickÃ½ prÃºd",
      iconBg: "#f5f3ee",
      iconBorder: "#e2ddd5",
      steps: [
        { header: "OkamÅ¾itÃ© kroky" },
        { text: "<strong>Overte rozsah vÃ½padku</strong> \u2013 svieti sa u susedov? Skontrolujte istiÄe. Ak je vÃ½padok ploÅ¡nÃ½, vypnite hlavnÃ½ istiÄ \u2013 ochrÃ¡nite spotrebiÄe pri obnovenÃ­ prÃºdu." },
        { text: "<strong>PlatobnÃ© karty a bankomaty nebudÃº fungovaÅ¥.</strong> Majte doma hotovosÅ¥ (â‚¬70\u2013100 na osobu) v malÃ½ch nominÃ¡loch." },
        { note: "Do niekoÄ¾kÃ½ch hodÃ­n prestanÃº fungovaÅ¥ aj telefÃ³nne siete. VÃ½znamne sa obmedzÃ­ vÃ¤ÄÅ¡ina zÃ¡kladnÃ½ch sluÅ¾ieb." },
        { header: "Jedlo a zÃ¡soby" },
        { text: "<strong>LedniÄku a mrazÃ¡k otvÃ¡rajte Äo najmenej</strong> \u2013 potraviny v neotvorenom mrazÃ¡ku vydrÅ¾ia 24\u201348 hodÃ­n." },
        { text: "<strong>Premiestnite nieÄo z mrazÃ¡ku do lednice</strong> \u2013 pomÃ´Å¾e udrÅ¾aÅ¥ v nej chlad." },
        { text: "<strong>Kontrolujte podlahu</strong> \u2013 pri tÃ¡nÃ­ mÃ´Å¾e vytekaÅ¥ voda." },
        { text: "<strong>RozmrazenÃ© potraviny spotrebujte Äo najrÃ½chlejÅ¡ie.</strong> Ak ich chcete znova zmraziÅ¥, najprv ich tepelne spracujte." },
        { text: "<strong>V zime skladujte potraviny vonku</strong> \u2013 chrÃ¡Åˆte ich pred zvieratami a priamym slnkom." },
        { text: "<strong>Jedlo bez elektriny:</strong> kuskus, instantnÃ¡ kaÅ¡a, vloÄky staÄÃ­ zaliaÅ¥ studenou vodou. KempingovÃ½ variÄ alebo gril \u2013 <strong>pouÅ¾Ã­vajte len vonku!</strong>" },
        { header: "Ako zostaÅ¥ v teple (zima)" },
        { text: "<strong>ZhromaÅ¾dite sa v jednej miestnosti.</strong> Dvere do ostatnÃ½ch miestnostÃ­ zatvorte a utesnite dekou." },
        { text: "<strong>Na podlahu poloÅ¾te koberec alebo prikrÃ½vky.</strong> ObleÄte si viacerÃ© vrstvy prieduÅ¡nÃ©ho obleÄenia." },
        { text: "<strong>PresuÅˆte posteÄ¾ na najteplejÅ¡ie miesto</strong> \u2013 spite spoloÄne pod vÅ¡etkÃ½mi prikrÃ½vkami." },
        { warn: "<strong>Alkohol</strong> zahrieva len krÃ¡tkodobo \u2013 zniÅ¾uje pozornosÅ¥ a zhorÅ¡uje termoregulÃ¡ciu. LepÅ¡ie sa mu vyhnÃºÅ¥." },
        { header: "Toaleta a hygiena" },
        { text: "<strong>PloÅ¡nÃ½ vÃ½padok elektriny preruÅ¡uje dodÃ¡vky vody.</strong> Toaletu splÃ¡chnete iba raz, potom sa nÃ¡drÅ¾ka nenapÄºÅˆa." },
        { text: "<strong>Pri preruÅ¡enÃ­ vody aj elektriny</strong> pouÅ¾Ã­vajte toaletu len v nevyhnutnÃ½ch prÃ­padoch. Na umytie rÃºk pouÅ¾Ã­vajte dezinfekciu." },
        { note: "<strong>NÃºdzovÃ© rieÅ¡enie toalety:</strong> do zÃ¡chodovej misy vloÅ¾te odpadkovÃ½ pytel, dajte naÅˆ toaletnÃ½ papier, noviny alebo koÄkolit. Po pouÅ¾itÃ­ pytel pevne zaviaÅ¾te a vloÅ¾te do ÄalÅ¡Ã­ch dvoch vriec." },
        { header: "KomunikÃ¡cia" },
        { text: "<strong>TelefÃ³n pouÅ¾Ã­vajte len v najnutnejÅ¡Ã­ch prÃ­padoch.</strong> Å etrite batÃ©riu \u2013 letovÃ½ reÅ¾im, nÃ­zky jas." },
        { text: "<strong>RÃ¡dio na batÃ©rie</strong> \u2013 mÃ´Å¾e byÅ¥ jedinÃ½ zdroj informÃ¡ciÃ­. SlovenskÃ½ rozhlas vysiela krÃ­zovÃ© informÃ¡cie." },
        { header: "Po obnovenÃ­ dodÃ¡vok" },
        { text: "<strong>Skontrolujte spotrebiÄe</strong> \u2013 uistite sa, Å¾e nie je zapnutÃ½ sporÃ¡k alebo inÃ½ spotrebiÄ." },
        { text: "<strong>Overte stav potravÃ­n</strong> v lednici a mrazÃ¡ku \u2013 ak boli dlhÅ¡ie ako 4 hodiny nad 5Â°C, zahoÄte ich." }
      ],
      warning: "Pozor: V budovÃ¡ch s diaÄ¾kovÃ½m vykurovanÃ­m mÃ´Å¾e byÅ¥ teplÃ¡ voda poÄas vÃ½padku prÃºdu nebezpeÄne horÃºca. Nikdy nekÃºrte vnÃºtri grilom alebo plynovÃ½m variÄom \u2013 hrozÃ­ otrava oxidom uhoÄ¾natÃ½m!",
      source: "CZ 72h + SK MINV + SE MSB",
      sources: [
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025) \u2013 VÃ½padok elektriny", url: "https://www.72h.gov.cz" },
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "Å vÃ©dsko MSB \u2013 Om krisen eller kriget kommer (2024)", url: "https://www.msb.se/en/rad-till-privatpersoner/the-brochure-if-crisis-or-war-comes/" }
      ]
    },
    {
      id: "water_outage",
      emoji: "ğŸš°",
      title: "VÃ½padok vody",
      subtitle: "PreruÅ¡enie dodÃ¡vok pitnej vody",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { header: "OkamÅ¾itÃ© kroky" },
        { text: "<strong>Napustite si vodu</strong> kÃ½m eÅ¡te teÄie \u2013 do vane, vedier, hrncov, PET fliaÅ¡. KaÅ¾dÃ½ liter sa poÄÃ­ta." },
        { text: "<strong>PouÅ¾ite zÃ¡soby balenej vody na pitie.</strong> Minimum 2 litre na osobu/deÅˆ (SK MINV odporÃºÄa 3\u20135 l)." },
        { text: "<strong>Pripravte si uzatvÃ¡rateÄ¾nÃ© nÃ¡doby</strong> (kanistre) \u2013 na odber vody z cisterien alebo vÃ½dajnÃ½ch miest." },
        { header: "HospodÃ¡renie s vodou" },
        { text: "<strong>PitnÃº vodu pouÅ¾Ã­vajte len na pitie a varenie.</strong> Na umÃ½vanie rÃºk staÄÃ­ dezinfekÄnÃ½ gÃ©l." },
        { text: "<strong>NepouÅ¾Ã­vajte umÃ½vaÄku riadu.</strong> Riad umÃ½vajte minimÃ¡lnym mnoÅ¾stvom vody do lavÃ³ra." },
        { text: "<strong>Toaletu splachujte len v nevyhnutnom prÃ­pade</strong> \u2013 pouÅ¾ite daÅ¾ÄovÃº vodu, vodu z vane alebo starÃº vodu z varenia." },
        { text: "<strong>ObleÄenie neperte</strong> \u2013 prezliekajte sa a perte aÅ¾ po obnovenÃ­ dodÃ¡vok." },
        { header: "NÃºdzovÃ© zdroje vody" },
        { text: "<strong>Cistierna</strong> \u2013 sledujte oznÃ¡menia obce/vodÃ¡renskej spoloÄnosti o vÃ½dajnÃ½ch miestach." },
        { text: "<strong>ZÃ¡sobnÃ­ky na ohrev vody</strong> (bojler) \u2013 obsahujÃº 50\u2013200 litrov vody, ktorÃ¡ sa dÃ¡ pouÅ¾iÅ¥ (vypustite z vÃ½pustnÃ©ho ventilu)." },
        { text: "<strong>StudÅˆa</strong> \u2013 ak mÃ¡te, overte kvalitu vody pred pitÃ­m (chemickÃ© zneÄistenie po povodniach)." },
        { warn: "<strong>Vodu z neznÃ¡meho zdroja vÅ¾dy prevÃ¡rajte</strong> minimÃ¡lne 1 minÃºtu v plnom vare. Eliminujete baktÃ©rie (nie chemikÃ¡lie)." },
        { header: "Hygiena" },
        { text: "<strong>MokrÃ© obrÃºsky a dezinfekcia</strong> sÃº nevyhnutnÃ© \u2013 majte ich v zÃ¡sobÃ¡ch." },
        { text: "<strong>Na Äistenie zubov</strong> pouÅ¾ite balenÃº vodu, nie vodu z vodovodu (potrubie mÃ´Å¾e byÅ¥ kontaminovanÃ©)." }
      ],
      warning: "Po obnovenÃ­ dodÃ¡vok nechajte vodu tiecÅ¥ niekoÄ¾ko minÃºt pred pouÅ¾itÃ­m \u2013 v potrubÃ­ mÃ´Å¾e byÅ¥ zneÄistenÃ¡. CZ prÃ­ruÄka 72h: vÃ½padok vody bÃ½va Äasto sprievodnÃ½m javom vÃ½padku elektriny.",
      source: "CZ 72h + SK MINV",
      sources: [
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025) \u2013 VÃ½padok vody", url: "https://www.72h.gov.cz" },
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    {
      id: "gas_leak",
      emoji: "ğŸ’¨",
      title: "Ãšnik plynu",
      subtitle: "Ãšnik zemnÃ©ho plynu v budove alebo okolÃ­",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>Ak cÃ­tite plyn \u2013 NEPANIKUJTE, ale konajte rÃ½chlo.</strong>" },
        { text: "<strong>NefajÄite, neÅ¡krtajte zÃ¡palkou, nepouÅ¾Ã­vajte elektrickÃ© vypÃ­naÄe</strong> (ani nezapÃ­najte, ani nevypÃ­najte svetlo!). Iskra mÃ´Å¾e spÃ´sobiÅ¥ vÃ½buch." },
        { text: "<strong>NepouÅ¾Ã­vajte zvonÄeky, telefÃ³n ani Å¾iadne elektronickÃ© zariadenie</strong> v priestore s plynom." },
        { text: "<strong>Otvorte oknÃ¡ a dvere dokorÃ¡n</strong> \u2013 vytvorte prievan na odvetranie." },
        { text: "<strong>Uzavrite hlavnÃ½ ventil plynu</strong> \u2013 zvyÄajne pri plynomere alebo pred sporÃ¡km. OtÃ¡Äajte kolmo na potrubie = zavretÃ©." },
        { text: "<strong>Opustite budovu</strong> \u2013 vezmite si len kÄ¾ÃºÄe a telefÃ³n. Varujte susedov." },
        { text: "<strong>AÅ¾ vonku zavolajte:</strong><br>\u2022 <strong>SPP poruchovÃ¡ linka: 0850 111 727</strong><br>\u2022 <strong>HasiÄi: 150</strong><br>\u2022 <strong>TiesÅˆovÃ¡ linka: 112</strong>" },
        { text: "<strong>Nevstupujte spÃ¤Å¥ do budovy</strong> kÃ½m situÃ¡ciu nevyhodnotÃ­ plynÃ¡r alebo hasiÄ." }
      ],
      warning: "ZemnÃ½ plyn je bez zÃ¡pachu \u2013 charakteristickÃ½ zÃ¡pach (po sÃ­rke) je pridanÃ½ odorizant. Ak cÃ­tite tento zÃ¡pach, VÅ½DY to berte vÃ¡Å¾ne. Oxid uhoÄ¾natÃ½ (CO) je bez zÃ¡pachu aj bez farby \u2013 preto je detektor CO v domÃ¡cnosti nevyhnutnÃ½.",
      source: "SK MINV + SPP",
      sources: [
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: Ãšnik plynu", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "SPP \u2013 PoruchovÃ¡ linka a bezpeÄnosÅ¥", url: "https://www.spp.sk/" }
      ]
    },
    {
      id: "chemical",
      emoji: "ğŸ§ª",
      title: "ChemickÃ½ Ãºnik",
      subtitle: "Ãšnik nebezpeÄnÃ½ch chemickÃ½ch lÃ¡tok",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { header: "Ak ste vonku" },
        { text: "<strong>OkamÅ¾ite sa vzÄaÄ¾te</strong> od zdroja Ãºniku \u2013 ideÃ¡lne kolmo na smer vetra." },
        { text: "<strong>ChrÃ¡Åˆte si dÃ½chacie cesty</strong> \u2013 navlhÄenou tkaninou, Å¡Ã¡lom, ÄÃ­mkoÄ¾vek. DÃ½chajte plytko." },
        { text: "<strong>ChrÃ¡Åˆte si oÄi</strong> \u2013 okuliare, lyÅ¾iarske okuliare, ÄokoÄ¾vek." },
        { text: "<strong>PresÃºvajte sa do vyÅ¡Å¡Ã­ch polÃ´h</strong> \u2013 vÃ¤ÄÅ¡ina nebezpeÄnÃ½ch plynov (chlÃ³r, fosgÃ©n) je Å¥aÅ¾Å¡ia ako vzduch a hromadÃ­ sa v nÃ­Å¾inÃ¡ch, pivniciach a priehlbinÃ¡ch." },
        { warn: "<strong>Nikdy sa neukrÃ½vajte do pivnÃ­c</strong> a terÃ©nnych nerovnostÃ­ \u2013 chemickÃ© lÃ¡tky sÃº Äasto Å¥aÅ¾Å¡ie neÅ¾ vzduch a hromadia sa tam!" },
        { header: "Ak ste doma (shelter-in-place)" },
        { text: "<strong>ZostaÅˆte doma!</strong> Zatvorte a utesnite oknÃ¡, dvere, vetracie otvory." },
        { text: "<strong>Vypnite ventilÃ¡ciu, klimatizÃ¡ciu, digestor.</strong>" },
        { text: "<strong>Uhaste otvorenÃ½ oheÅˆ</strong> a vypnite plynovÃ© spotrebiÄe." },
        { text: "<strong>Na utesnenie</strong> pouÅ¾ite mokrÃ© handry, igelitovÃ© vrecia a lepiacu pÃ¡sku na Å¡pÃ¡ry okien a dverÃ­." },
        { text: "<strong>PresÃºvajte sa do vyÅ¡Å¡Ã­ch poschodÃ­</strong> \u2013 ak je to moÅ¾nÃ©, na 2.+ poschodie." },
        { header: "Ak ste boli vystavenÃ­ chemikÃ¡liÃ¡m" },
        { text: "<strong>OdloÅ¾te kontaminovanÃ½ odev</strong> do neprieduÅ¡nÃ©ho vreca." },
        { text: "<strong>Osprchujte sa veÄ¾kÃ½m mnoÅ¾stvom vody</strong> \u2013 min. 15 minÃºt. NeumÃ½vajte sa teplou vodou (otvÃ¡ra pÃ³ry)." },
        { text: "<strong>VyplÃ¡chnite oÄi</strong> Äistou vodou min. 15 minÃºt." },
        { text: "<strong>VyhÄ¾adajte lekÃ¡rsku pomoc</strong> \u2013 aj keÄ sa cÃ­tite dobre. NiektorÃ© lÃ¡tky majÃº oneskorenÃ½ ÃºÄinok (6\u201324 hodÃ­n)." }
      ],
      warning: "Telefonujte len v sÃºrnom prÃ­pade \u2013 nezaÅ¥aÅ¾ujte siete. Pripravte si evakuaÄnÃ½ batoh pre prÃ­pad, Å¾e bude nariadenÃ¡ evakuÃ¡cia. Sledujte pokyny na oficiÃ¡lnych kanÃ¡loch.",
      source: "SK MINV + CZ 72h",
      sources: [
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: ChemickÃ½ Ãºnik", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025)", url: "https://www.72h.gov.cz" }
      ]
    },
    {
      id: "radiation",
      emoji: "â˜¢ï¸",
      title: "RÃ¡dioaktÃ­vny Ãºnik",
      subtitle: "JadrovÃ¡ havÃ¡ria alebo rÃ¡dioaktÃ­vna kontaminÃ¡cia",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { header: "OkamÅ¾itÃ¡ ochrana" },
        { text: "<strong>IhneÄ do budovy!</strong> Na otvorenom priestranstve vyhÄ¾adajte najbliÅ¾Å¡iu pevnÃº budovu." },
        { text: "<strong>ChoÄte Äo najhlbÅ¡ie</strong> \u2013 stredovÃ© miestnosti na prÃ­zemÃ­ alebo suterÃ©n. ÄŒÃ­m viac stien medzi vami a vonkajÅ¡Ã­m prostredÃ­m, tÃ½m lepÅ¡ie." },
        { text: "<strong>Uzatvorte a utesnite oknÃ¡, dvere,</strong> vetracie otvory. Vypnite ventilÃ¡ciu a klimatizÃ¡ciu." },
        { text: "<strong>ZabezpeÄte potraviny a vodu</strong> \u2013 hermeticky uzavrite v nÃ¡dobÃ¡ch. NepoÅ¾Ã­vajte ovocie, zeleninu a potraviny z voÄ¾nÃ©ho priestranstva." },
        { header: "Ak ste boli vonku poÄas Ãºniku" },
        { text: "<strong>OdloÅ¾te kontaminovanÃ½ odev</strong> do neprieduÅ¡nÃ©ho obalu \u2013 mimo obytnÃ© priestory." },
        { text: "<strong>Umyte si ruky, tvÃ¡r, vlasy Å¡ampÃ³nom</strong> (nie kondicionÃ©rom \u2013 viaÅ¾e Äastice). VyplÃ¡chnite oÄi a Ãºsta." },
        { text: "<strong>Osprchujte sa a vymeÅˆte bielizeÅˆ.</strong>" },
        { header: "JÃ³dovÃ© tablety" },
        { text: "<strong>Jodid draselnÃ½ (KI)</strong> \u2013 uÅ¾ite LEN na pokyn Ãºradov. ChrÃ¡ni Å¡tÃ­tnu Å¾Ä¾azu pred rÃ¡dioaktÃ­vnym jÃ³dom." },
        { note: "FÃ­nsko (72 tuntia) odporÃºÄa maÅ¥ doma jÃ³dovÃ© tablety. Na Slovensku ich vydÃ¡vajÃº Ãºrady v prÃ­pade jadrovej havÃ¡rie (JaslovskÃ© Bohunice, Mochovce)." },
        { header: "JadrovÃ½ vÃ½buch \u2013 UA DSNS odporÃºÄania" },
        { text: "<strong>Ak vidÃ­te zÃ¡blesk:</strong> NEPOZERAJTE SA naÅˆ (popÃ¡leniny rohovky). OkamÅ¾ite Ä¾ahnite na zem tvÃ¡rou nadol, nohy smerom k vÃ½buchu, ruky pod telo, zakryte si uÅ¡i." },
        { text: "<strong>ÄŒakajte na tlakovÃº vlnu</strong> \u2013 po prechode vlny okamÅ¾ite utekajte do najbliÅ¾Å¡ej budovy." },
        { text: "<strong>V Ãºkryte zostaÅˆte min. 24 hodÃ­n</strong> \u2013 rÃ¡dioaktÃ­vny spÃ¡d je najsilnejÅ¡Ã­ v prvÃ½ch hodinÃ¡ch." },
        { text: "<strong>EvakuÃ¡ciu vykonajte</strong> aÅ¾ na pokyn Ãºradov." }
      ],
      warning: "RÃ¡dioaktÃ­vne Äastice nie sÃº vidieÅ¥ ani cÃ­tiÅ¥. VÅ½DY berte varovanie Ãºradov vÃ¡Å¾ne. Å vÃ©dsko MSB (2024) a FÃ­nsko (72 tuntia) zdÃ´razÅˆujÃº: prÃ­prava na jadrovÃº hrozbu je sÃºÄasÅ¥ civilnej pripravenosti v EurÃ³pe.",
      source: "SK MINV + UA DSNS + SE MSB + FI 72 tuntia",
      sources: [
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: RadiaÄnÃ¡ udalosÅ¥", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "UA DSNS \u2013 Ako sa chrÃ¡niÅ¥ pred jadrovÃ½m Ãºtokom", url: "https://dovidka.info/en/yak-diyaty-v-razi-zastosuvannya-brudnoyi-bomby-yadernoyi-ataky-chy-avariyi-na-aes/" },
        { label: "Å vÃ©dsko MSB \u2013 Om krisen eller kriget kommer (2024)", url: "https://www.msb.se/en/rad-till-privatpersoner/the-brochure-if-crisis-or-war-comes/" }
      ]
    },
    {
      id: "terror",
      emoji: "ğŸš¨",
      title: "TeroristickÃ½ Ãºtok",
      subtitle: "StreÄ¾ba, bombovÃ½ Ãºtok alebo Ãºtok vozidlom",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { header: "UTEÄŒTE (ak mÃ¡te ÃºnikovÃº cestu)" },
        { text: "<strong>Opustite priestor najrÃ½chlejÅ¡ou bezpeÄnou cestou.</strong> Zoberte si iba telefÃ³n." },
        { text: "<strong>Varujte ostatnÃ½ch</strong> pred vstupom do nebezpeÄnej zÃ³ny \u2013 ale neÄakajte na nikoho, kto nechce Ã­sÅ¥." },
        { text: "<strong>Nechajte za sebou otvorenÃ© dvere</strong> \u2013 uÄ¾ahÄÃ­te Ãºnik ÄalÅ¡Ã­m Ä¾uÄom." },
        { text: "<strong>Neutekajte priamoÄiaro</strong> \u2013 cik-cak pohyb, za prekÃ¡Å¾kami, z dosahu ÃºtoÄnÃ­ka." },
        { header: "SKRYTE SA (ak nemÃ´Å¾ete utiecÅ¥)" },
        { text: "<strong>Zamknite dvere,</strong> kÄ¾ÃºÄ nechajte v zÃ¡mku. ZabarikÃ¡dujte nÃ¡bytkom." },
        { text: "<strong>NezdrÅ¾ujte sa pri oknÃ¡ch a stenÃ¡ch smerujÃºcich na chodbu.</strong>" },
        { text: "<strong>Schovajte sa za pevnÃ© predmety</strong> \u2013 betÃ³novÃ¡ stena, Å¥aÅ¾kÃ½ nÃ¡bytok, pilier." },
        { text: "<strong>StÃ­Å¡te telefÃ³n</strong> (aj vibrÃ¡cie!). NepÃ­Å¡te na sociÃ¡lne siete \u2013 prezrÃ¡dzate svoju pozÃ­ciu." },
        { text: "<strong>ZostaÅˆte skrytÃ­</strong> kÃ½m vÃ¡s neoslobodÃ­ polÃ­cia." },
        { header: "BRÃÅ‡TE SA (poslednÃ¡ moÅ¾nosÅ¥)" },
        { text: "<strong>Len pri bezprostrednom ohroÅ¾enÃ­ Å¾ivota</strong> \u2013 bojujte so vÅ¡etkÃ½m Äo mÃ¡te." },
        { text: "<strong>PouÅ¾ite predmety v okolÃ­:</strong> hasiaci prÃ­stroj (oslepÃ­ + Ãºdery), stoliÄka, fÄ¾aÅ¡a, kÄ¾ÃºÄe, pero." },
        { text: "<strong>Konajte rozhodne a agresÃ­vne.</strong> CieÄ¾te na oÄi a hrdlo." },
        { header: "Po zÃ¡sahu polÃ­cie" },
        { text: "<strong>UkÃ¡Å¾te prÃ¡zdne ruky</strong> \u2013 polÃ­cia netuÅ¡Ã­ kto je ÃºtoÄnÃ­k. Nerobte prudkÃ© pohyby." },
        { text: "<strong>PoslÃºchajte pokyny policajtov</strong> \u2013 aj keÄ idÃº opaÄnÃ½m smerom od vÃ½chodu." },
        { text: "<strong>NezdieÄ¾ajte videÃ¡ na sociÃ¡lnych sieÅ¥ach</strong> \u2013 mÃ´Å¾u byÅ¥ zneuÅ¾itÃ© ÃºtoÄnÃ­kmi." }
      ],
      warning: "Po vÃ½buchu mÃ´Å¾u nasledovaÅ¥ ÄalÅ¡ie Ãºtoky (tzv. double tap). Ak nie ste zranenÃ­, vzÄaÄ¾te sa z miesta Äo najÄalej. Ak neohrozÃ­te seba, poskytnite pomoc zranenÃ½m.",
      source: "SK MINV + UA DSNS",
      sources: [
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: TeroristickÃ½ Ãºtok", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "UA DSNS \u2013 PrÃ­ruÄka pre prÃ­pad nÃºdze alebo vojny", url: "https://dovidka.info/" }
      ]
    },
    {
      id: "armed_conflict",
      emoji: "ğŸ’£",
      title: "OzbrojenÃ½ konflikt",
      subtitle: "ÄŒo robiÅ¥ pri ostreÄ¾ovanÃ­, dronoch a bombardovanÃ­",
      iconBg: "#fef2f2",
      iconBorder: "#fecaca",
      steps: [
        { header: "KeÄ zaznie sirÃ©na (vzduÅ¡nÃ½ poplach)" },
        { text: "<strong>OkamÅ¾ite vyhÄ¾adajte Ãºkryt</strong> \u2013 pivnica, suterÃ©n, metro, podzemnÃ½ parking, vnÃºtornÃ¡ miestnosÅ¥ bez okien." },
        { text: "<strong>DrÅ¾te sa Äalej od okien, sklenenÃ½ch plÃ´ch a vonkajÅ¡Ã­ch stien.</strong>" },
        { text: "<strong>Sadnite si alebo Ä¾ahnite na zem</strong> \u2013 ÄÃ­m niÅ¾Å¡ie, tÃ½m lepÅ¡ie. ChrÃ¡Åˆte si hlavu a krk." },
        { text: "<strong>ZostaÅˆte v Ãºkryte</strong> kÃ½m nezaznie signÃ¡l konca ohrozenia alebo kÃ½m nedostanete oficiÃ¡lnu informÃ¡ciu." },
        { warn: "Nikdy nevychÃ¡dzajte von bezprostredne po vÃ½buchu \u2013 mÃ´Å¾u nasledovaÅ¥ ÄalÅ¡ie Ãºtoky (double tap)." },
        { header: "Pravidlo dvoch stien (UA DSNS)" },
        { text: "<strong>Ak ste doma a nestÃ­hate do Ãºkrytu</strong> \u2013 nÃ¡jdite miesto oddelenÃ© od vonkajÅ¡ej steny dvoma nosnÃ½mi stenami. KÃºpeÄ¾Åˆa alebo chodba v strede bytu." },
        { text: "<strong>Nikdy sa neukrÃ½vajte pri oknÃ¡ch</strong> \u2013 tlakovÃ¡ vlna vyrÃ¡Å¾a sklo, ktorÃ© spÃ´sobuje najÄastejÅ¡ie zranenia civilistov." },
        { header: "Ochrana okien a bytu" },
        { text: "<strong>Prelepte oknÃ¡ krÃ­Å¾om lepenkou</strong> \u2013 zmenÅ¡Ã­te riziko poranenia odletujÃºcim sklom.", forHousing: ["flat", "rd", "rd_cellar"] },
        { text: "<strong>Ochrana okien doskami, preglejkou</strong> alebo vrstvou kobercov. UA DSNS: nasypte piesok alebo zeminu do vriec pred vonkajÅ¡ie steny a oknÃ¡.", forHousing: ["rd", "rd_cellar"] },
        { text: "<strong>VnÃºtri otoÄte Å¥aÅ¾kÃ½ nÃ¡bytok</strong> (pohovka, skriÅˆa) medzi vonkajÅ¡iu stenu a miesto kde sa zdrÅ¾iavate \u2013 funguje ako ochrannÃ¡ bariÃ©ra." },
        { header: "Drony" },
        { text: "<strong>Ak poÄujete bzukot dronu \u2013 okamÅ¾ite pod betÃ³novÃº konÅ¡trukciu</strong> alebo do budovy." },
        { text: "<strong>Nepozerajte sa hore a nefotografujte</strong> \u2013 svetlo displeja vÃ¡s identifikuje." },
        { text: "<strong>Vonku bez Ãºkrytu:</strong> Ä¾ahnite si tvÃ¡rou nadol, zakryte hlavu. AkÃ¡koÄ¾vek priehlbina, priekopa alebo obrubnÃ­k je lepÅ¡ia ako niÄ." },
        { header: "Ochrana sluchu a zraku" },
        { text: "<strong>ChrÃ¡niÄe sluchu alebo aspoÅˆ Å¡tuple do uÅ¡Ã­</strong> \u2013 vÃ½buchy spÃ´sobujÃº trvalÃ© poÅ¡kodenie sluchu. UA DSNS: slÃºchadlÃ¡ sÃº ochrana proti barotraume." },
        { text: "<strong>OchrannÃ© okuliare</strong> \u2013 sklenÃ© Ärepiny, prach a Ãºlomky ohrozujÃº zrak. StavebnÃ© alebo lyÅ¾iarske okuliare." },
        { header: "Po vÃ½buchu / ostreÄ¾ovanÃ­" },
        { text: "<strong>Skontrolujte seba a blÃ­zkych</strong> \u2013 zastavte krvÃ¡canie (pozrite postup VojnovÃ© zranenia v sekcii PrvÃ¡ pomoc)." },
        { text: "<strong>Ak sa budova poÅ¡kodila \u2013 opatrne ju opustite.</strong> Pozor na uvoÄ¾nenÃ© konÅ¡trukcie, rozbitÃ© sklo a spadnutÃ© vedenie." },
        { text: "<strong>NedotÃ½kajte sa neznÃ¡mych predmetov</strong> \u2013 mÃ´Å¾e Ã­sÅ¥ o nevybuchnutÃº munÃ­ciu. Zavolajte 112." },
        { text: "<strong>Ak ste pod troskami</strong> \u2013 zavolajte 112, klopte na potrubie, svieÅ¥te telefÃ³nom. Å etrite energiu." },
        { header: "PrÃ­prava vopred" },
        { text: "<strong>Identifikujte najbliÅ¾Å¡ie Ãºkryty</strong> \u2013 pivnice, garÃ¡Å¾e, metro. UA DSNS: overte ich na mape Ãºkrytov." },
        { text: "<strong>EvakuaÄnÃ½ batoh pri dverÃ¡ch</strong> \u2013 doklady, voda, lieky, baterka, power banka, peniaze, nabÃ­jaÄka." },
        { text: "<strong>RodinnÃ½ plÃ¡n stretnutia</strong> \u2013 kde sa stretnete ak vypadne signÃ¡l. KaÅ¾dÃ½ Älen rodiny musÃ­ vedieÅ¥ plÃ¡n." },
        { text: "<strong>NauÄte sa zÃ¡klady prvej pomoci</strong> \u2013 turniket, zastavenie krvÃ¡cania, stabilizovanÃ¡ poloha." },
        { text: "<strong>PracovnÃ© obleÄenie a ochrannÃ© pomÃ´cky</strong> \u2013 UA DSNS odporÃºÄa: pracovnÃ© rukavice (sklo vÅ¡ade), pevnÃº obuv, stavebnÃ© okuliare, rÃºÅ¡ko/respirÃ¡tor, prilbu." }
      ],
      warning: "Tieto odporÃºÄania vychÃ¡dzajÃº zo skÃºsenostÃ­ ukrajinskÃ©ho obyvateÄ¾stva od roku 2022. VÅ¾dy sa riaÄte pokynmi miestnych autorÃ­t. NajÃºÄinnejÅ¡ia ochrana civilistov je vÄasnÃ¡ evakuÃ¡cia z ohrozenej oblasti.",
      source: "UA DSNS + SK MINV + ICRC",
      sources: [
        { label: "UA DSNS \u2013 PrÃ­ruÄka pre prÃ­pad nÃºdze alebo vojny", url: "https://dovidka.info/" },
        { label: "UA DSNS \u2013 Ako preÅ¾iÅ¥ ostreÄ¾ovanie a pripraviÅ¥ Ãºkryt", url: "https://dovidka.info/en/russians-are-shelling-ukrainian-cities-how-to-equip-a-shelter-and-get-out-of-the-rubble/" },
        { label: "UA DSNS \u2013 PrÃ­prava civilnej obrany v obliehaniu", url: "https://dovidka.info/en/preparation-of-civil-defense-in-the-siege/" },
        { label: "UA DSNS \u2013 V bojovej zÃ³ne", url: "https://dovidka.info/en/in-the-combat-area/" },
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "ICRC \u2013 International Committee of the Red Cross", url: "https://www.icrc.org/" }
      ]
    },
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PRIPRAVENOSÅ¤ A PODPORA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    {
      id: "survival_72h",
      emoji: "â±ï¸",
      title: "72 hodÃ­n bez sluÅ¾ieb",
      subtitle: "Ako zvlÃ¡dnuÅ¥ 3 dni bez zÃ¡kladnÃ½ch sluÅ¾ieb",
      iconBg: "#eff6ff",
      iconBorder: "#bfdbfe",
      steps: [
        { header: "ÄŒo sa mÃ´Å¾e staÅ¥ naraz?" },
        { text: "<strong>NepÃ´jde elektrina.</strong> Z kohÃºtika nepoteÄie voda. Prestane fungovaÅ¥ telefÃ³n, televÃ­zia a internet." },
        { text: "<strong>NezaplatÃ­me kartou.</strong> Nenatankujeme. Obchody budÃº zavretÃ©. Prestane jazdiÅ¥ MHD." },
        { text: "<strong>Prestane fungovaÅ¥ kÃºrenie.</strong> Nikde nevyzdvihneme lieky. Toaletu splÃ¡chneme moÅ¾no raz." },
        { note: "Pravidlo 72 hodÃ­n (CZ) / 1 tÃ½Å¾deÅˆ (Å vÃ©dsko, NÃ³rsko): kaÅ¾dÃ½ mÃ¡ zvlÃ¡dnuÅ¥ prvÃ© dni bez pomoci zÃ¡chrannÃ½ch zloÅ¾iek \u2013 iba s tÃ½m, Äo mÃ¡ doma." },
        { header: "ÄŒo maÅ¥ pripravenÃ©" },
        { text: "<strong>Voda:</strong> min. 2\u20133 litre na osobu/deÅˆ. Na 72h = min. 6\u20139 litrov na osobu. BalenÃº + nÃ¡doby na odber." },
        { text: "<strong>Jedlo:</strong> konzervy, suÅ¡ienky, mÃ¼sli tyÄinky, suÅ¡enÃ© ovocie, orechy. NiÄ Äo vyÅ¾aduje chladenie alebo varenie." },
        { text: "<strong>Lieky:</strong> min. na 7\u201314 dnÃ­. ChronickÃ¡ medikÃ¡cia, beÅ¾nÃ© lieky (paracetamol, ibuprofen, antidiaroikÃ¡)." },
        { text: "<strong>HotovosÅ¥:</strong> â‚¬70\u2013100 na osobu v malÃ½ch nominÃ¡loch (â‚¬5, â‚¬10, â‚¬20)." },
        { text: "<strong>Info a komunikÃ¡cia:</strong> rÃ¡dio na batÃ©rie, powerbanka, baterka, pÃ­Å¡Å¥alka, nabÃ­jaÄky." },
        { text: "<strong>Hygiena:</strong> mokrÃ© obrÃºsky, dezinfekcia, odpadkovÃ© vrecia, toaletnÃ½ papier." },
        { text: "<strong>Doklady:</strong> kÃ³pie OP, pasu, poistiek, lekÃ¡rskych sprÃ¡v v nepremokavom obale." },
        { header: "PreÄo sa pripraviÅ¥?" },
        { text: "<strong>PripravenÃ¡ domÃ¡cnosÅ¥ = menej stresu + schopnosÅ¥ pomÃ¡haÅ¥.</strong> Kto je pripravenÃ½, dokÃ¡Å¾e pomÃ´cÅ¥ susedom, starÅ¡Ã­m a rodinÃ¡m s deÅ¥mi." },
        { text: "<strong>PrÃ­prava zaberie len pÃ¡r hodÃ­n</strong> a stojÃ­ â‚¬30\u201350 na osobu. MÃ´Å¾e zachrÃ¡niÅ¥ Å¾ivot." }
      ],
      warning: "NajnÃ¡roÄnejÅ¡ie bÃ½vajÃº prvÃ© 72 hodÃ­n. Ak sa vÄas pripravÃ­te, pomÃ´Å¾ete tÃ½m nielen sebe ale aj ostatnÃ½m. EU Preparedness Union Strategy (2025) odporÃºÄa 72h sebestaÄnosÅ¥ pre vÅ¡etkÃ½ch obÄanov.",
      source: "CZ 72h + SE MSB + SK MINV + EU",
      sources: [
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025)", url: "https://www.72h.gov.cz" },
        { label: "Å vÃ©dsko MSB \u2013 Om krisen eller kriget kommer (2024)", url: "https://www.msb.se/en/rad-till-privatpersoner/the-brochure-if-crisis-or-war-comes/" },
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "EU Preparedness Union Strategy (2025)", url: "https://commission.europa.eu/strategy-and-policy/priorities-2024-2029/protecting-our-european-way-life/european-security-and-defence/preparedness-union-strategy_en" }
      ]
    },
    {
      id: "shelter",
      emoji: "ğŸ›–",
      title: "Ukrytie",
      subtitle: "Kedy a ako sa ukryÅ¥ na bezpeÄnom mieste",
      iconBg: "#f0fdf4",
      iconBorder: "#86efac",
      steps: [
        { header: "VarovnÃ½ signÃ¡l" },
        { text: "<strong>VÅ¡eobecnÃ¡ vÃ½straha:</strong> kolÃ­savÃ½ tÃ³n sirÃ©ny po dobu 140 sekÃºnd. ZnamenÃ¡: ihneÄ sa ukryte!" },
        { text: "<strong>Po zaznenÃ­ signÃ¡lu</strong> sa rÃ½chlo ukryte v najbliÅ¾Å¡ej pevnej budove. DÃ´kladne uzavrite dvere a oknÃ¡." },
        { header: "Kedy sa musÃ­me ukryÅ¥?" },
        { text: "<strong>SilnÃ¡ bÃºrka alebo tornÃ¡do, Ãºnik nebezpeÄnÃ½ch lÃ¡tok, riziko radiÃ¡cie, vzduÅ¡nÃ½ poplach, ostreÄ¾ovanie.</strong>" },
        { header: "ÄŒo je dobrÃ½ Ãºkryt?" },
        { text: "<strong>NajlepÅ¡ie:</strong> pivnica, suterÃ©n, metro, podzemnÃ½ parking, protiatÃ³movÃ½ kryt." },
        { text: "<strong>DobrÃ©:</strong> vnÃºtornÃ¡ miestnosÅ¥ bez okien (kÃºpeÄ¾Åˆa, chodba) obklopenÃ¡ nosnÃ½mi stenami." },
        { text: "<strong>Nie je Ãºkryt:</strong> auto, autobusovÃ¡ zastÃ¡vka, sklenenÃ¡ prÃ­stavba, stanovÃ© konÅ¡trukcie." },
        { note: "UA DSNS pravidlo dvoch stien: medzi vami a vonkajÅ¡ou stenou majÃº byÅ¥ aspoÅˆ 2 nosnÃ© steny." },
        { header: "V Ãºkryte" },
        { text: "<strong>Utesnite miestnosÅ¥</strong> \u2013 mokrÃ© handry do Å¡pÃ¡r dverÃ­ a okien. Vypnite ventilÃ¡ciu a klimatizÃ¡ciu." },
        { text: "<strong>ZabezpeÄte prÃ­stup k informÃ¡ciÃ¡m</strong> \u2013 rÃ¡dio na batÃ©rie, telefÃ³n v letovom reÅ¾ime (Å¡etrÃ­ batÃ©riu)." },
        { text: "<strong>ZbytoÄne netelefonujte</strong> \u2013 nepreÅ¥aÅ¾ujte mobilnÃ© siete." },
        { text: "<strong>ZostaÅˆte v Ãºkryte</strong> a Äakajte na pokyny (rÃ¡dio, sirÃ©ny, zÃ¡chranÃ¡ri)." },
        { warn: "NiektorÃ© nebezpeÄnÃ© lÃ¡tky nie sÃº vidieÅ¥ ani cÃ­tiÅ¥. VÅ½DY berte varovanie Ãºradov vÃ¡Å¾ne \u2013 aj keÄ sa vÃ¡m zdÃ¡, Å¾e vonku je vÅ¡etko v poriadku." }
      ],
      warning: "PamÃ¤tajte: kolÃ­savÃ½ tÃ³n 140 sekÃºnd = vÅ¡eobecnÃ¡ vÃ½straha = ihneÄ do Ãºkrytu. Koniec ohrozenia: stÃ¡ly tÃ³n 140 sekÃºnd.",
      source: "CZ 72h + UA DSNS + SK MINV",
      sources: [
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025) \u2013 Ukrytie", url: "https://www.72h.gov.cz" },
        { label: "UA DSNS \u2013 Ãškryty a ochrana pred ostreÄ¾ovanÃ­m", url: "https://dovidka.info/en/what-is-shelter/" },
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: Ukrytie", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    {
      id: "evacuation",
      emoji: "ğŸƒ",
      title: "EvakuÃ¡cia",
      subtitle: "KompletnÃ½ postup pri nariadenÃ­ evakuÃ¡cie",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { header: "BezpeÄnostnÃ© opatrenia pred odchodom" },
        { text: "<strong>Uhaste oheÅˆ</strong> v kamnÃ¡ch, krbe alebo na sporÃ¡ku." },
        { text: "<strong>Vypnite elektrickÃ© spotrebiÄe</strong> (okrem mrazÃ¡ku \u2013 ak funguje elektrina)." },
        { text: "<strong>Uzavrite vodu a plyn.</strong> Zatvorte oknÃ¡ a dvere, vypnite ventilÃ¡ciu." },
        { header: "EvakuaÄnÃ½ batoh" },
        { text: "<strong>Batoh oznaÄte Å¡tÃ­tkom</strong> so menom a telefÃ³nnym ÄÃ­slom." },
        { text: "<strong>HmotnosÅ¥:</strong> max 25 kg (dospelÃ½), 15 kg (dieÅ¥a), + 5 kg prÃ­ruÄnÃ¡ taÅ¡ka." },
        { text: "<strong>Obsah:</strong> doklady v nepremokavom obale, peniaze, lieky, 1.5l vody na osobu, potraviny na 1\u20132 dni, obleÄenie na prezleÄenie, hygienickÃ© potreby, baterka, powerbanka, nabÃ­jaÄka, rÃ¡dio." },
        { note: "UA DSNS: batoh max 25 litrov, max 50 kg. PlÃ¡nujte, Å¾e ÄasÅ¥ cesty moÅ¾no pÃ´jdete peÅ¡i \u2013 berte len najnutnejÅ¡ie." },
        { header: "Ochrana osÃ´b" },
        { text: "<strong>DeÅ¥om a zraniteÄ¾nÃ½m osobÃ¡m</strong> dajte do kapsy kartiÄku s menom, adresou a kontaktom na prÃ­buznÃ©ho." },
        { text: "<strong>Upozornite susedov.</strong> PonÃºknite pomoc starÅ¡Ã­m a osobÃ¡m s obmedzenou mobilitou." },
        { text: "<strong>Nezabudnite na domÃ¡ce zvieratÃ¡</strong> \u2013 prepravka, krmivo, voda, veterinÃ¡rne doklady." },
        { header: "Pred odchodom" },
        { text: "<strong>Zamknite byt / dom.</strong>" },
        { text: "<strong>Na dvere nalepte lÃ­stok</strong> s informÃ¡ciou kedy a kam ste sa evakuovali, s menami a kontaktom." },
        { header: "EvakuaÄnÃ© trasy" },
        { text: "<strong>RiaÄte sa pokynmi zÃ¡chranÃ¡rov</strong> \u2013 neopÃºÅ¡Å¥ajte stanovenÃ© trasy." },
        { text: "<strong>NeÅ¾ sa evakuujete autom</strong> \u2013 zvÃ¡Å¾te rizikÃ¡: palivo, stav ciest, premÃ¡vka. V niektorÃ½ch situÃ¡ciÃ¡ch je peÅ¡Ã­ odchod bezpeÄnejÅ¡Ã­." },
        { text: "<strong>Ak sa evakuujete sami</strong> \u2013 nahlÃ¡ste sa Ãºradom alebo znÃ¡mym, aby vedeli kde ste." },
        { text: "<strong>Dostavte sa na urÄenÃ© zhromaÅ¾disko.</strong>" }
      ],
      warning: "VÃ½zvu k evakuÃ¡cii musÃ­te uposlÃºchnuÅ¥. Nie je to odporÃºÄanie \u2013 je to nariadenie na zÃ¡chranu Å¾ivota. ChrÃ¡nime tÃ½m nielen seba, ale aj zdravie zÃ¡chranÃ¡rov.",
      source: "CZ 72h + SK MINV + UA DSNS",
      sources: [
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025) \u2013 EvakuÃ¡cia", url: "https://www.72h.gov.cz" },
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva: EvakuÃ¡cia", url: "https://www.minv.sk/?ochrana-obyvatelstva" },
        { label: "UA DSNS \u2013 EvakuÃ¡cia a organizÃ¡cia Ãºkrytov", url: "https://dovidka.info/en/evacuation-and-organization-of-shelters/" }
      ]
    },
    {
      id: "help_neighbors",
      emoji: "ğŸ¤",
      title: "Pomoc susedom",
      subtitle: "VzÃ¡jomnÃ¡ pomoc v okolÃ­ poÄas krÃ­zy",
      iconBg: "#f0fdf4",
      iconBorder: "#86efac",
      steps: [
        { text: "<strong>Å½ije vo vaÅ¡om okolÃ­ niekto, kto by mohol potrebovaÅ¥ pomoc?</strong> StarÅ¡Ã­ Älovek, rodina s malÃ½mi deÅ¥mi, osoba s handicapom, chorÃ½ alebo cudzinec, ktorÃ½ nerozumie dobre slovensky." },
        { note: "V krÃ­zovÃ½ch situÃ¡ciÃ¡ch je vzÃ¡jomnÃ¡ pomoc kÄ¾ÃºÄovÃ¡. CZ 72h: \u201ePripravenÃ¡ domÃ¡cnosÅ¥ mÃ´Å¾e lepÅ¡ie pomÃ¡haÅ¥ ostatnÃ½m.\u201c FÃ­nska prÃ­ruÄka zdÃ´razÅˆuje: vopred sa dohodnite so susedmi, kto je zraniteÄ¾nÃ½ a kto mÃ´Å¾e pomÃ´cÅ¥." },
        { header: "VaÅ¡i susedia mÃ´Å¾u" },
        { text: "<strong>PotrebovaÅ¥ lekÃ¡rsku pomoc</strong> alebo lieky, na ktorÃ© sa nedostanÃº." },
        { text: "<strong>NemaÅ¥ zÃ¡soby</strong> jedla alebo pitnej vody." },
        { text: "<strong>NevyznaÅ¥ sa v situÃ¡cii</strong> \u2013 nevedia preÄo nefunguje elektrina, voda, Äo majÃº robiÅ¥." },
        { text: "<strong>MaÅ¥ problÃ©m s pohybom</strong> \u2013 nemÃ´Å¾u sa dostaÅ¥ na miesto vÃ½daja vody alebo na zhromaÅ¾disko." },
        { header: "ÄŒo mÃ´Å¾ete urobiÅ¥" },
        { text: "<strong>Zavolajte pomoc</strong> v naliehavÃ½ch prÃ­padoch (112, 155, 150)." },
        { text: "<strong>RozdeÄ¾te sa o zÃ¡soby</strong> \u2013 aj malÃ© mnoÅ¾stvo vody alebo jedla mÃ´Å¾e pomÃ´cÅ¥." },
        { text: "<strong>PomÃ´Å¾te s presunom</strong> \u2013 do Ãºkrytu, na zhromaÅ¾disko, k lekÃ¡rovi." },
        { text: "<strong>OdovzdÃ¡vajte informÃ¡cie</strong> \u2013 Äo sa deje, kde je vÃ½dajnÃ© miesto, akÃ© sÃº pokyny." },
        { text: "<strong>Overte stav izolovanÃ½ch Ä¾udÃ­</strong> \u2013 zaklopte, zavolajte, opÃ½tajte sa Äi nieÄo nepotrebujÃº." }
      ],
      warning: "SpoloÄenstvo a susedskÃ¡ pomoc sÃº v krÃ­ze neoceniteÄ¾nÃ©. UA skÃºsenosÅ¥: susedstvÃ¡, ktorÃ© sa organizovali vopred, zvlÃ¡dli ostreÄ¾ovanie a blackouty vÃ½razne lepÅ¡ie.",
      source: "CZ 72h + SK MINV + FI 72 tuntia",
      sources: [
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025) \u2013 Pomoc susedom", url: "https://www.72h.gov.cz" },
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    {
      id: "children_crisis",
      emoji: "ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦",
      title: "KomunikÃ¡cia s deÅ¥mi",
      subtitle: "Ako hovoriÅ¥ s deÅ¥mi o krÃ­ze",
      iconBg: "#fdf2f8",
      iconBorder: "#fbcfe8",
      steps: [
        { text: "<strong>V krÃ­zovÃ½ch situÃ¡ciÃ¡ch sa deÅ¥om venujte eÅ¡te viac.</strong> Deti potrebujÃº chÃ¡paÅ¥ Äo sa deje, cÃ­tiÅ¥ podporu a vedieÅ¥ Äo ich ÄakÃ¡. VÄaka tomu sa so situÃ¡ciou lepÅ¡ie vyrovnajÃº." },
        { header: "Ako komunikovaÅ¥" },
        { text: "<strong>Hovorte otvorene a Ãºprimne,</strong> primerane veku dieÅ¥aÅ¥a." },
        { text: "<strong>Dajte im priestor</strong> povedaÅ¥, z Äoho majÃº obavy. NaslÃºchajte." },
        { text: "<strong>Hovorte aj o svojich pocitoch</strong> \u2013 je normÃ¡lne cÃ­tiÅ¥ strach alebo neistotu." },
        { text: "<strong>SnaÅ¾te sa zostaÅ¥ v pokoji</strong> \u2013 deti zrkadlia naÅ¡e emÃ³cie." },
        { text: "<strong>Zapojte ich do ÄinnostÃ­</strong> primerane veku \u2013 pomÃ¡hanie dÃ¡va pocit kontroly." },
        { header: "ÄŒo povedaÅ¥" },
        { text: "<strong>SituÃ¡ciu vysvetlite jednoducho:</strong> \u201eTeraz nemÃ¡me elektrinu. To sa stÃ¡va a my sme pripravenÃ­.\u201c" },
        { text: "<strong>ZdÃ´raznite, Å¾e odbornÃ­ci situÃ¡ciu rieÅ¡ia</strong> a robia vÅ¡etko pre ochranu." },
        { text: "<strong>Ujistite ich:</strong> \u201eBudeme stÃ¡le s tebou. Spolu to zvlÃ¡dneme.\u201c" },
        { text: "<strong>Ak je to moÅ¾nÃ©, udrÅ¾ujte obvyklÃ½ reÅ¾im</strong> \u2013 jedlo, spÃ¡nok, hra v pravidelnÃ½ch intervaloch." },
        { note: "<strong>EvakuÃ¡cia:</strong> Pripravte dieÅ¥aÅ¥u kartiÄku s menom, adresou a kontaktom na blÃ­zku osobu do vrecka. Do batÃ´Å¾ku pribaÄ¾te obÄ¾ÃºbenÃº hraÄku alebo plyÅ¡Ã¡ka." }
      ],
      warning: "Obmedzte vystavenie detÃ­ sprÃ¡vam a zÃ¡berom z krÃ­zy/vojny. Sledujte zmeny sprÃ¡vania (problÃ©my so spÃ¡nkom, agresivita, pomoÄovanie) \u2013 mÃ´Å¾u byÅ¥ signÃ¡lom traumy.",
      source: "CZ 72h + SK MINV",
      sources: [
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025) \u2013 Deti a krÃ­za", url: "https://www.72h.gov.cz" },
        { label: "SK MINV \u2013 Ochrana obyvateÄ¾stva", url: "https://www.minv.sk/?ochrana-obyvatelstva" }
      ]
    },
    {
      id: "mental_health",
      emoji: "ğŸ§ ",
      title: "PsychickÃ¡ podpora",
      subtitle: "Podpora v Å¥aÅ¾kÃ½ch chvÃ­Ä¾ach pre dospelÃ½ch",
      iconBg: "#ede9fe",
      iconBorder: "#c4b5fd",
      steps: [
        { text: "<strong>V krÃ­ze je dÃ´leÅ¾itÃ© myslieÅ¥ aj na psychickÃº pohodu.</strong> Strach, ÃºzkosÅ¥, hnev, smÃºtok alebo necitlivosÅ¥ sÃº normÃ¡lne reakcie na nenormÃ¡lnu situÃ¡ciu." },
        { header: "Ako sa staraÅ¥ o seba" },
        { text: "<strong>UdrÅ¾ujte dennÃ½ reÅ¾im</strong> \u2013 pravidelnÃ© jedlo, spÃ¡nok a pohyb pomÃ¡hajÃº." },
        { text: "<strong>Obmedzte sledovanie sprÃ¡v</strong> \u2013 staÄÃ­ 2x denne z overenÃ½ch zdrojov." },
        { text: "<strong>Hovorte o svojich pocitoch</strong> s blÃ­zkymi \u2013 izolÃ¡cia zhorÅ¡uje stav." },
        { text: "<strong>Zapojte sa do pomoci ostatnÃ½m</strong> \u2013 aktÃ­vna pomoc dÃ¡va pocit kontroly a zmyslu." },
        { header: "Ako podporovaÅ¥ druhÃ½ch" },
        { text: "<strong>Hovorte s reÅ¡pektom a trpezlivosÅ¥ou.</strong> NaslÃºchajte a nesÃºÄte." },
        { text: "<strong>Dajte priestor emÃ³ciÃ¡m</strong> \u2013 plaÄ, hnev aj ticho sÃº normÃ¡lne reakcie." },
        { text: "<strong>UmoÅ¾nite zapojenie</strong> do rieÅ¡enia situÃ¡cie spÃ´sobom, ktorÃ½ zvlÃ¡dnu." },
        { header: "Linky pomoci" },
        { text: "<strong>Linka dÃ´very (SK):</strong> <a href='tel:0800500333' style='color:#1e40af;font-weight:bold'>0800 500 333</a> \u2013 bezplatnÃ¡, nonstop" },
        { text: "<strong>Linka pomoci (SK):</strong> <a href='tel:116123' style='color:#1e40af;font-weight:bold'>116 123</a> \u2013 emocionÃ¡lna podpora" },
        { text: "<strong>KrÃ­zovÃ¡ linka (SK):</strong> <a href='tel:0800801616' style='color:#1e40af;font-weight:bold'>0800 801 616</a> \u2013 pre obete nÃ¡silia" },
        { note: "StarÃ¡te sa o niekoho so Å¡pecifickÃ½mi potrebami (starÅ¡Ã­, osoba so zdravotnÃ½m znevÃ½hodnenÃ­m, duÅ¡evnÃ© ochorenie)? Kontaktujte miestny Ãºrad sociÃ¡lnych vecÃ­ alebo linku pomoci." }
      ],
      warning: "Ak mÃ¡te myÅ¡lienky na sebapoÅ¡kodenie, zavolajte ihneÄ 0800 500 333 alebo 112. NemusÃ­te to zvlÃ¡daÅ¥ sami.",
      source: "CZ 72h + Linka dÃ´very SR",
      sources: [
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025) \u2013 PsychickÃ¡ podpora", url: "https://www.72h.gov.cz" },
        { label: "Linka dÃ´very SR \u2013 0800 500 333", url: "https://www.linkadovery.sk/" }
      ]
    },
    {
      id: "info_hygiene",
      emoji: "ğŸ“°",
      title: "Overovanie informÃ¡ciÃ­",
      subtitle: "Ako rozpoznaÅ¥ a brÃ¡niÅ¥ sa dezinformÃ¡ciÃ¡m v krÃ­ze",
      iconBg: "#fef3c7",
      iconBorder: "#fcd34d",
      steps: [
        { text: "<strong>V krÃ­ze sa rÃ½chlo Å¡Ã­ria fÃ¡my, poplaÅ¡nÃ© sprÃ¡vy a dezinformÃ¡cie.</strong> MÃ´Å¾u spÃ´sobiÅ¥ paniku, ohroziÅ¥ Å¾ivoty a komplikovaÅ¥ prÃ¡cu zÃ¡chranÃ¡rov." },
        { header: "PravidlÃ¡ informaÄnej hygieny" },
        { text: "<strong>Overujte z viacerÃ½ch dÃ´veryhodnÃ½ch zdrojov</strong> \u2013 SlovenskÃ½ rozhlas (RTVS), CivilnÃ¡ ochrana SR, SHMÃš, hasiÄi." },
        { text: "<strong>ZdieÄ¾ajte iba overenÃ© informÃ¡cie.</strong> Pred zdieÄ¾anÃ­m sa spÃ½tajte: Viem, kto to napÃ­sal? Je to z oficiÃ¡lneho zdroja? Nie je to starÃ¡ sprÃ¡va?" },
        { text: "<strong>DÃ¡vajte pozor na emocionÃ¡lny jazyk</strong> \u2013 sprÃ¡vy typu \u201eÅ ÃRTE ÄALEJ!!!\u201c, \u201eVÅ¡etci musia vedieÅ¥!\u201c sÃº typickÃ½m znakom dezinformÃ¡ciÃ­." },
        { header: "UA skÃºsenosÅ¥ s dezinformÃ¡ciami vo vojne" },
        { text: "<strong>Nefotografujte a nezdieÄ¾ajte:</strong> pozÃ­cie armÃ¡dy, pohyby vojsk, zÃ¡sahy na objekty \u2013 pomÃ¡hate tÃ½m nepriateÄ¾ovi." },
        { text: "<strong>FaloÅ¡nÃ© evakuaÄnÃ© prÃ­kazy:</strong> overte kaÅ¾dÃ½ prÃ­kaz k evakuÃ¡cii cez oficiÃ¡lne kanÃ¡ly (rÃ¡dio, web MV SR, civilnÃ¡ ochrana)." },
        { text: "<strong>NedÃ´verujte neznÃ¡mym ÃºÄtom</strong> na sociÃ¡lnych sieÅ¥ach \u2013 boti a trollovia sÃº reÃ¡lnou hrozbou aj v EurÃ³pe." },
        { note: "Å vÃ©dsko MSB (2024): dezinformÃ¡cie a kyberÃºtoky sÃº sÃºÄasÅ¥ou modernÃ©ho konfliktu. Pripravte sa rovnako ako na vÃ½padok elektriny." },
        { header: "DÃ´veryhodnÃ© zdroje na Slovensku" },
        { text: "<strong>RTVS</strong> (SlovenskÃ½ rozhlas a televÃ­zia), <strong>SHMÃš</strong> (shmu.sk), <strong>CivilnÃ¡ ochrana MV SR</strong> (minv.sk), <strong>HaZZ SR</strong> (hasiÄi), <strong>112</strong> (tiesÅˆovÃ¡ linka)." }
      ],
      warning: "V krÃ­ze platÃ­: najprv overiÅ¥, potom zdieÄ¾aÅ¥. Jedna nepravdivÃ¡ sprÃ¡va mÃ´Å¾e spÃ´sobiÅ¥ paniku a ohroziÅ¥ Å¾ivoty. BuÄte sÃºÄasÅ¥ou rieÅ¡enia, nie problÃ©mu.",
      source: "CZ 72h + UA DSNS + SE MSB",
      sources: [
        { label: "CZ 72h prÃ­ruÄka (MV ÄŒR, 2025) \u2013 InformaÄnÃ¡ hygiena", url: "https://www.72h.gov.cz" },
        { label: "UA DSNS \u2013 DezinformÃ¡cie a informaÄnÃ¡ bezpeÄnosÅ¥", url: "https://dovidka.info/" },
        { label: "Å vÃ©dsko MSB \u2013 Om krisen eller kriget kommer (2024)", url: "https://www.msb.se/en/rad-till-privatpersoner/the-brochure-if-crisis-or-war-comes/" }
      ]
    }
  ];


  function renderEmergencyProc() {
    const grid = document.getElementById("emergencyProcGrid");
    if (!grid) return;
    grid.innerHTML = "";

    // Group definitions from UX audit
    const groups = [
      { label: "PrÃ­rodnÃ© hrozby", ids: ["flood", "earthquake", "storm", "landslide", "heat", "snow"] },
      { label: "HavÃ¡rie a ohrozenia", ids: ["fire", "blackout", "water_outage", "gas_leak", "chemical", "radiation", "terror", "armed_conflict"] },
      { label: "PripravenosÅ¥ a podpora", ids: ["survival_72h", "shelter", "evacuation", "help_neighbors", "children_crisis", "mental_health", "info_hygiene"] }
    ];

    groups.forEach(group => {
      // Add group heading
      const heading = document.createElement("div");
      heading.className = "proc-group-heading";
      heading.textContent = group.label;
      grid.appendChild(heading);

      // Add cards for this group
      group.ids.forEach(id => {
        const item = EMERGENCY_PROC_DATA.find(d => d.id === id);
        if (!item) return;
        const card = document.createElement("div");
        card.className = "mu-card";
        card.setAttribute("role", "button");
        card.setAttribute("tabindex", "0");
        card.setAttribute("aria-label", item.title + " â€“ zobraziÅ¥ postup");
        card.innerHTML = `
          <div class="mu-icon" style="background:${item.iconBg}; border:1.5px solid ${item.iconBorder};">
            ${item.emoji}
          </div>
          <div class="mu-card-label">${item.title}</div>`;
        card.onclick = () => openEmergencyProcModal(item);
        card.onkeydown = (e) => { if (e.key === "Enter" || e.key === " ") { e.preventDefault(); openEmergencyProcModal(item); }};
        grid.appendChild(card);
      });
    });
  }

  function openEmergencyProcModal(item) {
    const icon = document.getElementById("muModalIcon");
    const title = document.getElementById("muModalTitle");
    const subtitle = document.getElementById("muModalSubtitle");
    const content = document.getElementById("muModalContent");

    icon.style.background = item.iconBg;
    icon.style.border = `1.5px solid ${item.iconBorder}`;
    icon.textContent = item.emoji;
    title.textContent = item.title;
    subtitle.textContent = item.subtitle;

    let html = `<div class="fa-emergency-bar">ğŸ“ TiesÅˆovÃ© ÄÃ­slo: <a href="tel:112">112</a> &nbsp;|&nbsp; HasiÄi: <a href="tel:150">150</a> &nbsp;|&nbsp; PolÃ­cia: <a href="tel:158">158</a></div>`;

    // Render steps with support for headers, notes, and housing-specific content
    html += `<div style="margin-bottom:0.5rem;">`;
    let stepNum = 0;
    const housing = (state.profile && state.profile.housing) || "flat";

    item.steps.forEach(step => {
      // Housing-specific content filter â€“ applies to ALL step types
      if (step.forHousing) {
        if (!step.forHousing.includes(housing)) return;
      }
      // Section header
      if (step.header) {
        html += `<div style="font-size:0.82rem; font-weight:700; color:var(--c-text); margin:1rem 0 0.5rem; padding-bottom:0.375rem; border-bottom:1.5px solid var(--c-border);">${step.header}</div>`;
        stepNum = 0;
        return;
      }
      // Info/note box
      if (step.note) {
        html += `<div style="background:#fef3c7; border:1px solid #fcd34d; border-radius:0.75rem; padding:0.75rem; margin:0.5rem 0; font-size:0.78rem; line-height:1.6; color:#92400e;"><strong>ğŸ’¡</strong> ${step.note}</div>`;
        return;
      }
      // Warning box
      if (step.warn) {
        html += `<div style="background:#fef2f2; border:1px solid #fecaca; border-radius:0.75rem; padding:0.75rem; margin:0.5rem 0; font-size:0.78rem; line-height:1.6; color:#991b1b;"><strong>âš ï¸</strong> ${step.warn}</div>`;
        return;
      }
      stepNum++;
      html += `<div class="fa-modal-step">
        <div class="fa-step-num">${stepNum}</div>
        <div class="fa-step-text">${step.text}</div>
      </div>`;
    });
    html += `</div>`;

    if (item.warning) {
      html += `<div class="fa-warning"><strong>âš ï¸ DÃ´leÅ¾itÃ©:</strong> ${item.warning}</div>`;
    }

    if (Array.isArray(item.sources)) {
      html += `<div class="fa-source"><strong>Zdroje:</strong><br>${item.sources.map(s =>
        s.url ? `<a href="${s.url}" target="_blank" rel="noopener" style="color:#2563eb; text-decoration:underline;">${s.label}</a>` : s.label
      ).join("<br>")}</div>`;
    } else if (item.source) {
      html += `<div class="fa-source"><strong>Zdroj:</strong> ${item.source}</div>`;
    }

    content.innerHTML = html;
    openModal("modalEmergencyProc");
  }

  function renderAll() {
    renderProfileCard();
    renderOverall();
    renderCategories();
    renderFirstAid();
    renderEmergencyContacts();
    renderPersonalContacts();
    renderSirens();
    renderRadio();
    renderEmergencyProc();
    renderEvacBags();
    // Aktualizuj detail kategÃ³rie len ak je modal otvorenÃ½
    if (document.getElementById("modalCategory").classList.contains("open")) {
      renderCategoryDetail();
    }
    renderPlans();
    renderAlerts();
    // Check for 100% completion â†’ Slovak confetti
    if (state.profile && overallScore() >= 99.5) {
      setTimeout(triggerSlovakConfetti, 500);
    }
  }

  // â”€â”€ Forms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openProfileEditor() {
    const f = document.getElementById("profileForm");
    if (state.profile) {
      const p = state.profile;
      ["adults","kids","infants","seniors","prepDays"].forEach(k => {
        if (f.elements[k]) f.elements[k].value = p[k] ?? (k === "prepDays" ? 3 : 0);
      });
      ["readiness","budget","housing"].forEach(k => {
        const val = p[k];
        if (val) {
          const radio = f.querySelector(`input[name="${k}"][value="${val}"]`);
          if (radio) radio.checked = true;
        }
      });
    } else {
      const defReadiness = f.querySelector('input[name="readiness"][value="standard"]');
      if (defReadiness) defReadiness.checked = true;
      const defBudget = f.querySelector('input[name="budget"][value="mid"]');
      if (defBudget) defBudget.checked = true;
      const defHousing = f.querySelector('input[name="housing"][value="flat"]');
      if (defHousing) defHousing.checked = true;
    }
    openModal("modalProfile");
  }
  window.openProfileEditor = openProfileEditor;

  // â”€â”€ Profile Advanced Toggle â”€â”€
  (function() {
    const toggle = document.getElementById("profileAdvancedToggle");
    const content = document.getElementById("profileAdvancedContent");
    const arrow = document.getElementById("profileAdvancedArrow");
    let isOpen = false;
    function setAdvancedOpen(open) {
      isOpen = open;
      content.style.display = open ? "grid" : "none";
      arrow.style.transform = open ? "rotate(180deg)" : "";
    }
    toggle.addEventListener("click", () => setAdvancedOpen(!isOpen));
    // Auto-expand when editing existing profile with non-default advanced values
    const origOpen = window.openProfileEditor;
    window.openProfileEditor = function() {
      origOpen();
      if (state.profile) {
        const p = state.profile;
        const hasAdvanced = p.readiness !== "standard" || p.budget !== "mid";
        setAdvancedOpen(hasAdvanced);
      } else {
        setAdvancedOpen(false);
      }
    };
  })();

  document.getElementById("profileForm").onsubmit = (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);

    // Koeficient pre zvÃ½Å¡enÃº pripravenosÅ¥
    const readiness = String(fd.get("readiness") || "standard");
    const readinessCoeff = readiness === "enhanced" ? 1.3 : 1.0;

    state.profile = {
      adults:   +fd.get("adults")   || 0,
      kids:     +fd.get("kids")     || 0,
      infants:  +fd.get("infants")  || 0,
      seniors:  +fd.get("seniors")  || 0,
      prepDays: +fd.get("prepDays") || 3,
      housing:  String(fd.get("housing")  || "flat"),
      readiness,
      readinessCoeff,
      budget:   String(fd.get("budget")   || "mid"),
    };
    closeModal("modalProfile");
    regenerateProfileBasedItems();
    scheduleSave(); renderAll();
    trackEvent('profile_setup', {
      household_size: state.profile.adults + state.profile.kids + state.profile.infants + state.profile.seniors,
      prep_days: state.profile.prepDays
    });
    // Onboarding: scroll to categories after first profile save
    const isFirstSetup = !state._profileWasSet;
    state._profileWasSet = true;
    setTimeout(() => {
      const catSection = document.getElementById("categoriesSection");
      if (catSection) catSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      // Show onboarding tip on first profile save
      if (isFirstSetup) {
        const tip = document.getElementById("onboardingTip");
        if (tip) {
          tip.style.display = "block";
          // Auto-dismiss after 12 seconds
          setTimeout(() => { tip.style.display = "none"; }, 12000);
        }
      }
    }, 300);
  };

  // â”€â”€ Unified Item Modal (Add / Edit) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let pendingDeleteCatId = "";
  let pendingDeleteIdx = -1;

  function openItemModal(catId, itemIdx) {
    const f = document.getElementById("addItemForm");
    const isEdit = itemIdx >= 0 && state.items[catId] && itemIdx < state.items[catId].length;
    const item = isEdit ? state.items[catId][itemIdx] : {};
    const isDocs = (catId === "docs");
    const hasExpiry = (catId === "food_water" || catId === "medkit");
    const hasLink = (catId === "food_water" || catId === "medkit" || catId === "hygiene" || catId === "gear");
    const isCashOnly = (catId === "cash");

    // Title
    const catLabels = { docs: "doklad", cash: "poloÅ¾ku", medkit: "poloÅ¾ku", food_water: "poloÅ¾ku", hygiene: "poloÅ¾ku", gear: "poloÅ¾ku" };
    if (isDocs) {
      document.getElementById("itemModalTitle").textContent = isEdit ? "âœï¸ UpraviÅ¥ doklad" : "â• PridaÅ¥ doklad";
    } else {
      document.getElementById("itemModalTitle").textContent = isEdit ? "âœï¸ UpraviÅ¥ poloÅ¾ku" : "â• PridaÅ¥ poloÅ¾ku";
    }
    document.getElementById("btnItemSubmit").textContent = isEdit ? "UloÅ¾iÅ¥" : "PridaÅ¥";

    // Name label
    document.getElementById("itemLabelName").textContent = isDocs ? "NÃ¡zov dokladu *" : "NÃ¡zov *";

    // Field visibility per category:
    // docs: Name + Typ uloÅ¾enia only
    // cash: Name + MnoÅ¾stvo only
    // food_water, medkit: Name + MnoÅ¾stvo + ExpirÃ¡cia + Odkaz
    // hygiene, gear: Name + MnoÅ¾stvo + Odkaz (no expiry)
    const qtyRow = document.getElementById("itemFieldQtyRow");
    const expiryField = document.getElementById("itemFieldExpiry");
    const docsField = document.getElementById("itemFieldDocs");
    const linkField = document.getElementById("itemFieldLink");

    if (isDocs) {
      qtyRow.style.display = "none";
      docsField.style.display = "block";
      linkField.style.display = "none";
    } else {
      qtyRow.style.display = hasExpiry ? "grid" : "block";
      qtyRow.style.gridTemplateColumns = hasExpiry ? "1fr 1fr" : "1fr";
      expiryField.style.display = hasExpiry ? "block" : "none";
      docsField.style.display = "none";
      linkField.style.display = (hasLink && !isCashOnly) ? "block" : "none";
    }

    f.elements["editIndex"].value = itemIdx;
    f.elements["name"].value = item.name || "";

    if (isDocs) {
      f.elements["qty_docs"].value = item.qty || "";
      f.elements["qty"].value = "";
      f.elements["expiry"].value = "";
      f.elements["link"].value = "";
    } else {
      f.elements["qty"].value = item.qty || "";
      f.elements["qty_docs"].value = "";
      f.elements["expiry"].value = hasExpiry ? (item.expiry || "") : "";
      f.elements["link"].value = hasLink ? (item.link || "") : "";
    }

    openModal("modalAddItem");
  }

  // â”€â”€ Undo toast system â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let undoTimeout = null;
  let undoData = null;

  function showUndoToast(message, restoreFn) {
    // Remove existing toast
    const existing = document.getElementById("undoToast");
    if (existing) existing.remove();
    if (undoTimeout) clearTimeout(undoTimeout);

    const toast = document.createElement("div");
    toast.id = "undoToast";
    toast.className = "undo-toast";
    toast.innerHTML = `<span>${message}</span><button onclick="performUndo()">VrÃ¡tiÅ¥ spÃ¤Å¥</button>`;
    document.body.appendChild(toast);

    undoData = restoreFn;
    undoTimeout = setTimeout(() => {
      toast.style.opacity = "0";
      toast.style.transition = "opacity 0.3s";
      setTimeout(() => toast.remove(), 300);
      undoData = null;
    }, 5000);
  }

  window.performUndo = function() {
    if (undoData) {
      undoData();
      undoData = null;
    }
    if (undoTimeout) clearTimeout(undoTimeout);
    const toast = document.getElementById("undoToast");
    if (toast) toast.remove();
    scheduleSave(); renderAll();
  };

  function openDeleteConfirmation(catId, itemIdx) {
    const cat = CATEGORIES.find(c => c.id === catId);
    const item = state.items[catId] && state.items[catId][itemIdx];
    if (!item || !cat) return;

    // Save item data for undo
    const deletedItem = structuredClone(item);
    const deletedIdx = itemIdx;
    const deletedCatId = catId;

    // Delete immediately
    state.items[catId].splice(itemIdx, 1);
    scheduleSave(); renderAll();

    // Show undo toast
    showUndoToast(`ğŸ—‘ï¸ ${esc(deletedItem.name)} odstrÃ¡nenÃ©`, () => {
      state.items[deletedCatId].splice(deletedIdx, 0, deletedItem);
    });
  }

  document.getElementById("btnConfirmDelete").onclick = () => {
    if (pendingDeleteCatId && pendingDeleteIdx >= 0 && state.items[pendingDeleteCatId]) {
      state.items[pendingDeleteCatId].splice(pendingDeleteIdx, 1);
      closeModal("modalDeleteItem");
      scheduleSave(); renderAll();
    }
  };

  document.getElementById("btnAddItem").onclick = () => {
    openItemModal(state.selectedCategoryId, -1);
  };

  document.getElementById("addItemForm").onsubmit = (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const name = String(fd.get("name")||"").trim();
    if (!name) return;
    const cid = state.selectedCategoryId;
    const idx = parseInt(fd.get("editIndex"));
    const isDocs = (cid === "docs");
    const hasExpiry = (cid === "food_water" || cid === "medkit");
    const hasLink = (cid === "food_water" || cid === "medkit" || cid === "hygiene" || cid === "gear");

    const itemData = {
      name,
      qty: isDocs ? String(fd.get("qty_docs")||"").trim() : String(fd.get("qty")||"").trim(),
      expiry: hasExpiry ? String(fd.get("expiry")||"").trim() : "",
      link: hasLink ? String(fd.get("link")||"").trim() : "",
    };

    state.items[cid] = state.items[cid] || [];
    if (idx >= 0 && idx < state.items[cid].length) {
      Object.assign(state.items[cid][idx], itemData);
    } else {
      const newItem = { ...itemData, done: false };
      if (isDocs) newItem.docGroup = "InÃ©";
      state.items[cid].push(newItem);
    }
    closeModal("modalAddItem");
    e.target.reset();
    scheduleSave(); renderAll();
  };

  document.getElementById("alertDaysMeds").onchange = (e) => {
    state.alertDaysMeds = +e.target.value;
    scheduleSave(); renderAlerts(); renderAll();
  };
  document.getElementById("alertDaysFood").onchange = (e) => {
    state.alertDaysFood = +e.target.value;
    scheduleSave(); renderAlerts(); renderAll();
  };

  // â”€â”€ Food Entry Edit Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openFoodEditModal(catId, itemIdx, entryIdx, entry) {
    const f = document.getElementById("foodEditForm");
    f.elements["fe_catId"].value = catId;
    f.elements["fe_itemIdx"].value = itemIdx;
    f.elements["fe_entryIdx"].value = entryIdx;
    f.elements["fe_name"].value = entry.name || "";
    f.elements["fe_kcal"].value = entry.kcal || "";
    f.elements["fe_qty"].value = entry.qty || 1;
    f.elements["fe_expiry"].value = entry.expiry || "";
    openModal("modalFoodEdit");
  }

  document.getElementById("foodEditForm").onsubmit = (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const catId = fd.get("fe_catId");
    const itemIdx = parseInt(fd.get("fe_itemIdx"));
    const entryIdx = parseInt(fd.get("fe_entryIdx"));
    const entry = state.items[catId]?.[itemIdx]?.foodEntries?.[entryIdx];
    if (!entry) return;
    entry.name = String(fd.get("fe_name")||"").trim();
    entry.kcal = Number(fd.get("fe_kcal"))||0;
    entry.qty = Number(fd.get("fe_qty"))||1;
    entry.expiry = String(fd.get("fe_expiry")||"").trim();
    closeModal("modalFoodEdit");
    scheduleSave(); renderAll();
  };

  // â”€â”€ Water Entry Edit Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openWaterEditModal(catId, itemIdx, entryIdx, entry) {
    const f = document.getElementById("waterEditForm");
    f.elements["we_catId"].value = catId;
    f.elements["we_itemIdx"].value = itemIdx;
    f.elements["we_entryIdx"].value = entryIdx;
    f.elements["we_name"].value = entry.name || "";
    f.elements["we_liters"].value = entry.liters || "";
    f.elements["we_qty"].value = entry.qty || 1;
    f.elements["we_expiry"].value = entry.expiry || "";
    openModal("modalWaterEdit");
  }

  document.getElementById("waterEditForm").onsubmit = (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const catId = fd.get("we_catId");
    const itemIdx = parseInt(fd.get("we_itemIdx"));
    const entryIdx = parseInt(fd.get("we_entryIdx"));
    const entry = state.items[catId]?.[itemIdx]?.waterEntries?.[entryIdx];
    if (!entry) return;
    entry.name = String(fd.get("we_name")||"").trim();
    entry.liters = Number(fd.get("we_liters"))||0;
    entry.qty = Number(fd.get("we_qty"))||1;
    entry.expiry = String(fd.get("we_expiry")||"").trim();
    closeModal("modalWaterEdit");
    scheduleSave(); renderAll();
  };

  // â”€â”€ Cash Entry Edit Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openCashEditModal(catId, itemIdx, entryIdx, entry) {
    const f = document.getElementById("cashEditForm");
    f.elements["ce_catId"].value = catId;
    f.elements["ce_itemIdx"].value = itemIdx;
    f.elements["ce_entryIdx"].value = entryIdx;
    f.elements["ce_type"].value = entry.type || "bankovka";
    f.elements["ce_value"].value = entry.value || "";
    f.elements["ce_qty"].value = entry.qty || 1;
    openModal("modalCashEdit");
  }

  document.getElementById("cashEditForm").onsubmit = (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const catId = fd.get("ce_catId");
    const itemIdx = parseInt(fd.get("ce_itemIdx"));
    const entryIdx = parseInt(fd.get("ce_entryIdx"));
    const entry = state.items[catId]?.[itemIdx]?.cashEntries?.[entryIdx];
    if (!entry) return;
    entry.type = String(fd.get("ce_type")||"bankovka");
    entry.value = Number(fd.get("ce_value"))||0;
    entry.qty = Number(fd.get("ce_qty"))||1;
    closeModal("modalCashEdit");
    scheduleSave(); renderAll();
  };

  // â”€â”€ Validation Modal Helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showValidation(msg) {
    document.getElementById("validationText").textContent = msg;
    openModal("modalValidation");
  }

  // Click outside modal to close
  document.querySelectorAll(".modal-overlay").forEach(overlay => {
    overlay.onclick = (e) => { if (e.target === overlay) closeModal(overlay.id); };
  });


  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EMAIL NOTIFIKÃCIE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // PrahovÃ© hodnoty v dÅˆoch
  // ExpirÃ¡cia: riadi sa nastaveniami v appke (alertDaysMeds / alertDaysFood)
  const NOTIFY_SHOPPING_DAYS = 14; // nÃ¡kupnÃ½ zoznam ak expiruje do 14 dnÃ­
  const NOTIFY_COOLDOWN_H    = 24; // min. hodÃ­n medzi emailami rovnakÃ©ho typu

  // ZistÃ­ Äo expiruje â€“ vrÃ¡ti pole { name, catName, expiry, days }
  // Ak thresholdDays nie je zadanÃ½, pouÅ¾ije per-kategÃ³riu nastavenia
  function getExpiringItems(thresholdDays) {
    const items = [];
    for (const c of CATEGORIES) {
      const catThreshold = thresholdDays !== undefined ? thresholdDays : getAlertDaysForCategory(c.id);
      (state.items[c.id] || []).forEach(it => {
        // Food entries: check each entry's expiry
        if (it.isFoodItem && it.foodEntries) {
          it.foodEntries.forEach(fe => {
            if (!fe.expiry) return;
            const d = daysUntil(fe.expiry);
            if (d <= catThreshold) {
              items.push({
                name:    fe.name,
                catName: c.name,
                expiry:  fe.expiry,
                days:    d,
                qty:     (fe.qty||1) + "Ã— " + (fe.kcal||0) + " kcal"
              });
            }
          });
          return;
        }
        // Water entries: check each entry's expiry
        if (it.isWaterItem && it.waterEntries) {
          it.waterEntries.forEach(we => {
            if (!we.expiry) return;
            const d = daysUntil(we.expiry);
            if (d <= catThreshold) {
              items.push({
                name:    we.name,
                catName: c.name,
                expiry:  we.expiry,
                days:    d,
                qty:     (we.qty||1) + "Ã— " + (we.liters||0) + " l"
              });
            }
          });
          return;
        }
        if (!it.expiry || !it.done) return; // len poloÅ¾ky ktorÃ© sÃº v zÃ¡sobÃ¡ch (done=true)
        const d = daysUntil(it.expiry);
        if (d <= catThreshold) {
          items.push({
            name:    it.name,
            catName: c.name,
            expiry:  it.expiry,
            days:    d,
            qty:     it.qty || ""
          });
        }
      });
    }
    return items.sort((a, b) => a.days - b.days);
  }

  // Skontroluje Äi sa mÃ¡ poslaÅ¥ email (cooldown 24h)
  async function canSendEmail(type) {
    if (isDemo) return false; // Demo: Å¾iadne emaily
    if (!currentUser) return false;
    if (EMAILJS_CONFIG.publicKey === "YOUR_EMAILJS_PUBLIC_KEY") return false; // nekonfigurovanÃ©
    try {
      const snap = await getDoc(doc(db, "users", currentUser.uid, "notifications", type));
      if (!snap.exists()) return true;
      const lastSent = snap.data().sentAt?.toMillis?.() || 0;
      const hoursSince = (Date.now() - lastSent) / 3600000;
      return hoursSince >= NOTIFY_COOLDOWN_H;
    } catch { return false; }
  }

  // ZapÃ­Å¡e timestamp poslednÃ©ho odoslania
  async function markEmailSent(type) {
    if (isDemo || !currentUser) return;
    try {
      await setDoc(
        doc(db, "users", currentUser.uid, "notifications", type),
        { sentAt: new Date() }
      );
    } catch(e) { console.warn("markEmailSent error", e); }
  }

  // FormÃ¡tuje zoznam poloÅ¾iek do HTML pre email
  function formatItemsHtml(items) {
    return items.map(it => {
      const daysLabel = it.days < 0
        ? "<span style='color:#dc2626;font-weight:600;'>EXPIROVANÃ‰</span>"
        : `za <strong>${it.days} dnÃ­</strong> (${it.expiry})`;
      return `<tr>
        <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;">${it.name}</td>
        <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;color:#6b6560;">${it.catName}</td>
        <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;">${daysLabel}</td>
      </tr>`;
    }).join("");
  }

  // EMAIL 1 â€“ Upozornenie na blÃ­Å¾iacu sa expirÃ¡ciu (spotrebuj to!)
  async function sendExpiryWarningEmail(items) {
    if (!currentUser?.email) return;
    if (!(await canSendEmail("expiry_warning"))) return;
    if (!items.length) return;

    const userName = currentUser.displayName?.split(" ")[0] || "pouÅ¾Ã­vateÄ¾";
    const itemsHtml = formatItemsHtml(items);
    const itemCount = items.length;

    try {
      await emailjs.send(EMAILJS_CONFIG.serviceId, EMAILJS_CONFIG.template_expiry, {
        to_email:    currentUser.email,
        to_name:     userName,
        item_count:  itemCount,
        items_html:  itemsHtml,
        items_text:  items.map(it => `â€¢ ${it.name} (${it.catName}) â€“ expiruje ${it.expiry}`).join("\n"),
        app_url:     window.location.href,
        subject:     `Gerlach: ${itemCount} ${itemCount === 1 ? "poloÅ¾ka" : itemCount < 5 ? "poloÅ¾ky" : "poloÅ¾iek"} v zÃ¡sobÃ¡ch Äoskoro expiruje`
      });
      await markEmailSent("expiry_warning");
      console.log("âœ‰ï¸ Expiry warning email odoslanÃ½");
    } catch(e) {
      console.warn("EmailJS expiry send error:", e);
    }
  }

  // EMAIL 2 â€“ NÃ¡kupnÃ½ zoznam (dobuÄ zÃ¡soby!)
  async function sendShoppingListEmail(items) {
    if (!currentUser?.email) return;
    if (!(await canSendEmail("shopping_list"))) return;
    if (!items.length) return;

    const userName = currentUser.displayName?.split(" ")[0] || "pouÅ¾Ã­vateÄ¾";
    const itemCount = items.length;
    const shoppingHtml = items.map(it => `<tr>
      <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;"><strong>${it.name}</strong></td>
      <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;color:#6b6560;">${it.catName}</td>
      <td style="padding:6px 12px;border-bottom:1px solid #f0ebe3;color:#6b6560;">${it.qty || "â€”"}</td>
    </tr>`).join("");

    try {
      await emailjs.send(EMAILJS_CONFIG.serviceId, EMAILJS_CONFIG.template_shopping, {
        to_email:      currentUser.email,
        to_name:       userName,
        item_count:    itemCount,
        shopping_html: shoppingHtml,
        shopping_text: items.map(it => `â€¢ ${it.name} (${it.catName})${it.qty ? " â€“ " + it.qty : ""}`).join("\n"),
        app_url:       window.location.href,
        subject:       `Gerlach: NÃ¡kupnÃ½ zoznam â€“ ${itemCount} ${itemCount === 1 ? "poloÅ¾ka na doplnenie" : "poloÅ¾ky na doplnenie"}`
      });
      await markEmailSent("shopping_list");
      console.log("âœ‰ï¸ Shopping list email odoslanÃ½");
    } catch(e) {
      console.warn("EmailJS shopping send error:", e);
    }
  }

  // HlavnÃ¡ funkcia â€“ skontroluje expirÃ¡cie a odoÅ¡le emaily ak treba
  async function checkAndSendNotifications() {
    if (isDemo) return; // Demo: Å¾iadne emaily
    if (!currentUser || EMAILJS_CONFIG.publicKey === "YOUR_EMAILJS_PUBLIC_KEY") return;

    const expiringItems  = getExpiringItems(); // per-category thresholds
    const criticalItems  = getExpiringItems(NOTIFY_SHOPPING_DAYS);

    // Email 1: upozornenie (podÄ¾a nastavenÃ½ch prahov per kategÃ³ria)
    if (expiringItems.length > 0) {
      await sendExpiryWarningEmail(expiringItems);
    }

    // Email 2: nÃ¡kupnÃ½ zoznam (do 14 dnÃ­) â€“ s oneskorenÃ­m aby neiÅ¡li sÃºÄasne
    if (criticalItems.length > 0) {
      setTimeout(() => sendShoppingListEmail(criticalItems), 3000);
    }
  }

  // UI funkcia â€“ manuÃ¡lne odoslanie z appky (tlaÄidlo)
  async function sendTestNotification() {
    if (isDemo) {
      alert("V demo reÅ¾ime nie sÃº emailovÃ© notifikÃ¡cie dostupnÃ©. Vytvorte si ÃºÄet zadarmo pre plnÃº funkcionalitu.");
      return;
    }
    const btn = document.getElementById("btnTestEmail");
    if (btn) { btn.disabled = true; btn.textContent = "Odosielam..."; }

    try {
      const expiringItems = getExpiringItems(); // per-category thresholds
      const criticalItems = getExpiringItems(NOTIFY_SHOPPING_DAYS);

      if (!expiringItems.length && !criticalItems.length) {
        alert("Å½iadne poloÅ¾ky s blÃ­Å¾iacou sa expirÃ¡ciou. Pridajte poloÅ¾ky s dÃ¡tumom expirÃ¡cie.");
        return;
      }

      // ObÃ­de cooldown pre testovanie
      if (EMAILJS_CONFIG.publicKey !== "YOUR_EMAILJS_PUBLIC_KEY") {
        await emailjs.send(EMAILJS_CONFIG.serviceId, EMAILJS_CONFIG.template_expiry, {
          to_email:   currentUser.email,
          to_name:    currentUser.displayName?.split(" ")[0] || "pouÅ¾Ã­vateÄ¾",
          item_count: expiringItems.length,
          items_text: expiringItems.map(it => `â€¢ ${it.name} (${it.catName}) â€“ expiruje ${it.expiry}`).join("\n"),
          items_html: formatItemsHtml(expiringItems),
          app_url:    window.location.href,
          subject:    "Gerlach: Test emailovej notifikÃ¡cie"
        });
        alert(`âœ… TestovacÃ­ email odoslanÃ½ na ${currentUser.email}`);
      } else {
        alert("EmailJS nie je nakonfigurovanÃ½. Pozri komentÃ¡re v kÃ³de.");
      }
    } catch(e) {
      alert("Chyba pri odosielanÃ­: " + (e.text || e.message || e));
    } finally {
      if (btn) { btn.disabled = false; btn.textContent = "TestovacÃ­ email"; }
    }
  }

  // ZavrieÅ¥ user menu pri kliknutÃ­ mimo
  document.addEventListener("click", (e) => {
    const menu = document.getElementById("userMenu");
    const avatar = document.getElementById("userAvatar");
    if (menu && !menu.contains(e.target) && e.target !== avatar) {
      menu.classList.remove("open");
    }
  });

  // Dynamic year
  document.querySelectorAll('.js-year').forEach(el => { el.textContent = new Date().getFullYear(); });

</script>

<!-- Cookie Banner -->
<div class="cookie-banner" id="cookieBanner" role="dialog" aria-label="InformÃ¡cia o cookies">
  <div class="cookie-banner-inner">
    <div class="cookie-banner-text">
      PouÅ¾Ã­vame <strong style="font-weight:500;color:#fff;">nevyhnutnÃ© cookies</strong> na prihlÃ¡senie a <strong style="font-weight:500;color:#fff;">analytickÃ© cookies</strong> (Firebase Analytics) na zlepÅ¡ovanie aplikÃ¡cie. AnalytickÃ© cookies aktivujeme len s vaÅ¡Ã­m sÃºhlasom.
      <a href="./pravne-info.html#cookies">Podrobnosti</a>
    </div>
    <div class="cookie-banner-actions">
      <button class="cookie-btn cookie-btn-accept" onclick="acceptAllCookies()">PrijaÅ¥ vÅ¡etko</button>
      <button class="cookie-btn cookie-btn-info" onclick="acceptNecessaryOnly()">Len nevyhnutnÃ©</button>
    </div>
  </div>
</div>
<script>
  (function() {
    // Ak pouÅ¾Ã­vateÄ¾ eÅ¡te nerozhodol â†’ ukÃ¡Å¾ banner
    if (!localStorage.getItem('gerlach_cookie_consent')) {
      setTimeout(function() {
        document.getElementById('cookieBanner').classList.add('show');
      }, 1500);
    }
  })();
  function acceptAllCookies() {
    localStorage.setItem('gerlach_cookie_consent', 'all');
    if (typeof window.enableAnalytics === 'function') window.enableAnalytics();
    document.getElementById('cookieBanner').classList.remove('show');
  }
  function acceptNecessaryOnly() {
    localStorage.setItem('gerlach_cookie_consent', 'necessary');
    if (typeof window.disableAnalytics === 'function') window.disableAnalytics();
    document.getElementById('cookieBanner').classList.remove('show');
  }
</script>
</body>
</html>
